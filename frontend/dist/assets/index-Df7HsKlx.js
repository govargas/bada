var mw=Object.defineProperty;var Kv=n=>{throw TypeError(n)};var gw=(n,o,u)=>o in n?mw(n,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[o]=u;var Xv=(n,o,u)=>gw(n,typeof o!="symbol"?o+"":o,u),Ty=(n,o,u)=>o.has(n)||Kv("Cannot "+u);var _e=(n,o,u)=>(Ty(n,o,"read from private field"),u?u.call(n):o.get(n)),Wt=(n,o,u)=>o.has(n)?Kv("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(n):o.set(n,u),Mt=(n,o,u,m)=>(Ty(n,o,"write to private field"),m?m.call(n,u):o.set(n,u),u),wr=(n,o,u)=>(Ty(n,o,"access private method"),u);var ag=(n,o,u,m)=>({set _(b){Mt(n,o,b,u)},get _(){return _e(n,o,m)}});(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))m(b);new MutationObserver(b=>{for(const P of b)if(P.type==="childList")for(const w of P.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&m(w)}).observe(document,{childList:!0,subtree:!0});function u(b){const P={};return b.integrity&&(P.integrity=b.integrity),b.referrerPolicy&&(P.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?P.credentials="include":b.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function m(b){if(b.ep)return;b.ep=!0;const P=u(b);fetch(b.href,P)}})();function k_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Py={exports:{}},Bp={},Cy={exports:{}},Gr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yv;function yw(){if(Yv)return Gr;Yv=1;var n=Symbol.for("react.element"),o=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),w=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),B=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),G=Symbol.iterator;function te(Me){return Me===null||typeof Me!="object"?null:(Me=G&&Me[G]||Me["@@iterator"],typeof Me=="function"?Me:null)}var q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Se=Object.assign,ye={};function fe(Me,Ye,jt){this.props=Me,this.context=Ye,this.refs=ye,this.updater=jt||q}fe.prototype.isReactComponent={},fe.prototype.setState=function(Me,Ye){if(typeof Me!="object"&&typeof Me!="function"&&Me!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Me,Ye,"setState")},fe.prototype.forceUpdate=function(Me){this.updater.enqueueForceUpdate(this,Me,"forceUpdate")};function Fe(){}Fe.prototype=fe.prototype;function Ce(Me,Ye,jt){this.props=Me,this.context=Ye,this.refs=ye,this.updater=jt||q}var Ie=Ce.prototype=new Fe;Ie.constructor=Ce,Se(Ie,fe.prototype),Ie.isPureReactComponent=!0;var Le=Array.isArray,Xe=Object.prototype.hasOwnProperty,mt={current:null},yt={key:!0,ref:!0,__self:!0,__source:!0};function Qe(Me,Ye,jt){var tr,fr={},Kt=null,Lr=null;if(Ye!=null)for(tr in Ye.ref!==void 0&&(Lr=Ye.ref),Ye.key!==void 0&&(Kt=""+Ye.key),Ye)Xe.call(Ye,tr)&&!yt.hasOwnProperty(tr)&&(fr[tr]=Ye[tr]);var sr=arguments.length-2;if(sr===1)fr.children=jt;else if(1<sr){for(var yr=Array(sr),lr=0;lr<sr;lr++)yr[lr]=arguments[lr+2];fr.children=yr}if(Me&&Me.defaultProps)for(tr in sr=Me.defaultProps,sr)fr[tr]===void 0&&(fr[tr]=sr[tr]);return{$$typeof:n,type:Me,key:Kt,ref:Lr,props:fr,_owner:mt.current}}function it(Me,Ye){return{$$typeof:n,type:Me.type,key:Ye,ref:Me.ref,props:Me.props,_owner:Me._owner}}function at(Me){return typeof Me=="object"&&Me!==null&&Me.$$typeof===n}function It(Me){var Ye={"=":"=0",":":"=2"};return"$"+Me.replace(/[=:]/g,function(jt){return Ye[jt]})}var Rt=/\/+/g;function At(Me,Ye){return typeof Me=="object"&&Me!==null&&Me.key!=null?It(""+Me.key):Ye.toString(36)}function Ht(Me,Ye,jt,tr,fr){var Kt=typeof Me;(Kt==="undefined"||Kt==="boolean")&&(Me=null);var Lr=!1;if(Me===null)Lr=!0;else switch(Kt){case"string":case"number":Lr=!0;break;case"object":switch(Me.$$typeof){case n:case o:Lr=!0}}if(Lr)return Lr=Me,fr=fr(Lr),Me=tr===""?"."+At(Lr,0):tr,Le(fr)?(jt="",Me!=null&&(jt=Me.replace(Rt,"$&/")+"/"),Ht(fr,Ye,jt,"",function(lr){return lr})):fr!=null&&(at(fr)&&(fr=it(fr,jt+(!fr.key||Lr&&Lr.key===fr.key?"":(""+fr.key).replace(Rt,"$&/")+"/")+Me)),Ye.push(fr)),1;if(Lr=0,tr=tr===""?".":tr+":",Le(Me))for(var sr=0;sr<Me.length;sr++){Kt=Me[sr];var yr=tr+At(Kt,sr);Lr+=Ht(Kt,Ye,jt,yr,fr)}else if(yr=te(Me),typeof yr=="function")for(Me=yr.call(Me),sr=0;!(Kt=Me.next()).done;)Kt=Kt.value,yr=tr+At(Kt,sr++),Lr+=Ht(Kt,Ye,jt,yr,fr);else if(Kt==="object")throw Ye=String(Me),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(Me).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.");return Lr}function Rr(Me,Ye,jt){if(Me==null)return Me;var tr=[],fr=0;return Ht(Me,tr,"","",function(Kt){return Ye.call(jt,Kt,fr++)}),tr}function ar(Me){if(Me._status===-1){var Ye=Me._result;Ye=Ye(),Ye.then(function(jt){(Me._status===0||Me._status===-1)&&(Me._status=1,Me._result=jt)},function(jt){(Me._status===0||Me._status===-1)&&(Me._status=2,Me._result=jt)}),Me._status===-1&&(Me._status=0,Me._result=Ye)}if(Me._status===1)return Me._result.default;throw Me._result}var Zt={current:null},_t={transition:null},ht={ReactCurrentDispatcher:Zt,ReactCurrentBatchConfig:_t,ReactCurrentOwner:mt};function Ct(){throw Error("act(...) is not supported in production builds of React.")}return Gr.Children={map:Rr,forEach:function(Me,Ye,jt){Rr(Me,function(){Ye.apply(this,arguments)},jt)},count:function(Me){var Ye=0;return Rr(Me,function(){Ye++}),Ye},toArray:function(Me){return Rr(Me,function(Ye){return Ye})||[]},only:function(Me){if(!at(Me))throw Error("React.Children.only expected to receive a single React element child.");return Me}},Gr.Component=fe,Gr.Fragment=u,Gr.Profiler=b,Gr.PureComponent=Ce,Gr.StrictMode=m,Gr.Suspense=L,Gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ht,Gr.act=Ct,Gr.cloneElement=function(Me,Ye,jt){if(Me==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Me+".");var tr=Se({},Me.props),fr=Me.key,Kt=Me.ref,Lr=Me._owner;if(Ye!=null){if(Ye.ref!==void 0&&(Kt=Ye.ref,Lr=mt.current),Ye.key!==void 0&&(fr=""+Ye.key),Me.type&&Me.type.defaultProps)var sr=Me.type.defaultProps;for(yr in Ye)Xe.call(Ye,yr)&&!yt.hasOwnProperty(yr)&&(tr[yr]=Ye[yr]===void 0&&sr!==void 0?sr[yr]:Ye[yr])}var yr=arguments.length-2;if(yr===1)tr.children=jt;else if(1<yr){sr=Array(yr);for(var lr=0;lr<yr;lr++)sr[lr]=arguments[lr+2];tr.children=sr}return{$$typeof:n,type:Me.type,key:fr,ref:Kt,props:tr,_owner:Lr}},Gr.createContext=function(Me){return Me={$$typeof:w,_currentValue:Me,_currentValue2:Me,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Me.Provider={$$typeof:P,_context:Me},Me.Consumer=Me},Gr.createElement=Qe,Gr.createFactory=function(Me){var Ye=Qe.bind(null,Me);return Ye.type=Me,Ye},Gr.createRef=function(){return{current:null}},Gr.forwardRef=function(Me){return{$$typeof:l,render:Me}},Gr.isValidElement=at,Gr.lazy=function(Me){return{$$typeof:V,_payload:{_status:-1,_result:Me},_init:ar}},Gr.memo=function(Me,Ye){return{$$typeof:B,type:Me,compare:Ye===void 0?null:Ye}},Gr.startTransition=function(Me){var Ye=_t.transition;_t.transition={};try{Me()}finally{_t.transition=Ye}},Gr.unstable_act=Ct,Gr.useCallback=function(Me,Ye){return Zt.current.useCallback(Me,Ye)},Gr.useContext=function(Me){return Zt.current.useContext(Me)},Gr.useDebugValue=function(){},Gr.useDeferredValue=function(Me){return Zt.current.useDeferredValue(Me)},Gr.useEffect=function(Me,Ye){return Zt.current.useEffect(Me,Ye)},Gr.useId=function(){return Zt.current.useId()},Gr.useImperativeHandle=function(Me,Ye,jt){return Zt.current.useImperativeHandle(Me,Ye,jt)},Gr.useInsertionEffect=function(Me,Ye){return Zt.current.useInsertionEffect(Me,Ye)},Gr.useLayoutEffect=function(Me,Ye){return Zt.current.useLayoutEffect(Me,Ye)},Gr.useMemo=function(Me,Ye){return Zt.current.useMemo(Me,Ye)},Gr.useReducer=function(Me,Ye,jt){return Zt.current.useReducer(Me,Ye,jt)},Gr.useRef=function(Me){return Zt.current.useRef(Me)},Gr.useState=function(Me){return Zt.current.useState(Me)},Gr.useSyncExternalStore=function(Me,Ye,jt){return Zt.current.useSyncExternalStore(Me,Ye,jt)},Gr.useTransition=function(){return Zt.current.useTransition()},Gr.version="18.3.1",Gr}var Qv;function M_(){return Qv||(Qv=1,Cy.exports=yw()),Cy.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jv;function _w(){if(Jv)return Bp;Jv=1;var n=M_(),o=Symbol.for("react.element"),u=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,b=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,P={key:!0,ref:!0,__self:!0,__source:!0};function w(l,L,B){var V,G={},te=null,q=null;B!==void 0&&(te=""+B),L.key!==void 0&&(te=""+L.key),L.ref!==void 0&&(q=L.ref);for(V in L)m.call(L,V)&&!P.hasOwnProperty(V)&&(G[V]=L[V]);if(l&&l.defaultProps)for(V in L=l.defaultProps,L)G[V]===void 0&&(G[V]=L[V]);return{$$typeof:o,type:l,key:te,ref:q,props:G,_owner:b.current}}return Bp.Fragment=u,Bp.jsx=w,Bp.jsxs=w,Bp}var ex;function vw(){return ex||(ex=1,Py.exports=_w()),Py.exports}var J=vw(),ee=M_();const hn=k_(ee);var lg={},Ey={exports:{}},Po={},ky={exports:{}},My={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tx;function xw(){return tx||(tx=1,(function(n){function o(_t,ht){var Ct=_t.length;_t.push(ht);e:for(;0<Ct;){var Me=Ct-1>>>1,Ye=_t[Me];if(0<b(Ye,ht))_t[Me]=ht,_t[Ct]=Ye,Ct=Me;else break e}}function u(_t){return _t.length===0?null:_t[0]}function m(_t){if(_t.length===0)return null;var ht=_t[0],Ct=_t.pop();if(Ct!==ht){_t[0]=Ct;e:for(var Me=0,Ye=_t.length,jt=Ye>>>1;Me<jt;){var tr=2*(Me+1)-1,fr=_t[tr],Kt=tr+1,Lr=_t[Kt];if(0>b(fr,Ct))Kt<Ye&&0>b(Lr,fr)?(_t[Me]=Lr,_t[Kt]=Ct,Me=Kt):(_t[Me]=fr,_t[tr]=Ct,Me=tr);else if(Kt<Ye&&0>b(Lr,Ct))_t[Me]=Lr,_t[Kt]=Ct,Me=Kt;else break e}}return ht}function b(_t,ht){var Ct=_t.sortIndex-ht.sortIndex;return Ct!==0?Ct:_t.id-ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var P=performance;n.unstable_now=function(){return P.now()}}else{var w=Date,l=w.now();n.unstable_now=function(){return w.now()-l}}var L=[],B=[],V=1,G=null,te=3,q=!1,Se=!1,ye=!1,fe=typeof setTimeout=="function"?setTimeout:null,Fe=typeof clearTimeout=="function"?clearTimeout:null,Ce=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ie(_t){for(var ht=u(B);ht!==null;){if(ht.callback===null)m(B);else if(ht.startTime<=_t)m(B),ht.sortIndex=ht.expirationTime,o(L,ht);else break;ht=u(B)}}function Le(_t){if(ye=!1,Ie(_t),!Se)if(u(L)!==null)Se=!0,ar(Xe);else{var ht=u(B);ht!==null&&Zt(Le,ht.startTime-_t)}}function Xe(_t,ht){Se=!1,ye&&(ye=!1,Fe(Qe),Qe=-1),q=!0;var Ct=te;try{for(Ie(ht),G=u(L);G!==null&&(!(G.expirationTime>ht)||_t&&!It());){var Me=G.callback;if(typeof Me=="function"){G.callback=null,te=G.priorityLevel;var Ye=Me(G.expirationTime<=ht);ht=n.unstable_now(),typeof Ye=="function"?G.callback=Ye:G===u(L)&&m(L),Ie(ht)}else m(L);G=u(L)}if(G!==null)var jt=!0;else{var tr=u(B);tr!==null&&Zt(Le,tr.startTime-ht),jt=!1}return jt}finally{G=null,te=Ct,q=!1}}var mt=!1,yt=null,Qe=-1,it=5,at=-1;function It(){return!(n.unstable_now()-at<it)}function Rt(){if(yt!==null){var _t=n.unstable_now();at=_t;var ht=!0;try{ht=yt(!0,_t)}finally{ht?At():(mt=!1,yt=null)}}else mt=!1}var At;if(typeof Ce=="function")At=function(){Ce(Rt)};else if(typeof MessageChannel<"u"){var Ht=new MessageChannel,Rr=Ht.port2;Ht.port1.onmessage=Rt,At=function(){Rr.postMessage(null)}}else At=function(){fe(Rt,0)};function ar(_t){yt=_t,mt||(mt=!0,At())}function Zt(_t,ht){Qe=fe(function(){_t(n.unstable_now())},ht)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(_t){_t.callback=null},n.unstable_continueExecution=function(){Se||q||(Se=!0,ar(Xe))},n.unstable_forceFrameRate=function(_t){0>_t||125<_t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<_t?Math.floor(1e3/_t):5},n.unstable_getCurrentPriorityLevel=function(){return te},n.unstable_getFirstCallbackNode=function(){return u(L)},n.unstable_next=function(_t){switch(te){case 1:case 2:case 3:var ht=3;break;default:ht=te}var Ct=te;te=ht;try{return _t()}finally{te=Ct}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(_t,ht){switch(_t){case 1:case 2:case 3:case 4:case 5:break;default:_t=3}var Ct=te;te=_t;try{return ht()}finally{te=Ct}},n.unstable_scheduleCallback=function(_t,ht,Ct){var Me=n.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?Me+Ct:Me):Ct=Me,_t){case 1:var Ye=-1;break;case 2:Ye=250;break;case 5:Ye=1073741823;break;case 4:Ye=1e4;break;default:Ye=5e3}return Ye=Ct+Ye,_t={id:V++,callback:ht,priorityLevel:_t,startTime:Ct,expirationTime:Ye,sortIndex:-1},Ct>Me?(_t.sortIndex=Ct,o(B,_t),u(L)===null&&_t===u(B)&&(ye?(Fe(Qe),Qe=-1):ye=!0,Zt(Le,Ct-Me))):(_t.sortIndex=Ye,o(L,_t),Se||q||(Se=!0,ar(Xe))),_t},n.unstable_shouldYield=It,n.unstable_wrapCallback=function(_t){var ht=te;return function(){var Ct=te;te=ht;try{return _t.apply(this,arguments)}finally{te=Ct}}}})(My)),My}var rx;function bw(){return rx||(rx=1,ky.exports=xw()),ky.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nx;function ww(){if(nx)return Po;nx=1;var n=M_(),o=bw();function u(a){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+a,x=1;x<arguments.length;x++)d+="&args[]="+encodeURIComponent(arguments[x]);return"Minified React error #"+a+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var m=new Set,b={};function P(a,d){w(a,d),w(a+"Capture",d)}function w(a,d){for(b[a]=d,a=0;a<d.length;a++)m.add(d[a])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),L=Object.prototype.hasOwnProperty,B=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,V={},G={};function te(a){return L.call(G,a)?!0:L.call(V,a)?!1:B.test(a)?G[a]=!0:(V[a]=!0,!1)}function q(a,d,x,C){if(x!==null&&x.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return C?!1:x!==null?!x.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function Se(a,d,x,C){if(d===null||typeof d>"u"||q(a,d,x,C))return!0;if(C)return!1;if(x!==null)switch(x.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function ye(a,d,x,C,z,O,Q){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=C,this.attributeNamespace=z,this.mustUseProperty=x,this.propertyName=a,this.type=d,this.sanitizeURL=O,this.removeEmptyString=Q}var fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){fe[a]=new ye(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var d=a[0];fe[d]=new ye(d,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){fe[a]=new ye(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){fe[a]=new ye(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){fe[a]=new ye(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){fe[a]=new ye(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){fe[a]=new ye(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){fe[a]=new ye(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){fe[a]=new ye(a,5,!1,a.toLowerCase(),null,!1,!1)});var Fe=/[\-:]([a-z])/g;function Ce(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var d=a.replace(Fe,Ce);fe[d]=new ye(d,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var d=a.replace(Fe,Ce);fe[d]=new ye(d,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var d=a.replace(Fe,Ce);fe[d]=new ye(d,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){fe[a]=new ye(a,1,!1,a.toLowerCase(),null,!1,!1)}),fe.xlinkHref=new ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){fe[a]=new ye(a,1,!1,a.toLowerCase(),null,!0,!0)});function Ie(a,d,x,C){var z=fe.hasOwnProperty(d)?fe[d]:null;(z!==null?z.type!==0:C||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(Se(d,x,z,C)&&(x=null),C||z===null?te(d)&&(x===null?a.removeAttribute(d):a.setAttribute(d,""+x)):z.mustUseProperty?a[z.propertyName]=x===null?z.type===3?!1:"":x:(d=z.attributeName,C=z.attributeNamespace,x===null?a.removeAttribute(d):(z=z.type,x=z===3||z===4&&x===!0?"":""+x,C?a.setAttributeNS(C,d,x):a.setAttribute(d,x))))}var Le=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xe=Symbol.for("react.element"),mt=Symbol.for("react.portal"),yt=Symbol.for("react.fragment"),Qe=Symbol.for("react.strict_mode"),it=Symbol.for("react.profiler"),at=Symbol.for("react.provider"),It=Symbol.for("react.context"),Rt=Symbol.for("react.forward_ref"),At=Symbol.for("react.suspense"),Ht=Symbol.for("react.suspense_list"),Rr=Symbol.for("react.memo"),ar=Symbol.for("react.lazy"),Zt=Symbol.for("react.offscreen"),_t=Symbol.iterator;function ht(a){return a===null||typeof a!="object"?null:(a=_t&&a[_t]||a["@@iterator"],typeof a=="function"?a:null)}var Ct=Object.assign,Me;function Ye(a){if(Me===void 0)try{throw Error()}catch(x){var d=x.stack.trim().match(/\n( *(at )?)/);Me=d&&d[1]||""}return`
`+Me+a}var jt=!1;function tr(a,d){if(!a||jt)return"";jt=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(He){var C=He}Reflect.construct(a,[],d)}else{try{d.call()}catch(He){C=He}a.call(d.prototype)}else{try{throw Error()}catch(He){C=He}a()}}catch(He){if(He&&C&&typeof He.stack=="string"){for(var z=He.stack.split(`
`),O=C.stack.split(`
`),Q=z.length-1,me=O.length-1;1<=Q&&0<=me&&z[Q]!==O[me];)me--;for(;1<=Q&&0<=me;Q--,me--)if(z[Q]!==O[me]){if(Q!==1||me!==1)do if(Q--,me--,0>me||z[Q]!==O[me]){var ke=`
`+z[Q].replace(" at new "," at ");return a.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",a.displayName)),ke}while(1<=Q&&0<=me);break}}}finally{jt=!1,Error.prepareStackTrace=x}return(a=a?a.displayName||a.name:"")?Ye(a):""}function fr(a){switch(a.tag){case 5:return Ye(a.type);case 16:return Ye("Lazy");case 13:return Ye("Suspense");case 19:return Ye("SuspenseList");case 0:case 2:case 15:return a=tr(a.type,!1),a;case 11:return a=tr(a.type.render,!1),a;case 1:return a=tr(a.type,!0),a;default:return""}}function Kt(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case yt:return"Fragment";case mt:return"Portal";case it:return"Profiler";case Qe:return"StrictMode";case At:return"Suspense";case Ht:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case It:return(a.displayName||"Context")+".Consumer";case at:return(a._context.displayName||"Context")+".Provider";case Rt:var d=a.render;return a=a.displayName,a||(a=d.displayName||d.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Rr:return d=a.displayName||null,d!==null?d:Kt(a.type)||"Memo";case ar:d=a._payload,a=a._init;try{return Kt(a(d))}catch{}}return null}function Lr(a){var d=a.type;switch(a.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=d.render,a=a.displayName||a.name||"",d.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Kt(d);case 8:return d===Qe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function sr(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function yr(a){var d=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function lr(a){var d=yr(a)?"checked":"value",x=Object.getOwnPropertyDescriptor(a.constructor.prototype,d),C=""+a[d];if(!a.hasOwnProperty(d)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var z=x.get,O=x.set;return Object.defineProperty(a,d,{configurable:!0,get:function(){return z.call(this)},set:function(Q){C=""+Q,O.call(this,Q)}}),Object.defineProperty(a,d,{enumerable:x.enumerable}),{getValue:function(){return C},setValue:function(Q){C=""+Q},stopTracking:function(){a._valueTracker=null,delete a[d]}}}}function ci(a){a._valueTracker||(a._valueTracker=lr(a))}function ln(a){if(!a)return!1;var d=a._valueTracker;if(!d)return!0;var x=d.getValue(),C="";return a&&(C=yr(a)?a.checked?"true":"false":a.value),a=C,a!==x?(d.setValue(a),!0):!1}function Vr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Nr(a,d){var x=d.checked;return Ct({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:x??a._wrapperState.initialChecked})}function Cn(a,d){var x=d.defaultValue==null?"":d.defaultValue,C=d.checked!=null?d.checked:d.defaultChecked;x=sr(d.value!=null?d.value:x),a._wrapperState={initialChecked:C,initialValue:x,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function jn(a,d){d=d.checked,d!=null&&Ie(a,"checked",d,!1)}function Xi(a,d){jn(a,d);var x=sr(d.value),C=d.type;if(x!=null)C==="number"?(x===0&&a.value===""||a.value!=x)&&(a.value=""+x):a.value!==""+x&&(a.value=""+x);else if(C==="submit"||C==="reset"){a.removeAttribute("value");return}d.hasOwnProperty("value")?Zn(a,d.type,x):d.hasOwnProperty("defaultValue")&&Zn(a,d.type,sr(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(a.defaultChecked=!!d.defaultChecked)}function zi(a,d,x){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var C=d.type;if(!(C!=="submit"&&C!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+a._wrapperState.initialValue,x||d===a.value||(a.value=d),a.defaultValue=d}x=a.name,x!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,x!==""&&(a.name=x)}function Zn(a,d,x){(d!=="number"||Vr(a.ownerDocument)!==a)&&(x==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+x&&(a.defaultValue=""+x))}var xe=Array.isArray;function Be(a,d,x,C){if(a=a.options,d){d={};for(var z=0;z<x.length;z++)d["$"+x[z]]=!0;for(x=0;x<a.length;x++)z=d.hasOwnProperty("$"+a[x].value),a[x].selected!==z&&(a[x].selected=z),z&&C&&(a[x].defaultSelected=!0)}else{for(x=""+sr(x),d=null,z=0;z<a.length;z++){if(a[z].value===x){a[z].selected=!0,C&&(a[z].defaultSelected=!0);return}d!==null||a[z].disabled||(d=a[z])}d!==null&&(d.selected=!0)}}function Ke(a,d){if(d.dangerouslySetInnerHTML!=null)throw Error(u(91));return Ct({},d,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function kt(a,d){var x=d.value;if(x==null){if(x=d.children,d=d.defaultValue,x!=null){if(d!=null)throw Error(u(92));if(xe(x)){if(1<x.length)throw Error(u(93));x=x[0]}d=x}d==null&&(d=""),x=d}a._wrapperState={initialValue:sr(x)}}function vt(a,d){var x=sr(d.value),C=sr(d.defaultValue);x!=null&&(x=""+x,x!==a.value&&(a.value=x),d.defaultValue==null&&a.defaultValue!==x&&(a.defaultValue=x)),C!=null&&(a.defaultValue=""+C)}function pt(a){var d=a.textContent;d===a._wrapperState.initialValue&&d!==""&&d!==null&&(a.value=d)}function Bt(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _r(a,d){return a==null||a==="http://www.w3.org/1999/xhtml"?Bt(d):a==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Sr,Te=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,x,C,z){MSApp.execUnsafeLocalFunction(function(){return a(d,x,C,z)})}:a})(function(a,d){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=d;else{for(Sr=Sr||document.createElement("div"),Sr.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Sr.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}});function K(a,d){if(d){var x=a.firstChild;if(x&&x===a.lastChild&&x.nodeType===3){x.nodeValue=d;return}}a.textContent=d}var X={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ne=["Webkit","ms","Moz","O"];Object.keys(X).forEach(function(a){ne.forEach(function(d){d=d+a.charAt(0).toUpperCase()+a.substring(1),X[d]=X[a]})});function ue(a,d,x){return d==null||typeof d=="boolean"||d===""?"":x||typeof d!="number"||d===0||X.hasOwnProperty(a)&&X[a]?(""+d).trim():d+"px"}function ve(a,d){a=a.style;for(var x in d)if(d.hasOwnProperty(x)){var C=x.indexOf("--")===0,z=ue(x,d[x],C);x==="float"&&(x="cssFloat"),C?a.setProperty(x,z):a[x]=z}}var Ae=Ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Oe(a,d){if(d){if(Ae[a]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(u(137,a));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(u(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(u(61))}if(d.style!=null&&typeof d.style!="object")throw Error(u(62))}}function ze(a,d){if(a.indexOf("-")===-1)return typeof d.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qe=null;function rt(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Je=null,zt=null,Pe=null;function $t(a){if(a=Vl(a)){if(typeof Je!="function")throw Error(u(280));var d=a.stateNode;d&&(d=Fc(d),Je(a.stateNode,a.type,d))}}function rr(a){zt?Pe?Pe.push(a):Pe=[a]:zt=a}function Dt(){if(zt){var a=zt,d=Pe;if(Pe=zt=null,$t(a),d)for(a=0;a<d.length;a++)$t(d[a])}}function Xt(a,d){return a(d)}function Cr(){}var Kr=!1;function dn(a,d,x){if(Kr)return a(d,x);Kr=!0;try{return Xt(a,d,x)}finally{Kr=!1,(zt!==null||Pe!==null)&&(Cr(),Dt())}}function Tr(a,d){var x=a.stateNode;if(x===null)return null;var C=Fc(x);if(C===null)return null;x=C[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(a=a.type,C=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!C;break e;default:a=!1}if(a)return null;if(x&&typeof x!="function")throw Error(u(231,d,typeof x));return x}var cr=!1;if(l)try{var or={};Object.defineProperty(or,"passive",{get:function(){cr=!0}}),window.addEventListener("test",or,or),window.removeEventListener("test",or,or)}catch{cr=!1}function en(a,d,x,C,z,O,Q,me,ke){var He=Array.prototype.slice.call(arguments,3);try{d.apply(x,He)}catch(ut){this.onError(ut)}}var st=!1,_n=null,$r=!1,vi=null,ao={onError:function(a){st=!0,_n=a}};function Pt(a,d,x,C,z,O,Q,me,ke){st=!1,_n=null,en.apply(ao,arguments)}function Dr(a,d,x,C,z,O,Q,me,ke){if(Pt.apply(this,arguments),st){if(st){var He=_n;st=!1,_n=null}else throw Error(u(198));$r||($r=!0,vi=He)}}function pr(a){var d=a,x=a;if(a.alternate)for(;d.return;)d=d.return;else{a=d;do d=a,(d.flags&4098)!==0&&(x=d.return),a=d.return;while(a)}return d.tag===3?x:null}function ti(a){if(a.tag===13){var d=a.memoizedState;if(d===null&&(a=a.alternate,a!==null&&(d=a.memoizedState)),d!==null)return d.dehydrated}return null}function aa(a){if(pr(a)!==a)throw Error(u(188))}function la(a){var d=a.alternate;if(!d){if(d=pr(a),d===null)throw Error(u(188));return d!==a?null:a}for(var x=a,C=d;;){var z=x.return;if(z===null)break;var O=z.alternate;if(O===null){if(C=z.return,C!==null){x=C;continue}break}if(z.child===O.child){for(O=z.child;O;){if(O===x)return aa(z),a;if(O===C)return aa(z),d;O=O.sibling}throw Error(u(188))}if(x.return!==C.return)x=z,C=O;else{for(var Q=!1,me=z.child;me;){if(me===x){Q=!0,x=z,C=O;break}if(me===C){Q=!0,C=z,x=O;break}me=me.sibling}if(!Q){for(me=O.child;me;){if(me===x){Q=!0,x=O,C=z;break}if(me===C){Q=!0,C=O,x=z;break}me=me.sibling}if(!Q)throw Error(u(189))}}if(x.alternate!==C)throw Error(u(190))}if(x.tag!==3)throw Error(u(188));return x.stateNode.current===x?a:d}function xr(a){return a=la(a),a!==null?uc(a):null}function uc(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var d=uc(a);if(d!==null)return d;a=a.sibling}return null}var Io=o.unstable_scheduleCallback,hc=o.unstable_cancelCallback,lo=o.unstable_shouldYield,vl=o.unstable_requestPaint,Er=o.unstable_now,du=o.unstable_getCurrentPriorityLevel,xi=o.unstable_ImmediatePriority,on=o.unstable_UserBlockingPriority,dc=o.unstable_NormalPriority,fc=o.unstable_LowPriority,fu=o.unstable_IdlePriority,Ns=null,ui=null;function gh(a){if(ui&&typeof ui.onCommitFiberRoot=="function")try{ui.onCommitFiberRoot(Ns,a,void 0,(a.current.flags&128)===128)}catch{}}var Es=Math.clz32?Math.clz32:Vd,Ud=Math.log,xl=Math.LN2;function Vd(a){return a>>>=0,a===0?32:31-(Ud(a)/xl|0)|0}var pu=64,mu=4194304;function pc(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function bl(a,d){var x=a.pendingLanes;if(x===0)return 0;var C=0,z=a.suspendedLanes,O=a.pingedLanes,Q=x&268435455;if(Q!==0){var me=Q&~z;me!==0?C=pc(me):(O&=Q,O!==0&&(C=pc(O)))}else Q=x&~z,Q!==0?C=pc(Q):O!==0&&(C=pc(O));if(C===0)return 0;if(d!==0&&d!==C&&(d&z)===0&&(z=C&-C,O=d&-d,z>=O||z===16&&(O&4194240)!==0))return d;if((C&4)!==0&&(C|=x&16),d=a.entangledLanes,d!==0)for(a=a.entanglements,d&=C;0<d;)x=31-Es(d),z=1<<x,C|=a[x],d&=~z;return C}function wl(a,d){switch(a){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yh(a,d){for(var x=a.suspendedLanes,C=a.pingedLanes,z=a.expirationTimes,O=a.pendingLanes;0<O;){var Q=31-Es(O),me=1<<Q,ke=z[Q];ke===-1?((me&x)===0||(me&C)!==0)&&(z[Q]=wl(me,d)):ke<=d&&(a.expiredLanes|=me),O&=~me}}function mc(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function Oa(){var a=pu;return pu<<=1,(pu&4194240)===0&&(pu=64),a}function gc(a){for(var d=[],x=0;31>x;x++)d.push(a);return d}function ja(a,d,x){a.pendingLanes|=d,d!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,d=31-Es(d),a[d]=x}function Yf(a,d){var x=a.pendingLanes&~d;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=d,a.mutableReadLanes&=d,a.entangledLanes&=d,d=a.entanglements;var C=a.eventTimes;for(a=a.expirationTimes;0<x;){var z=31-Es(x),O=1<<z;d[z]=0,C[z]=-1,a[z]=-1,x&=~O}}function ca(a,d){var x=a.entangledLanes|=d;for(a=a.entanglements;x;){var C=31-Es(x),z=1<<C;z&d|a[C]&d&&(a[C]|=d),x&=~z}}var qr=0;function ks(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var kr,Ao,zo,co,ua,Pr=!1,uo=[],Bs=null,$s=null,En=null,kn=new Map,Gn=new Map,fn=[],cn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _h(a,d){switch(a){case"focusin":case"focusout":Bs=null;break;case"dragenter":case"dragleave":$s=null;break;case"mouseover":case"mouseout":En=null;break;case"pointerover":case"pointerout":kn.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gn.delete(d.pointerId)}}function qn(a,d,x,C,z,O){return a===null||a.nativeEvent!==O?(a={blockedOn:d,domEventName:x,eventSystemFlags:C,nativeEvent:O,targetContainers:[z]},d!==null&&(d=Vl(d),d!==null&&Ao(d)),a):(a.eventSystemFlags|=C,d=a.targetContainers,z!==null&&d.indexOf(z)===-1&&d.push(z),a)}function ds(a,d,x,C,z){switch(d){case"focusin":return Bs=qn(Bs,a,d,x,C,z),!0;case"dragenter":return $s=qn($s,a,d,x,C,z),!0;case"mouseover":return En=qn(En,a,d,x,C,z),!0;case"pointerover":var O=z.pointerId;return kn.set(O,qn(kn.get(O)||null,a,d,x,C,z)),!0;case"gotpointercapture":return O=z.pointerId,Gn.set(O,qn(Gn.get(O)||null,a,d,x,C,z)),!0}return!1}function hi(a){var d=Vo(a.target);if(d!==null){var x=pr(d);if(x!==null){if(d=x.tag,d===13){if(d=ti(x),d!==null){a.blockedOn=d,ua(a.priority,function(){zo(x)});return}}else if(d===3&&x.stateNode.current.memoizedState.isDehydrated){a.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}a.blockedOn=null}function an(a){if(a.blockedOn!==null)return!1;for(var d=a.targetContainers;0<d.length;){var x=da(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(x===null){x=a.nativeEvent;var C=new x.constructor(x.type,x);qe=C,x.target.dispatchEvent(C),qe=null}else return d=Vl(x),d!==null&&Ao(d),a.blockedOn=x,!1;d.shift()}return!0}function ha(a,d,x){an(a)&&x.delete(d)}function nr(){Pr=!1,Bs!==null&&an(Bs)&&(Bs=null),$s!==null&&an($s)&&($s=null),En!==null&&an(En)&&(En=null),kn.forEach(ha),Gn.forEach(ha)}function ur(a,d){a.blockedOn===d&&(a.blockedOn=null,Pr||(Pr=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,nr)))}function fs(a){function d(z){return ur(z,a)}if(0<uo.length){ur(uo[0],a);for(var x=1;x<uo.length;x++){var C=uo[x];C.blockedOn===a&&(C.blockedOn=null)}}for(Bs!==null&&ur(Bs,a),$s!==null&&ur($s,a),En!==null&&ur(En,a),kn.forEach(d),Gn.forEach(d),x=0;x<fn.length;x++)C=fn[x],C.blockedOn===a&&(C.blockedOn=null);for(;0<fn.length&&(x=fn[0],x.blockedOn===null);)hi(x),x.blockedOn===null&&fn.shift()}var Mr=Le.ReactCurrentBatchConfig,bi=!0;function ho(a,d,x,C){var z=qr,O=Mr.transition;Mr.transition=null;try{qr=1,Sl(a,d,x,C)}finally{qr=z,Mr.transition=O}}function fo(a,d,x,C){var z=qr,O=Mr.transition;Mr.transition=null;try{qr=4,Sl(a,d,x,C)}finally{qr=z,Mr.transition=O}}function Sl(a,d,x,C){if(bi){var z=da(a,d,x,C);if(z===null)qa(a,d,C,Tl,x),_h(a,C);else if(ds(z,a,d,x,C))C.stopPropagation();else if(_h(a,C),d&4&&-1<cn.indexOf(a)){for(;z!==null;){var O=Vl(z);if(O!==null&&kr(O),O=da(a,d,x,C),O===null&&qa(a,d,C,Tl,x),O===z)break;z=O}z!==null&&C.stopPropagation()}else qa(a,d,C,null,x)}}var Tl=null;function da(a,d,x,C){if(Tl=null,a=rt(C),a=Vo(a),a!==null)if(d=pr(a),d===null)a=null;else if(x=d.tag,x===13){if(a=ti(d),a!==null)return a;a=null}else if(x===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;a=null}else d!==a&&(a=null);return Tl=a,null}function Pl(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(du()){case xi:return 1;case on:return 4;case dc:case fc:return 16;case fu:return 536870912;default:return 16}default:return 16}}var Us=null,Cl=null,Na=null;function Ms(){if(Na)return Na;var a,d=Cl,x=d.length,C,z="value"in Us?Us.value:Us.textContent,O=z.length;for(a=0;a<x&&d[a]===z[a];a++);var Q=x-a;for(C=1;C<=Q&&d[x-C]===z[O-C];C++);return Na=z.slice(a,1<C?1-C:void 0)}function zn(a){var d=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&d===13&&(a=13)):a=d,a===10&&(a=13),32<=a||a===13?a:0}function Ro(){return!0}function El(){return!1}function Wn(a){function d(x,C,z,O,Q){this._reactName=x,this._targetInst=z,this.type=C,this.nativeEvent=O,this.target=Q,this.currentTarget=null;for(var me in a)a.hasOwnProperty(me)&&(x=a[me],this[me]=x?x(O):O[me]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?Ro:El,this.isPropagationStopped=El,this}return Ct(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=Ro)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=Ro)},persist:function(){},isPersistent:Ro}),d}var pn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gu=Wn(pn),Do=Ct({},pn,{view:0,detail:0}),vh=Wn(Do),xh,fa,Rn,pa=Ct({},Do,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Rn&&(Rn&&a.type==="mousemove"?(xh=a.screenX-Rn.screenX,fa=a.screenY-Rn.screenY):fa=xh=0,Rn=a),xh)},movementY:function(a){return"movementY"in a?a.movementY:fa}}),Vs=Wn(pa),yc=Ct({},pa,{dataTransfer:0}),_c=Wn(yc),vc=Ct({},Do,{relatedTarget:0}),ri=Wn(vc),Zd=Ct({},pn,{animationName:0,elapsedTime:0,pseudoElement:0}),yu=Wn(Zd),Qf=Ct({},pn,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),bh=Wn(Qf),Jf=Ct({},pn,{data:0}),Gd=Wn(Jf),_u={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ba={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sh(a){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(a):(a=Ba[a])?!!d[a]:!1}function kl(){return Sh}var Zs=Ct({},Do,{key:function(a){if(a.key){var d=_u[a.key]||a.key;if(d!=="Unidentified")return d}return a.type==="keypress"?(a=zn(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?wh[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kl,charCode:function(a){return a.type==="keypress"?zn(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?zn(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),ep=Wn(Zs),vu=Ct({},pa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ml=Wn(vu),xc=Ct({},Do,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kl}),tp=Wn(xc),xu=Ct({},pn,{propertyName:0,elapsedTime:0,pseudoElement:0}),rp=Wn(xu),$a=Ct({},pa,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),qd=Wn($a),Th=[9,13,27,32],Ph=l&&"CompositionEvent"in window,Il=null;l&&"documentMode"in document&&(Il=document.documentMode);var Ch=l&&"TextEvent"in window&&!Il,Eh=l&&(!Ph||Il&&8<Il&&11>=Il),bc=" ",kh=!1;function Mh(a,d){switch(a){case"keyup":return Th.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ma(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ga=!1;function Ih(a,d){switch(a){case"compositionend":return ma(d);case"keypress":return d.which!==32?null:(kh=!0,bc);case"textInput":return a=d.data,a===bc&&kh?null:a;default:return null}}function wc(a,d){if(ga)return a==="compositionend"||!Ph&&Mh(a,d)?(a=Ms(),Na=Cl=Us=null,ga=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Eh&&d.locale!=="ko"?null:d.data;default:return null}}var np={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Al(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d==="input"?!!np[a.type]:d==="textarea"}function Ah(a,d,x,C){rr(C),d=Ac(d,"onChange"),0<d.length&&(x=new gu("onChange","change",null,x,C),a.push({event:x,listeners:d}))}var Sc=null,zl=null;function Wd(a){Yd(a,0)}function Rl(a){var d=Ha(a);if(ln(d))return a}function zh(a,d){if(a==="change")return d}var Rh=!1;if(l){var Dl;if(l){var Gs="oninput"in document;if(!Gs){var Ur=document.createElement("div");Ur.setAttribute("oninput","return;"),Gs=typeof Ur.oninput=="function"}Dl=Gs}else Dl=!1;Rh=Dl&&(!document.documentMode||9<document.documentMode)}function bu(){Sc&&(Sc.detachEvent("onpropertychange",wu),zl=Sc=null)}function wu(a){if(a.propertyName==="value"&&Rl(zl)){var d=[];Ah(d,zl,a,rt(a)),dn(Wd,d)}}function Hd(a,d,x){a==="focusin"?(bu(),Sc=d,zl=x,Sc.attachEvent("onpropertychange",wu)):a==="focusout"&&bu()}function Dh(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Rl(zl)}function Ua(a,d){if(a==="click")return Rl(d)}function Lh(a,d){if(a==="input"||a==="change")return Rl(d)}function ip(a,d){return a===d&&(a!==0||1/a===1/d)||a!==a&&d!==d}var qs=typeof Object.is=="function"?Object.is:ip;function Tc(a,d){if(qs(a,d))return!0;if(typeof a!="object"||a===null||typeof d!="object"||d===null)return!1;var x=Object.keys(a),C=Object.keys(d);if(x.length!==C.length)return!1;for(C=0;C<x.length;C++){var z=x[C];if(!L.call(d,z)||!qs(a[z],d[z]))return!1}return!0}function Kd(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Fh(a,d){var x=Kd(a);a=0;for(var C;x;){if(x.nodeType===3){if(C=a+x.textContent.length,a<=d&&C>=d)return{node:x,offset:d-a};a=C}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=Kd(x)}}function Xd(a,d){return a&&d?a===d?!0:a&&a.nodeType===3?!1:d&&d.nodeType===3?Xd(a,d.parentNode):"contains"in a?a.contains(d):a.compareDocumentPosition?!!(a.compareDocumentPosition(d)&16):!1:!1}function Oh(){for(var a=window,d=Vr();d instanceof a.HTMLIFrameElement;){try{var x=typeof d.contentWindow.location.href=="string"}catch{x=!1}if(x)a=d.contentWindow;else break;d=Vr(a.document)}return d}function Ll(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d&&(d==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||d==="textarea"||a.contentEditable==="true")}function Su(a){var d=Oh(),x=a.focusedElem,C=a.selectionRange;if(d!==x&&x&&x.ownerDocument&&Xd(x.ownerDocument.documentElement,x)){if(C!==null&&Ll(x)){if(d=C.start,a=C.end,a===void 0&&(a=d),"selectionStart"in x)x.selectionStart=d,x.selectionEnd=Math.min(a,x.value.length);else if(a=(d=x.ownerDocument||document)&&d.defaultView||window,a.getSelection){a=a.getSelection();var z=x.textContent.length,O=Math.min(C.start,z);C=C.end===void 0?O:Math.min(C.end,z),!a.extend&&O>C&&(z=C,C=O,O=z),z=Fh(x,O);var Q=Fh(x,C);z&&Q&&(a.rangeCount!==1||a.anchorNode!==z.node||a.anchorOffset!==z.offset||a.focusNode!==Q.node||a.focusOffset!==Q.offset)&&(d=d.createRange(),d.setStart(z.node,z.offset),a.removeAllRanges(),O>C?(a.addRange(d),a.extend(Q.node,Q.offset)):(d.setEnd(Q.node,Q.offset),a.addRange(d)))}}for(d=[],a=x;a=a.parentNode;)a.nodeType===1&&d.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<d.length;x++)a=d[x],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Tu=l&&"documentMode"in document&&11>=document.documentMode,ya=null,Lo=null,Fo=null,_a=!1;function ps(a,d,x){var C=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;_a||ya==null||ya!==Vr(C)||(C=ya,"selectionStart"in C&&Ll(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),Fo&&Tc(Fo,C)||(Fo=C,C=Ac(Lo,"onSelect"),0<C.length&&(d=new gu("onSelect","select",null,d,x),a.push({event:d,listeners:C}),d.target=ya)))}function Pc(a,d){var x={};return x[a.toLowerCase()]=d.toLowerCase(),x["Webkit"+a]="webkit"+d,x["Moz"+a]="moz"+d,x}var Va={animationend:Pc("Animation","AnimationEnd"),animationiteration:Pc("Animation","AnimationIteration"),animationstart:Pc("Animation","AnimationStart"),transitionend:Pc("Transition","TransitionEnd")},Cc={},va={};l&&(va=document.createElement("div").style,"AnimationEvent"in window||(delete Va.animationend.animation,delete Va.animationiteration.animation,delete Va.animationstart.animation),"TransitionEvent"in window||delete Va.transitionend.transition);function Za(a){if(Cc[a])return Cc[a];if(!Va[a])return a;var d=Va[a],x;for(x in d)if(d.hasOwnProperty(x)&&x in va)return Cc[a]=d[x];return a}var Ec=Za("animationend"),Fl=Za("animationiteration"),kc=Za("animationstart"),jh=Za("transitionend"),Ga=new Map,Oo="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jo(a,d){Ga.set(a,d),P(d,[a])}for(var Mc=0;Mc<Oo.length;Mc++){var Ir=Oo[Mc],Ic=Ir.toLowerCase(),sp=Ir[0].toUpperCase()+Ir.slice(1);jo(Ic,"on"+sp)}jo(Ec,"onAnimationEnd"),jo(Fl,"onAnimationIteration"),jo(kc,"onAnimationStart"),jo("dblclick","onDoubleClick"),jo("focusin","onFocus"),jo("focusout","onBlur"),jo(jh,"onTransitionEnd"),w("onMouseEnter",["mouseout","mouseover"]),w("onMouseLeave",["mouseout","mouseover"]),w("onPointerEnter",["pointerout","pointerover"]),w("onPointerLeave",["pointerout","pointerover"]),P("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),P("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),P("onBeforeInput",["compositionend","keypress","textInput","paste"]),P("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),P("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),P("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xa=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ol));function Nh(a,d,x){var C=a.type||"unknown-event";a.currentTarget=x,Dr(C,d,void 0,a),a.currentTarget=null}function Yd(a,d){d=(d&4)!==0;for(var x=0;x<a.length;x++){var C=a[x],z=C.event;C=C.listeners;e:{var O=void 0;if(d)for(var Q=C.length-1;0<=Q;Q--){var me=C[Q],ke=me.instance,He=me.currentTarget;if(me=me.listener,ke!==O&&z.isPropagationStopped())break e;Nh(z,me,He),O=ke}else for(Q=0;Q<C.length;Q++){if(me=C[Q],ke=me.instance,He=me.currentTarget,me=me.listener,ke!==O&&z.isPropagationStopped())break e;Nh(z,me,He),O=ke}}}if($r)throw a=vi,$r=!1,vi=null,a}function gn(a,d){var x=d[$o];x===void 0&&(x=d[$o]=new Set);var C=a+"__bubble";x.has(C)||(Nl(d,a,2,!1),x.add(C))}function Bh(a,d,x){var C=0;d&&(C|=4),Nl(x,a,C,d)}var jl="_reactListening"+Math.random().toString(36).slice(2);function ba(a){if(!a[jl]){a[jl]=!0,m.forEach(function(x){x!=="selectionchange"&&(xa.has(x)||Bh(x,!1,a),Bh(x,!0,a))});var d=a.nodeType===9?a:a.ownerDocument;d===null||d[jl]||(d[jl]=!0,Bh("selectionchange",!1,d))}}function Nl(a,d,x,C){switch(Pl(d)){case 1:var z=ho;break;case 4:z=fo;break;default:z=Sl}x=z.bind(null,d,x,a),z=void 0,!cr||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(z=!0),C?z!==void 0?a.addEventListener(d,x,{capture:!0,passive:z}):a.addEventListener(d,x,!0):z!==void 0?a.addEventListener(d,x,{passive:z}):a.addEventListener(d,x,!1)}function qa(a,d,x,C,z){var O=C;if((d&1)===0&&(d&2)===0&&C!==null)e:for(;;){if(C===null)return;var Q=C.tag;if(Q===3||Q===4){var me=C.stateNode.containerInfo;if(me===z||me.nodeType===8&&me.parentNode===z)break;if(Q===4)for(Q=C.return;Q!==null;){var ke=Q.tag;if((ke===3||ke===4)&&(ke=Q.stateNode.containerInfo,ke===z||ke.nodeType===8&&ke.parentNode===z))return;Q=Q.return}for(;me!==null;){if(Q=Vo(me),Q===null)return;if(ke=Q.tag,ke===5||ke===6){C=O=Q;continue e}me=me.parentNode}}C=C.return}dn(function(){var He=O,ut=rt(x),lt=[];e:{var ot=Ga.get(a);if(ot!==void 0){var Ot=gu,Vt=a;switch(a){case"keypress":if(zn(x)===0)break e;case"keydown":case"keyup":Ot=ep;break;case"focusin":Vt="focus",Ot=ri;break;case"focusout":Vt="blur",Ot=ri;break;case"beforeblur":case"afterblur":Ot=ri;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ot=Vs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ot=_c;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ot=tp;break;case Ec:case Fl:case kc:Ot=yu;break;case jh:Ot=rp;break;case"scroll":Ot=vh;break;case"wheel":Ot=qd;break;case"copy":case"cut":case"paste":Ot=bh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ot=Ml}var Qt=(d&4)!==0,Mn=!Qt&&a==="scroll",Ve=Qt?ot!==null?ot+"Capture":null:ot;Qt=[];for(var De=He,Ge;De!==null;){Ge=De;var bt=Ge.stateNode;if(Ge.tag===5&&bt!==null&&(Ge=bt,Ve!==null&&(bt=Tr(De,Ve),bt!=null&&Qt.push(Wa(De,bt,Ge)))),Mn)break;De=De.return}0<Qt.length&&(ot=new Ot(ot,Vt,null,x,ut),lt.push({event:ot,listeners:Qt}))}}if((d&7)===0){e:{if(ot=a==="mouseover"||a==="pointerover",Ot=a==="mouseout"||a==="pointerout",ot&&x!==qe&&(Vt=x.relatedTarget||x.fromElement)&&(Vo(Vt)||Vt[go]))break e;if((Ot||ot)&&(ot=ut.window===ut?ut:(ot=ut.ownerDocument)?ot.defaultView||ot.parentWindow:window,Ot?(Vt=x.relatedTarget||x.toElement,Ot=He,Vt=Vt?Vo(Vt):null,Vt!==null&&(Mn=pr(Vt),Vt!==Mn||Vt.tag!==5&&Vt.tag!==6)&&(Vt=null)):(Ot=null,Vt=He),Ot!==Vt)){if(Qt=Vs,bt="onMouseLeave",Ve="onMouseEnter",De="mouse",(a==="pointerout"||a==="pointerover")&&(Qt=Ml,bt="onPointerLeave",Ve="onPointerEnter",De="pointer"),Mn=Ot==null?ot:Ha(Ot),Ge=Vt==null?ot:Ha(Vt),ot=new Qt(bt,De+"leave",Ot,x,ut),ot.target=Mn,ot.relatedTarget=Ge,bt=null,Vo(ut)===He&&(Qt=new Qt(Ve,De+"enter",Vt,x,ut),Qt.target=Ge,Qt.relatedTarget=Mn,bt=Qt),Mn=bt,Ot&&Vt)t:{for(Qt=Ot,Ve=Vt,De=0,Ge=Qt;Ge;Ge=po(Ge))De++;for(Ge=0,bt=Ve;bt;bt=po(bt))Ge++;for(;0<De-Ge;)Qt=po(Qt),De--;for(;0<Ge-De;)Ve=po(Ve),Ge--;for(;De--;){if(Qt===Ve||Ve!==null&&Qt===Ve.alternate)break t;Qt=po(Qt),Ve=po(Ve)}Qt=null}else Qt=null;Ot!==null&&Bl(lt,ot,Ot,Qt,!1),Vt!==null&&Mn!==null&&Bl(lt,Mn,Vt,Qt,!0)}}e:{if(ot=He?Ha(He):window,Ot=ot.nodeName&&ot.nodeName.toLowerCase(),Ot==="select"||Ot==="input"&&ot.type==="file")var Gt=zh;else if(Al(ot))if(Rh)Gt=Lh;else{Gt=Dh;var hr=Hd}else(Ot=ot.nodeName)&&Ot.toLowerCase()==="input"&&(ot.type==="checkbox"||ot.type==="radio")&&(Gt=Ua);if(Gt&&(Gt=Gt(a,He))){Ah(lt,Gt,x,ut);break e}hr&&hr(a,ot,He),a==="focusout"&&(hr=ot._wrapperState)&&hr.controlled&&ot.type==="number"&&Zn(ot,"number",ot.value)}switch(hr=He?Ha(He):window,a){case"focusin":(Al(hr)||hr.contentEditable==="true")&&(ya=hr,Lo=He,Fo=null);break;case"focusout":Fo=Lo=ya=null;break;case"mousedown":_a=!0;break;case"contextmenu":case"mouseup":case"dragend":_a=!1,ps(lt,x,ut);break;case"selectionchange":if(Tu)break;case"keydown":case"keyup":ps(lt,x,ut)}var dr;if(Ph)e:{switch(a){case"compositionstart":var vr="onCompositionStart";break e;case"compositionend":vr="onCompositionEnd";break e;case"compositionupdate":vr="onCompositionUpdate";break e}vr=void 0}else ga?Mh(a,x)&&(vr="onCompositionEnd"):a==="keydown"&&x.keyCode===229&&(vr="onCompositionStart");vr&&(Eh&&x.locale!=="ko"&&(ga||vr!=="onCompositionStart"?vr==="onCompositionEnd"&&ga&&(dr=Ms()):(Us=ut,Cl="value"in Us?Us.value:Us.textContent,ga=!0)),hr=Ac(He,vr),0<hr.length&&(vr=new Gd(vr,a,null,x,ut),lt.push({event:vr,listeners:hr}),dr?vr.data=dr:(dr=ma(x),dr!==null&&(vr.data=dr)))),(dr=Ch?Ih(a,x):wc(a,x))&&(He=Ac(He,"onBeforeInput"),0<He.length&&(ut=new Gd("onBeforeInput","beforeinput",null,x,ut),lt.push({event:ut,listeners:He}),ut.data=dr))}Yd(lt,d)})}function Wa(a,d,x){return{instance:a,listener:d,currentTarget:x}}function Ac(a,d){for(var x=d+"Capture",C=[];a!==null;){var z=a,O=z.stateNode;z.tag===5&&O!==null&&(z=O,O=Tr(a,x),O!=null&&C.unshift(Wa(a,O,z)),O=Tr(a,d),O!=null&&C.push(Wa(a,O,z))),a=a.return}return C}function po(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Bl(a,d,x,C,z){for(var O=d._reactName,Q=[];x!==null&&x!==C;){var me=x,ke=me.alternate,He=me.stateNode;if(ke!==null&&ke===C)break;me.tag===5&&He!==null&&(me=He,z?(ke=Tr(x,O),ke!=null&&Q.unshift(Wa(x,ke,me))):z||(ke=Tr(x,O),ke!=null&&Q.push(Wa(x,ke,me)))),x=x.return}Q.length!==0&&a.push({event:d,listeners:Q})}var zc=/\r\n?/g,Pu=/\u0000|\uFFFD/g;function Cu(a){return(typeof a=="string"?a:""+a).replace(zc,`
`).replace(Pu,"")}function mo(a,d,x){if(d=Cu(d),Cu(a)!==d&&x)throw Error(u(425))}function $l(){}var Ul=null,No=null;function Rc(a,d){return a==="textarea"||a==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var Eu=typeof setTimeout=="function"?setTimeout:void 0,Qd=typeof clearTimeout=="function"?clearTimeout:void 0,Dc=typeof Promise=="function"?Promise:void 0,$h=typeof queueMicrotask=="function"?queueMicrotask:typeof Dc<"u"?function(a){return Dc.resolve(null).then(a).catch(op)}:Eu;function op(a){setTimeout(function(){throw a})}function Lc(a,d){var x=d,C=0;do{var z=x.nextSibling;if(a.removeChild(x),z&&z.nodeType===8)if(x=z.data,x==="/$"){if(C===0){a.removeChild(z),fs(d);return}C--}else x!=="$"&&x!=="$?"&&x!=="$!"||C++;x=z}while(x);fs(d)}function tn(a){for(;a!=null;a=a.nextSibling){var d=a.nodeType;if(d===1||d===3)break;if(d===8){if(d=a.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return a}function Ws(a){a=a.previousSibling;for(var d=0;a;){if(a.nodeType===8){var x=a.data;if(x==="$"||x==="$!"||x==="$?"){if(d===0)return a;d--}else x==="/$"&&d++}a=a.previousSibling}return null}var di=Math.random().toString(36).slice(2),ms="__reactFiber$"+di,Bo="__reactProps$"+di,go="__reactContainer$"+di,$o="__reactEvents$"+di,ku="__reactListeners$"+di,Uo="__reactHandles$"+di;function Vo(a){var d=a[ms];if(d)return d;for(var x=a.parentNode;x;){if(d=x[go]||x[ms]){if(x=d.alternate,d.child!==null||x!==null&&x.child!==null)for(a=Ws(a);a!==null;){if(x=a[ms])return x;a=Ws(a)}return d}a=x,x=a.parentNode}return null}function Vl(a){return a=a[ms]||a[go],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Ha(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(u(33))}function Fc(a){return a[Bo]||null}var Mu=[],Ka=-1;function ni(a){return{current:a}}function rn(a){0>Ka||(a.current=Mu[Ka],Mu[Ka]=null,Ka--)}function Or(a,d){Ka++,Mu[Ka]=a.current,a.current=d}var gs={},ii=ni(gs),Ri=ni(!1),wa=gs;function Hs(a,d){var x=a.type.contextTypes;if(!x)return gs;var C=a.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===d)return C.__reactInternalMemoizedMaskedChildContext;var z={},O;for(O in x)z[O]=d[O];return C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=d,a.__reactInternalMemoizedMaskedChildContext=z),z}function wi(a){return a=a.childContextTypes,a!=null}function Zo(){rn(Ri),rn(ii)}function Uh(a,d,x){if(ii.current!==gs)throw Error(u(168));Or(ii,d),Or(Ri,x)}function Di(a,d,x){var C=a.stateNode;if(d=d.childContextTypes,typeof C.getChildContext!="function")return x;C=C.getChildContext();for(var z in C)if(!(z in d))throw Error(u(108,Lr(a)||"Unknown",z));return Ct({},x,C)}function Yi(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||gs,wa=ii.current,Or(ii,a),Or(Ri,Ri.current),!0}function Xa(a,d,x){var C=a.stateNode;if(!C)throw Error(u(169));x?(a=Di(a,d,wa),C.__reactInternalMemoizedMergedChildContext=a,rn(Ri),rn(ii),Or(ii,a)):rn(Ri),Or(Ri,x)}var Hn=null,Go=!1,Vh=!1;function Zl(a){Hn===null?Hn=[a]:Hn.push(a)}function ap(a){Go=!0,Zl(a)}function Sa(){if(!Vh&&Hn!==null){Vh=!0;var a=0,d=qr;try{var x=Hn;for(qr=1;a<x.length;a++){var C=x[a];do C=C(!0);while(C!==null)}Hn=null,Go=!1}catch(z){throw Hn!==null&&(Hn=Hn.slice(a+1)),Io(xi,Sa),z}finally{qr=d,Vh=!1}}return null}var yo=[],_o=0,Qi=null,Et=0,Ji=[],Li=0,qo=null,es=1,Fi="";function vo(a,d){yo[_o++]=Et,yo[_o++]=Qi,Qi=a,Et=d}function Fr(a,d,x){Ji[Li++]=es,Ji[Li++]=Fi,Ji[Li++]=qo,qo=a;var C=es;a=Fi;var z=32-Es(C)-1;C&=~(1<<z),x+=1;var O=32-Es(d)+z;if(30<O){var Q=z-z%5;O=(C&(1<<Q)-1).toString(32),C>>=Q,z-=Q,es=1<<32-Es(d)+z|x<<z|C,Fi=O+a}else es=1<<O|x<<z|C,Fi=a}function Gl(a){a.return!==null&&(vo(a,1),Fr(a,1,0))}function Zh(a){for(;a===Qi;)Qi=yo[--_o],yo[_o]=null,Et=yo[--_o],yo[_o]=null;for(;a===qo;)qo=Ji[--Li],Ji[Li]=null,Fi=Ji[--Li],Ji[Li]=null,es=Ji[--Li],Ji[Li]=null}var Si=null,ys=null,vn=!1,_s=null;function Iu(a,d){var x=to(5,null,null,0);x.elementType="DELETED",x.stateNode=d,x.return=a,d=a.deletions,d===null?(a.deletions=[x],a.flags|=16):d.push(x)}function Gh(a,d){switch(a.tag){case 5:var x=a.type;return d=d.nodeType!==1||x.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(a.stateNode=d,Si=a,ys=tn(d.firstChild),!0):!1;case 6:return d=a.pendingProps===""||d.nodeType!==3?null:d,d!==null?(a.stateNode=d,Si=a,ys=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(x=qo!==null?{id:es,overflow:Fi}:null,a.memoizedState={dehydrated:d,treeContext:x,retryLane:1073741824},x=to(18,null,null,0),x.stateNode=d,x.return=a,a.child=x,Si=a,ys=null,!0):!1;default:return!1}}function Au(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Oc(a){if(vn){var d=ys;if(d){var x=d;if(!Gh(a,d)){if(Au(a))throw Error(u(418));d=tn(x.nextSibling);var C=Si;d&&Gh(a,d)?Iu(C,x):(a.flags=a.flags&-4097|2,vn=!1,Si=a)}}else{if(Au(a))throw Error(u(418));a.flags=a.flags&-4097|2,vn=!1,Si=a}}}function qh(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Si=a}function jc(a){if(a!==Si)return!1;if(!vn)return qh(a),vn=!0,!1;var d;if((d=a.tag!==3)&&!(d=a.tag!==5)&&(d=a.type,d=d!=="head"&&d!=="body"&&!Rc(a.type,a.memoizedProps)),d&&(d=ys)){if(Au(a))throw Is(),Error(u(418));for(;d;)Iu(a,d),d=tn(d.nextSibling)}if(qh(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(u(317));e:{for(a=a.nextSibling,d=0;a;){if(a.nodeType===8){var x=a.data;if(x==="/$"){if(d===0){ys=tn(a.nextSibling);break e}d--}else x!=="$"&&x!=="$!"&&x!=="$?"||d++}a=a.nextSibling}ys=null}}else ys=Si?tn(a.stateNode.nextSibling):null;return!0}function Is(){for(var a=ys;a;)a=tn(a.nextSibling)}function Wr(){ys=Si=null,vn=!1}function Ta(a){_s===null?_s=[a]:_s.push(a)}var Wh=Le.ReactCurrentBatchConfig;function ql(a,d,x){if(a=x.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(x._owner){if(x=x._owner,x){if(x.tag!==1)throw Error(u(309));var C=x.stateNode}if(!C)throw Error(u(147,a));var z=C,O=""+a;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===O?d.ref:(d=function(Q){var me=z.refs;Q===null?delete me[O]:me[O]=Q},d._stringRef=O,d)}if(typeof a!="string")throw Error(u(284));if(!x._owner)throw Error(u(290,a))}return a}function Wl(a,d){throw a=Object.prototype.toString.call(d),Error(u(31,a==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":a))}function zu(a){var d=a._init;return d(a._payload)}function Hh(a){function d(Ve,De){if(a){var Ge=Ve.deletions;Ge===null?(Ve.deletions=[De],Ve.flags|=16):Ge.push(De)}}function x(Ve,De){if(!a)return null;for(;De!==null;)d(Ve,De),De=De.sibling;return null}function C(Ve,De){for(Ve=new Map;De!==null;)De.key!==null?Ve.set(De.key,De):Ve.set(De.index,De),De=De.sibling;return Ve}function z(Ve,De){return Ve=nl(Ve,De),Ve.index=0,Ve.sibling=null,Ve}function O(Ve,De,Ge){return Ve.index=Ge,a?(Ge=Ve.alternate,Ge!==null?(Ge=Ge.index,Ge<De?(Ve.flags|=2,De):Ge):(Ve.flags|=2,De)):(Ve.flags|=1048576,De)}function Q(Ve){return a&&Ve.alternate===null&&(Ve.flags|=2),Ve}function me(Ve,De,Ge,bt){return De===null||De.tag!==6?(De=zp(Ge,Ve.mode,bt),De.return=Ve,De):(De=z(De,Ge),De.return=Ve,De)}function ke(Ve,De,Ge,bt){var Gt=Ge.type;return Gt===yt?ut(Ve,De,Ge.props.children,bt,Ge.key):De!==null&&(De.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===ar&&zu(Gt)===De.type)?(bt=z(De,Ge.props),bt.ref=ql(Ve,De,Ge),bt.return=Ve,bt):(bt=hf(Ge.type,Ge.key,Ge.props,null,Ve.mode,bt),bt.ref=ql(Ve,De,Ge),bt.return=Ve,bt)}function He(Ve,De,Ge,bt){return De===null||De.tag!==4||De.stateNode.containerInfo!==Ge.containerInfo||De.stateNode.implementation!==Ge.implementation?(De=Rp(Ge,Ve.mode,bt),De.return=Ve,De):(De=z(De,Ge.children||[]),De.return=Ve,De)}function ut(Ve,De,Ge,bt,Gt){return De===null||De.tag!==7?(De=Xc(Ge,Ve.mode,bt,Gt),De.return=Ve,De):(De=z(De,Ge),De.return=Ve,De)}function lt(Ve,De,Ge){if(typeof De=="string"&&De!==""||typeof De=="number")return De=zp(""+De,Ve.mode,Ge),De.return=Ve,De;if(typeof De=="object"&&De!==null){switch(De.$$typeof){case Xe:return Ge=hf(De.type,De.key,De.props,null,Ve.mode,Ge),Ge.ref=ql(Ve,null,De),Ge.return=Ve,Ge;case mt:return De=Rp(De,Ve.mode,Ge),De.return=Ve,De;case ar:var bt=De._init;return lt(Ve,bt(De._payload),Ge)}if(xe(De)||ht(De))return De=Xc(De,Ve.mode,Ge,null),De.return=Ve,De;Wl(Ve,De)}return null}function ot(Ve,De,Ge,bt){var Gt=De!==null?De.key:null;if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number")return Gt!==null?null:me(Ve,De,""+Ge,bt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Xe:return Ge.key===Gt?ke(Ve,De,Ge,bt):null;case mt:return Ge.key===Gt?He(Ve,De,Ge,bt):null;case ar:return Gt=Ge._init,ot(Ve,De,Gt(Ge._payload),bt)}if(xe(Ge)||ht(Ge))return Gt!==null?null:ut(Ve,De,Ge,bt,null);Wl(Ve,Ge)}return null}function Ot(Ve,De,Ge,bt,Gt){if(typeof bt=="string"&&bt!==""||typeof bt=="number")return Ve=Ve.get(Ge)||null,me(De,Ve,""+bt,Gt);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case Xe:return Ve=Ve.get(bt.key===null?Ge:bt.key)||null,ke(De,Ve,bt,Gt);case mt:return Ve=Ve.get(bt.key===null?Ge:bt.key)||null,He(De,Ve,bt,Gt);case ar:var hr=bt._init;return Ot(Ve,De,Ge,hr(bt._payload),Gt)}if(xe(bt)||ht(bt))return Ve=Ve.get(Ge)||null,ut(De,Ve,bt,Gt,null);Wl(De,bt)}return null}function Vt(Ve,De,Ge,bt){for(var Gt=null,hr=null,dr=De,vr=De=0,gi=null;dr!==null&&vr<Ge.length;vr++){dr.index>vr?(gi=dr,dr=null):gi=dr.sibling;var Hr=ot(Ve,dr,Ge[vr],bt);if(Hr===null){dr===null&&(dr=gi);break}a&&dr&&Hr.alternate===null&&d(Ve,dr),De=O(Hr,De,vr),hr===null?Gt=Hr:hr.sibling=Hr,hr=Hr,dr=gi}if(vr===Ge.length)return x(Ve,dr),vn&&vo(Ve,vr),Gt;if(dr===null){for(;vr<Ge.length;vr++)dr=lt(Ve,Ge[vr],bt),dr!==null&&(De=O(dr,De,vr),hr===null?Gt=dr:hr.sibling=dr,hr=dr);return vn&&vo(Ve,vr),Gt}for(dr=C(Ve,dr);vr<Ge.length;vr++)gi=Ot(dr,Ve,vr,Ge[vr],bt),gi!==null&&(a&&gi.alternate!==null&&dr.delete(gi.key===null?vr:gi.key),De=O(gi,De,vr),hr===null?Gt=gi:hr.sibling=gi,hr=gi);return a&&dr.forEach(function(ol){return d(Ve,ol)}),vn&&vo(Ve,vr),Gt}function Qt(Ve,De,Ge,bt){var Gt=ht(Ge);if(typeof Gt!="function")throw Error(u(150));if(Ge=Gt.call(Ge),Ge==null)throw Error(u(151));for(var hr=Gt=null,dr=De,vr=De=0,gi=null,Hr=Ge.next();dr!==null&&!Hr.done;vr++,Hr=Ge.next()){dr.index>vr?(gi=dr,dr=null):gi=dr.sibling;var ol=ot(Ve,dr,Hr.value,bt);if(ol===null){dr===null&&(dr=gi);break}a&&dr&&ol.alternate===null&&d(Ve,dr),De=O(ol,De,vr),hr===null?Gt=ol:hr.sibling=ol,hr=ol,dr=gi}if(Hr.done)return x(Ve,dr),vn&&vo(Ve,vr),Gt;if(dr===null){for(;!Hr.done;vr++,Hr=Ge.next())Hr=lt(Ve,Hr.value,bt),Hr!==null&&(De=O(Hr,De,vr),hr===null?Gt=Hr:hr.sibling=Hr,hr=Hr);return vn&&vo(Ve,vr),Gt}for(dr=C(Ve,dr);!Hr.done;vr++,Hr=Ge.next())Hr=Ot(dr,Ve,vr,Hr.value,bt),Hr!==null&&(a&&Hr.alternate!==null&&dr.delete(Hr.key===null?vr:Hr.key),De=O(Hr,De,vr),hr===null?Gt=Hr:hr.sibling=Hr,hr=Hr);return a&&dr.forEach(function(cy){return d(Ve,cy)}),vn&&vo(Ve,vr),Gt}function Mn(Ve,De,Ge,bt){if(typeof Ge=="object"&&Ge!==null&&Ge.type===yt&&Ge.key===null&&(Ge=Ge.props.children),typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Xe:e:{for(var Gt=Ge.key,hr=De;hr!==null;){if(hr.key===Gt){if(Gt=Ge.type,Gt===yt){if(hr.tag===7){x(Ve,hr.sibling),De=z(hr,Ge.props.children),De.return=Ve,Ve=De;break e}}else if(hr.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===ar&&zu(Gt)===hr.type){x(Ve,hr.sibling),De=z(hr,Ge.props),De.ref=ql(Ve,hr,Ge),De.return=Ve,Ve=De;break e}x(Ve,hr);break}else d(Ve,hr);hr=hr.sibling}Ge.type===yt?(De=Xc(Ge.props.children,Ve.mode,bt,Ge.key),De.return=Ve,Ve=De):(bt=hf(Ge.type,Ge.key,Ge.props,null,Ve.mode,bt),bt.ref=ql(Ve,De,Ge),bt.return=Ve,Ve=bt)}return Q(Ve);case mt:e:{for(hr=Ge.key;De!==null;){if(De.key===hr)if(De.tag===4&&De.stateNode.containerInfo===Ge.containerInfo&&De.stateNode.implementation===Ge.implementation){x(Ve,De.sibling),De=z(De,Ge.children||[]),De.return=Ve,Ve=De;break e}else{x(Ve,De);break}else d(Ve,De);De=De.sibling}De=Rp(Ge,Ve.mode,bt),De.return=Ve,Ve=De}return Q(Ve);case ar:return hr=Ge._init,Mn(Ve,De,hr(Ge._payload),bt)}if(xe(Ge))return Vt(Ve,De,Ge,bt);if(ht(Ge))return Qt(Ve,De,Ge,bt);Wl(Ve,Ge)}return typeof Ge=="string"&&Ge!==""||typeof Ge=="number"?(Ge=""+Ge,De!==null&&De.tag===6?(x(Ve,De.sibling),De=z(De,Ge),De.return=Ve,Ve=De):(x(Ve,De),De=zp(Ge,Ve.mode,bt),De.return=Ve,Ve=De),Q(Ve)):x(Ve,De)}return Mn}var Oi=Hh(!0),Nc=Hh(!1),Lt=ni(null),Yt=null,Wo=null,xo=null;function Hl(){xo=Wo=Yt=null}function fi(a){var d=Lt.current;rn(Lt),a._currentValue=d}function Ru(a,d,x){for(;a!==null;){var C=a.alternate;if((a.childLanes&d)!==d?(a.childLanes|=d,C!==null&&(C.childLanes|=d)):C!==null&&(C.childLanes&d)!==d&&(C.childLanes|=d),a===x)break;a=a.return}}function pi(a,d){Yt=a,xo=Wo=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&d)!==0&&(Ds=!0),a.firstContext=null)}function As(a){var d=a._currentValue;if(xo!==a)if(a={context:a,memoizedValue:d,next:null},Wo===null){if(Yt===null)throw Error(u(308));Wo=a,Yt.dependencies={lanes:0,firstContext:a}}else Wo=Wo.next=a;return d}var Ks=null;function Yr(a){Ks===null?Ks=[a]:Ks.push(a)}function wn(a,d,x,C){var z=d.interleaved;return z===null?(x.next=x,Yr(d)):(x.next=z.next,z.next=x),d.interleaved=x,zs(a,C)}function zs(a,d){a.lanes|=d;var x=a.alternate;for(x!==null&&(x.lanes|=d),x=a,a=a.return;a!==null;)a.childLanes|=d,x=a.alternate,x!==null&&(x.childLanes|=d),x=a,a=a.return;return x.tag===3?x.stateNode:null}var vs=!1;function Pa(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Du(a,d){a=a.updateQueue,d.updateQueue===a&&(d.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function ts(a,d){return{eventTime:a,lane:d,tag:0,payload:null,callback:null,next:null}}function rs(a,d,x){var C=a.updateQueue;if(C===null)return null;if(C=C.shared,(Br&2)!==0){var z=C.pending;return z===null?d.next=d:(d.next=z.next,z.next=d),C.pending=d,zs(a,x)}return z=C.interleaved,z===null?(d.next=d,Yr(C)):(d.next=z.next,z.next=d),C.interleaved=d,zs(a,x)}function Ca(a,d,x){if(d=d.updateQueue,d!==null&&(d=d.shared,(x&4194240)!==0)){var C=d.lanes;C&=a.pendingLanes,x|=C,d.lanes=x,ca(a,x)}}function Bc(a,d){var x=a.updateQueue,C=a.alternate;if(C!==null&&(C=C.updateQueue,x===C)){var z=null,O=null;if(x=x.firstBaseUpdate,x!==null){do{var Q={eventTime:x.eventTime,lane:x.lane,tag:x.tag,payload:x.payload,callback:x.callback,next:null};O===null?z=O=Q:O=O.next=Q,x=x.next}while(x!==null);O===null?z=O=d:O=O.next=d}else z=O=d;x={baseState:C.baseState,firstBaseUpdate:z,lastBaseUpdate:O,shared:C.shared,effects:C.effects},a.updateQueue=x;return}a=x.lastBaseUpdate,a===null?x.firstBaseUpdate=d:a.next=d,x.lastBaseUpdate=d}function bo(a,d,x,C){var z=a.updateQueue;vs=!1;var O=z.firstBaseUpdate,Q=z.lastBaseUpdate,me=z.shared.pending;if(me!==null){z.shared.pending=null;var ke=me,He=ke.next;ke.next=null,Q===null?O=He:Q.next=He,Q=ke;var ut=a.alternate;ut!==null&&(ut=ut.updateQueue,me=ut.lastBaseUpdate,me!==Q&&(me===null?ut.firstBaseUpdate=He:me.next=He,ut.lastBaseUpdate=ke))}if(O!==null){var lt=z.baseState;Q=0,ut=He=ke=null,me=O;do{var ot=me.lane,Ot=me.eventTime;if((C&ot)===ot){ut!==null&&(ut=ut.next={eventTime:Ot,lane:0,tag:me.tag,payload:me.payload,callback:me.callback,next:null});e:{var Vt=a,Qt=me;switch(ot=d,Ot=x,Qt.tag){case 1:if(Vt=Qt.payload,typeof Vt=="function"){lt=Vt.call(Ot,lt,ot);break e}lt=Vt;break e;case 3:Vt.flags=Vt.flags&-65537|128;case 0:if(Vt=Qt.payload,ot=typeof Vt=="function"?Vt.call(Ot,lt,ot):Vt,ot==null)break e;lt=Ct({},lt,ot);break e;case 2:vs=!0}}me.callback!==null&&me.lane!==0&&(a.flags|=64,ot=z.effects,ot===null?z.effects=[me]:ot.push(me))}else Ot={eventTime:Ot,lane:ot,tag:me.tag,payload:me.payload,callback:me.callback,next:null},ut===null?(He=ut=Ot,ke=lt):ut=ut.next=Ot,Q|=ot;if(me=me.next,me===null){if(me=z.shared.pending,me===null)break;ot=me,me=ot.next,ot.next=null,z.lastBaseUpdate=ot,z.shared.pending=null}}while(!0);if(ut===null&&(ke=lt),z.baseState=ke,z.firstBaseUpdate=He,z.lastBaseUpdate=ut,d=z.shared.interleaved,d!==null){z=d;do Q|=z.lane,z=z.next;while(z!==d)}else O===null&&(z.shared.lanes=0);Yl|=Q,a.lanes=Q,a.memoizedState=lt}}function Lu(a,d,x){if(a=d.effects,d.effects=null,a!==null)for(d=0;d<a.length;d++){var C=a[d],z=C.callback;if(z!==null){if(C.callback=null,C=x,typeof z!="function")throw Error(u(191,z));z.call(C)}}}var Ya={},xs=ni(Ya),Qa=ni(Ya),g=ni(Ya);function e(a){if(a===Ya)throw Error(u(174));return a}function s(a,d){switch(Or(g,d),Or(Qa,a),Or(xs,Ya),a=d.nodeType,a){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:_r(null,"");break;default:a=a===8?d.parentNode:d,d=a.namespaceURI||null,a=a.tagName,d=_r(d,a)}rn(xs),Or(xs,d)}function h(){rn(xs),rn(Qa),rn(g)}function p(a){e(g.current);var d=e(xs.current),x=_r(d,a.type);d!==x&&(Or(Qa,a),Or(xs,x))}function y(a){Qa.current===a&&(rn(xs),rn(Qa))}var S=ni(0);function k(a){for(var d=a;d!==null;){if(d.tag===13){var x=d.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||x.data==="$?"||x.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var M=[];function R(){for(var a=0;a<M.length;a++)M[a]._workInProgressVersionPrimary=null;M.length=0}var D=Le.ReactCurrentDispatcher,N=Le.ReactCurrentBatchConfig,j=0,$=null,W=null,re=null,se=!1,oe=!1,ae=0,de=0;function le(){throw Error(u(321))}function ge(a,d){if(d===null)return!1;for(var x=0;x<d.length&&x<a.length;x++)if(!qs(a[x],d[x]))return!1;return!0}function we(a,d,x,C,z,O){if(j=O,$=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,D.current=a===null||a.memoizedState===null?Bn:$c,a=x(C,z),oe){O=0;do{if(oe=!1,ae=0,25<=O)throw Error(u(301));O+=1,re=W=null,d.updateQueue=null,D.current=Kl,a=x(C,z)}while(oe)}if(D.current=Bi,d=W!==null&&W.next!==null,j=0,re=W=$=null,se=!1,d)throw Error(u(300));return a}function he(){var a=ae!==0;return ae=0,a}function Ee(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return re===null?$.memoizedState=re=a:re=re.next=a,re}function $e(){if(W===null){var a=$.alternate;a=a!==null?a.memoizedState:null}else a=W.next;var d=re===null?$.memoizedState:re.next;if(d!==null)re=d,W=a;else{if(a===null)throw Error(u(310));W=a,a={memoizedState:W.memoizedState,baseState:W.baseState,baseQueue:W.baseQueue,queue:W.queue,next:null},re===null?$.memoizedState=re=a:re=re.next=a}return re}function je(a,d){return typeof d=="function"?d(a):d}function Ne(a){var d=$e(),x=d.queue;if(x===null)throw Error(u(311));x.lastRenderedReducer=a;var C=W,z=C.baseQueue,O=x.pending;if(O!==null){if(z!==null){var Q=z.next;z.next=O.next,O.next=Q}C.baseQueue=z=O,x.pending=null}if(z!==null){O=z.next,C=C.baseState;var me=Q=null,ke=null,He=O;do{var ut=He.lane;if((j&ut)===ut)ke!==null&&(ke=ke.next={lane:0,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null}),C=He.hasEagerState?He.eagerState:a(C,He.action);else{var lt={lane:ut,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null};ke===null?(me=ke=lt,Q=C):ke=ke.next=lt,$.lanes|=ut,Yl|=ut}He=He.next}while(He!==null&&He!==O);ke===null?Q=C:ke.next=me,qs(C,d.memoizedState)||(Ds=!0),d.memoizedState=C,d.baseState=Q,d.baseQueue=ke,x.lastRenderedState=C}if(a=x.interleaved,a!==null){z=a;do O=z.lane,$.lanes|=O,Yl|=O,z=z.next;while(z!==a)}else z===null&&(x.lanes=0);return[d.memoizedState,x.dispatch]}function Ze(a){var d=$e(),x=d.queue;if(x===null)throw Error(u(311));x.lastRenderedReducer=a;var C=x.dispatch,z=x.pending,O=d.memoizedState;if(z!==null){x.pending=null;var Q=z=z.next;do O=a(O,Q.action),Q=Q.next;while(Q!==z);qs(O,d.memoizedState)||(Ds=!0),d.memoizedState=O,d.baseQueue===null&&(d.baseState=O),x.lastRenderedState=O}return[O,C]}function ct(){}function ft(a,d){var x=$,C=$e(),z=d(),O=!qs(C.memoizedState,z);if(O&&(C.memoizedState=z,Ds=!0),C=C.queue,Ln(br.bind(null,x,C,a),[a]),C.getSnapshot!==d||O||re!==null&&re.memoizedState.tag&1){if(x.flags|=2048,un(9,Ft.bind(null,x,C,z,d),void 0,null),Yn===null)throw Error(u(349));(j&30)!==0||tt(x,d,z)}return z}function tt(a,d,x){a.flags|=16384,a={getSnapshot:d,value:x},d=$.updateQueue,d===null?(d={lastEffect:null,stores:null},$.updateQueue=d,d.stores=[a]):(x=d.stores,x===null?d.stores=[a]:x.push(a))}function Ft(a,d,x,C){d.value=x,d.getSnapshot=C,Zr(d)&&nn(a)}function br(a,d,x){return x(function(){Zr(d)&&nn(a)})}function Zr(a){var d=a.getSnapshot;a=a.value;try{var x=d();return!qs(a,x)}catch{return!0}}function nn(a){var d=zs(a,1);d!==null&&Jo(d,a,1,-1)}function Qr(a){var d=Ee();return typeof a=="function"&&(a=a()),d.memoizedState=d.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:je,lastRenderedState:a},d.queue=a,a=a.dispatch=Ni.bind(null,$,a),[d.memoizedState,a]}function un(a,d,x,C){return a={tag:a,create:d,destroy:x,deps:C,next:null},d=$.updateQueue,d===null?(d={lastEffect:null,stores:null},$.updateQueue=d,d.lastEffect=a.next=a):(x=d.lastEffect,x===null?d.lastEffect=a.next=a:(C=x.next,x.next=a,a.next=C,d.lastEffect=a)),a}function xn(){return $e().memoizedState}function mr(a,d,x,C){var z=Ee();$.flags|=a,z.memoizedState=un(1|d,x,void 0,C===void 0?null:C)}function Xr(a,d,x,C){var z=$e();C=C===void 0?null:C;var O=void 0;if(W!==null){var Q=W.memoizedState;if(O=Q.destroy,C!==null&&ge(C,Q.deps)){z.memoizedState=un(d,x,O,C);return}}$.flags|=a,z.memoizedState=un(1|d,x,O,C)}function Dn(a,d){return mr(8390656,8,a,d)}function Ln(a,d){return Xr(2048,8,a,d)}function Kn(a,d){return Xr(4,2,a,d)}function Ti(a,d){return Xr(4,4,a,d)}function Rs(a,d){if(typeof d=="function")return a=a(),d(a),function(){d(null)};if(d!=null)return a=a(),d.current=a,function(){d.current=null}}function Ho(a,d,x){return x=x!=null?x.concat([a]):null,Xr(4,4,Rs.bind(null,d,a),x)}function wo(){}function Ja(a,d){var x=$e();d=d===void 0?null:d;var C=x.memoizedState;return C!==null&&d!==null&&ge(d,C[1])?C[0]:(x.memoizedState=[a,d],a)}function el(a,d){var x=$e();d=d===void 0?null:d;var C=x.memoizedState;return C!==null&&d!==null&&ge(d,C[1])?C[0]:(a=a(),x.memoizedState=[a,d],a)}function Ea(a,d,x){return(j&21)===0?(a.baseState&&(a.baseState=!1,Ds=!0),a.memoizedState=x):(qs(x,d)||(x=Oa(),$.lanes|=x,Yl|=x,a.baseState=!0),d)}function tl(a,d){var x=qr;qr=x!==0&&4>x?x:4,a(!0);var C=N.transition;N.transition={};try{a(!1),d()}finally{qr=x,N.transition=C}}function ji(){return $e().memoizedState}function Xs(a,d,x){var C=Ia(a);if(x={lane:C,action:x,hasEagerState:!1,eagerState:null,next:null},Ko(a))Fn(d,x);else if(x=wn(a,d,x,C),x!==null){var z=mi();Jo(x,a,C,z),Nn(x,d,C)}}function Ni(a,d,x){var C=Ia(a),z={lane:C,action:x,hasEagerState:!1,eagerState:null,next:null};if(Ko(a))Fn(d,z);else{var O=a.alternate;if(a.lanes===0&&(O===null||O.lanes===0)&&(O=d.lastRenderedReducer,O!==null))try{var Q=d.lastRenderedState,me=O(Q,x);if(z.hasEagerState=!0,z.eagerState=me,qs(me,Q)){var ke=d.interleaved;ke===null?(z.next=z,Yr(d)):(z.next=ke.next,ke.next=z),d.interleaved=z;return}}catch{}finally{}x=wn(a,d,z,C),x!==null&&(z=mi(),Jo(x,a,C,z),Nn(x,d,C))}}function Ko(a){var d=a.alternate;return a===$||d!==null&&d===$}function Fn(a,d){oe=se=!0;var x=a.pending;x===null?d.next=d:(d.next=x.next,x.next=d),a.pending=d}function Nn(a,d,x){if((x&4194240)!==0){var C=d.lanes;C&=a.pendingLanes,x|=C,d.lanes=x,ca(a,x)}}var Bi={readContext:As,useCallback:le,useContext:le,useEffect:le,useImperativeHandle:le,useInsertionEffect:le,useLayoutEffect:le,useMemo:le,useReducer:le,useRef:le,useState:le,useDebugValue:le,useDeferredValue:le,useTransition:le,useMutableSource:le,useSyncExternalStore:le,useId:le,unstable_isNewReconciler:!1},Bn={readContext:As,useCallback:function(a,d){return Ee().memoizedState=[a,d===void 0?null:d],a},useContext:As,useEffect:Dn,useImperativeHandle:function(a,d,x){return x=x!=null?x.concat([a]):null,mr(4194308,4,Rs.bind(null,d,a),x)},useLayoutEffect:function(a,d){return mr(4194308,4,a,d)},useInsertionEffect:function(a,d){return mr(4,2,a,d)},useMemo:function(a,d){var x=Ee();return d=d===void 0?null:d,a=a(),x.memoizedState=[a,d],a},useReducer:function(a,d,x){var C=Ee();return d=x!==void 0?x(d):d,C.memoizedState=C.baseState=d,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:d},C.queue=a,a=a.dispatch=Xs.bind(null,$,a),[C.memoizedState,a]},useRef:function(a){var d=Ee();return a={current:a},d.memoizedState=a},useState:Qr,useDebugValue:wo,useDeferredValue:function(a){return Ee().memoizedState=a},useTransition:function(){var a=Qr(!1),d=a[0];return a=tl.bind(null,a[1]),Ee().memoizedState=a,[d,a]},useMutableSource:function(){},useSyncExternalStore:function(a,d,x){var C=$,z=Ee();if(vn){if(x===void 0)throw Error(u(407));x=x()}else{if(x=d(),Yn===null)throw Error(u(349));(j&30)!==0||tt(C,d,x)}z.memoizedState=x;var O={value:x,getSnapshot:d};return z.queue=O,Dn(br.bind(null,C,O,a),[a]),C.flags|=2048,un(9,Ft.bind(null,C,O,x,d),void 0,null),x},useId:function(){var a=Ee(),d=Yn.identifierPrefix;if(vn){var x=Fi,C=es;x=(C&~(1<<32-Es(C)-1)).toString(32)+x,d=":"+d+"R"+x,x=ae++,0<x&&(d+="H"+x.toString(32)),d+=":"}else x=de++,d=":"+d+"r"+x.toString(32)+":";return a.memoizedState=d},unstable_isNewReconciler:!1},$c={readContext:As,useCallback:Ja,useContext:As,useEffect:Ln,useImperativeHandle:Ho,useInsertionEffect:Kn,useLayoutEffect:Ti,useMemo:el,useReducer:Ne,useRef:xn,useState:function(){return Ne(je)},useDebugValue:wo,useDeferredValue:function(a){var d=$e();return Ea(d,W.memoizedState,a)},useTransition:function(){var a=Ne(je)[0],d=$e().memoizedState;return[a,d]},useMutableSource:ct,useSyncExternalStore:ft,useId:ji,unstable_isNewReconciler:!1},Kl={readContext:As,useCallback:Ja,useContext:As,useEffect:Ln,useImperativeHandle:Ho,useInsertionEffect:Kn,useLayoutEffect:Ti,useMemo:el,useReducer:Ze,useRef:xn,useState:function(){return Ze(je)},useDebugValue:wo,useDeferredValue:function(a){var d=$e();return W===null?d.memoizedState=a:Ea(d,W.memoizedState,a)},useTransition:function(){var a=Ze(je)[0],d=$e().memoizedState;return[a,d]},useMutableSource:ct,useSyncExternalStore:ft,useId:ji,unstable_isNewReconciler:!1};function Xn(a,d){if(a&&a.defaultProps){d=Ct({},d),a=a.defaultProps;for(var x in a)d[x]===void 0&&(d[x]=a[x]);return d}return d}function bs(a,d,x,C){d=a.memoizedState,x=x(C,d),x=x==null?d:Ct({},d,x),a.memoizedState=x,a.lanes===0&&(a.updateQueue.baseState=x)}var Ys={isMounted:function(a){return(a=a._reactInternals)?pr(a)===a:!1},enqueueSetState:function(a,d,x){a=a._reactInternals;var C=mi(),z=Ia(a),O=ts(C,z);O.payload=d,x!=null&&(O.callback=x),d=rs(a,O,z),d!==null&&(Jo(d,a,z,C),Ca(d,a,z))},enqueueReplaceState:function(a,d,x){a=a._reactInternals;var C=mi(),z=Ia(a),O=ts(C,z);O.tag=1,O.payload=d,x!=null&&(O.callback=x),d=rs(a,O,z),d!==null&&(Jo(d,a,z,C),Ca(d,a,z))},enqueueForceUpdate:function(a,d){a=a._reactInternals;var x=mi(),C=Ia(a),z=ts(x,C);z.tag=2,d!=null&&(z.callback=d),d=rs(a,z,C),d!==null&&(Jo(d,a,C,x),Ca(d,a,C))}};function Kh(a,d,x,C,z,O,Q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(C,O,Q):d.prototype&&d.prototype.isPureReactComponent?!Tc(x,C)||!Tc(z,O):!0}function ns(a,d,x){var C=!1,z=gs,O=d.contextType;return typeof O=="object"&&O!==null?O=As(O):(z=wi(d)?wa:ii.current,C=d.contextTypes,O=(C=C!=null)?Hs(a,z):gs),d=new d(x,O),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ys,a.stateNode=d,d._reactInternals=a,C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=z,a.__reactInternalMemoizedMaskedChildContext=O),d}function Xh(a,d,x,C){a=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(x,C),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(x,C),d.state!==a&&Ys.enqueueReplaceState(d,d.state,null)}function Uc(a,d,x,C){var z=a.stateNode;z.props=x,z.state=a.memoizedState,z.refs={},Pa(a);var O=d.contextType;typeof O=="object"&&O!==null?z.context=As(O):(O=wi(d)?wa:ii.current,z.context=Hs(a,O)),z.state=a.memoizedState,O=d.getDerivedStateFromProps,typeof O=="function"&&(bs(a,d,O,x),z.state=a.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(d=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),d!==z.state&&Ys.enqueueReplaceState(z,z.state,null),bo(a,x,z,C),z.state=a.memoizedState),typeof z.componentDidMount=="function"&&(a.flags|=4194308)}function Xo(a,d){try{var x="",C=d;do x+=fr(C),C=C.return;while(C);var z=x}catch(O){z=`
Error generating stack: `+O.message+`
`+O.stack}return{value:a,source:d,stack:z,digest:null}}function Xl(a,d,x){return{value:a,source:null,stack:x??null,digest:d??null}}function So(a,d){try{console.error(d.value)}catch(x){setTimeout(function(){throw x})}}var Yo=typeof WeakMap=="function"?WeakMap:Map;function lp(a,d,x){x=ts(-1,x),x.tag=3,x.payload={element:null};var C=d.value;return x.callback=function(){sf||(sf=!0,Pp=C),So(a,d)},x}function Tm(a,d,x){x=ts(-1,x),x.tag=3;var C=a.type.getDerivedStateFromError;if(typeof C=="function"){var z=d.value;x.payload=function(){return C(z)},x.callback=function(){So(a,d)}}var O=a.stateNode;return O!==null&&typeof O.componentDidCatch=="function"&&(x.callback=function(){So(a,d),typeof C!="function"&&(eo===null?eo=new Set([this]):eo.add(this));var Q=d.stack;this.componentDidCatch(d.value,{componentStack:Q!==null?Q:""})}),x}function Jd(a,d,x){var C=a.pingCache;if(C===null){C=a.pingCache=new Yo;var z=new Set;C.set(d,z)}else z=C.get(d),z===void 0&&(z=new Set,C.set(d,z));z.has(x)||(z.add(x),a=qm.bind(null,a,d,x),d.then(a,a))}function cp(a){do{var d;if((d=a.tag===13)&&(d=a.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return a;a=a.return}while(a!==null);return null}function Pm(a,d,x,C,z){return(a.mode&1)===0?(a===d?a.flags|=65536:(a.flags|=128,x.flags|=131072,x.flags&=-52805,x.tag===1&&(x.alternate===null?x.tag=17:(d=ts(-1,1),d.tag=2,rs(x,d,1))),x.lanes|=1),a):(a.flags|=65536,a.lanes=z,a)}var Cm=Le.ReactCurrentOwner,Ds=!1;function $i(a,d,x,C){d.child=a===null?Nc(d,null,x,C):Oi(d,a.child,x,C)}function Em(a,d,x,C,z){x=x.render;var O=d.ref;return pi(d,z),C=we(a,d,x,C,O,z),x=he(),a!==null&&!Ds?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~z,Qs(a,d,z)):(vn&&x&&Gl(d),d.flags|=1,$i(a,d,C,z),d.child)}function ef(a,d,x,C,z){if(a===null){var O=x.type;return typeof O=="function"&&!fd(O)&&O.defaultProps===void 0&&x.compare===null&&x.defaultProps===void 0?(d.tag=15,d.type=O,up(a,d,O,C,z)):(a=hf(x.type,null,C,d,d.mode,z),a.ref=d.ref,a.return=d,d.child=a)}if(O=a.child,(a.lanes&z)===0){var Q=O.memoizedProps;if(x=x.compare,x=x!==null?x:Tc,x(Q,C)&&a.ref===d.ref)return Qs(a,d,z)}return d.flags|=1,a=nl(O,C),a.ref=d.ref,a.return=d,d.child=a}function up(a,d,x,C,z){if(a!==null){var O=a.memoizedProps;if(Tc(O,C)&&a.ref===d.ref)if(Ds=!1,d.pendingProps=C=O,(a.lanes&z)!==0)(a.flags&131072)!==0&&(Ds=!0);else return d.lanes=a.lanes,Qs(a,d,z)}return dp(a,d,x,C,z)}function hp(a,d,x){var C=d.pendingProps,z=C.children,O=a!==null?a.memoizedState:null;if(C.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Or(qc,Js),Js|=x;else{if((x&1073741824)===0)return a=O!==null?O.baseLanes|x:x,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:a,cachePool:null,transitions:null},d.updateQueue=null,Or(qc,Js),Js|=a,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=O!==null?O.baseLanes:x,Or(qc,Js),Js|=C}else O!==null?(C=O.baseLanes|x,d.memoizedState=null):C=x,Or(qc,Js),Js|=C;return $i(a,d,z,x),d.child}function Vc(a,d){var x=d.ref;(a===null&&x!==null||a!==null&&a.ref!==x)&&(d.flags|=512,d.flags|=2097152)}function dp(a,d,x,C,z){var O=wi(x)?wa:ii.current;return O=Hs(d,O),pi(d,z),x=we(a,d,x,C,O,z),C=he(),a!==null&&!Ds?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~z,Qs(a,d,z)):(vn&&C&&Gl(d),d.flags|=1,$i(a,d,x,z),d.child)}function Fu(a,d,x,C,z){if(wi(x)){var O=!0;Yi(d)}else O=!1;if(pi(d,z),d.stateNode===null)ju(a,d),ns(d,x,C),Uc(d,x,C,z),C=!0;else if(a===null){var Q=d.stateNode,me=d.memoizedProps;Q.props=me;var ke=Q.context,He=x.contextType;typeof He=="object"&&He!==null?He=As(He):(He=wi(x)?wa:ii.current,He=Hs(d,He));var ut=x.getDerivedStateFromProps,lt=typeof ut=="function"||typeof Q.getSnapshotBeforeUpdate=="function";lt||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(me!==C||ke!==He)&&Xh(d,Q,C,He),vs=!1;var ot=d.memoizedState;Q.state=ot,bo(d,C,Q,z),ke=d.memoizedState,me!==C||ot!==ke||Ri.current||vs?(typeof ut=="function"&&(bs(d,x,ut,C),ke=d.memoizedState),(me=vs||Kh(d,x,me,C,ot,ke,He))?(lt||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(d.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=C,d.memoizedState=ke),Q.props=C,Q.state=ke,Q.context=He,C=me):(typeof Q.componentDidMount=="function"&&(d.flags|=4194308),C=!1)}else{Q=d.stateNode,Du(a,d),me=d.memoizedProps,He=d.type===d.elementType?me:Xn(d.type,me),Q.props=He,lt=d.pendingProps,ot=Q.context,ke=x.contextType,typeof ke=="object"&&ke!==null?ke=As(ke):(ke=wi(x)?wa:ii.current,ke=Hs(d,ke));var Ot=x.getDerivedStateFromProps;(ut=typeof Ot=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(me!==lt||ot!==ke)&&Xh(d,Q,C,ke),vs=!1,ot=d.memoizedState,Q.state=ot,bo(d,C,Q,z);var Vt=d.memoizedState;me!==lt||ot!==Vt||Ri.current||vs?(typeof Ot=="function"&&(bs(d,x,Ot,C),Vt=d.memoizedState),(He=vs||Kh(d,x,He,C,ot,Vt,ke)||!1)?(ut||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(C,Vt,ke),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(C,Vt,ke)),typeof Q.componentDidUpdate=="function"&&(d.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof Q.componentDidUpdate!="function"||me===a.memoizedProps&&ot===a.memoizedState||(d.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||me===a.memoizedProps&&ot===a.memoizedState||(d.flags|=1024),d.memoizedProps=C,d.memoizedState=Vt),Q.props=C,Q.state=Vt,Q.context=ke,C=He):(typeof Q.componentDidUpdate!="function"||me===a.memoizedProps&&ot===a.memoizedState||(d.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||me===a.memoizedProps&&ot===a.memoizedState||(d.flags|=1024),C=!1)}return Ou(a,d,x,C,O,z)}function Ou(a,d,x,C,z,O){Vc(a,d);var Q=(d.flags&128)!==0;if(!C&&!Q)return z&&Xa(d,x,!1),Qs(a,d,O);C=d.stateNode,Cm.current=d;var me=Q&&typeof x.getDerivedStateFromError!="function"?null:C.render();return d.flags|=1,a!==null&&Q?(d.child=Oi(d,a.child,null,O),d.child=Oi(d,null,me,O)):$i(a,d,me,O),d.memoizedState=C.state,z&&Xa(d,x,!0),d.child}function Yh(a){var d=a.stateNode;d.pendingContext?Uh(a,d.pendingContext,d.pendingContext!==d.context):d.context&&Uh(a,d.context,!1),s(a,d.containerInfo)}function fp(a,d,x,C,z){return Wr(),Ta(z),d.flags|=256,$i(a,d,x,C),d.child}var tf={dehydrated:null,treeContext:null,retryLane:0};function pp(a){return{baseLanes:a,cachePool:null,transitions:null}}function km(a,d,x){var C=d.pendingProps,z=S.current,O=!1,Q=(d.flags&128)!==0,me;if((me=Q)||(me=a!==null&&a.memoizedState===null?!1:(z&2)!==0),me?(O=!0,d.flags&=-129):(a===null||a.memoizedState!==null)&&(z|=1),Or(S,z&1),a===null)return Oc(d),a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((d.mode&1)===0?d.lanes=1:a.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(Q=C.children,a=C.fallback,O?(C=d.mode,O=d.child,Q={mode:"hidden",children:Q},(C&1)===0&&O!==null?(O.childLanes=0,O.pendingProps=Q):O=df(Q,C,0,null),a=Xc(a,C,x,null),O.return=d,a.return=d,O.sibling=a,d.child=O,d.child.memoizedState=pp(x),d.memoizedState=tf,a):rf(d,Q));if(z=a.memoizedState,z!==null&&(me=z.dehydrated,me!==null))return Mm(a,d,Q,C,me,z,x);if(O){O=C.fallback,Q=d.mode,z=a.child,me=z.sibling;var ke={mode:"hidden",children:C.children};return(Q&1)===0&&d.child!==z?(C=d.child,C.childLanes=0,C.pendingProps=ke,d.deletions=null):(C=nl(z,ke),C.subtreeFlags=z.subtreeFlags&14680064),me!==null?O=nl(me,O):(O=Xc(O,Q,x,null),O.flags|=2),O.return=d,C.return=d,C.sibling=O,d.child=C,C=O,O=d.child,Q=a.child.memoizedState,Q=Q===null?pp(x):{baseLanes:Q.baseLanes|x,cachePool:null,transitions:Q.transitions},O.memoizedState=Q,O.childLanes=a.childLanes&~x,d.memoizedState=tf,C}return O=a.child,a=O.sibling,C=nl(O,{mode:"visible",children:C.children}),(d.mode&1)===0&&(C.lanes=x),C.return=d,C.sibling=null,a!==null&&(x=d.deletions,x===null?(d.deletions=[a],d.flags|=16):x.push(a)),d.child=C,d.memoizedState=null,C}function rf(a,d){return d=df({mode:"visible",children:d},a.mode,0,null),d.return=a,a.child=d}function Qh(a,d,x,C){return C!==null&&Ta(C),Oi(d,a.child,null,x),a=rf(d,d.pendingProps.children),a.flags|=2,d.memoizedState=null,a}function Mm(a,d,x,C,z,O,Q){if(x)return d.flags&256?(d.flags&=-257,C=Xl(Error(u(422))),Qh(a,d,Q,C)):d.memoizedState!==null?(d.child=a.child,d.flags|=128,null):(O=C.fallback,z=d.mode,C=df({mode:"visible",children:C.children},z,0,null),O=Xc(O,z,Q,null),O.flags|=2,C.return=d,O.return=d,C.sibling=O,d.child=C,(d.mode&1)!==0&&Oi(d,a.child,null,Q),d.child.memoizedState=pp(Q),d.memoizedState=tf,O);if((d.mode&1)===0)return Qh(a,d,Q,null);if(z.data==="$!"){if(C=z.nextSibling&&z.nextSibling.dataset,C)var me=C.dgst;return C=me,O=Error(u(419)),C=Xl(O,C,void 0),Qh(a,d,Q,C)}if(me=(Q&a.childLanes)!==0,Ds||me){if(C=Yn,C!==null){switch(Q&-Q){case 4:z=2;break;case 16:z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:z=32;break;case 536870912:z=268435456;break;default:z=0}z=(z&(C.suspendedLanes|Q))!==0?0:z,z!==0&&z!==O.retryLane&&(O.retryLane=z,zs(a,z),Jo(C,a,z,-1))}return cd(),C=Xl(Error(u(421))),Qh(a,d,Q,C)}return z.data==="$?"?(d.flags|=128,d.child=a.child,d=sy.bind(null,a),z._reactRetry=d,null):(a=O.treeContext,ys=tn(z.nextSibling),Si=d,vn=!0,_s=null,a!==null&&(Ji[Li++]=es,Ji[Li++]=Fi,Ji[Li++]=qo,es=a.id,Fi=a.overflow,qo=d),d=rf(d,C.children),d.flags|=4096,d)}function Im(a,d,x){a.lanes|=d;var C=a.alternate;C!==null&&(C.lanes|=d),Ru(a.return,d,x)}function Jh(a,d,x,C,z){var O=a.memoizedState;O===null?a.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:C,tail:x,tailMode:z}:(O.isBackwards=d,O.rendering=null,O.renderingStartTime=0,O.last=C,O.tail=x,O.tailMode=z)}function mp(a,d,x){var C=d.pendingProps,z=C.revealOrder,O=C.tail;if($i(a,d,C.children,x),C=S.current,(C&2)!==0)C=C&1|2,d.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=d.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Im(a,x,d);else if(a.tag===19)Im(a,x,d);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===d)break e;for(;a.sibling===null;){if(a.return===null||a.return===d)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}C&=1}if(Or(S,C),(d.mode&1)===0)d.memoizedState=null;else switch(z){case"forwards":for(x=d.child,z=null;x!==null;)a=x.alternate,a!==null&&k(a)===null&&(z=x),x=x.sibling;x=z,x===null?(z=d.child,d.child=null):(z=x.sibling,x.sibling=null),Jh(d,!1,z,x,O);break;case"backwards":for(x=null,z=d.child,d.child=null;z!==null;){if(a=z.alternate,a!==null&&k(a)===null){d.child=z;break}a=z.sibling,z.sibling=x,x=z,z=a}Jh(d,!0,x,null,O);break;case"together":Jh(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function ju(a,d){(d.mode&1)===0&&a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2)}function Qs(a,d,x){if(a!==null&&(d.dependencies=a.dependencies),Yl|=d.lanes,(x&d.childLanes)===0)return null;if(a!==null&&d.child!==a.child)throw Error(u(153));if(d.child!==null){for(a=d.child,x=nl(a,a.pendingProps),d.child=x,x.return=d;a.sibling!==null;)a=a.sibling,x=x.sibling=nl(a,a.pendingProps),x.return=d;x.sibling=null}return d.child}function ws(a,d,x){switch(d.tag){case 3:Yh(d),Wr();break;case 5:p(d);break;case 1:wi(d.type)&&Yi(d);break;case 4:s(d,d.stateNode.containerInfo);break;case 10:var C=d.type._context,z=d.memoizedProps.value;Or(Lt,C._currentValue),C._currentValue=z;break;case 13:if(C=d.memoizedState,C!==null)return C.dehydrated!==null?(Or(S,S.current&1),d.flags|=128,null):(x&d.child.childLanes)!==0?km(a,d,x):(Or(S,S.current&1),a=Qs(a,d,x),a!==null?a.sibling:null);Or(S,S.current&1);break;case 19:if(C=(x&d.childLanes)!==0,(a.flags&128)!==0){if(C)return mp(a,d,x);d.flags|=128}if(z=d.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),Or(S,S.current),C)break;return null;case 22:case 23:return d.lanes=0,hp(a,d,x)}return Qs(a,d,x)}var gp,ed,Am,yp;gp=function(a,d){for(var x=d.child;x!==null;){if(x.tag===5||x.tag===6)a.appendChild(x.stateNode);else if(x.tag!==4&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===d)break;for(;x.sibling===null;){if(x.return===null||x.return===d)return;x=x.return}x.sibling.return=x.return,x=x.sibling}},ed=function(){},Am=function(a,d,x,C){var z=a.memoizedProps;if(z!==C){a=d.stateNode,e(xs.current);var O=null;switch(x){case"input":z=Nr(a,z),C=Nr(a,C),O=[];break;case"select":z=Ct({},z,{value:void 0}),C=Ct({},C,{value:void 0}),O=[];break;case"textarea":z=Ke(a,z),C=Ke(a,C),O=[];break;default:typeof z.onClick!="function"&&typeof C.onClick=="function"&&(a.onclick=$l)}Oe(x,C);var Q;x=null;for(He in z)if(!C.hasOwnProperty(He)&&z.hasOwnProperty(He)&&z[He]!=null)if(He==="style"){var me=z[He];for(Q in me)me.hasOwnProperty(Q)&&(x||(x={}),x[Q]="")}else He!=="dangerouslySetInnerHTML"&&He!=="children"&&He!=="suppressContentEditableWarning"&&He!=="suppressHydrationWarning"&&He!=="autoFocus"&&(b.hasOwnProperty(He)?O||(O=[]):(O=O||[]).push(He,null));for(He in C){var ke=C[He];if(me=z!=null?z[He]:void 0,C.hasOwnProperty(He)&&ke!==me&&(ke!=null||me!=null))if(He==="style")if(me){for(Q in me)!me.hasOwnProperty(Q)||ke&&ke.hasOwnProperty(Q)||(x||(x={}),x[Q]="");for(Q in ke)ke.hasOwnProperty(Q)&&me[Q]!==ke[Q]&&(x||(x={}),x[Q]=ke[Q])}else x||(O||(O=[]),O.push(He,x)),x=ke;else He==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,me=me?me.__html:void 0,ke!=null&&me!==ke&&(O=O||[]).push(He,ke)):He==="children"?typeof ke!="string"&&typeof ke!="number"||(O=O||[]).push(He,""+ke):He!=="suppressContentEditableWarning"&&He!=="suppressHydrationWarning"&&(b.hasOwnProperty(He)?(ke!=null&&He==="onScroll"&&gn("scroll",a),O||me===ke||(O=[])):(O=O||[]).push(He,ke))}x&&(O=O||[]).push("style",x);var He=O;(d.updateQueue=He)&&(d.flags|=4)}},yp=function(a,d,x,C){x!==C&&(d.flags|=4)};function td(a,d){if(!vn)switch(a.tailMode){case"hidden":d=a.tail;for(var x=null;d!==null;)d.alternate!==null&&(x=d),d=d.sibling;x===null?a.tail=null:x.sibling=null;break;case"collapsed":x=a.tail;for(var C=null;x!==null;)x.alternate!==null&&(C=x),x=x.sibling;C===null?d||a.tail===null?a.tail=null:a.tail.sibling=null:C.sibling=null}}function is(a){var d=a.alternate!==null&&a.alternate.child===a.child,x=0,C=0;if(d)for(var z=a.child;z!==null;)x|=z.lanes|z.childLanes,C|=z.subtreeFlags&14680064,C|=z.flags&14680064,z.return=a,z=z.sibling;else for(z=a.child;z!==null;)x|=z.lanes|z.childLanes,C|=z.subtreeFlags,C|=z.flags,z.return=a,z=z.sibling;return a.subtreeFlags|=C,a.childLanes=x,d}function zm(a,d,x){var C=d.pendingProps;switch(Zh(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return is(d),null;case 1:return wi(d.type)&&Zo(),is(d),null;case 3:return C=d.stateNode,h(),rn(Ri),rn(ii),R(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(a===null||a.child===null)&&(jc(d)?d.flags|=4:a===null||a.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,_s!==null&&(Ep(_s),_s=null))),ed(a,d),is(d),null;case 5:y(d);var z=e(g.current);if(x=d.type,a!==null&&d.stateNode!=null)Am(a,d,x,C,z),a.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!C){if(d.stateNode===null)throw Error(u(166));return is(d),null}if(a=e(xs.current),jc(d)){C=d.stateNode,x=d.type;var O=d.memoizedProps;switch(C[ms]=d,C[Bo]=O,a=(d.mode&1)!==0,x){case"dialog":gn("cancel",C),gn("close",C);break;case"iframe":case"object":case"embed":gn("load",C);break;case"video":case"audio":for(z=0;z<Ol.length;z++)gn(Ol[z],C);break;case"source":gn("error",C);break;case"img":case"image":case"link":gn("error",C),gn("load",C);break;case"details":gn("toggle",C);break;case"input":Cn(C,O),gn("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!O.multiple},gn("invalid",C);break;case"textarea":kt(C,O),gn("invalid",C)}Oe(x,O),z=null;for(var Q in O)if(O.hasOwnProperty(Q)){var me=O[Q];Q==="children"?typeof me=="string"?C.textContent!==me&&(O.suppressHydrationWarning!==!0&&mo(C.textContent,me,a),z=["children",me]):typeof me=="number"&&C.textContent!==""+me&&(O.suppressHydrationWarning!==!0&&mo(C.textContent,me,a),z=["children",""+me]):b.hasOwnProperty(Q)&&me!=null&&Q==="onScroll"&&gn("scroll",C)}switch(x){case"input":ci(C),zi(C,O,!0);break;case"textarea":ci(C),pt(C);break;case"select":case"option":break;default:typeof O.onClick=="function"&&(C.onclick=$l)}C=z,d.updateQueue=C,C!==null&&(d.flags|=4)}else{Q=z.nodeType===9?z:z.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=Bt(x)),a==="http://www.w3.org/1999/xhtml"?x==="script"?(a=Q.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof C.is=="string"?a=Q.createElement(x,{is:C.is}):(a=Q.createElement(x),x==="select"&&(Q=a,C.multiple?Q.multiple=!0:C.size&&(Q.size=C.size))):a=Q.createElementNS(a,x),a[ms]=d,a[Bo]=C,gp(a,d,!1,!1),d.stateNode=a;e:{switch(Q=ze(x,C),x){case"dialog":gn("cancel",a),gn("close",a),z=C;break;case"iframe":case"object":case"embed":gn("load",a),z=C;break;case"video":case"audio":for(z=0;z<Ol.length;z++)gn(Ol[z],a);z=C;break;case"source":gn("error",a),z=C;break;case"img":case"image":case"link":gn("error",a),gn("load",a),z=C;break;case"details":gn("toggle",a),z=C;break;case"input":Cn(a,C),z=Nr(a,C),gn("invalid",a);break;case"option":z=C;break;case"select":a._wrapperState={wasMultiple:!!C.multiple},z=Ct({},C,{value:void 0}),gn("invalid",a);break;case"textarea":kt(a,C),z=Ke(a,C),gn("invalid",a);break;default:z=C}Oe(x,z),me=z;for(O in me)if(me.hasOwnProperty(O)){var ke=me[O];O==="style"?ve(a,ke):O==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,ke!=null&&Te(a,ke)):O==="children"?typeof ke=="string"?(x!=="textarea"||ke!=="")&&K(a,ke):typeof ke=="number"&&K(a,""+ke):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(b.hasOwnProperty(O)?ke!=null&&O==="onScroll"&&gn("scroll",a):ke!=null&&Ie(a,O,ke,Q))}switch(x){case"input":ci(a),zi(a,C,!1);break;case"textarea":ci(a),pt(a);break;case"option":C.value!=null&&a.setAttribute("value",""+sr(C.value));break;case"select":a.multiple=!!C.multiple,O=C.value,O!=null?Be(a,!!C.multiple,O,!1):C.defaultValue!=null&&Be(a,!!C.multiple,C.defaultValue,!0);break;default:typeof z.onClick=="function"&&(a.onclick=$l)}switch(x){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return is(d),null;case 6:if(a&&d.stateNode!=null)yp(a,d,a.memoizedProps,C);else{if(typeof C!="string"&&d.stateNode===null)throw Error(u(166));if(x=e(g.current),e(xs.current),jc(d)){if(C=d.stateNode,x=d.memoizedProps,C[ms]=d,(O=C.nodeValue!==x)&&(a=Si,a!==null))switch(a.tag){case 3:mo(C.nodeValue,x,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&mo(C.nodeValue,x,(a.mode&1)!==0)}O&&(d.flags|=4)}else C=(x.nodeType===9?x:x.ownerDocument).createTextNode(C),C[ms]=d,d.stateNode=C}return is(d),null;case 13:if(rn(S),C=d.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(vn&&ys!==null&&(d.mode&1)!==0&&(d.flags&128)===0)Is(),Wr(),d.flags|=98560,O=!1;else if(O=jc(d),C!==null&&C.dehydrated!==null){if(a===null){if(!O)throw Error(u(318));if(O=d.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(u(317));O[ms]=d}else Wr(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;is(d),O=!1}else _s!==null&&(Ep(_s),_s=null),O=!0;if(!O)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=x,d):(C=C!==null,C!==(a!==null&&a.memoizedState!==null)&&C&&(d.child.flags|=8192,(d.mode&1)!==0&&(a===null||(S.current&1)!==0?Tn===0&&(Tn=3):cd())),d.updateQueue!==null&&(d.flags|=4),is(d),null);case 4:return h(),ed(a,d),a===null&&ba(d.stateNode.containerInfo),is(d),null;case 10:return fi(d.type._context),is(d),null;case 17:return wi(d.type)&&Zo(),is(d),null;case 19:if(rn(S),O=d.memoizedState,O===null)return is(d),null;if(C=(d.flags&128)!==0,Q=O.rendering,Q===null)if(C)td(O,!1);else{if(Tn!==0||a!==null&&(a.flags&128)!==0)for(a=d.child;a!==null;){if(Q=k(a),Q!==null){for(d.flags|=128,td(O,!1),C=Q.updateQueue,C!==null&&(d.updateQueue=C,d.flags|=4),d.subtreeFlags=0,C=x,x=d.child;x!==null;)O=x,a=C,O.flags&=14680066,Q=O.alternate,Q===null?(O.childLanes=0,O.lanes=a,O.child=null,O.subtreeFlags=0,O.memoizedProps=null,O.memoizedState=null,O.updateQueue=null,O.dependencies=null,O.stateNode=null):(O.childLanes=Q.childLanes,O.lanes=Q.lanes,O.child=Q.child,O.subtreeFlags=0,O.deletions=null,O.memoizedProps=Q.memoizedProps,O.memoizedState=Q.memoizedState,O.updateQueue=Q.updateQueue,O.type=Q.type,a=Q.dependencies,O.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),x=x.sibling;return Or(S,S.current&1|2),d.child}a=a.sibling}O.tail!==null&&Er()>Gu&&(d.flags|=128,C=!0,td(O,!1),d.lanes=4194304)}else{if(!C)if(a=k(Q),a!==null){if(d.flags|=128,C=!0,x=a.updateQueue,x!==null&&(d.updateQueue=x,d.flags|=4),td(O,!0),O.tail===null&&O.tailMode==="hidden"&&!Q.alternate&&!vn)return is(d),null}else 2*Er()-O.renderingStartTime>Gu&&x!==1073741824&&(d.flags|=128,C=!0,td(O,!1),d.lanes=4194304);O.isBackwards?(Q.sibling=d.child,d.child=Q):(x=O.last,x!==null?x.sibling=Q:d.child=Q,O.last=Q)}return O.tail!==null?(d=O.tail,O.rendering=d,O.tail=d.sibling,O.renderingStartTime=Er(),d.sibling=null,x=S.current,Or(S,C?x&1|2:x&1),d):(is(d),null);case 22:case 23:return Ip(),C=d.memoizedState!==null,a!==null&&a.memoizedState!==null!==C&&(d.flags|=8192),C&&(d.mode&1)!==0?(Js&1073741824)!==0&&(is(d),d.subtreeFlags&6&&(d.flags|=8192)):is(d),null;case 24:return null;case 25:return null}throw Error(u(156,d.tag))}function ny(a,d){switch(Zh(d),d.tag){case 1:return wi(d.type)&&Zo(),a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 3:return h(),rn(Ri),rn(ii),R(),a=d.flags,(a&65536)!==0&&(a&128)===0?(d.flags=a&-65537|128,d):null;case 5:return y(d),null;case 13:if(rn(S),a=d.memoizedState,a!==null&&a.dehydrated!==null){if(d.alternate===null)throw Error(u(340));Wr()}return a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 19:return rn(S),null;case 4:return h(),null;case 10:return fi(d.type._context),null;case 22:case 23:return Ip(),null;case 24:return null;default:return null}}var Nu=!1,Ui=!1,Rm=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function Bu(a,d){var x=a.ref;if(x!==null)if(typeof x=="function")try{x(null)}catch(C){$n(a,d,C)}else x.current=null}function _p(a,d,x){try{x()}catch(C){$n(a,d,C)}}var nf=!1;function vp(a,d){if(Ul=bi,a=Oh(),Ll(a)){if("selectionStart"in a)var x={start:a.selectionStart,end:a.selectionEnd};else e:{x=(x=a.ownerDocument)&&x.defaultView||window;var C=x.getSelection&&x.getSelection();if(C&&C.rangeCount!==0){x=C.anchorNode;var z=C.anchorOffset,O=C.focusNode;C=C.focusOffset;try{x.nodeType,O.nodeType}catch{x=null;break e}var Q=0,me=-1,ke=-1,He=0,ut=0,lt=a,ot=null;t:for(;;){for(var Ot;lt!==x||z!==0&&lt.nodeType!==3||(me=Q+z),lt!==O||C!==0&&lt.nodeType!==3||(ke=Q+C),lt.nodeType===3&&(Q+=lt.nodeValue.length),(Ot=lt.firstChild)!==null;)ot=lt,lt=Ot;for(;;){if(lt===a)break t;if(ot===x&&++He===z&&(me=Q),ot===O&&++ut===C&&(ke=Q),(Ot=lt.nextSibling)!==null)break;lt=ot,ot=lt.parentNode}lt=Ot}x=me===-1||ke===-1?null:{start:me,end:ke}}else x=null}x=x||{start:0,end:0}}else x=null;for(No={focusedElem:a,selectionRange:x},bi=!1,Ut=d;Ut!==null;)if(d=Ut,a=d.child,(d.subtreeFlags&1028)!==0&&a!==null)a.return=d,Ut=a;else for(;Ut!==null;){d=Ut;try{var Vt=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(Vt!==null){var Qt=Vt.memoizedProps,Mn=Vt.memoizedState,Ve=d.stateNode,De=Ve.getSnapshotBeforeUpdate(d.elementType===d.type?Qt:Xn(d.type,Qt),Mn);Ve.__reactInternalSnapshotBeforeUpdate=De}break;case 3:var Ge=d.stateNode.containerInfo;Ge.nodeType===1?Ge.textContent="":Ge.nodeType===9&&Ge.documentElement&&Ge.removeChild(Ge.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(u(163))}}catch(bt){$n(d,d.return,bt)}if(a=d.sibling,a!==null){a.return=d.return,Ut=a;break}Ut=d.return}return Vt=nf,nf=!1,Vt}function $u(a,d,x){var C=d.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var z=C=C.next;do{if((z.tag&a)===a){var O=z.destroy;z.destroy=void 0,O!==void 0&&_p(d,x,O)}z=z.next}while(z!==C)}}function ka(a,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var x=d=d.next;do{if((x.tag&a)===a){var C=x.create;x.destroy=C()}x=x.next}while(x!==d)}}function Zc(a){var d=a.ref;if(d!==null){var x=a.stateNode;switch(a.tag){case 5:a=x;break;default:a=x}typeof d=="function"?d(a):d.current=a}}function Dm(a){var d=a.alternate;d!==null&&(a.alternate=null,Dm(d)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(d=a.stateNode,d!==null&&(delete d[ms],delete d[Bo],delete d[$o],delete d[ku],delete d[Uo])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Lm(a){return a.tag===5||a.tag===3||a.tag===4}function Fm(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Lm(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function xp(a,d,x){var C=a.tag;if(C===5||C===6)a=a.stateNode,d?x.nodeType===8?x.parentNode.insertBefore(a,d):x.insertBefore(a,d):(x.nodeType===8?(d=x.parentNode,d.insertBefore(a,x)):(d=x,d.appendChild(a)),x=x._reactRootContainer,x!=null||d.onclick!==null||(d.onclick=$l));else if(C!==4&&(a=a.child,a!==null))for(xp(a,d,x),a=a.sibling;a!==null;)xp(a,d,x),a=a.sibling}function bp(a,d,x){var C=a.tag;if(C===5||C===6)a=a.stateNode,d?x.insertBefore(a,d):x.appendChild(a);else if(C!==4&&(a=a.child,a!==null))for(bp(a,d,x),a=a.sibling;a!==null;)bp(a,d,x),a=a.sibling}var Vi=null,Qo=!1;function Ma(a,d,x){for(x=x.child;x!==null;)Om(a,d,x),x=x.sibling}function Om(a,d,x){if(ui&&typeof ui.onCommitFiberUnmount=="function")try{ui.onCommitFiberUnmount(Ns,x)}catch{}switch(x.tag){case 5:Ui||Bu(x,d);case 6:var C=Vi,z=Qo;Vi=null,Ma(a,d,x),Vi=C,Qo=z,Vi!==null&&(Qo?(a=Vi,x=x.stateNode,a.nodeType===8?a.parentNode.removeChild(x):a.removeChild(x)):Vi.removeChild(x.stateNode));break;case 18:Vi!==null&&(Qo?(a=Vi,x=x.stateNode,a.nodeType===8?Lc(a.parentNode,x):a.nodeType===1&&Lc(a,x),fs(a)):Lc(Vi,x.stateNode));break;case 4:C=Vi,z=Qo,Vi=x.stateNode.containerInfo,Qo=!0,Ma(a,d,x),Vi=C,Qo=z;break;case 0:case 11:case 14:case 15:if(!Ui&&(C=x.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){z=C=C.next;do{var O=z,Q=O.destroy;O=O.tag,Q!==void 0&&((O&2)!==0||(O&4)!==0)&&_p(x,d,Q),z=z.next}while(z!==C)}Ma(a,d,x);break;case 1:if(!Ui&&(Bu(x,d),C=x.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=x.memoizedProps,C.state=x.memoizedState,C.componentWillUnmount()}catch(me){$n(x,d,me)}Ma(a,d,x);break;case 21:Ma(a,d,x);break;case 22:x.mode&1?(Ui=(C=Ui)||x.memoizedState!==null,Ma(a,d,x),Ui=C):Ma(a,d,x);break;default:Ma(a,d,x)}}function wp(a){var d=a.updateQueue;if(d!==null){a.updateQueue=null;var x=a.stateNode;x===null&&(x=a.stateNode=new Rm),d.forEach(function(C){var z=dd.bind(null,a,C);x.has(C)||(x.add(C),C.then(z,z))})}}function Ss(a,d){var x=d.deletions;if(x!==null)for(var C=0;C<x.length;C++){var z=x[C];try{var O=a,Q=d,me=Q;e:for(;me!==null;){switch(me.tag){case 5:Vi=me.stateNode,Qo=!1;break e;case 3:Vi=me.stateNode.containerInfo,Qo=!0;break e;case 4:Vi=me.stateNode.containerInfo,Qo=!0;break e}me=me.return}if(Vi===null)throw Error(u(160));Om(O,Q,z),Vi=null,Qo=!1;var ke=z.alternate;ke!==null&&(ke.return=null),z.return=null}catch(He){$n(z,d,He)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)jm(d,a),d=d.sibling}function jm(a,d){var x=a.alternate,C=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Ss(d,a),sn(a),C&4){try{$u(3,a,a.return),ka(3,a)}catch(Qt){$n(a,a.return,Qt)}try{$u(5,a,a.return)}catch(Qt){$n(a,a.return,Qt)}}break;case 1:Ss(d,a),sn(a),C&512&&x!==null&&Bu(x,x.return);break;case 5:if(Ss(d,a),sn(a),C&512&&x!==null&&Bu(x,x.return),a.flags&32){var z=a.stateNode;try{K(z,"")}catch(Qt){$n(a,a.return,Qt)}}if(C&4&&(z=a.stateNode,z!=null)){var O=a.memoizedProps,Q=x!==null?x.memoizedProps:O,me=a.type,ke=a.updateQueue;if(a.updateQueue=null,ke!==null)try{me==="input"&&O.type==="radio"&&O.name!=null&&jn(z,O),ze(me,Q);var He=ze(me,O);for(Q=0;Q<ke.length;Q+=2){var ut=ke[Q],lt=ke[Q+1];ut==="style"?ve(z,lt):ut==="dangerouslySetInnerHTML"?Te(z,lt):ut==="children"?K(z,lt):Ie(z,ut,lt,He)}switch(me){case"input":Xi(z,O);break;case"textarea":vt(z,O);break;case"select":var ot=z._wrapperState.wasMultiple;z._wrapperState.wasMultiple=!!O.multiple;var Ot=O.value;Ot!=null?Be(z,!!O.multiple,Ot,!1):ot!==!!O.multiple&&(O.defaultValue!=null?Be(z,!!O.multiple,O.defaultValue,!0):Be(z,!!O.multiple,O.multiple?[]:"",!1))}z[Bo]=O}catch(Qt){$n(a,a.return,Qt)}}break;case 6:if(Ss(d,a),sn(a),C&4){if(a.stateNode===null)throw Error(u(162));z=a.stateNode,O=a.memoizedProps;try{z.nodeValue=O}catch(Qt){$n(a,a.return,Qt)}}break;case 3:if(Ss(d,a),sn(a),C&4&&x!==null&&x.memoizedState.isDehydrated)try{fs(d.containerInfo)}catch(Qt){$n(a,a.return,Qt)}break;case 4:Ss(d,a),sn(a);break;case 13:Ss(d,a),sn(a),z=a.child,z.flags&8192&&(O=z.memoizedState!==null,z.stateNode.isHidden=O,!O||z.alternate!==null&&z.alternate.memoizedState!==null||(Tp=Er())),C&4&&wp(a);break;case 22:if(ut=x!==null&&x.memoizedState!==null,a.mode&1?(Ui=(He=Ui)||ut,Ss(d,a),Ui=He):Ss(d,a),sn(a),C&8192){if(He=a.memoizedState!==null,(a.stateNode.isHidden=He)&&!ut&&(a.mode&1)!==0)for(Ut=a,ut=a.child;ut!==null;){for(lt=Ut=ut;Ut!==null;){switch(ot=Ut,Ot=ot.child,ot.tag){case 0:case 11:case 14:case 15:$u(4,ot,ot.return);break;case 1:Bu(ot,ot.return);var Vt=ot.stateNode;if(typeof Vt.componentWillUnmount=="function"){C=ot,x=ot.return;try{d=C,Vt.props=d.memoizedProps,Vt.state=d.memoizedState,Vt.componentWillUnmount()}catch(Qt){$n(C,x,Qt)}}break;case 5:Bu(ot,ot.return);break;case 22:if(ot.memoizedState!==null){nd(lt);continue}}Ot!==null?(Ot.return=ot,Ut=Ot):nd(lt)}ut=ut.sibling}e:for(ut=null,lt=a;;){if(lt.tag===5){if(ut===null){ut=lt;try{z=lt.stateNode,He?(O=z.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none"):(me=lt.stateNode,ke=lt.memoizedProps.style,Q=ke!=null&&ke.hasOwnProperty("display")?ke.display:null,me.style.display=ue("display",Q))}catch(Qt){$n(a,a.return,Qt)}}}else if(lt.tag===6){if(ut===null)try{lt.stateNode.nodeValue=He?"":lt.memoizedProps}catch(Qt){$n(a,a.return,Qt)}}else if((lt.tag!==22&&lt.tag!==23||lt.memoizedState===null||lt===a)&&lt.child!==null){lt.child.return=lt,lt=lt.child;continue}if(lt===a)break e;for(;lt.sibling===null;){if(lt.return===null||lt.return===a)break e;ut===lt&&(ut=null),lt=lt.return}ut===lt&&(ut=null),lt.sibling.return=lt.return,lt=lt.sibling}}break;case 19:Ss(d,a),sn(a),C&4&&wp(a);break;case 21:break;default:Ss(d,a),sn(a)}}function sn(a){var d=a.flags;if(d&2){try{e:{for(var x=a.return;x!==null;){if(Lm(x)){var C=x;break e}x=x.return}throw Error(u(160))}switch(C.tag){case 5:var z=C.stateNode;C.flags&32&&(K(z,""),C.flags&=-33);var O=Fm(a);bp(a,O,z);break;case 3:case 4:var Q=C.stateNode.containerInfo,me=Fm(a);xp(a,me,Q);break;default:throw Error(u(161))}}catch(ke){$n(a,a.return,ke)}a.flags&=-3}d&4096&&(a.flags&=-4097)}function Uu(a,d,x){Ut=a,Sp(a)}function Sp(a,d,x){for(var C=(a.mode&1)!==0;Ut!==null;){var z=Ut,O=z.child;if(z.tag===22&&C){var Q=z.memoizedState!==null||Nu;if(!Q){var me=z.alternate,ke=me!==null&&me.memoizedState!==null||Ui;me=Nu;var He=Ui;if(Nu=Q,(Ui=ke)&&!He)for(Ut=z;Ut!==null;)Q=Ut,ke=Q.child,Q.tag===22&&Q.memoizedState!==null?Vu(z):ke!==null?(ke.return=Q,Ut=ke):Vu(z);for(;O!==null;)Ut=O,Sp(O),O=O.sibling;Ut=z,Nu=me,Ui=He}rd(a)}else(z.subtreeFlags&8772)!==0&&O!==null?(O.return=z,Ut=O):rd(a)}}function rd(a){for(;Ut!==null;){var d=Ut;if((d.flags&8772)!==0){var x=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:Ui||ka(5,d);break;case 1:var C=d.stateNode;if(d.flags&4&&!Ui)if(x===null)C.componentDidMount();else{var z=d.elementType===d.type?x.memoizedProps:Xn(d.type,x.memoizedProps);C.componentDidUpdate(z,x.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var O=d.updateQueue;O!==null&&Lu(d,O,C);break;case 3:var Q=d.updateQueue;if(Q!==null){if(x=null,d.child!==null)switch(d.child.tag){case 5:x=d.child.stateNode;break;case 1:x=d.child.stateNode}Lu(d,Q,x)}break;case 5:var me=d.stateNode;if(x===null&&d.flags&4){x=me;var ke=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":ke.autoFocus&&x.focus();break;case"img":ke.src&&(x.src=ke.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var He=d.alternate;if(He!==null){var ut=He.memoizedState;if(ut!==null){var lt=ut.dehydrated;lt!==null&&fs(lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(u(163))}Ui||d.flags&512&&Zc(d)}catch(ot){$n(d,d.return,ot)}}if(d===a){Ut=null;break}if(x=d.sibling,x!==null){x.return=d.return,Ut=x;break}Ut=d.return}}function nd(a){for(;Ut!==null;){var d=Ut;if(d===a){Ut=null;break}var x=d.sibling;if(x!==null){x.return=d.return,Ut=x;break}Ut=d.return}}function Vu(a){for(;Ut!==null;){var d=Ut;try{switch(d.tag){case 0:case 11:case 15:var x=d.return;try{ka(4,d)}catch(ke){$n(d,x,ke)}break;case 1:var C=d.stateNode;if(typeof C.componentDidMount=="function"){var z=d.return;try{C.componentDidMount()}catch(ke){$n(d,z,ke)}}var O=d.return;try{Zc(d)}catch(ke){$n(d,O,ke)}break;case 5:var Q=d.return;try{Zc(d)}catch(ke){$n(d,Q,ke)}}}catch(ke){$n(d,d.return,ke)}if(d===a){Ut=null;break}var me=d.sibling;if(me!==null){me.return=d.return,Ut=me;break}Ut=d.return}}var Nm=Math.ceil,id=Le.ReactCurrentDispatcher,Gc=Le.ReactCurrentOwner,Ls=Le.ReactCurrentBatchConfig,Br=0,Yn=null,Sn=null,Qn=0,Js=0,qc=ni(0),Tn=0,sd=null,Yl=0,Ql=0,od=0,Zu=null,Ts=null,Tp=0,Gu=1/0,rl=null,sf=!1,Pp=null,eo=null,of=!1,Jl=null,ad=0,ld=0,af=null,lf=-1,qu=0;function mi(){return(Br&6)!==0?Er():lf!==-1?lf:lf=Er()}function Ia(a){return(a.mode&1)===0?1:(Br&2)!==0&&Qn!==0?Qn&-Qn:Wh.transition!==null?(qu===0&&(qu=Oa()),qu):(a=qr,a!==0||(a=window.event,a=a===void 0?16:Pl(a.type)),a)}function Jo(a,d,x,C){if(50<ld)throw ld=0,af=null,Error(u(185));ja(a,x,C),((Br&2)===0||a!==Yn)&&(a===Yn&&((Br&2)===0&&(Ql|=x),Tn===4&&To(a,Qn)),Fs(a,C),x===1&&Br===0&&(d.mode&1)===0&&(Gu=Er()+500,Go&&Sa()))}function Fs(a,d){var x=a.callbackNode;yh(a,d);var C=bl(a,a===Yn?Qn:0);if(C===0)x!==null&&hc(x),a.callbackNode=null,a.callbackPriority=0;else if(d=C&-C,a.callbackPriority!==d){if(x!=null&&hc(x),d===1)a.tag===0?ap(kp.bind(null,a)):Zl(kp.bind(null,a)),$h(function(){(Br&6)===0&&Sa()}),x=null;else{switch(ks(C)){case 1:x=xi;break;case 4:x=on;break;case 16:x=dc;break;case 536870912:x=fu;break;default:x=dc}x=uf(x,Cp.bind(null,a))}a.callbackPriority=d,a.callbackNode=x}}function Cp(a,d){if(lf=-1,qu=0,(Br&6)!==0)throw Error(u(327));var x=a.callbackNode;if(Wu()&&a.callbackNode!==x)return null;var C=bl(a,a===Yn?Qn:0);if(C===0)return null;if((C&30)!==0||(C&a.expiredLanes)!==0||d)d=ud(a,C);else{d=C;var z=Br;Br|=2;var O=Ap();(Yn!==a||Qn!==d)&&(rl=null,Gu=Er()+500,Hc(a,d));do try{Um();break}catch(me){Bm(a,me)}while(!0);Hl(),id.current=O,Br=z,Sn!==null?d=0:(Yn=null,Qn=0,d=Tn)}if(d!==0){if(d===2&&(z=mc(a),z!==0&&(C=z,d=cf(a,z))),d===1)throw x=sd,Hc(a,0),To(a,C),Fs(a,Er()),x;if(d===6)To(a,C);else{if(z=a.current.alternate,(C&30)===0&&!iy(z)&&(d=ud(a,C),d===2&&(O=mc(a),O!==0&&(C=O,d=cf(a,O))),d===1))throw x=sd,Hc(a,0),To(a,C),Fs(a,Er()),x;switch(a.finishedWork=z,a.finishedLanes=C,d){case 0:case 1:throw Error(u(345));case 2:Kc(a,Ts,rl);break;case 3:if(To(a,C),(C&130023424)===C&&(d=Tp+500-Er(),10<d)){if(bl(a,0)!==0)break;if(z=a.suspendedLanes,(z&C)!==C){mi(),a.pingedLanes|=a.suspendedLanes&z;break}a.timeoutHandle=Eu(Kc.bind(null,a,Ts,rl),d);break}Kc(a,Ts,rl);break;case 4:if(To(a,C),(C&4194240)===C)break;for(d=a.eventTimes,z=-1;0<C;){var Q=31-Es(C);O=1<<Q,Q=d[Q],Q>z&&(z=Q),C&=~O}if(C=z,C=Er()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*Nm(C/1960))-C,10<C){a.timeoutHandle=Eu(Kc.bind(null,a,Ts,rl),C);break}Kc(a,Ts,rl);break;case 5:Kc(a,Ts,rl);break;default:throw Error(u(329))}}}return Fs(a,Er()),a.callbackNode===x?Cp.bind(null,a):null}function cf(a,d){var x=Zu;return a.current.memoizedState.isDehydrated&&(Hc(a,d).flags|=256),a=ud(a,d),a!==2&&(d=Ts,Ts=x,d!==null&&Ep(d)),a}function Ep(a){Ts===null?Ts=a:Ts.push.apply(Ts,a)}function iy(a){for(var d=a;;){if(d.flags&16384){var x=d.updateQueue;if(x!==null&&(x=x.stores,x!==null))for(var C=0;C<x.length;C++){var z=x[C],O=z.getSnapshot;z=z.value;try{if(!qs(O(),z))return!1}catch{return!1}}}if(x=d.child,d.subtreeFlags&16384&&x!==null)x.return=d,d=x;else{if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function To(a,d){for(d&=~od,d&=~Ql,a.suspendedLanes|=d,a.pingedLanes&=~d,a=a.expirationTimes;0<d;){var x=31-Es(d),C=1<<x;a[x]=-1,d&=~C}}function kp(a){if((Br&6)!==0)throw Error(u(327));Wu();var d=bl(a,0);if((d&1)===0)return Fs(a,Er()),null;var x=ud(a,d);if(a.tag!==0&&x===2){var C=mc(a);C!==0&&(d=C,x=cf(a,C))}if(x===1)throw x=sd,Hc(a,0),To(a,d),Fs(a,Er()),x;if(x===6)throw Error(u(345));return a.finishedWork=a.current.alternate,a.finishedLanes=d,Kc(a,Ts,rl),Fs(a,Er()),null}function Mp(a,d){var x=Br;Br|=1;try{return a(d)}finally{Br=x,Br===0&&(Gu=Er()+500,Go&&Sa())}}function Wc(a){Jl!==null&&Jl.tag===0&&(Br&6)===0&&Wu();var d=Br;Br|=1;var x=Ls.transition,C=qr;try{if(Ls.transition=null,qr=1,a)return a()}finally{qr=C,Ls.transition=x,Br=d,(Br&6)===0&&Sa()}}function Ip(){Js=qc.current,rn(qc)}function Hc(a,d){a.finishedWork=null,a.finishedLanes=0;var x=a.timeoutHandle;if(x!==-1&&(a.timeoutHandle=-1,Qd(x)),Sn!==null)for(x=Sn.return;x!==null;){var C=x;switch(Zh(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&Zo();break;case 3:h(),rn(Ri),rn(ii),R();break;case 5:y(C);break;case 4:h();break;case 13:rn(S);break;case 19:rn(S);break;case 10:fi(C.type._context);break;case 22:case 23:Ip()}x=x.return}if(Yn=a,Sn=a=nl(a.current,null),Qn=Js=d,Tn=0,sd=null,od=Ql=Yl=0,Ts=Zu=null,Ks!==null){for(d=0;d<Ks.length;d++)if(x=Ks[d],C=x.interleaved,C!==null){x.interleaved=null;var z=C.next,O=x.pending;if(O!==null){var Q=O.next;O.next=z,C.next=Q}x.pending=C}Ks=null}return a}function Bm(a,d){do{var x=Sn;try{if(Hl(),D.current=Bi,se){for(var C=$.memoizedState;C!==null;){var z=C.queue;z!==null&&(z.pending=null),C=C.next}se=!1}if(j=0,re=W=$=null,oe=!1,ae=0,Gc.current=null,x===null||x.return===null){Tn=1,sd=d,Sn=null;break}e:{var O=a,Q=x.return,me=x,ke=d;if(d=Qn,me.flags|=32768,ke!==null&&typeof ke=="object"&&typeof ke.then=="function"){var He=ke,ut=me,lt=ut.tag;if((ut.mode&1)===0&&(lt===0||lt===11||lt===15)){var ot=ut.alternate;ot?(ut.updateQueue=ot.updateQueue,ut.memoizedState=ot.memoizedState,ut.lanes=ot.lanes):(ut.updateQueue=null,ut.memoizedState=null)}var Ot=cp(Q);if(Ot!==null){Ot.flags&=-257,Pm(Ot,Q,me,O,d),Ot.mode&1&&Jd(O,He,d),d=Ot,ke=He;var Vt=d.updateQueue;if(Vt===null){var Qt=new Set;Qt.add(ke),d.updateQueue=Qt}else Vt.add(ke);break e}else{if((d&1)===0){Jd(O,He,d),cd();break e}ke=Error(u(426))}}else if(vn&&me.mode&1){var Mn=cp(Q);if(Mn!==null){(Mn.flags&65536)===0&&(Mn.flags|=256),Pm(Mn,Q,me,O,d),Ta(Xo(ke,me));break e}}O=ke=Xo(ke,me),Tn!==4&&(Tn=2),Zu===null?Zu=[O]:Zu.push(O),O=Q;do{switch(O.tag){case 3:O.flags|=65536,d&=-d,O.lanes|=d;var Ve=lp(O,ke,d);Bc(O,Ve);break e;case 1:me=ke;var De=O.type,Ge=O.stateNode;if((O.flags&128)===0&&(typeof De.getDerivedStateFromError=="function"||Ge!==null&&typeof Ge.componentDidCatch=="function"&&(eo===null||!eo.has(Ge)))){O.flags|=65536,d&=-d,O.lanes|=d;var bt=Tm(O,me,d);Bc(O,bt);break e}}O=O.return}while(O!==null)}hd(x)}catch(Gt){d=Gt,Sn===x&&x!==null&&(Sn=x=x.return);continue}break}while(!0)}function Ap(){var a=id.current;return id.current=Bi,a===null?Bi:a}function cd(){(Tn===0||Tn===3||Tn===2)&&(Tn=4),Yn===null||(Yl&268435455)===0&&(Ql&268435455)===0||To(Yn,Qn)}function ud(a,d){var x=Br;Br|=2;var C=Ap();(Yn!==a||Qn!==d)&&(rl=null,Hc(a,d));do try{$m();break}catch(z){Bm(a,z)}while(!0);if(Hl(),Br=x,id.current=C,Sn!==null)throw Error(u(261));return Yn=null,Qn=0,Tn}function $m(){for(;Sn!==null;)Vm(Sn)}function Um(){for(;Sn!==null&&!lo();)Vm(Sn)}function Vm(a){var d=Jn(a.alternate,a,Js);a.memoizedProps=a.pendingProps,d===null?hd(a):Sn=d,Gc.current=null}function hd(a){var d=a;do{var x=d.alternate;if(a=d.return,(d.flags&32768)===0){if(x=zm(x,d,Js),x!==null){Sn=x;return}}else{if(x=ny(x,d),x!==null){x.flags&=32767,Sn=x;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Tn=6,Sn=null;return}}if(d=d.sibling,d!==null){Sn=d;return}Sn=d=a}while(d!==null);Tn===0&&(Tn=5)}function Kc(a,d,x){var C=qr,z=Ls.transition;try{Ls.transition=null,qr=1,Zm(a,d,x,C)}finally{Ls.transition=z,qr=C}return null}function Zm(a,d,x,C){do Wu();while(Jl!==null);if((Br&6)!==0)throw Error(u(327));x=a.finishedWork;var z=a.finishedLanes;if(x===null)return null;if(a.finishedWork=null,a.finishedLanes=0,x===a.current)throw Error(u(177));a.callbackNode=null,a.callbackPriority=0;var O=x.lanes|x.childLanes;if(Yf(a,O),a===Yn&&(Sn=Yn=null,Qn=0),(x.subtreeFlags&2064)===0&&(x.flags&2064)===0||of||(of=!0,uf(dc,function(){return Wu(),null})),O=(x.flags&15990)!==0,(x.subtreeFlags&15990)!==0||O){O=Ls.transition,Ls.transition=null;var Q=qr;qr=1;var me=Br;Br|=4,Gc.current=null,vp(a,x),jm(x,a),Su(No),bi=!!Ul,No=Ul=null,a.current=x,Uu(x),vl(),Br=me,qr=Q,Ls.transition=O}else a.current=x;if(of&&(of=!1,Jl=a,ad=z),O=a.pendingLanes,O===0&&(eo=null),gh(x.stateNode),Fs(a,Er()),d!==null)for(C=a.onRecoverableError,x=0;x<d.length;x++)z=d[x],C(z.value,{componentStack:z.stack,digest:z.digest});if(sf)throw sf=!1,a=Pp,Pp=null,a;return(ad&1)!==0&&a.tag!==0&&Wu(),O=a.pendingLanes,(O&1)!==0?a===af?ld++:(ld=0,af=a):ld=0,Sa(),null}function Wu(){if(Jl!==null){var a=ks(ad),d=Ls.transition,x=qr;try{if(Ls.transition=null,qr=16>a?16:a,Jl===null)var C=!1;else{if(a=Jl,Jl=null,ad=0,(Br&6)!==0)throw Error(u(331));var z=Br;for(Br|=4,Ut=a.current;Ut!==null;){var O=Ut,Q=O.child;if((Ut.flags&16)!==0){var me=O.deletions;if(me!==null){for(var ke=0;ke<me.length;ke++){var He=me[ke];for(Ut=He;Ut!==null;){var ut=Ut;switch(ut.tag){case 0:case 11:case 15:$u(8,ut,O)}var lt=ut.child;if(lt!==null)lt.return=ut,Ut=lt;else for(;Ut!==null;){ut=Ut;var ot=ut.sibling,Ot=ut.return;if(Dm(ut),ut===He){Ut=null;break}if(ot!==null){ot.return=Ot,Ut=ot;break}Ut=Ot}}}var Vt=O.alternate;if(Vt!==null){var Qt=Vt.child;if(Qt!==null){Vt.child=null;do{var Mn=Qt.sibling;Qt.sibling=null,Qt=Mn}while(Qt!==null)}}Ut=O}}if((O.subtreeFlags&2064)!==0&&Q!==null)Q.return=O,Ut=Q;else e:for(;Ut!==null;){if(O=Ut,(O.flags&2048)!==0)switch(O.tag){case 0:case 11:case 15:$u(9,O,O.return)}var Ve=O.sibling;if(Ve!==null){Ve.return=O.return,Ut=Ve;break e}Ut=O.return}}var De=a.current;for(Ut=De;Ut!==null;){Q=Ut;var Ge=Q.child;if((Q.subtreeFlags&2064)!==0&&Ge!==null)Ge.return=Q,Ut=Ge;else e:for(Q=De;Ut!==null;){if(me=Ut,(me.flags&2048)!==0)try{switch(me.tag){case 0:case 11:case 15:ka(9,me)}}catch(Gt){$n(me,me.return,Gt)}if(me===Q){Ut=null;break e}var bt=me.sibling;if(bt!==null){bt.return=me.return,Ut=bt;break e}Ut=me.return}}if(Br=z,Sa(),ui&&typeof ui.onPostCommitFiberRoot=="function")try{ui.onPostCommitFiberRoot(Ns,a)}catch{}C=!0}return C}finally{qr=x,Ls.transition=d}}return!1}function Gm(a,d,x){d=Xo(x,d),d=lp(a,d,1),a=rs(a,d,1),d=mi(),a!==null&&(ja(a,1,d),Fs(a,d))}function $n(a,d,x){if(a.tag===3)Gm(a,a,x);else for(;d!==null;){if(d.tag===3){Gm(d,a,x);break}else if(d.tag===1){var C=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(eo===null||!eo.has(C))){a=Xo(x,a),a=Tm(d,a,1),d=rs(d,a,1),a=mi(),d!==null&&(ja(d,1,a),Fs(d,a));break}}d=d.return}}function qm(a,d,x){var C=a.pingCache;C!==null&&C.delete(d),d=mi(),a.pingedLanes|=a.suspendedLanes&x,Yn===a&&(Qn&x)===x&&(Tn===4||Tn===3&&(Qn&130023424)===Qn&&500>Er()-Tp?Hc(a,0):od|=x),Fs(a,d)}function Wm(a,d){d===0&&((a.mode&1)===0?d=1:(d=mu,mu<<=1,(mu&130023424)===0&&(mu=4194304)));var x=mi();a=zs(a,d),a!==null&&(ja(a,d,x),Fs(a,x))}function sy(a){var d=a.memoizedState,x=0;d!==null&&(x=d.retryLane),Wm(a,x)}function dd(a,d){var x=0;switch(a.tag){case 13:var C=a.stateNode,z=a.memoizedState;z!==null&&(x=z.retryLane);break;case 19:C=a.stateNode;break;default:throw Error(u(314))}C!==null&&C.delete(d),Wm(a,x)}var Jn;Jn=function(a,d,x){if(a!==null)if(a.memoizedProps!==d.pendingProps||Ri.current)Ds=!0;else{if((a.lanes&x)===0&&(d.flags&128)===0)return Ds=!1,ws(a,d,x);Ds=(a.flags&131072)!==0}else Ds=!1,vn&&(d.flags&1048576)!==0&&Fr(d,Et,d.index);switch(d.lanes=0,d.tag){case 2:var C=d.type;ju(a,d),a=d.pendingProps;var z=Hs(d,ii.current);pi(d,x),z=we(null,d,C,a,z,x);var O=he();return d.flags|=1,typeof z=="object"&&z!==null&&typeof z.render=="function"&&z.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,wi(C)?(O=!0,Yi(d)):O=!1,d.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,Pa(d),z.updater=Ys,d.stateNode=z,z._reactInternals=d,Uc(d,C,a,x),d=Ou(null,d,C,!0,O,x)):(d.tag=0,vn&&O&&Gl(d),$i(null,d,z,x),d=d.child),d;case 16:C=d.elementType;e:{switch(ju(a,d),a=d.pendingProps,z=C._init,C=z(C._payload),d.type=C,z=d.tag=Hu(C),a=Xn(C,a),z){case 0:d=dp(null,d,C,a,x);break e;case 1:d=Fu(null,d,C,a,x);break e;case 11:d=Em(null,d,C,a,x);break e;case 14:d=ef(null,d,C,Xn(C.type,a),x);break e}throw Error(u(306,C,""))}return d;case 0:return C=d.type,z=d.pendingProps,z=d.elementType===C?z:Xn(C,z),dp(a,d,C,z,x);case 1:return C=d.type,z=d.pendingProps,z=d.elementType===C?z:Xn(C,z),Fu(a,d,C,z,x);case 3:e:{if(Yh(d),a===null)throw Error(u(387));C=d.pendingProps,O=d.memoizedState,z=O.element,Du(a,d),bo(d,C,null,x);var Q=d.memoizedState;if(C=Q.element,O.isDehydrated)if(O={element:C,isDehydrated:!1,cache:Q.cache,pendingSuspenseBoundaries:Q.pendingSuspenseBoundaries,transitions:Q.transitions},d.updateQueue.baseState=O,d.memoizedState=O,d.flags&256){z=Xo(Error(u(423)),d),d=fp(a,d,C,x,z);break e}else if(C!==z){z=Xo(Error(u(424)),d),d=fp(a,d,C,x,z);break e}else for(ys=tn(d.stateNode.containerInfo.firstChild),Si=d,vn=!0,_s=null,x=Nc(d,null,C,x),d.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling;else{if(Wr(),C===z){d=Qs(a,d,x);break e}$i(a,d,C,x)}d=d.child}return d;case 5:return p(d),a===null&&Oc(d),C=d.type,z=d.pendingProps,O=a!==null?a.memoizedProps:null,Q=z.children,Rc(C,z)?Q=null:O!==null&&Rc(C,O)&&(d.flags|=32),Vc(a,d),$i(a,d,Q,x),d.child;case 6:return a===null&&Oc(d),null;case 13:return km(a,d,x);case 4:return s(d,d.stateNode.containerInfo),C=d.pendingProps,a===null?d.child=Oi(d,null,C,x):$i(a,d,C,x),d.child;case 11:return C=d.type,z=d.pendingProps,z=d.elementType===C?z:Xn(C,z),Em(a,d,C,z,x);case 7:return $i(a,d,d.pendingProps,x),d.child;case 8:return $i(a,d,d.pendingProps.children,x),d.child;case 12:return $i(a,d,d.pendingProps.children,x),d.child;case 10:e:{if(C=d.type._context,z=d.pendingProps,O=d.memoizedProps,Q=z.value,Or(Lt,C._currentValue),C._currentValue=Q,O!==null)if(qs(O.value,Q)){if(O.children===z.children&&!Ri.current){d=Qs(a,d,x);break e}}else for(O=d.child,O!==null&&(O.return=d);O!==null;){var me=O.dependencies;if(me!==null){Q=O.child;for(var ke=me.firstContext;ke!==null;){if(ke.context===C){if(O.tag===1){ke=ts(-1,x&-x),ke.tag=2;var He=O.updateQueue;if(He!==null){He=He.shared;var ut=He.pending;ut===null?ke.next=ke:(ke.next=ut.next,ut.next=ke),He.pending=ke}}O.lanes|=x,ke=O.alternate,ke!==null&&(ke.lanes|=x),Ru(O.return,x,d),me.lanes|=x;break}ke=ke.next}}else if(O.tag===10)Q=O.type===d.type?null:O.child;else if(O.tag===18){if(Q=O.return,Q===null)throw Error(u(341));Q.lanes|=x,me=Q.alternate,me!==null&&(me.lanes|=x),Ru(Q,x,d),Q=O.sibling}else Q=O.child;if(Q!==null)Q.return=O;else for(Q=O;Q!==null;){if(Q===d){Q=null;break}if(O=Q.sibling,O!==null){O.return=Q.return,Q=O;break}Q=Q.return}O=Q}$i(a,d,z.children,x),d=d.child}return d;case 9:return z=d.type,C=d.pendingProps.children,pi(d,x),z=As(z),C=C(z),d.flags|=1,$i(a,d,C,x),d.child;case 14:return C=d.type,z=Xn(C,d.pendingProps),z=Xn(C.type,z),ef(a,d,C,z,x);case 15:return up(a,d,d.type,d.pendingProps,x);case 17:return C=d.type,z=d.pendingProps,z=d.elementType===C?z:Xn(C,z),ju(a,d),d.tag=1,wi(C)?(a=!0,Yi(d)):a=!1,pi(d,x),ns(d,C,z),Uc(d,C,z,x),Ou(null,d,C,!0,a,x);case 19:return mp(a,d,x);case 22:return hp(a,d,x)}throw Error(u(156,d.tag))};function uf(a,d){return Io(a,d)}function Hm(a,d,x,C){this.tag=a,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function to(a,d,x,C){return new Hm(a,d,x,C)}function fd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Hu(a){if(typeof a=="function")return fd(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Rt)return 11;if(a===Rr)return 14}return 2}function nl(a,d){var x=a.alternate;return x===null?(x=to(a.tag,d,a.key,a.mode),x.elementType=a.elementType,x.type=a.type,x.stateNode=a.stateNode,x.alternate=a,a.alternate=x):(x.pendingProps=d,x.type=a.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=a.flags&14680064,x.childLanes=a.childLanes,x.lanes=a.lanes,x.child=a.child,x.memoizedProps=a.memoizedProps,x.memoizedState=a.memoizedState,x.updateQueue=a.updateQueue,d=a.dependencies,x.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},x.sibling=a.sibling,x.index=a.index,x.ref=a.ref,x}function hf(a,d,x,C,z,O){var Q=2;if(C=a,typeof a=="function")fd(a)&&(Q=1);else if(typeof a=="string")Q=5;else e:switch(a){case yt:return Xc(x.children,z,O,d);case Qe:Q=8,z|=8;break;case it:return a=to(12,x,d,z|2),a.elementType=it,a.lanes=O,a;case At:return a=to(13,x,d,z),a.elementType=At,a.lanes=O,a;case Ht:return a=to(19,x,d,z),a.elementType=Ht,a.lanes=O,a;case Zt:return df(x,z,O,d);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case at:Q=10;break e;case It:Q=9;break e;case Rt:Q=11;break e;case Rr:Q=14;break e;case ar:Q=16,C=null;break e}throw Error(u(130,a==null?a:typeof a,""))}return d=to(Q,x,d,z),d.elementType=a,d.type=C,d.lanes=O,d}function Xc(a,d,x,C){return a=to(7,a,C,d),a.lanes=x,a}function df(a,d,x,C){return a=to(22,a,C,d),a.elementType=Zt,a.lanes=x,a.stateNode={isHidden:!1},a}function zp(a,d,x){return a=to(6,a,null,d),a.lanes=x,a}function Rp(a,d,x){return d=to(4,a.children!==null?a.children:[],a.key,d),d.lanes=x,d.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},d}function oy(a,d,x,C,z){this.tag=d,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gc(0),this.expirationTimes=gc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gc(0),this.identifierPrefix=C,this.onRecoverableError=z,this.mutableSourceEagerHydrationData=null}function Dp(a,d,x,C,z,O,Q,me,ke){return a=new oy(a,d,x,me,ke),d===1?(d=1,O===!0&&(d|=8)):d=0,O=to(3,null,null,d),a.current=O,O.stateNode=a,O.memoizedState={element:C,isDehydrated:x,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pa(O),a}function ay(a,d,x){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:mt,key:C==null?null:""+C,children:a,containerInfo:d,implementation:x}}function Km(a){if(!a)return gs;a=a._reactInternals;e:{if(pr(a)!==a||a.tag!==1)throw Error(u(170));var d=a;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(wi(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(u(171))}if(a.tag===1){var x=a.type;if(wi(x))return Di(a,x,d)}return d}function Xm(a,d,x,C,z,O,Q,me,ke){return a=Dp(x,C,!0,a,z,O,Q,me,ke),a.context=Km(null),x=a.current,C=mi(),z=Ia(x),O=ts(C,z),O.callback=d??null,rs(x,O,z),a.current.lanes=z,ja(a,z,C),Fs(a,C),a}function ff(a,d,x,C){var z=d.current,O=mi(),Q=Ia(z);return x=Km(x),d.context===null?d.context=x:d.pendingContext=x,d=ts(O,Q),d.payload={element:a},C=C===void 0?null:C,C!==null&&(d.callback=C),a=rs(z,d,Q),a!==null&&(Jo(a,z,Q,O),Ca(a,z,Q)),Q}function pf(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Lp(a,d){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var x=a.retryLane;a.retryLane=x!==0&&x<d?x:d}}function pd(a,d){Lp(a,d),(a=a.alternate)&&Lp(a,d)}function Ym(){return null}var il=typeof reportError=="function"?reportError:function(a){console.error(a)};function Yc(a){this._internalRoot=a}sl.prototype.render=Yc.prototype.render=function(a){var d=this._internalRoot;if(d===null)throw Error(u(409));ff(a,d,null,null)},sl.prototype.unmount=Yc.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var d=a.containerInfo;Wc(function(){ff(null,a,null,null)}),d[go]=null}};function sl(a){this._internalRoot=a}sl.prototype.unstable_scheduleHydration=function(a){if(a){var d=co();a={blockedOn:null,target:a,priority:d};for(var x=0;x<fn.length&&d!==0&&d<fn[x].priority;x++);fn.splice(x,0,a),x===0&&hi(a)}};function Ku(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Qc(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Qm(){}function ly(a,d,x,C,z){if(z){if(typeof C=="function"){var O=C;C=function(){var He=pf(Q);O.call(He)}}var Q=Xm(d,C,a,0,null,!1,!1,"",Qm);return a._reactRootContainer=Q,a[go]=Q.current,ba(a.nodeType===8?a.parentNode:a),Wc(),Q}for(;z=a.lastChild;)a.removeChild(z);if(typeof C=="function"){var me=C;C=function(){var He=pf(ke);me.call(He)}}var ke=Dp(a,0,!1,null,null,!1,!1,"",Qm);return a._reactRootContainer=ke,a[go]=ke.current,ba(a.nodeType===8?a.parentNode:a),Wc(function(){ff(d,ke,x,C)}),ke}function md(a,d,x,C,z){var O=x._reactRootContainer;if(O){var Q=O;if(typeof z=="function"){var me=z;z=function(){var ke=pf(Q);me.call(ke)}}ff(d,Q,a,z)}else Q=ly(x,d,a,z,C);return pf(Q)}kr=function(a){switch(a.tag){case 3:var d=a.stateNode;if(d.current.memoizedState.isDehydrated){var x=pc(d.pendingLanes);x!==0&&(ca(d,x|1),Fs(d,Er()),(Br&6)===0&&(Gu=Er()+500,Sa()))}break;case 13:Wc(function(){var C=zs(a,1);if(C!==null){var z=mi();Jo(C,a,1,z)}}),pd(a,1)}},Ao=function(a){if(a.tag===13){var d=zs(a,134217728);if(d!==null){var x=mi();Jo(d,a,134217728,x)}pd(a,134217728)}},zo=function(a){if(a.tag===13){var d=Ia(a),x=zs(a,d);if(x!==null){var C=mi();Jo(x,a,d,C)}pd(a,d)}},co=function(){return qr},ua=function(a,d){var x=qr;try{return qr=a,d()}finally{qr=x}},Je=function(a,d,x){switch(d){case"input":if(Xi(a,x),d=x.name,x.type==="radio"&&d!=null){for(x=a;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<x.length;d++){var C=x[d];if(C!==a&&C.form===a.form){var z=Fc(C);if(!z)throw Error(u(90));ln(C),Xi(C,z)}}}break;case"textarea":vt(a,x);break;case"select":d=x.value,d!=null&&Be(a,!!x.multiple,d,!1)}},Xt=Mp,Cr=Wc;var Jm={usingClientEntryPoint:!1,Events:[Vl,Ha,Fc,rr,Dt,Mp]},gd={findFiberByHostInstance:Vo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eg={bundleType:gd.bundleType,version:gd.version,rendererPackageName:gd.rendererPackageName,rendererConfig:gd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Le.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=xr(a),a===null?null:a.stateNode},findFiberByHostInstance:gd.findFiberByHostInstance||Ym,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yd.isDisabled&&yd.supportsFiber)try{Ns=yd.inject(eg),ui=yd}catch{}}return Po.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jm,Po.createPortal=function(a,d){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ku(d))throw Error(u(200));return ay(a,d,null,x)},Po.createRoot=function(a,d){if(!Ku(a))throw Error(u(299));var x=!1,C="",z=il;return d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(C=d.identifierPrefix),d.onRecoverableError!==void 0&&(z=d.onRecoverableError)),d=Dp(a,1,!1,null,null,x,!1,C,z),a[go]=d.current,ba(a.nodeType===8?a.parentNode:a),new Yc(d)},Po.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var d=a._reactInternals;if(d===void 0)throw typeof a.render=="function"?Error(u(188)):(a=Object.keys(a).join(","),Error(u(268,a)));return a=xr(d),a=a===null?null:a.stateNode,a},Po.flushSync=function(a){return Wc(a)},Po.hydrate=function(a,d,x){if(!Qc(d))throw Error(u(200));return md(null,a,d,!0,x)},Po.hydrateRoot=function(a,d,x){if(!Ku(a))throw Error(u(405));var C=x!=null&&x.hydratedSources||null,z=!1,O="",Q=il;if(x!=null&&(x.unstable_strictMode===!0&&(z=!0),x.identifierPrefix!==void 0&&(O=x.identifierPrefix),x.onRecoverableError!==void 0&&(Q=x.onRecoverableError)),d=Xm(d,null,a,1,x??null,z,!1,O,Q),a[go]=d.current,ba(a),C)for(a=0;a<C.length;a++)x=C[a],z=x._getVersion,z=z(x._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[x,z]:d.mutableSourceEagerHydrationData.push(x,z);return new sl(d)},Po.render=function(a,d,x){if(!Qc(d))throw Error(u(200));return md(null,a,d,!1,x)},Po.unmountComponentAtNode=function(a){if(!Qc(a))throw Error(u(40));return a._reactRootContainer?(Wc(function(){md(null,null,a,!1,function(){a._reactRootContainer=null,a[go]=null})}),!0):!1},Po.unstable_batchedUpdates=Mp,Po.unstable_renderSubtreeIntoContainer=function(a,d,x,C){if(!Qc(x))throw Error(u(200));if(a==null||a._reactInternals===void 0)throw Error(u(38));return md(a,d,x,!1,C)},Po.version="18.3.1-next-f1338f8080-20240426",Po}var ix;function X0(){if(ix)return Ey.exports;ix=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(o){console.error(o)}}return n(),Ey.exports=ww(),Ey.exports}var sx;function Sw(){if(sx)return lg;sx=1;var n=X0();return lg.createRoot=n.createRoot,lg.hydrateRoot=n.hydrateRoot,lg}var Tw=Sw();const Pw=k_(Tw);/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var ox="popstate";function Cw(n={}){function o(m,b){let{pathname:P,search:w,hash:l}=m.location;return By("",{pathname:P,search:w,hash:l},b.state&&b.state.usr||null,b.state&&b.state.key||"default")}function u(m,b){return typeof b=="string"?b:Jp(b)}return kw(o,u,null,n)}function Un(n,o){if(n===!1||n===null||typeof n>"u")throw new Error(o)}function ml(n,o){if(!n){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function Ew(){return Math.random().toString(36).substring(2,10)}function ax(n,o){return{usr:n.state,key:n.key,idx:o}}function By(n,o,u=null,m){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof o=="string"?Vf(o):o,state:u,key:o&&o.key||m||Ew()}}function Jp({pathname:n="/",search:o="",hash:u=""}){return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),u&&u!=="#"&&(n+=u.charAt(0)==="#"?u:"#"+u),n}function Vf(n){let o={};if(n){let u=n.indexOf("#");u>=0&&(o.hash=n.substring(u),n=n.substring(0,u));let m=n.indexOf("?");m>=0&&(o.search=n.substring(m),n=n.substring(0,m)),n&&(o.pathname=n)}return o}function kw(n,o,u,m={}){let{window:b=document.defaultView,v5Compat:P=!1}=m,w=b.history,l="POP",L=null,B=V();B==null&&(B=0,w.replaceState({...w.state,idx:B},""));function V(){return(w.state||{idx:null}).idx}function G(){l="POP";let fe=V(),Fe=fe==null?null:fe-B;B=fe,L&&L({action:l,location:ye.location,delta:Fe})}function te(fe,Fe){l="PUSH";let Ce=By(ye.location,fe,Fe);B=V()+1;let Ie=ax(Ce,B),Le=ye.createHref(Ce);try{w.pushState(Ie,"",Le)}catch(Xe){if(Xe instanceof DOMException&&Xe.name==="DataCloneError")throw Xe;b.location.assign(Le)}P&&L&&L({action:l,location:ye.location,delta:1})}function q(fe,Fe){l="REPLACE";let Ce=By(ye.location,fe,Fe);B=V();let Ie=ax(Ce,B),Le=ye.createHref(Ce);w.replaceState(Ie,"",Le),P&&L&&L({action:l,location:ye.location,delta:0})}function Se(fe){return Mw(fe)}let ye={get action(){return l},get location(){return n(b,w)},listen(fe){if(L)throw new Error("A history only accepts one active listener");return b.addEventListener(ox,G),L=fe,()=>{b.removeEventListener(ox,G),L=null}},createHref(fe){return o(b,fe)},createURL:Se,encodeLocation(fe){let Fe=Se(fe);return{pathname:Fe.pathname,search:Fe.search,hash:Fe.hash}},push:te,replace:q,go(fe){return w.go(fe)}};return ye}function Mw(n,o=!1){let u="http://localhost";typeof window<"u"&&(u=window.location.origin!=="null"?window.location.origin:window.location.href),Un(u,"No window.location.(origin|href) available to create URL");let m=typeof n=="string"?n:Jp(n);return m=m.replace(/ $/,"%20"),!o&&m.startsWith("//")&&(m=u+m),new URL(m,u)}function Y0(n,o,u="/"){return Iw(n,o,u,!1)}function Iw(n,o,u,m){let b=typeof o=="string"?Vf(o):o,P=cu(b.pathname||"/",u);if(P==null)return null;let w=Q0(n);Aw(w);let l=null;for(let L=0;l==null&&L<w.length;++L){let B=Uw(P);l=Bw(w[L],B,m)}return l}function Q0(n,o=[],u=[],m="",b=!1){let P=(w,l,L=b,B)=>{let V={relativePath:B===void 0?w.path||"":B,caseSensitive:w.caseSensitive===!0,childrenIndex:l,route:w};if(V.relativePath.startsWith("/")){if(!V.relativePath.startsWith(m)&&L)return;Un(V.relativePath.startsWith(m),`Absolute route path "${V.relativePath}" nested under path "${m}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),V.relativePath=V.relativePath.slice(m.length)}let G=au([m,V.relativePath]),te=u.concat(V);w.children&&w.children.length>0&&(Un(w.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${G}".`),Q0(w.children,o,te,G,L)),!(w.path==null&&!w.index)&&o.push({path:G,score:jw(G,w.index),routesMeta:te})};return n.forEach((w,l)=>{var L;if(w.path===""||!((L=w.path)!=null&&L.includes("?")))P(w,l);else for(let B of J0(w.path))P(w,l,!0,B)}),o}function J0(n){let o=n.split("/");if(o.length===0)return[];let[u,...m]=o,b=u.endsWith("?"),P=u.replace(/\?$/,"");if(m.length===0)return b?[P,""]:[P];let w=J0(m.join("/")),l=[];return l.push(...w.map(L=>L===""?P:[P,L].join("/"))),b&&l.push(...w),l.map(L=>n.startsWith("/")&&L===""?"/":L)}function Aw(n){n.sort((o,u)=>o.score!==u.score?u.score-o.score:Nw(o.routesMeta.map(m=>m.childrenIndex),u.routesMeta.map(m=>m.childrenIndex)))}var zw=/^:[\w-]+$/,Rw=3,Dw=2,Lw=1,Fw=10,Ow=-2,lx=n=>n==="*";function jw(n,o){let u=n.split("/"),m=u.length;return u.some(lx)&&(m+=Ow),o&&(m+=Dw),u.filter(b=>!lx(b)).reduce((b,P)=>b+(zw.test(P)?Rw:P===""?Lw:Fw),m)}function Nw(n,o){return n.length===o.length&&n.slice(0,-1).every((m,b)=>m===o[b])?n[n.length-1]-o[o.length-1]:0}function Bw(n,o,u=!1){let{routesMeta:m}=n,b={},P="/",w=[];for(let l=0;l<m.length;++l){let L=m[l],B=l===m.length-1,V=P==="/"?o:o.slice(P.length)||"/",G=Pg({path:L.relativePath,caseSensitive:L.caseSensitive,end:B},V),te=L.route;if(!G&&B&&u&&!m[m.length-1].route.index&&(G=Pg({path:L.relativePath,caseSensitive:L.caseSensitive,end:!1},V)),!G)return null;Object.assign(b,G.params),w.push({params:b,pathname:au([P,G.pathname]),pathnameBase:qw(au([P,G.pathnameBase])),route:te}),G.pathnameBase!=="/"&&(P=au([P,G.pathnameBase]))}return w}function Pg(n,o){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[u,m]=$w(n.path,n.caseSensitive,n.end),b=o.match(u);if(!b)return null;let P=b[0],w=P.replace(/(.)\/+$/,"$1"),l=b.slice(1);return{params:m.reduce((B,{paramName:V,isOptional:G},te)=>{if(V==="*"){let Se=l[te]||"";w=P.slice(0,P.length-Se.length).replace(/(.)\/+$/,"$1")}const q=l[te];return G&&!q?B[V]=void 0:B[V]=(q||"").replace(/%2F/g,"/"),B},{}),pathname:P,pathnameBase:w,pattern:n}}function $w(n,o=!1,u=!0){ml(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let m=[],b="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(w,l,L)=>(m.push({paramName:l,isOptional:L!=null}),L?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(m.push({paramName:"*"}),b+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):u?b+="\\/*$":n!==""&&n!=="/"&&(b+="(?:(?=\\/|$))"),[new RegExp(b,o?void 0:"i"),m]}function Uw(n){try{return n.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return ml(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${o}).`),n}}function cu(n,o){if(o==="/")return n;if(!n.toLowerCase().startsWith(o.toLowerCase()))return null;let u=o.endsWith("/")?o.length-1:o.length,m=n.charAt(u);return m&&m!=="/"?null:n.slice(u)||"/"}function Vw(n,o="/"){let{pathname:u,search:m="",hash:b=""}=typeof n=="string"?Vf(n):n;return{pathname:u?u.startsWith("/")?u:Zw(u,o):o,search:Ww(m),hash:Hw(b)}}function Zw(n,o){let u=o.replace(/\/+$/,"").split("/");return n.split("/").forEach(b=>{b===".."?u.length>1&&u.pop():b!=="."&&u.push(b)}),u.length>1?u.join("/"):"/"}function Iy(n,o,u,m){return`Cannot include a '${n}' character in a manually specified \`to.${o}\` field [${JSON.stringify(m)}].  Please separate it out to the \`to.${u}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Gw(n){return n.filter((o,u)=>u===0||o.route.path&&o.route.path.length>0)}function I_(n){let o=Gw(n);return o.map((u,m)=>m===o.length-1?u.pathname:u.pathnameBase)}function A_(n,o,u,m=!1){let b;typeof n=="string"?b=Vf(n):(b={...n},Un(!b.pathname||!b.pathname.includes("?"),Iy("?","pathname","search",b)),Un(!b.pathname||!b.pathname.includes("#"),Iy("#","pathname","hash",b)),Un(!b.search||!b.search.includes("#"),Iy("#","search","hash",b)));let P=n===""||b.pathname==="",w=P?"/":b.pathname,l;if(w==null)l=u;else{let G=o.length-1;if(!m&&w.startsWith("..")){let te=w.split("/");for(;te[0]==="..";)te.shift(),G-=1;b.pathname=te.join("/")}l=G>=0?o[G]:"/"}let L=Vw(b,l),B=w&&w!=="/"&&w.endsWith("/"),V=(P||w===".")&&u.endsWith("/");return!L.pathname.endsWith("/")&&(B||V)&&(L.pathname+="/"),L}var au=n=>n.join("/").replace(/\/\/+/g,"/"),qw=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Ww=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Hw=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function Kw(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var eb=["POST","PUT","PATCH","DELETE"];new Set(eb);var Xw=["GET",...eb];new Set(Xw);var Zf=ee.createContext(null);Zf.displayName="DataRouter";var $g=ee.createContext(null);$g.displayName="DataRouterState";ee.createContext(!1);var tb=ee.createContext({isTransitioning:!1});tb.displayName="ViewTransition";var Yw=ee.createContext(new Map);Yw.displayName="Fetchers";var Qw=ee.createContext(null);Qw.displayName="Await";var yl=ee.createContext(null);yl.displayName="Navigation";var gm=ee.createContext(null);gm.displayName="Location";var La=ee.createContext({outlet:null,matches:[],isDataRoute:!1});La.displayName="Route";var z_=ee.createContext(null);z_.displayName="RouteError";function Jw(n,{relative:o}={}){Un(Gf(),"useHref() may be used only in the context of a <Router> component.");let{basename:u,navigator:m}=ee.useContext(yl),{hash:b,pathname:P,search:w}=ym(n,{relative:o}),l=P;return u!=="/"&&(l=P==="/"?u:au([u,P])),m.createHref({pathname:l,search:w,hash:b})}function Gf(){return ee.useContext(gm)!=null}function _l(){return Un(Gf(),"useLocation() may be used only in the context of a <Router> component."),ee.useContext(gm).location}var rb="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nb(n){ee.useContext(yl).static||ee.useLayoutEffect(n)}function qf(){let{isDataRoute:n}=ee.useContext(La);return n?m2():e2()}function e2(){Un(Gf(),"useNavigate() may be used only in the context of a <Router> component.");let n=ee.useContext(Zf),{basename:o,navigator:u}=ee.useContext(yl),{matches:m}=ee.useContext(La),{pathname:b}=_l(),P=JSON.stringify(I_(m)),w=ee.useRef(!1);return nb(()=>{w.current=!0}),ee.useCallback((L,B={})=>{if(ml(w.current,rb),!w.current)return;if(typeof L=="number"){u.go(L);return}let V=A_(L,JSON.parse(P),b,B.relative==="path");n==null&&o!=="/"&&(V.pathname=V.pathname==="/"?o:au([o,V.pathname])),(B.replace?u.replace:u.push)(V,B.state,B)},[o,u,P,b,n])}var t2=ee.createContext(null);function r2(n){let o=ee.useContext(La).outlet;return o&&ee.createElement(t2.Provider,{value:n},o)}function n2(){let{matches:n}=ee.useContext(La),o=n[n.length-1];return o?o.params:{}}function ym(n,{relative:o}={}){let{matches:u}=ee.useContext(La),{pathname:m}=_l(),b=JSON.stringify(I_(u));return ee.useMemo(()=>A_(n,JSON.parse(b),m,o==="path"),[n,b,m,o])}function i2(n,o){return ib(n,o)}function ib(n,o,u,m,b){var Ce;Un(Gf(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:P}=ee.useContext(yl),{matches:w}=ee.useContext(La),l=w[w.length-1],L=l?l.params:{},B=l?l.pathname:"/",V=l?l.pathnameBase:"/",G=l&&l.route;{let Ie=G&&G.path||"";sb(B,!G||Ie.endsWith("*")||Ie.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${B}" (under <Route path="${Ie}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ie}"> to <Route path="${Ie==="/"?"*":`${Ie}/*`}">.`)}let te=_l(),q;if(o){let Ie=typeof o=="string"?Vf(o):o;Un(V==="/"||((Ce=Ie.pathname)==null?void 0:Ce.startsWith(V)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${V}" but pathname "${Ie.pathname}" was given in the \`location\` prop.`),q=Ie}else q=te;let Se=q.pathname||"/",ye=Se;if(V!=="/"){let Ie=V.replace(/^\//,"").split("/");ye="/"+Se.replace(/^\//,"").split("/").slice(Ie.length).join("/")}let fe=Y0(n,{pathname:ye});ml(G||fe!=null,`No routes matched location "${q.pathname}${q.search}${q.hash}" `),ml(fe==null||fe[fe.length-1].route.element!==void 0||fe[fe.length-1].route.Component!==void 0||fe[fe.length-1].route.lazy!==void 0,`Matched leaf route at location "${q.pathname}${q.search}${q.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Fe=c2(fe&&fe.map(Ie=>Object.assign({},Ie,{params:Object.assign({},L,Ie.params),pathname:au([V,P.encodeLocation?P.encodeLocation(Ie.pathname).pathname:Ie.pathname]),pathnameBase:Ie.pathnameBase==="/"?V:au([V,P.encodeLocation?P.encodeLocation(Ie.pathnameBase).pathname:Ie.pathnameBase])})),w,u,m,b);return o&&Fe?ee.createElement(gm.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...q},navigationType:"POP"}},Fe):Fe}function s2(){let n=p2(),o=Kw(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),u=n instanceof Error?n.stack:null,m="rgba(200,200,200, 0.5)",b={padding:"0.5rem",backgroundColor:m},P={padding:"2px 4px",backgroundColor:m},w=null;return console.error("Error handled by React Router default ErrorBoundary:",n),w=ee.createElement(ee.Fragment,null,ee.createElement("p",null,"💿 Hey developer 👋"),ee.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ee.createElement("code",{style:P},"ErrorBoundary")," or"," ",ee.createElement("code",{style:P},"errorElement")," prop on your route.")),ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},o),u?ee.createElement("pre",{style:b},u):null,w)}var o2=ee.createElement(s2,null),a2=class extends ee.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,o){return o.location!==n.location||o.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:o.error,location:o.location,revalidation:n.revalidation||o.revalidation}}componentDidCatch(n,o){this.props.unstable_onError?this.props.unstable_onError(n,o):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?ee.createElement(La.Provider,{value:this.props.routeContext},ee.createElement(z_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function l2({routeContext:n,match:o,children:u}){let m=ee.useContext(Zf);return m&&m.static&&m.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(m.staticContext._deepestRenderedBoundaryId=o.route.id),ee.createElement(La.Provider,{value:n},u)}function c2(n,o=[],u=null,m=null,b=null){if(n==null){if(!u)return null;if(u.errors)n=u.matches;else if(o.length===0&&!u.initialized&&u.matches.length>0)n=u.matches;else return null}let P=n,w=u==null?void 0:u.errors;if(w!=null){let B=P.findIndex(V=>V.route.id&&(w==null?void 0:w[V.route.id])!==void 0);Un(B>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(w).join(",")}`),P=P.slice(0,Math.min(P.length,B+1))}let l=!1,L=-1;if(u)for(let B=0;B<P.length;B++){let V=P[B];if((V.route.HydrateFallback||V.route.hydrateFallbackElement)&&(L=B),V.route.id){let{loaderData:G,errors:te}=u,q=V.route.loader&&!G.hasOwnProperty(V.route.id)&&(!te||te[V.route.id]===void 0);if(V.route.lazy||q){l=!0,L>=0?P=P.slice(0,L+1):P=[P[0]];break}}}return P.reduceRight((B,V,G)=>{let te,q=!1,Se=null,ye=null;u&&(te=w&&V.route.id?w[V.route.id]:void 0,Se=V.route.errorElement||o2,l&&(L<0&&G===0?(sb("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),q=!0,ye=null):L===G&&(q=!0,ye=V.route.hydrateFallbackElement||null)));let fe=o.concat(P.slice(0,G+1)),Fe=()=>{let Ce;return te?Ce=Se:q?Ce=ye:V.route.Component?Ce=ee.createElement(V.route.Component,null):V.route.element?Ce=V.route.element:Ce=B,ee.createElement(l2,{match:V,routeContext:{outlet:B,matches:fe,isDataRoute:u!=null},children:Ce})};return u&&(V.route.ErrorBoundary||V.route.errorElement||G===0)?ee.createElement(a2,{location:u.location,revalidation:u.revalidation,component:Se,error:te,children:Fe(),routeContext:{outlet:null,matches:fe,isDataRoute:!0},unstable_onError:m}):Fe()},null)}function R_(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function u2(n){let o=ee.useContext(Zf);return Un(o,R_(n)),o}function h2(n){let o=ee.useContext($g);return Un(o,R_(n)),o}function d2(n){let o=ee.useContext(La);return Un(o,R_(n)),o}function D_(n){let o=d2(n),u=o.matches[o.matches.length-1];return Un(u.route.id,`${n} can only be used on routes that contain a unique "id"`),u.route.id}function f2(){return D_("useRouteId")}function p2(){var m;let n=ee.useContext(z_),o=h2("useRouteError"),u=D_("useRouteError");return n!==void 0?n:(m=o.errors)==null?void 0:m[u]}function m2(){let{router:n}=u2("useNavigate"),o=D_("useNavigate"),u=ee.useRef(!1);return nb(()=>{u.current=!0}),ee.useCallback(async(b,P={})=>{ml(u.current,rb),u.current&&(typeof b=="number"?n.navigate(b):await n.navigate(b,{fromRouteId:o,...P}))},[n,o])}var cx={};function sb(n,o,u){!o&&!cx[n]&&(cx[n]=!0,ml(!1,u))}ee.memo(g2);function g2({routes:n,future:o,state:u,unstable_onError:m}){return ib(n,void 0,u,m,o)}function y2({to:n,replace:o,state:u,relative:m}){Un(Gf(),"<Navigate> may be used only in the context of a <Router> component.");let{static:b}=ee.useContext(yl);ml(!b,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:P}=ee.useContext(La),{pathname:w}=_l(),l=qf(),L=A_(n,I_(P),w,m==="path"),B=JSON.stringify(L);return ee.useEffect(()=>{l(JSON.parse(B),{replace:o,state:u,relative:m})},[l,B,m,o,u]),null}function _2(n){return r2(n.context)}function ia(n){Un(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function v2({basename:n="/",children:o=null,location:u,navigationType:m="POP",navigator:b,static:P=!1}){Un(!Gf(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let w=n.replace(/^\/*/,"/"),l=ee.useMemo(()=>({basename:w,navigator:b,static:P,future:{}}),[w,b,P]);typeof u=="string"&&(u=Vf(u));let{pathname:L="/",search:B="",hash:V="",state:G=null,key:te="default"}=u,q=ee.useMemo(()=>{let Se=cu(L,w);return Se==null?null:{location:{pathname:Se,search:B,hash:V,state:G,key:te},navigationType:m}},[w,L,B,V,G,te,m]);return ml(q!=null,`<Router basename="${w}"> is not able to match the URL "${L}${B}${V}" because it does not start with the basename, so the <Router> won't render anything.`),q==null?null:ee.createElement(yl.Provider,{value:l},ee.createElement(gm.Provider,{children:o,value:q}))}function x2({children:n,location:o}){return i2($y(n),o)}function $y(n,o=[]){let u=[];return ee.Children.forEach(n,(m,b)=>{if(!ee.isValidElement(m))return;let P=[...o,b];if(m.type===ee.Fragment){u.push.apply(u,$y(m.props.children,P));return}Un(m.type===ia,`[${typeof m.type=="string"?m.type:m.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Un(!m.props.index||!m.props.children,"An index route cannot have child routes.");let w={id:m.props.id||P.join("-"),caseSensitive:m.props.caseSensitive,element:m.props.element,Component:m.props.Component,index:m.props.index,path:m.props.path,loader:m.props.loader,action:m.props.action,hydrateFallbackElement:m.props.hydrateFallbackElement,HydrateFallback:m.props.HydrateFallback,errorElement:m.props.errorElement,ErrorBoundary:m.props.ErrorBoundary,hasErrorBoundary:m.props.hasErrorBoundary===!0||m.props.ErrorBoundary!=null||m.props.errorElement!=null,shouldRevalidate:m.props.shouldRevalidate,handle:m.props.handle,lazy:m.props.lazy};m.props.children&&(w.children=$y(m.props.children,P)),u.push(w)}),u}var vg="get",xg="application/x-www-form-urlencoded";function Ug(n){return n!=null&&typeof n.tagName=="string"}function b2(n){return Ug(n)&&n.tagName.toLowerCase()==="button"}function w2(n){return Ug(n)&&n.tagName.toLowerCase()==="form"}function S2(n){return Ug(n)&&n.tagName.toLowerCase()==="input"}function T2(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function P2(n,o){return n.button===0&&(!o||o==="_self")&&!T2(n)}var cg=null;function C2(){if(cg===null)try{new FormData(document.createElement("form"),0),cg=!1}catch{cg=!0}return cg}var E2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ay(n){return n!=null&&!E2.has(n)?(ml(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${xg}"`),null):n}function k2(n,o){let u,m,b,P,w;if(w2(n)){let l=n.getAttribute("action");m=l?cu(l,o):null,u=n.getAttribute("method")||vg,b=Ay(n.getAttribute("enctype"))||xg,P=new FormData(n)}else if(b2(n)||S2(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let L=n.getAttribute("formaction")||l.getAttribute("action");if(m=L?cu(L,o):null,u=n.getAttribute("formmethod")||l.getAttribute("method")||vg,b=Ay(n.getAttribute("formenctype"))||Ay(l.getAttribute("enctype"))||xg,P=new FormData(l,n),!C2()){let{name:B,type:V,value:G}=n;if(V==="image"){let te=B?`${B}.`:"";P.append(`${te}x`,"0"),P.append(`${te}y`,"0")}else B&&P.append(B,G)}}else{if(Ug(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');u=vg,m=null,b=xg,w=n}return P&&b==="text/plain"&&(w=P,P=void 0),{action:m,method:u.toLowerCase(),encType:b,formData:P,body:w}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function L_(n,o){if(n===!1||n===null||typeof n>"u")throw new Error(o)}function M2(n,o,u){let m=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return m.pathname==="/"?m.pathname=`_root.${u}`:o&&cu(m.pathname,o)==="/"?m.pathname=`${o.replace(/\/$/,"")}/_root.${u}`:m.pathname=`${m.pathname.replace(/\/$/,"")}.${u}`,m}async function I2(n,o){if(n.id in o)return o[n.id];try{let u=await import(n.module);return o[n.id]=u,u}catch(u){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(u),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function A2(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function z2(n,o,u){let m=await Promise.all(n.map(async b=>{let P=o.routes[b.route.id];if(P){let w=await I2(P,u);return w.links?w.links():[]}return[]}));return F2(m.flat(1).filter(A2).filter(b=>b.rel==="stylesheet"||b.rel==="preload").map(b=>b.rel==="stylesheet"?{...b,rel:"prefetch",as:"style"}:{...b,rel:"prefetch"}))}function ux(n,o,u,m,b,P){let w=(L,B)=>u[B]?L.route.id!==u[B].route.id:!0,l=(L,B)=>{var V;return u[B].pathname!==L.pathname||((V=u[B].route.path)==null?void 0:V.endsWith("*"))&&u[B].params["*"]!==L.params["*"]};return P==="assets"?o.filter((L,B)=>w(L,B)||l(L,B)):P==="data"?o.filter((L,B)=>{var G;let V=m.routes[L.route.id];if(!V||!V.hasLoader)return!1;if(w(L,B)||l(L,B))return!0;if(L.route.shouldRevalidate){let te=L.route.shouldRevalidate({currentUrl:new URL(b.pathname+b.search+b.hash,window.origin),currentParams:((G=u[0])==null?void 0:G.params)||{},nextUrl:new URL(n,window.origin),nextParams:L.params,defaultShouldRevalidate:!0});if(typeof te=="boolean")return te}return!0}):[]}function R2(n,o,{includeHydrateFallback:u}={}){return D2(n.map(m=>{let b=o.routes[m.route.id];if(!b)return[];let P=[b.module];return b.clientActionModule&&(P=P.concat(b.clientActionModule)),b.clientLoaderModule&&(P=P.concat(b.clientLoaderModule)),u&&b.hydrateFallbackModule&&(P=P.concat(b.hydrateFallbackModule)),b.imports&&(P=P.concat(b.imports)),P}).flat(1))}function D2(n){return[...new Set(n)]}function L2(n){let o={},u=Object.keys(n).sort();for(let m of u)o[m]=n[m];return o}function F2(n,o){let u=new Set;return new Set(o),n.reduce((m,b)=>{let P=JSON.stringify(L2(b));return u.has(P)||(u.add(P),m.push({key:P,link:b})),m},[])}function ob(){let n=ee.useContext(Zf);return L_(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function O2(){let n=ee.useContext($g);return L_(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var F_=ee.createContext(void 0);F_.displayName="FrameworkContext";function ab(){let n=ee.useContext(F_);return L_(n,"You must render this element inside a <HydratedRouter> element"),n}function j2(n,o){let u=ee.useContext(F_),[m,b]=ee.useState(!1),[P,w]=ee.useState(!1),{onFocus:l,onBlur:L,onMouseEnter:B,onMouseLeave:V,onTouchStart:G}=o,te=ee.useRef(null);ee.useEffect(()=>{if(n==="render"&&w(!0),n==="viewport"){let ye=Fe=>{Fe.forEach(Ce=>{w(Ce.isIntersecting)})},fe=new IntersectionObserver(ye,{threshold:.5});return te.current&&fe.observe(te.current),()=>{fe.disconnect()}}},[n]),ee.useEffect(()=>{if(m){let ye=setTimeout(()=>{w(!0)},100);return()=>{clearTimeout(ye)}}},[m]);let q=()=>{b(!0)},Se=()=>{b(!1),w(!1)};return u?n!=="intent"?[P,te,{}]:[P,te,{onFocus:$p(l,q),onBlur:$p(L,Se),onMouseEnter:$p(B,q),onMouseLeave:$p(V,Se),onTouchStart:$p(G,q)}]:[!1,te,{}]}function $p(n,o){return u=>{n&&n(u),u.defaultPrevented||o(u)}}function N2({page:n,...o}){let{router:u}=ob(),m=ee.useMemo(()=>Y0(u.routes,n,u.basename),[u.routes,n,u.basename]);return m?ee.createElement($2,{page:n,matches:m,...o}):null}function B2(n){let{manifest:o,routeModules:u}=ab(),[m,b]=ee.useState([]);return ee.useEffect(()=>{let P=!1;return z2(n,o,u).then(w=>{P||b(w)}),()=>{P=!0}},[n,o,u]),m}function $2({page:n,matches:o,...u}){let m=_l(),{manifest:b,routeModules:P}=ab(),{basename:w}=ob(),{loaderData:l,matches:L}=O2(),B=ee.useMemo(()=>ux(n,o,L,b,m,"data"),[n,o,L,b,m]),V=ee.useMemo(()=>ux(n,o,L,b,m,"assets"),[n,o,L,b,m]),G=ee.useMemo(()=>{if(n===m.pathname+m.search+m.hash)return[];let Se=new Set,ye=!1;if(o.forEach(Fe=>{var Ie;let Ce=b.routes[Fe.route.id];!Ce||!Ce.hasLoader||(!B.some(Le=>Le.route.id===Fe.route.id)&&Fe.route.id in l&&((Ie=P[Fe.route.id])!=null&&Ie.shouldRevalidate)||Ce.hasClientLoader?ye=!0:Se.add(Fe.route.id))}),Se.size===0)return[];let fe=M2(n,w,"data");return ye&&Se.size>0&&fe.searchParams.set("_routes",o.filter(Fe=>Se.has(Fe.route.id)).map(Fe=>Fe.route.id).join(",")),[fe.pathname+fe.search]},[w,l,m,b,B,o,n,P]),te=ee.useMemo(()=>R2(V,b),[V,b]),q=B2(V);return ee.createElement(ee.Fragment,null,G.map(Se=>ee.createElement("link",{key:Se,rel:"prefetch",as:"fetch",href:Se,...u})),te.map(Se=>ee.createElement("link",{key:Se,rel:"modulepreload",href:Se,...u})),q.map(({key:Se,link:ye})=>ee.createElement("link",{key:Se,nonce:u.nonce,...ye})))}function U2(...n){return o=>{n.forEach(u=>{typeof u=="function"?u(o):u!=null&&(u.current=o)})}}var lb=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{lb&&(window.__reactRouterVersion="7.9.1")}catch{}function V2({basename:n,children:o,window:u}){let m=ee.useRef();m.current==null&&(m.current=Cw({window:u,v5Compat:!0}));let b=m.current,[P,w]=ee.useState({action:b.action,location:b.location}),l=ee.useCallback(L=>{ee.startTransition(()=>w(L))},[w]);return ee.useLayoutEffect(()=>b.listen(l),[b,l]),ee.createElement(v2,{basename:n,children:o,location:P.location,navigationType:P.action,navigator:b})}var cb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,li=ee.forwardRef(function({onClick:o,discover:u="render",prefetch:m="none",relative:b,reloadDocument:P,replace:w,state:l,target:L,to:B,preventScrollReset:V,viewTransition:G,...te},q){let{basename:Se}=ee.useContext(yl),ye=typeof B=="string"&&cb.test(B),fe,Fe=!1;if(typeof B=="string"&&ye&&(fe=B,lb))try{let it=new URL(window.location.href),at=B.startsWith("//")?new URL(it.protocol+B):new URL(B),It=cu(at.pathname,Se);at.origin===it.origin&&It!=null?B=It+at.search+at.hash:Fe=!0}catch{ml(!1,`<Link to="${B}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Ce=Jw(B,{relative:b}),[Ie,Le,Xe]=j2(m,te),mt=W2(B,{replace:w,state:l,target:L,preventScrollReset:V,relative:b,viewTransition:G});function yt(it){o&&o(it),it.defaultPrevented||mt(it)}let Qe=ee.createElement("a",{...te,...Xe,href:fe||Ce,onClick:Fe||P?o:yt,ref:U2(q,Le),target:L,"data-discover":!ye&&u==="render"?"true":void 0});return Ie&&!ye?ee.createElement(ee.Fragment,null,Qe,ee.createElement(N2,{page:Ce})):Qe});li.displayName="Link";var Z2=ee.forwardRef(function({"aria-current":o="page",caseSensitive:u=!1,className:m="",end:b=!1,style:P,to:w,viewTransition:l,children:L,...B},V){let G=ym(w,{relative:B.relative}),te=_l(),q=ee.useContext($g),{navigator:Se,basename:ye}=ee.useContext(yl),fe=q!=null&&Q2(G)&&l===!0,Fe=Se.encodeLocation?Se.encodeLocation(G).pathname:G.pathname,Ce=te.pathname,Ie=q&&q.navigation&&q.navigation.location?q.navigation.location.pathname:null;u||(Ce=Ce.toLowerCase(),Ie=Ie?Ie.toLowerCase():null,Fe=Fe.toLowerCase()),Ie&&ye&&(Ie=cu(Ie,ye)||Ie);const Le=Fe!=="/"&&Fe.endsWith("/")?Fe.length-1:Fe.length;let Xe=Ce===Fe||!b&&Ce.startsWith(Fe)&&Ce.charAt(Le)==="/",mt=Ie!=null&&(Ie===Fe||!b&&Ie.startsWith(Fe)&&Ie.charAt(Fe.length)==="/"),yt={isActive:Xe,isPending:mt,isTransitioning:fe},Qe=Xe?o:void 0,it;typeof m=="function"?it=m(yt):it=[m,Xe?"active":null,mt?"pending":null,fe?"transitioning":null].filter(Boolean).join(" ");let at=typeof P=="function"?P(yt):P;return ee.createElement(li,{...B,"aria-current":Qe,className:it,ref:V,style:at,to:w,viewTransition:l},typeof L=="function"?L(yt):L)});Z2.displayName="NavLink";var G2=ee.forwardRef(({discover:n="render",fetcherKey:o,navigate:u,reloadDocument:m,replace:b,state:P,method:w=vg,action:l,onSubmit:L,relative:B,preventScrollReset:V,viewTransition:G,...te},q)=>{let Se=X2(),ye=Y2(l,{relative:B}),fe=w.toLowerCase()==="get"?"get":"post",Fe=typeof l=="string"&&cb.test(l),Ce=Ie=>{if(L&&L(Ie),Ie.defaultPrevented)return;Ie.preventDefault();let Le=Ie.nativeEvent.submitter,Xe=(Le==null?void 0:Le.getAttribute("formmethod"))||w;Se(Le||Ie.currentTarget,{fetcherKey:o,method:Xe,navigate:u,replace:b,state:P,relative:B,preventScrollReset:V,viewTransition:G})};return ee.createElement("form",{ref:q,method:fe,action:ye,onSubmit:m?L:Ce,...te,"data-discover":!Fe&&n==="render"?"true":void 0})});G2.displayName="Form";function q2(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ub(n){let o=ee.useContext(Zf);return Un(o,q2(n)),o}function W2(n,{target:o,replace:u,state:m,preventScrollReset:b,relative:P,viewTransition:w}={}){let l=qf(),L=_l(),B=ym(n,{relative:P});return ee.useCallback(V=>{if(P2(V,o)){V.preventDefault();let G=u!==void 0?u:Jp(L)===Jp(B);l(n,{replace:G,state:m,preventScrollReset:b,relative:P,viewTransition:w})}},[L,l,B,u,m,o,n,b,P,w])}var H2=0,K2=()=>`__${String(++H2)}__`;function X2(){let{router:n}=ub("useSubmit"),{basename:o}=ee.useContext(yl),u=f2();return ee.useCallback(async(m,b={})=>{let{action:P,method:w,encType:l,formData:L,body:B}=k2(m,o);if(b.navigate===!1){let V=b.fetcherKey||K2();await n.fetch(V,u,b.action||P,{preventScrollReset:b.preventScrollReset,formData:L,body:B,formMethod:b.method||w,formEncType:b.encType||l,flushSync:b.flushSync})}else await n.navigate(b.action||P,{preventScrollReset:b.preventScrollReset,formData:L,body:B,formMethod:b.method||w,formEncType:b.encType||l,replace:b.replace,state:b.state,fromRouteId:u,flushSync:b.flushSync,viewTransition:b.viewTransition})},[n,o,u])}function Y2(n,{relative:o}={}){let{basename:u}=ee.useContext(yl),m=ee.useContext(La);Un(m,"useFormAction must be used inside a RouteContext");let[b]=m.matches.slice(-1),P={...ym(n||".",{relative:o})},w=_l();if(n==null){P.search=w.search;let l=new URLSearchParams(P.search),L=l.getAll("index");if(L.some(V=>V==="")){l.delete("index"),L.filter(G=>G).forEach(G=>l.append("index",G));let V=l.toString();P.search=V?`?${V}`:""}}return(!n||n===".")&&b.route.index&&(P.search=P.search?P.search.replace(/^\?/,"?index&"):"?index"),u!=="/"&&(P.pathname=P.pathname==="/"?u:au([u,P.pathname])),Jp(P)}function Q2(n,{relative:o}={}){let u=ee.useContext(tb);Un(u!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:m}=ub("useViewTransitionState"),b=ym(n,{relative:o});if(!u.isTransitioning)return!1;let P=cu(u.currentLocation.pathname,m)||u.currentLocation.pathname,w=cu(u.nextLocation.pathname,m)||u.nextLocation.pathname;return Pg(b.pathname,w)!=null||Pg(b.pathname,P)!=null}var Zp=X0();const hx=n=>{let o;const u=new Set,m=(B,V)=>{const G=typeof B=="function"?B(o):B;if(!Object.is(G,o)){const te=o;o=V??(typeof G!="object"||G===null)?G:Object.assign({},o,G),u.forEach(q=>q(o,te))}},b=()=>o,l={setState:m,getState:b,getInitialState:()=>L,subscribe:B=>(u.add(B),()=>u.delete(B))},L=o=n(m,b,l);return l},J2=(n=>n?hx(n):hx),eS=n=>n;function tS(n,o=eS){const u=hn.useSyncExternalStore(n.subscribe,hn.useCallback(()=>o(n.getState()),[n,o]),hn.useCallback(()=>o(n.getInitialState()),[n,o]));return hn.useDebugValue(u),u}const dx=n=>{const o=J2(n),u=m=>tS(o,m);return Object.assign(u,o),u},hb=(n=>n?dx(n):dx),Uy=hb(n=>({search:"",setSearch:o=>n({search:o})})),ug="bada_token",lc=hb(n=>({token:typeof window<"u"?window.localStorage.getItem(ug):null,setToken:u=>{u?window.localStorage.setItem(ug,u):window.localStorage.removeItem(ug),n({token:u})},clearToken:()=>{window.localStorage.removeItem(ug),n({token:null})}})),rS=()=>!!lc.getState().token;var Nd=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},nS={setTimeout:(n,o)=>setTimeout(n,o),clearTimeout:n=>clearTimeout(n),setInterval:(n,o)=>setInterval(n,o),clearInterval:n=>clearInterval(n)},rh,E_,j0,iS=(j0=class{constructor(){Wt(this,rh,nS);Wt(this,E_,!1)}setTimeoutProvider(n){Mt(this,rh,n)}setTimeout(n,o){return _e(this,rh).setTimeout(n,o)}clearTimeout(n){_e(this,rh).clearTimeout(n)}setInterval(n,o){return _e(this,rh).setInterval(n,o)}clearInterval(n){_e(this,rh).clearInterval(n)}},rh=new WeakMap,E_=new WeakMap,j0),wd=new iS;function sS(n){setTimeout(n,0)}var Ld=typeof window>"u"||"Deno"in globalThis;function js(){}function oS(n,o){return typeof n=="function"?n(o):n}function Vy(n){return typeof n=="number"&&n>=0&&n!==1/0}function db(n,o){return Math.max(n+(o||0)-Date.now(),0)}function fh(n,o){return typeof n=="function"?n(o):n}function Ra(n,o){return typeof n=="function"?n(o):n}function fx(n,o){const{type:u="all",exact:m,fetchStatus:b,predicate:P,queryKey:w,stale:l}=n;if(w){if(m){if(o.queryHash!==O_(w,o.options))return!1}else if(!em(o.queryKey,w))return!1}if(u!=="all"){const L=o.isActive();if(u==="active"&&!L||u==="inactive"&&L)return!1}return!(typeof l=="boolean"&&o.isStale()!==l||b&&b!==o.state.fetchStatus||P&&!P(o))}function px(n,o){const{exact:u,status:m,predicate:b,mutationKey:P}=n;if(P){if(!o.options.mutationKey)return!1;if(u){if(Fd(o.options.mutationKey)!==Fd(P))return!1}else if(!em(o.options.mutationKey,P))return!1}return!(m&&o.state.status!==m||b&&!b(o))}function O_(n,o){return((o==null?void 0:o.queryKeyHashFn)||Fd)(n)}function Fd(n){return JSON.stringify(n,(o,u)=>Zy(u)?Object.keys(u).sort().reduce((m,b)=>(m[b]=u[b],m),{}):u)}function em(n,o){return n===o?!0:typeof n!=typeof o?!1:n&&o&&typeof n=="object"&&typeof o=="object"?Object.keys(o).every(u=>em(n[u],o[u])):!1}var aS=Object.prototype.hasOwnProperty;function j_(n,o){if(n===o)return n;const u=mx(n)&&mx(o);if(!u&&!(Zy(n)&&Zy(o)))return o;const b=(u?n:Object.keys(n)).length,P=u?o:Object.keys(o),w=P.length,l=u?new Array(w):{};let L=0;for(let B=0;B<w;B++){const V=u?B:P[B],G=n[V],te=o[V];if(G===te){l[V]=G,(u?B<b:aS.call(n,V))&&L++;continue}if(G===null||te===null||typeof G!="object"||typeof te!="object"){l[V]=te;continue}const q=j_(G,te);l[V]=q,q===G&&L++}return b===w&&L===b?n:l}function tm(n,o){if(!o||Object.keys(n).length!==Object.keys(o).length)return!1;for(const u in n)if(n[u]!==o[u])return!1;return!0}function mx(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function Zy(n){if(!gx(n))return!1;const o=n.constructor;if(o===void 0)return!0;const u=o.prototype;return!(!gx(u)||!u.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function gx(n){return Object.prototype.toString.call(n)==="[object Object]"}function lS(n){return new Promise(o=>{wd.setTimeout(o,n)})}function Gy(n,o,u){return typeof u.structuralSharing=="function"?u.structuralSharing(n,o):u.structuralSharing!==!1?j_(n,o):o}function cS(n,o,u=0){const m=[...n,o];return u&&m.length>u?m.slice(1):m}function uS(n,o,u=0){const m=[o,...n];return u&&m.length>u?m.slice(0,-1):m}var N_=Symbol();function fb(n,o){return!n.queryFn&&(o!=null&&o.initialPromise)?()=>o.initialPromise:!n.queryFn||n.queryFn===N_?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}function pb(n,o){return typeof n=="function"?n(...o):!!n}var Td,nh,kf,N0,hS=(N0=class extends Nd{constructor(){super();Wt(this,Td);Wt(this,nh);Wt(this,kf);Mt(this,kf,o=>{if(!Ld&&window.addEventListener){const u=()=>o();return window.addEventListener("visibilitychange",u,!1),()=>{window.removeEventListener("visibilitychange",u)}}})}onSubscribe(){_e(this,nh)||this.setEventListener(_e(this,kf))}onUnsubscribe(){var o;this.hasListeners()||((o=_e(this,nh))==null||o.call(this),Mt(this,nh,void 0))}setEventListener(o){var u;Mt(this,kf,o),(u=_e(this,nh))==null||u.call(this),Mt(this,nh,o(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()}))}setFocused(o){_e(this,Td)!==o&&(Mt(this,Td,o),this.onFocus())}onFocus(){const o=this.isFocused();this.listeners.forEach(u=>{u(o)})}isFocused(){var o;return typeof _e(this,Td)=="boolean"?_e(this,Td):((o=globalThis.document)==null?void 0:o.visibilityState)!=="hidden"}},Td=new WeakMap,nh=new WeakMap,kf=new WeakMap,N0),B_=new hS;function qy(){let n,o;const u=new Promise((b,P)=>{n=b,o=P});u.status="pending",u.catch(()=>{});function m(b){Object.assign(u,b),delete u.resolve,delete u.reject}return u.resolve=b=>{m({status:"fulfilled",value:b}),n(b)},u.reject=b=>{m({status:"rejected",reason:b}),o(b)},u}var dS=sS;function fS(){let n=[],o=0,u=l=>{l()},m=l=>{l()},b=dS;const P=l=>{o?n.push(l):b(()=>{u(l)})},w=()=>{const l=n;n=[],l.length&&b(()=>{m(()=>{l.forEach(L=>{u(L)})})})};return{batch:l=>{let L;o++;try{L=l()}finally{o--,o||w()}return L},batchCalls:l=>(...L)=>{P(()=>{l(...L)})},schedule:P,setNotifyFunction:l=>{u=l},setBatchNotifyFunction:l=>{m=l},setScheduler:l=>{b=l}}}var ai=fS(),Mf,ih,If,B0,pS=(B0=class extends Nd{constructor(){super();Wt(this,Mf,!0);Wt(this,ih);Wt(this,If);Mt(this,If,o=>{if(!Ld&&window.addEventListener){const u=()=>o(!0),m=()=>o(!1);return window.addEventListener("online",u,!1),window.addEventListener("offline",m,!1),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",m)}}})}onSubscribe(){_e(this,ih)||this.setEventListener(_e(this,If))}onUnsubscribe(){var o;this.hasListeners()||((o=_e(this,ih))==null||o.call(this),Mt(this,ih,void 0))}setEventListener(o){var u;Mt(this,If,o),(u=_e(this,ih))==null||u.call(this),Mt(this,ih,o(this.setOnline.bind(this)))}setOnline(o){_e(this,Mf)!==o&&(Mt(this,Mf,o),this.listeners.forEach(m=>{m(o)}))}isOnline(){return _e(this,Mf)}},Mf=new WeakMap,ih=new WeakMap,If=new WeakMap,B0),Cg=new pS;function mS(n){return Math.min(1e3*2**n,3e4)}function mb(n){return(n??"online")==="online"?Cg.isOnline():!0}var Wy=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function gb(n){let o=!1,u=0,m;const b=qy(),P=()=>b.status!=="pending",w=ye=>{var fe;if(!P()){const Fe=new Wy(ye);te(Fe),(fe=n.onCancel)==null||fe.call(n,Fe)}},l=()=>{o=!0},L=()=>{o=!1},B=()=>B_.isFocused()&&(n.networkMode==="always"||Cg.isOnline())&&n.canRun(),V=()=>mb(n.networkMode)&&n.canRun(),G=ye=>{P()||(m==null||m(),b.resolve(ye))},te=ye=>{P()||(m==null||m(),b.reject(ye))},q=()=>new Promise(ye=>{var fe;m=Fe=>{(P()||B())&&ye(Fe)},(fe=n.onPause)==null||fe.call(n)}).then(()=>{var ye;m=void 0,P()||(ye=n.onContinue)==null||ye.call(n)}),Se=()=>{if(P())return;let ye;const fe=u===0?n.initialPromise:void 0;try{ye=fe??n.fn()}catch(Fe){ye=Promise.reject(Fe)}Promise.resolve(ye).then(G).catch(Fe=>{var mt;if(P())return;const Ce=n.retry??(Ld?0:3),Ie=n.retryDelay??mS,Le=typeof Ie=="function"?Ie(u,Fe):Ie,Xe=Ce===!0||typeof Ce=="number"&&u<Ce||typeof Ce=="function"&&Ce(u,Fe);if(o||!Xe){te(Fe);return}u++,(mt=n.onFail)==null||mt.call(n,u,Fe),lS(Le).then(()=>B()?void 0:q()).then(()=>{o?te(Fe):Se()})})};return{promise:b,status:()=>b.status,cancel:w,continue:()=>(m==null||m(),b),cancelRetry:l,continueRetry:L,canStart:V,start:()=>(V()?Se():q().then(Se),b)}}var Pd,$0,yb=($0=class{constructor(){Wt(this,Pd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Vy(this.gcTime)&&Mt(this,Pd,wd.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Ld?1/0:300*1e3))}clearGcTimeout(){_e(this,Pd)&&(wd.clearTimeout(_e(this,Pd)),Mt(this,Pd,void 0))}},Pd=new WeakMap,$0),Cd,Af,Aa,Ed,ls,cm,kd,hl,nu,U0,gS=(U0=class extends yb{constructor(o){super();Wt(this,hl);Wt(this,Cd);Wt(this,Af);Wt(this,Aa);Wt(this,Ed);Wt(this,ls);Wt(this,cm);Wt(this,kd);Mt(this,kd,!1),Mt(this,cm,o.defaultOptions),this.setOptions(o.options),this.observers=[],Mt(this,Ed,o.client),Mt(this,Aa,_e(this,Ed).getQueryCache()),this.queryKey=o.queryKey,this.queryHash=o.queryHash,Mt(this,Cd,yx(this.options)),this.state=o.state??_e(this,Cd),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var o;return(o=_e(this,ls))==null?void 0:o.promise}setOptions(o){if(this.options={..._e(this,cm),...o},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const u=yx(this.options);u.data!==void 0&&(this.setData(u.data,{updatedAt:u.dataUpdatedAt,manual:!0}),Mt(this,Cd,u))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&_e(this,Aa).remove(this)}setData(o,u){const m=Gy(this.state.data,o,this.options);return wr(this,hl,nu).call(this,{data:m,type:"success",dataUpdatedAt:u==null?void 0:u.updatedAt,manual:u==null?void 0:u.manual}),m}setState(o,u){wr(this,hl,nu).call(this,{type:"setState",state:o,setStateOptions:u})}cancel(o){var m,b;const u=(m=_e(this,ls))==null?void 0:m.promise;return(b=_e(this,ls))==null||b.cancel(o),u?u.then(js).catch(js):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(_e(this,Cd))}isActive(){return this.observers.some(o=>Ra(o.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===N_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(o=>fh(o.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(o=>o.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(o=0){return this.state.data===void 0?!0:o==="static"?!1:this.state.isInvalidated?!0:!db(this.state.dataUpdatedAt,o)}onFocus(){var u;const o=this.observers.find(m=>m.shouldFetchOnWindowFocus());o==null||o.refetch({cancelRefetch:!1}),(u=_e(this,ls))==null||u.continue()}onOnline(){var u;const o=this.observers.find(m=>m.shouldFetchOnReconnect());o==null||o.refetch({cancelRefetch:!1}),(u=_e(this,ls))==null||u.continue()}addObserver(o){this.observers.includes(o)||(this.observers.push(o),this.clearGcTimeout(),_e(this,Aa).notify({type:"observerAdded",query:this,observer:o}))}removeObserver(o){this.observers.includes(o)&&(this.observers=this.observers.filter(u=>u!==o),this.observers.length||(_e(this,ls)&&(_e(this,kd)?_e(this,ls).cancel({revert:!0}):_e(this,ls).cancelRetry()),this.scheduleGc()),_e(this,Aa).notify({type:"observerRemoved",query:this,observer:o}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||wr(this,hl,nu).call(this,{type:"invalidate"})}async fetch(o,u){var L,B,V,G,te,q,Se,ye,fe,Fe,Ce,Ie;if(this.state.fetchStatus!=="idle"&&((L=_e(this,ls))==null?void 0:L.status())!=="rejected"){if(this.state.data!==void 0&&(u!=null&&u.cancelRefetch))this.cancel({silent:!0});else if(_e(this,ls))return _e(this,ls).continueRetry(),_e(this,ls).promise}if(o&&this.setOptions(o),!this.options.queryFn){const Le=this.observers.find(Xe=>Xe.options.queryFn);Le&&this.setOptions(Le.options)}const m=new AbortController,b=Le=>{Object.defineProperty(Le,"signal",{enumerable:!0,get:()=>(Mt(this,kd,!0),m.signal)})},P=()=>{const Le=fb(this.options,u),mt=(()=>{const yt={client:_e(this,Ed),queryKey:this.queryKey,meta:this.meta};return b(yt),yt})();return Mt(this,kd,!1),this.options.persister?this.options.persister(Le,mt,this):Le(mt)},l=(()=>{const Le={fetchOptions:u,options:this.options,queryKey:this.queryKey,client:_e(this,Ed),state:this.state,fetchFn:P};return b(Le),Le})();(B=this.options.behavior)==null||B.onFetch(l,this),Mt(this,Af,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((V=l.fetchOptions)==null?void 0:V.meta))&&wr(this,hl,nu).call(this,{type:"fetch",meta:(G=l.fetchOptions)==null?void 0:G.meta}),Mt(this,ls,gb({initialPromise:u==null?void 0:u.initialPromise,fn:l.fetchFn,onCancel:Le=>{Le instanceof Wy&&Le.revert&&this.setState({..._e(this,Af),fetchStatus:"idle"}),m.abort()},onFail:(Le,Xe)=>{wr(this,hl,nu).call(this,{type:"failed",failureCount:Le,error:Xe})},onPause:()=>{wr(this,hl,nu).call(this,{type:"pause"})},onContinue:()=>{wr(this,hl,nu).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const Le=await _e(this,ls).start();if(Le===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(Le),(q=(te=_e(this,Aa).config).onSuccess)==null||q.call(te,Le,this),(ye=(Se=_e(this,Aa).config).onSettled)==null||ye.call(Se,Le,this.state.error,this),Le}catch(Le){if(Le instanceof Wy){if(Le.silent)return _e(this,ls).promise;if(Le.revert){if(this.state.data===void 0)throw Le;return this.state.data}}throw wr(this,hl,nu).call(this,{type:"error",error:Le}),(Fe=(fe=_e(this,Aa).config).onError)==null||Fe.call(fe,Le,this),(Ie=(Ce=_e(this,Aa).config).onSettled)==null||Ie.call(Ce,this.state.data,Le,this),Le}finally{this.scheduleGc()}}},Cd=new WeakMap,Af=new WeakMap,Aa=new WeakMap,Ed=new WeakMap,ls=new WeakMap,cm=new WeakMap,kd=new WeakMap,hl=new WeakSet,nu=function(o){const u=m=>{switch(o.type){case"failed":return{...m,fetchFailureCount:o.failureCount,fetchFailureReason:o.error};case"pause":return{...m,fetchStatus:"paused"};case"continue":return{...m,fetchStatus:"fetching"};case"fetch":return{...m,..._b(m.data,this.options),fetchMeta:o.meta??null};case"success":const b={...m,data:o.data,dataUpdateCount:m.dataUpdateCount+1,dataUpdatedAt:o.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!o.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Mt(this,Af,o.manual?b:void 0),b;case"error":const P=o.error;return{...m,error:P,errorUpdateCount:m.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:m.fetchFailureCount+1,fetchFailureReason:P,fetchStatus:"idle",status:"error"};case"invalidate":return{...m,isInvalidated:!0};case"setState":return{...m,...o.state}}};this.state=u(this.state),ai.batch(()=>{this.observers.forEach(m=>{m.onQueryUpdate()}),_e(this,Aa).notify({query:this,type:"updated",action:o})})},U0);function _b(n,o){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:mb(o.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function yx(n){const o=typeof n.initialData=="function"?n.initialData():n.initialData,u=o!==void 0,m=u?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:o,dataUpdateCount:0,dataUpdatedAt:u?m??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:u?"success":"pending",fetchStatus:"idle"}}var Co,Jr,um,io,Md,zf,iu,sh,hm,Rf,Df,Id,Ad,oh,Lf,yn,Gp,Hy,Ky,Xy,Yy,Qy,Jy,e_,vb,V0,$_=(V0=class extends Nd{constructor(o,u){super();Wt(this,yn);Wt(this,Co);Wt(this,Jr);Wt(this,um);Wt(this,io);Wt(this,Md);Wt(this,zf);Wt(this,iu);Wt(this,sh);Wt(this,hm);Wt(this,Rf);Wt(this,Df);Wt(this,Id);Wt(this,Ad);Wt(this,oh);Wt(this,Lf,new Set);this.options=u,Mt(this,Co,o),Mt(this,sh,null),Mt(this,iu,qy()),this.bindMethods(),this.setOptions(u)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(_e(this,Jr).addObserver(this),_x(_e(this,Jr),this.options)?wr(this,yn,Gp).call(this):this.updateResult(),wr(this,yn,Yy).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return t_(_e(this,Jr),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return t_(_e(this,Jr),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,wr(this,yn,Qy).call(this),wr(this,yn,Jy).call(this),_e(this,Jr).removeObserver(this)}setOptions(o){const u=this.options,m=_e(this,Jr);if(this.options=_e(this,Co).defaultQueryOptions(o),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ra(this.options.enabled,_e(this,Jr))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");wr(this,yn,e_).call(this),_e(this,Jr).setOptions(this.options),u._defaulted&&!tm(this.options,u)&&_e(this,Co).getQueryCache().notify({type:"observerOptionsUpdated",query:_e(this,Jr),observer:this});const b=this.hasListeners();b&&vx(_e(this,Jr),m,this.options,u)&&wr(this,yn,Gp).call(this),this.updateResult(),b&&(_e(this,Jr)!==m||Ra(this.options.enabled,_e(this,Jr))!==Ra(u.enabled,_e(this,Jr))||fh(this.options.staleTime,_e(this,Jr))!==fh(u.staleTime,_e(this,Jr)))&&wr(this,yn,Hy).call(this);const P=wr(this,yn,Ky).call(this);b&&(_e(this,Jr)!==m||Ra(this.options.enabled,_e(this,Jr))!==Ra(u.enabled,_e(this,Jr))||P!==_e(this,oh))&&wr(this,yn,Xy).call(this,P)}getOptimisticResult(o){const u=_e(this,Co).getQueryCache().build(_e(this,Co),o),m=this.createResult(u,o);return _S(this,m)&&(Mt(this,io,m),Mt(this,zf,this.options),Mt(this,Md,_e(this,Jr).state)),m}getCurrentResult(){return _e(this,io)}trackResult(o,u){return new Proxy(o,{get:(m,b)=>(this.trackProp(b),u==null||u(b),b==="promise"&&!this.options.experimental_prefetchInRender&&_e(this,iu).status==="pending"&&_e(this,iu).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(m,b))})}trackProp(o){_e(this,Lf).add(o)}getCurrentQuery(){return _e(this,Jr)}refetch({...o}={}){return this.fetch({...o})}fetchOptimistic(o){const u=_e(this,Co).defaultQueryOptions(o),m=_e(this,Co).getQueryCache().build(_e(this,Co),u);return m.fetch().then(()=>this.createResult(m,u))}fetch(o){return wr(this,yn,Gp).call(this,{...o,cancelRefetch:o.cancelRefetch??!0}).then(()=>(this.updateResult(),_e(this,io)))}createResult(o,u){var it;const m=_e(this,Jr),b=this.options,P=_e(this,io),w=_e(this,Md),l=_e(this,zf),B=o!==m?o.state:_e(this,um),{state:V}=o;let G={...V},te=!1,q;if(u._optimisticResults){const at=this.hasListeners(),It=!at&&_x(o,u),Rt=at&&vx(o,m,u,b);(It||Rt)&&(G={...G,..._b(V.data,o.options)}),u._optimisticResults==="isRestoring"&&(G.fetchStatus="idle")}let{error:Se,errorUpdatedAt:ye,status:fe}=G;q=G.data;let Fe=!1;if(u.placeholderData!==void 0&&q===void 0&&fe==="pending"){let at;P!=null&&P.isPlaceholderData&&u.placeholderData===(l==null?void 0:l.placeholderData)?(at=P.data,Fe=!0):at=typeof u.placeholderData=="function"?u.placeholderData((it=_e(this,Df))==null?void 0:it.state.data,_e(this,Df)):u.placeholderData,at!==void 0&&(fe="success",q=Gy(P==null?void 0:P.data,at,u),te=!0)}if(u.select&&q!==void 0&&!Fe)if(P&&q===(w==null?void 0:w.data)&&u.select===_e(this,hm))q=_e(this,Rf);else try{Mt(this,hm,u.select),q=u.select(q),q=Gy(P==null?void 0:P.data,q,u),Mt(this,Rf,q),Mt(this,sh,null)}catch(at){Mt(this,sh,at)}_e(this,sh)&&(Se=_e(this,sh),q=_e(this,Rf),ye=Date.now(),fe="error");const Ce=G.fetchStatus==="fetching",Ie=fe==="pending",Le=fe==="error",Xe=Ie&&Ce,mt=q!==void 0,Qe={status:fe,fetchStatus:G.fetchStatus,isPending:Ie,isSuccess:fe==="success",isError:Le,isInitialLoading:Xe,isLoading:Xe,data:q,dataUpdatedAt:G.dataUpdatedAt,error:Se,errorUpdatedAt:ye,failureCount:G.fetchFailureCount,failureReason:G.fetchFailureReason,errorUpdateCount:G.errorUpdateCount,isFetched:G.dataUpdateCount>0||G.errorUpdateCount>0,isFetchedAfterMount:G.dataUpdateCount>B.dataUpdateCount||G.errorUpdateCount>B.errorUpdateCount,isFetching:Ce,isRefetching:Ce&&!Ie,isLoadingError:Le&&!mt,isPaused:G.fetchStatus==="paused",isPlaceholderData:te,isRefetchError:Le&&mt,isStale:U_(o,u),refetch:this.refetch,promise:_e(this,iu),isEnabled:Ra(u.enabled,o)!==!1};if(this.options.experimental_prefetchInRender){const at=At=>{Qe.status==="error"?At.reject(Qe.error):Qe.data!==void 0&&At.resolve(Qe.data)},It=()=>{const At=Mt(this,iu,Qe.promise=qy());at(At)},Rt=_e(this,iu);switch(Rt.status){case"pending":o.queryHash===m.queryHash&&at(Rt);break;case"fulfilled":(Qe.status==="error"||Qe.data!==Rt.value)&&It();break;case"rejected":(Qe.status!=="error"||Qe.error!==Rt.reason)&&It();break}}return Qe}updateResult(){const o=_e(this,io),u=this.createResult(_e(this,Jr),this.options);if(Mt(this,Md,_e(this,Jr).state),Mt(this,zf,this.options),_e(this,Md).data!==void 0&&Mt(this,Df,_e(this,Jr)),tm(u,o))return;Mt(this,io,u);const m=()=>{if(!o)return!0;const{notifyOnChangeProps:b}=this.options,P=typeof b=="function"?b():b;if(P==="all"||!P&&!_e(this,Lf).size)return!0;const w=new Set(P??_e(this,Lf));return this.options.throwOnError&&w.add("error"),Object.keys(_e(this,io)).some(l=>{const L=l;return _e(this,io)[L]!==o[L]&&w.has(L)})};wr(this,yn,vb).call(this,{listeners:m()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&wr(this,yn,Yy).call(this)}},Co=new WeakMap,Jr=new WeakMap,um=new WeakMap,io=new WeakMap,Md=new WeakMap,zf=new WeakMap,iu=new WeakMap,sh=new WeakMap,hm=new WeakMap,Rf=new WeakMap,Df=new WeakMap,Id=new WeakMap,Ad=new WeakMap,oh=new WeakMap,Lf=new WeakMap,yn=new WeakSet,Gp=function(o){wr(this,yn,e_).call(this);let u=_e(this,Jr).fetch(this.options,o);return o!=null&&o.throwOnError||(u=u.catch(js)),u},Hy=function(){wr(this,yn,Qy).call(this);const o=fh(this.options.staleTime,_e(this,Jr));if(Ld||_e(this,io).isStale||!Vy(o))return;const m=db(_e(this,io).dataUpdatedAt,o)+1;Mt(this,Id,wd.setTimeout(()=>{_e(this,io).isStale||this.updateResult()},m))},Ky=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(_e(this,Jr)):this.options.refetchInterval)??!1},Xy=function(o){wr(this,yn,Jy).call(this),Mt(this,oh,o),!(Ld||Ra(this.options.enabled,_e(this,Jr))===!1||!Vy(_e(this,oh))||_e(this,oh)===0)&&Mt(this,Ad,wd.setInterval(()=>{(this.options.refetchIntervalInBackground||B_.isFocused())&&wr(this,yn,Gp).call(this)},_e(this,oh)))},Yy=function(){wr(this,yn,Hy).call(this),wr(this,yn,Xy).call(this,wr(this,yn,Ky).call(this))},Qy=function(){_e(this,Id)&&(wd.clearTimeout(_e(this,Id)),Mt(this,Id,void 0))},Jy=function(){_e(this,Ad)&&(wd.clearInterval(_e(this,Ad)),Mt(this,Ad,void 0))},e_=function(){const o=_e(this,Co).getQueryCache().build(_e(this,Co),this.options);if(o===_e(this,Jr))return;const u=_e(this,Jr);Mt(this,Jr,o),Mt(this,um,o.state),this.hasListeners()&&(u==null||u.removeObserver(this),o.addObserver(this))},vb=function(o){ai.batch(()=>{o.listeners&&this.listeners.forEach(u=>{u(_e(this,io))}),_e(this,Co).getQueryCache().notify({query:_e(this,Jr),type:"observerResultsUpdated"})})},V0);function yS(n,o){return Ra(o.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&o.retryOnMount===!1)}function _x(n,o){return yS(n,o)||n.state.data!==void 0&&t_(n,o,o.refetchOnMount)}function t_(n,o,u){if(Ra(o.enabled,n)!==!1&&fh(o.staleTime,n)!=="static"){const m=typeof u=="function"?u(n):u;return m==="always"||m!==!1&&U_(n,o)}return!1}function vx(n,o,u,m){return(n!==o||Ra(m.enabled,n)===!1)&&(!u.suspense||n.state.status!=="error")&&U_(n,u)}function U_(n,o){return Ra(o.enabled,n)!==!1&&n.isStaleByTime(fh(o.staleTime,n))}function _S(n,o){return!tm(n.getCurrentResult(),o)}function xx(n){return{onFetch:(o,u)=>{var V,G,te,q,Se;const m=o.options,b=(te=(G=(V=o.fetchOptions)==null?void 0:V.meta)==null?void 0:G.fetchMore)==null?void 0:te.direction,P=((q=o.state.data)==null?void 0:q.pages)||[],w=((Se=o.state.data)==null?void 0:Se.pageParams)||[];let l={pages:[],pageParams:[]},L=0;const B=async()=>{let ye=!1;const fe=Ie=>{Object.defineProperty(Ie,"signal",{enumerable:!0,get:()=>(o.signal.aborted?ye=!0:o.signal.addEventListener("abort",()=>{ye=!0}),o.signal)})},Fe=fb(o.options,o.fetchOptions),Ce=async(Ie,Le,Xe)=>{if(ye)return Promise.reject();if(Le==null&&Ie.pages.length)return Promise.resolve(Ie);const yt=(()=>{const It={client:o.client,queryKey:o.queryKey,pageParam:Le,direction:Xe?"backward":"forward",meta:o.options.meta};return fe(It),It})(),Qe=await Fe(yt),{maxPages:it}=o.options,at=Xe?uS:cS;return{pages:at(Ie.pages,Qe,it),pageParams:at(Ie.pageParams,Le,it)}};if(b&&P.length){const Ie=b==="backward",Le=Ie?vS:bx,Xe={pages:P,pageParams:w},mt=Le(m,Xe);l=await Ce(Xe,mt,Ie)}else{const Ie=n??P.length;do{const Le=L===0?w[0]??m.initialPageParam:bx(m,l);if(L>0&&Le==null)break;l=await Ce(l,Le),L++}while(L<Ie)}return l};o.options.persister?o.fetchFn=()=>{var ye,fe;return(fe=(ye=o.options).persister)==null?void 0:fe.call(ye,B,{client:o.client,queryKey:o.queryKey,meta:o.options.meta,signal:o.signal},u)}:o.fetchFn=B}}}function bx(n,{pages:o,pageParams:u}){const m=o.length-1;return o.length>0?n.getNextPageParam(o[m],o,u[m],u):void 0}function vS(n,{pages:o,pageParams:u}){var m;return o.length>0?(m=n.getPreviousPageParam)==null?void 0:m.call(n,o[0],o,u[0],u):void 0}var rc,so,zd,nc,Qu,Z0,xS=(Z0=class extends yb{constructor(o){super();Wt(this,nc);Wt(this,rc);Wt(this,so);Wt(this,zd);this.mutationId=o.mutationId,Mt(this,so,o.mutationCache),Mt(this,rc,[]),this.state=o.state||xb(),this.setOptions(o.options),this.scheduleGc()}setOptions(o){this.options=o,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(o){_e(this,rc).includes(o)||(_e(this,rc).push(o),this.clearGcTimeout(),_e(this,so).notify({type:"observerAdded",mutation:this,observer:o}))}removeObserver(o){Mt(this,rc,_e(this,rc).filter(u=>u!==o)),this.scheduleGc(),_e(this,so).notify({type:"observerRemoved",mutation:this,observer:o})}optionalRemove(){_e(this,rc).length||(this.state.status==="pending"?this.scheduleGc():_e(this,so).remove(this))}continue(){var o;return((o=_e(this,zd))==null?void 0:o.continue())??this.execute(this.state.variables)}async execute(o){var P,w,l,L,B,V,G,te,q,Se,ye,fe,Fe,Ce,Ie,Le,Xe,mt,yt,Qe;const u=()=>{wr(this,nc,Qu).call(this,{type:"continue"})};Mt(this,zd,gb({fn:()=>this.options.mutationFn?this.options.mutationFn(o):Promise.reject(new Error("No mutationFn found")),onFail:(it,at)=>{wr(this,nc,Qu).call(this,{type:"failed",failureCount:it,error:at})},onPause:()=>{wr(this,nc,Qu).call(this,{type:"pause"})},onContinue:u,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>_e(this,so).canRun(this)}));const m=this.state.status==="pending",b=!_e(this,zd).canStart();try{if(m)u();else{wr(this,nc,Qu).call(this,{type:"pending",variables:o,isPaused:b}),await((w=(P=_e(this,so).config).onMutate)==null?void 0:w.call(P,o,this));const at=await((L=(l=this.options).onMutate)==null?void 0:L.call(l,o));at!==this.state.context&&wr(this,nc,Qu).call(this,{type:"pending",context:at,variables:o,isPaused:b})}const it=await _e(this,zd).start();return await((V=(B=_e(this,so).config).onSuccess)==null?void 0:V.call(B,it,o,this.state.context,this)),await((te=(G=this.options).onSuccess)==null?void 0:te.call(G,it,o,this.state.context)),await((Se=(q=_e(this,so).config).onSettled)==null?void 0:Se.call(q,it,null,this.state.variables,this.state.context,this)),await((fe=(ye=this.options).onSettled)==null?void 0:fe.call(ye,it,null,o,this.state.context)),wr(this,nc,Qu).call(this,{type:"success",data:it}),it}catch(it){try{throw await((Ce=(Fe=_e(this,so).config).onError)==null?void 0:Ce.call(Fe,it,o,this.state.context,this)),await((Le=(Ie=this.options).onError)==null?void 0:Le.call(Ie,it,o,this.state.context)),await((mt=(Xe=_e(this,so).config).onSettled)==null?void 0:mt.call(Xe,void 0,it,this.state.variables,this.state.context,this)),await((Qe=(yt=this.options).onSettled)==null?void 0:Qe.call(yt,void 0,it,o,this.state.context)),it}finally{wr(this,nc,Qu).call(this,{type:"error",error:it})}}finally{_e(this,so).runNext(this)}}},rc=new WeakMap,so=new WeakMap,zd=new WeakMap,nc=new WeakSet,Qu=function(o){const u=m=>{switch(o.type){case"failed":return{...m,failureCount:o.failureCount,failureReason:o.error};case"pause":return{...m,isPaused:!0};case"continue":return{...m,isPaused:!1};case"pending":return{...m,context:o.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:o.isPaused,status:"pending",variables:o.variables,submittedAt:Date.now()};case"success":return{...m,data:o.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...m,data:void 0,error:o.error,failureCount:m.failureCount+1,failureReason:o.error,isPaused:!1,status:"error"}}};this.state=u(this.state),ai.batch(()=>{_e(this,rc).forEach(m=>{m.onMutationUpdate(o)}),_e(this,so).notify({mutation:this,type:"updated",action:o})})},Z0);function xb(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var su,dl,dm,G0,bS=(G0=class extends Nd{constructor(o={}){super();Wt(this,su);Wt(this,dl);Wt(this,dm);this.config=o,Mt(this,su,new Set),Mt(this,dl,new Map),Mt(this,dm,0)}build(o,u,m){const b=new xS({mutationCache:this,mutationId:++ag(this,dm)._,options:o.defaultMutationOptions(u),state:m});return this.add(b),b}add(o){_e(this,su).add(o);const u=hg(o);if(typeof u=="string"){const m=_e(this,dl).get(u);m?m.push(o):_e(this,dl).set(u,[o])}this.notify({type:"added",mutation:o})}remove(o){if(_e(this,su).delete(o)){const u=hg(o);if(typeof u=="string"){const m=_e(this,dl).get(u);if(m)if(m.length>1){const b=m.indexOf(o);b!==-1&&m.splice(b,1)}else m[0]===o&&_e(this,dl).delete(u)}}this.notify({type:"removed",mutation:o})}canRun(o){const u=hg(o);if(typeof u=="string"){const m=_e(this,dl).get(u),b=m==null?void 0:m.find(P=>P.state.status==="pending");return!b||b===o}else return!0}runNext(o){var m;const u=hg(o);if(typeof u=="string"){const b=(m=_e(this,dl).get(u))==null?void 0:m.find(P=>P!==o&&P.state.isPaused);return(b==null?void 0:b.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ai.batch(()=>{_e(this,su).forEach(o=>{this.notify({type:"removed",mutation:o})}),_e(this,su).clear(),_e(this,dl).clear()})}getAll(){return Array.from(_e(this,su))}find(o){const u={exact:!0,...o};return this.getAll().find(m=>px(u,m))}findAll(o={}){return this.getAll().filter(u=>px(o,u))}notify(o){ai.batch(()=>{this.listeners.forEach(u=>{u(o)})})}resumePausedMutations(){const o=this.getAll().filter(u=>u.state.isPaused);return ai.batch(()=>Promise.all(o.map(u=>u.continue().catch(js))))}},su=new WeakMap,dl=new WeakMap,dm=new WeakMap,G0);function hg(n){var o;return(o=n.options.scope)==null?void 0:o.id}var ah,lh,Eo,ou,lu,bg,r_,q0,wS=(q0=class extends Nd{constructor(u,m){super();Wt(this,lu);Wt(this,ah);Wt(this,lh);Wt(this,Eo);Wt(this,ou);Mt(this,ah,u),this.setOptions(m),this.bindMethods(),wr(this,lu,bg).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(u){var b;const m=this.options;this.options=_e(this,ah).defaultMutationOptions(u),tm(this.options,m)||_e(this,ah).getMutationCache().notify({type:"observerOptionsUpdated",mutation:_e(this,Eo),observer:this}),m!=null&&m.mutationKey&&this.options.mutationKey&&Fd(m.mutationKey)!==Fd(this.options.mutationKey)?this.reset():((b=_e(this,Eo))==null?void 0:b.state.status)==="pending"&&_e(this,Eo).setOptions(this.options)}onUnsubscribe(){var u;this.hasListeners()||(u=_e(this,Eo))==null||u.removeObserver(this)}onMutationUpdate(u){wr(this,lu,bg).call(this),wr(this,lu,r_).call(this,u)}getCurrentResult(){return _e(this,lh)}reset(){var u;(u=_e(this,Eo))==null||u.removeObserver(this),Mt(this,Eo,void 0),wr(this,lu,bg).call(this),wr(this,lu,r_).call(this)}mutate(u,m){var b;return Mt(this,ou,m),(b=_e(this,Eo))==null||b.removeObserver(this),Mt(this,Eo,_e(this,ah).getMutationCache().build(_e(this,ah),this.options)),_e(this,Eo).addObserver(this),_e(this,Eo).execute(u)}},ah=new WeakMap,lh=new WeakMap,Eo=new WeakMap,ou=new WeakMap,lu=new WeakSet,bg=function(){var m;const u=((m=_e(this,Eo))==null?void 0:m.state)??xb();Mt(this,lh,{...u,isPending:u.status==="pending",isSuccess:u.status==="success",isError:u.status==="error",isIdle:u.status==="idle",mutate:this.mutate,reset:this.reset})},r_=function(u){ai.batch(()=>{var m,b,P,w,l,L,B,V;if(_e(this,ou)&&this.hasListeners()){const G=_e(this,lh).variables,te=_e(this,lh).context;(u==null?void 0:u.type)==="success"?((b=(m=_e(this,ou)).onSuccess)==null||b.call(m,u.data,G,te),(w=(P=_e(this,ou)).onSettled)==null||w.call(P,u.data,null,G,te)):(u==null?void 0:u.type)==="error"&&((L=(l=_e(this,ou)).onError)==null||L.call(l,u.error,G,te),(V=(B=_e(this,ou)).onSettled)==null||V.call(B,void 0,u.error,G,te))}this.listeners.forEach(G=>{G(_e(this,lh))})})},q0);function wx(n,o){const u=new Set(o);return n.filter(m=>!u.has(m))}function SS(n,o,u){const m=n.slice(0);return m[o]=u,m}var Ff,sa,Of,jf,za,ch,fm,pm,mm,Cs,n_,i_,s_,o_,a_,W0,TS=(W0=class extends Nd{constructor(o,u,m){super();Wt(this,Cs);Wt(this,Ff);Wt(this,sa);Wt(this,Of);Wt(this,jf);Wt(this,za);Wt(this,ch);Wt(this,fm);Wt(this,pm);Wt(this,mm,[]);Mt(this,Ff,o),Mt(this,jf,m),Mt(this,Of,[]),Mt(this,za,[]),Mt(this,sa,[]),this.setQueries(u)}onSubscribe(){this.listeners.size===1&&_e(this,za).forEach(o=>{o.subscribe(u=>{wr(this,Cs,o_).call(this,o,u)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,_e(this,za).forEach(o=>{o.destroy()})}setQueries(o,u){Mt(this,Of,o),Mt(this,jf,u),ai.batch(()=>{const m=_e(this,za),b=wr(this,Cs,s_).call(this,_e(this,Of));Mt(this,mm,b),b.forEach(G=>G.observer.setOptions(G.defaultedQueryOptions));const P=b.map(G=>G.observer),w=P.map(G=>G.getCurrentResult()),l=m.length!==P.length,L=P.some((G,te)=>G!==m[te]),B=l||L,V=B?!0:w.some((G,te)=>{const q=_e(this,sa)[te];return!q||!tm(G,q)});!B&&!V||(B&&Mt(this,za,P),Mt(this,sa,w),this.hasListeners()&&(B&&(wx(m,P).forEach(G=>{G.destroy()}),wx(P,m).forEach(G=>{G.subscribe(te=>{wr(this,Cs,o_).call(this,G,te)})})),wr(this,Cs,a_).call(this)))})}getCurrentResult(){return _e(this,sa)}getQueries(){return _e(this,za).map(o=>o.getCurrentQuery())}getObservers(){return _e(this,za)}getOptimisticResult(o,u){const m=wr(this,Cs,s_).call(this,o),b=m.map(P=>P.observer.getOptimisticResult(P.defaultedQueryOptions));return[b,P=>wr(this,Cs,i_).call(this,P??b,u),()=>wr(this,Cs,n_).call(this,b,m)]}},Ff=new WeakMap,sa=new WeakMap,Of=new WeakMap,jf=new WeakMap,za=new WeakMap,ch=new WeakMap,fm=new WeakMap,pm=new WeakMap,mm=new WeakMap,Cs=new WeakSet,n_=function(o,u){return u.map((m,b)=>{const P=o[b];return m.defaultedQueryOptions.notifyOnChangeProps?P:m.observer.trackResult(P,w=>{u.forEach(l=>{l.observer.trackProp(w)})})})},i_=function(o,u){return u?((!_e(this,ch)||_e(this,sa)!==_e(this,pm)||u!==_e(this,fm))&&(Mt(this,fm,u),Mt(this,pm,_e(this,sa)),Mt(this,ch,j_(_e(this,ch),u(o)))),_e(this,ch)):o},s_=function(o){const u=new Map(_e(this,za).map(b=>[b.options.queryHash,b])),m=[];return o.forEach(b=>{const P=_e(this,Ff).defaultQueryOptions(b),w=u.get(P.queryHash);w?m.push({defaultedQueryOptions:P,observer:w}):m.push({defaultedQueryOptions:P,observer:new $_(_e(this,Ff),P)})}),m},o_=function(o,u){const m=_e(this,za).indexOf(o);m!==-1&&(Mt(this,sa,SS(_e(this,sa),m,u)),wr(this,Cs,a_).call(this))},a_=function(){var o;if(this.hasListeners()){const u=_e(this,ch),m=wr(this,Cs,n_).call(this,_e(this,sa),_e(this,mm)),b=wr(this,Cs,i_).call(this,m,(o=_e(this,jf))==null?void 0:o.combine);u!==b&&ai.batch(()=>{this.listeners.forEach(P=>{P(_e(this,sa))})})}},W0),ic,H0,PS=(H0=class extends Nd{constructor(o={}){super();Wt(this,ic);this.config=o,Mt(this,ic,new Map)}build(o,u,m){const b=u.queryKey,P=u.queryHash??O_(b,u);let w=this.get(P);return w||(w=new gS({client:o,queryKey:b,queryHash:P,options:o.defaultQueryOptions(u),state:m,defaultOptions:o.getQueryDefaults(b)}),this.add(w)),w}add(o){_e(this,ic).has(o.queryHash)||(_e(this,ic).set(o.queryHash,o),this.notify({type:"added",query:o}))}remove(o){const u=_e(this,ic).get(o.queryHash);u&&(o.destroy(),u===o&&_e(this,ic).delete(o.queryHash),this.notify({type:"removed",query:o}))}clear(){ai.batch(()=>{this.getAll().forEach(o=>{this.remove(o)})})}get(o){return _e(this,ic).get(o)}getAll(){return[..._e(this,ic).values()]}find(o){const u={exact:!0,...o};return this.getAll().find(m=>fx(u,m))}findAll(o={}){const u=this.getAll();return Object.keys(o).length>0?u.filter(m=>fx(o,m)):u}notify(o){ai.batch(()=>{this.listeners.forEach(u=>{u(o)})})}onFocus(){ai.batch(()=>{this.getAll().forEach(o=>{o.onFocus()})})}onOnline(){ai.batch(()=>{this.getAll().forEach(o=>{o.onOnline()})})}},ic=new WeakMap,H0),oi,uh,hh,Nf,Bf,dh,$f,Uf,K0,CS=(K0=class{constructor(n={}){Wt(this,oi);Wt(this,uh);Wt(this,hh);Wt(this,Nf);Wt(this,Bf);Wt(this,dh);Wt(this,$f);Wt(this,Uf);Mt(this,oi,n.queryCache||new PS),Mt(this,uh,n.mutationCache||new bS),Mt(this,hh,n.defaultOptions||{}),Mt(this,Nf,new Map),Mt(this,Bf,new Map),Mt(this,dh,0)}mount(){ag(this,dh)._++,_e(this,dh)===1&&(Mt(this,$f,B_.subscribe(async n=>{n&&(await this.resumePausedMutations(),_e(this,oi).onFocus())})),Mt(this,Uf,Cg.subscribe(async n=>{n&&(await this.resumePausedMutations(),_e(this,oi).onOnline())})))}unmount(){var n,o;ag(this,dh)._--,_e(this,dh)===0&&((n=_e(this,$f))==null||n.call(this),Mt(this,$f,void 0),(o=_e(this,Uf))==null||o.call(this),Mt(this,Uf,void 0))}isFetching(n){return _e(this,oi).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return _e(this,uh).findAll({...n,status:"pending"}).length}getQueryData(n){var u;const o=this.defaultQueryOptions({queryKey:n});return(u=_e(this,oi).get(o.queryHash))==null?void 0:u.state.data}ensureQueryData(n){const o=this.defaultQueryOptions(n),u=_e(this,oi).build(this,o),m=u.state.data;return m===void 0?this.fetchQuery(n):(n.revalidateIfStale&&u.isStaleByTime(fh(o.staleTime,u))&&this.prefetchQuery(o),Promise.resolve(m))}getQueriesData(n){return _e(this,oi).findAll(n).map(({queryKey:o,state:u})=>{const m=u.data;return[o,m]})}setQueryData(n,o,u){const m=this.defaultQueryOptions({queryKey:n}),b=_e(this,oi).get(m.queryHash),P=b==null?void 0:b.state.data,w=oS(o,P);if(w!==void 0)return _e(this,oi).build(this,m).setData(w,{...u,manual:!0})}setQueriesData(n,o,u){return ai.batch(()=>_e(this,oi).findAll(n).map(({queryKey:m})=>[m,this.setQueryData(m,o,u)]))}getQueryState(n){var u;const o=this.defaultQueryOptions({queryKey:n});return(u=_e(this,oi).get(o.queryHash))==null?void 0:u.state}removeQueries(n){const o=_e(this,oi);ai.batch(()=>{o.findAll(n).forEach(u=>{o.remove(u)})})}resetQueries(n,o){const u=_e(this,oi);return ai.batch(()=>(u.findAll(n).forEach(m=>{m.reset()}),this.refetchQueries({type:"active",...n},o)))}cancelQueries(n,o={}){const u={revert:!0,...o},m=ai.batch(()=>_e(this,oi).findAll(n).map(b=>b.cancel(u)));return Promise.all(m).then(js).catch(js)}invalidateQueries(n,o={}){return ai.batch(()=>(_e(this,oi).findAll(n).forEach(u=>{u.invalidate()}),(n==null?void 0:n.refetchType)==="none"?Promise.resolve():this.refetchQueries({...n,type:(n==null?void 0:n.refetchType)??(n==null?void 0:n.type)??"active"},o)))}refetchQueries(n,o={}){const u={...o,cancelRefetch:o.cancelRefetch??!0},m=ai.batch(()=>_e(this,oi).findAll(n).filter(b=>!b.isDisabled()&&!b.isStatic()).map(b=>{let P=b.fetch(void 0,u);return u.throwOnError||(P=P.catch(js)),b.state.fetchStatus==="paused"?Promise.resolve():P}));return Promise.all(m).then(js)}fetchQuery(n){const o=this.defaultQueryOptions(n);o.retry===void 0&&(o.retry=!1);const u=_e(this,oi).build(this,o);return u.isStaleByTime(fh(o.staleTime,u))?u.fetch(o):Promise.resolve(u.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(js).catch(js)}fetchInfiniteQuery(n){return n.behavior=xx(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(js).catch(js)}ensureInfiniteQueryData(n){return n.behavior=xx(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Cg.isOnline()?_e(this,uh).resumePausedMutations():Promise.resolve()}getQueryCache(){return _e(this,oi)}getMutationCache(){return _e(this,uh)}getDefaultOptions(){return _e(this,hh)}setDefaultOptions(n){Mt(this,hh,n)}setQueryDefaults(n,o){_e(this,Nf).set(Fd(n),{queryKey:n,defaultOptions:o})}getQueryDefaults(n){const o=[..._e(this,Nf).values()],u={};return o.forEach(m=>{em(n,m.queryKey)&&Object.assign(u,m.defaultOptions)}),u}setMutationDefaults(n,o){_e(this,Bf).set(Fd(n),{mutationKey:n,defaultOptions:o})}getMutationDefaults(n){const o=[..._e(this,Bf).values()],u={};return o.forEach(m=>{em(n,m.mutationKey)&&Object.assign(u,m.defaultOptions)}),u}defaultQueryOptions(n){if(n._defaulted)return n;const o={..._e(this,hh).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return o.queryHash||(o.queryHash=O_(o.queryKey,o)),o.refetchOnReconnect===void 0&&(o.refetchOnReconnect=o.networkMode!=="always"),o.throwOnError===void 0&&(o.throwOnError=!!o.suspense),!o.networkMode&&o.persister&&(o.networkMode="offlineFirst"),o.queryFn===N_&&(o.enabled=!1),o}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{..._e(this,hh).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){_e(this,oi).clear(),_e(this,uh).clear()}},oi=new WeakMap,uh=new WeakMap,hh=new WeakMap,Nf=new WeakMap,Bf=new WeakMap,dh=new WeakMap,$f=new WeakMap,Uf=new WeakMap,K0),bb=ee.createContext(void 0),hu=n=>{const o=ee.useContext(bb);if(!o)throw new Error("No QueryClient set, use QueryClientProvider to set one");return o},ES=({client:n,children:o})=>(ee.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),J.jsx(bb.Provider,{value:n,children:o})),wb=ee.createContext(!1),Sb=()=>ee.useContext(wb);wb.Provider;function kS(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var MS=ee.createContext(kS()),Tb=()=>ee.useContext(MS),Pb=(n,o)=>{(n.suspense||n.throwOnError||n.experimental_prefetchInRender)&&(o.isReset()||(n.retryOnMount=!1))},Cb=n=>{ee.useEffect(()=>{n.clearReset()},[n])},Eb=({result:n,errorResetBoundary:o,throwOnError:u,query:m,suspense:b})=>n.isError&&!o.isReset()&&!n.isFetching&&m&&(b&&n.data===void 0||pb(u,[n.error,m])),kb=n=>{if(n.suspense){const u=b=>b==="static"?b:Math.max(b??1e3,1e3),m=n.staleTime;n.staleTime=typeof m=="function"?(...b)=>u(m(...b)):u(m),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3))}},Mb=(n,o)=>n.isLoading&&n.isFetching&&!o,l_=(n,o)=>(n==null?void 0:n.suspense)&&o.isPending,Eg=(n,o,u)=>o.fetchOptimistic(n).catch(()=>{u.clearReset()});function IS({queries:n,...o},u){const m=hu(),b=Sb(),P=Tb(),w=ee.useMemo(()=>n.map(ye=>{const fe=m.defaultQueryOptions(ye);return fe._optimisticResults=b?"isRestoring":"optimistic",fe}),[n,m,b]);w.forEach(ye=>{kb(ye),Pb(ye,P)}),Cb(P);const[l]=ee.useState(()=>new TS(m,w,o)),[L,B,V]=l.getOptimisticResult(w,o.combine),G=!b&&o.subscribed!==!1;ee.useSyncExternalStore(ee.useCallback(ye=>G?l.subscribe(ai.batchCalls(ye)):js,[l,G]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),ee.useEffect(()=>{l.setQueries(w,o)},[w,o,l]);const q=L.some((ye,fe)=>l_(w[fe],ye))?L.flatMap((ye,fe)=>{const Fe=w[fe];if(Fe){const Ce=new $_(m,Fe);if(l_(Fe,ye))return Eg(Fe,Ce,P);Mb(ye,b)&&Eg(Fe,Ce,P)}return[]}):[];if(q.length>0)throw Promise.all(q);const Se=L.find((ye,fe)=>{const Fe=w[fe];return Fe&&Eb({result:ye,errorResetBoundary:P,throwOnError:Fe.throwOnError,query:m.getQueryCache().get(Fe.queryHash),suspense:Fe.suspense})});if(Se!=null&&Se.error)throw Se.error;return B(V())}function AS(n,o,u){var G,te,q,Se,ye;const m=Sb(),b=Tb(),P=hu(),w=P.defaultQueryOptions(n);(te=(G=P.getDefaultOptions().queries)==null?void 0:G._experimental_beforeQuery)==null||te.call(G,w),w._optimisticResults=m?"isRestoring":"optimistic",kb(w),Pb(w,b),Cb(b);const l=!P.getQueryCache().get(w.queryHash),[L]=ee.useState(()=>new o(P,w)),B=L.getOptimisticResult(w),V=!m&&n.subscribed!==!1;if(ee.useSyncExternalStore(ee.useCallback(fe=>{const Fe=V?L.subscribe(ai.batchCalls(fe)):js;return L.updateResult(),Fe},[L,V]),()=>L.getCurrentResult(),()=>L.getCurrentResult()),ee.useEffect(()=>{L.setOptions(w)},[w,L]),l_(w,B))throw Eg(w,L,b);if(Eb({result:B,errorResetBoundary:b,throwOnError:w.throwOnError,query:P.getQueryCache().get(w.queryHash),suspense:w.suspense}))throw B.error;if((Se=(q=P.getDefaultOptions().queries)==null?void 0:q._experimental_afterQuery)==null||Se.call(q,w,B),w.experimental_prefetchInRender&&!Ld&&Mb(B,m)){const fe=l?Eg(w,L,b):(ye=P.getQueryCache().get(w.queryHash))==null?void 0:ye.promise;fe==null||fe.catch(js).finally(()=>{L.updateResult()})}return w.notifyOnChangeProps?B:L.trackResult(B)}function V_(n,o){return AS(n,$_)}function Z_(n,o){const u=hu(),[m]=ee.useState(()=>new wS(u,n));ee.useEffect(()=>{m.setOptions(n)},[m,n]);const b=ee.useSyncExternalStore(ee.useCallback(w=>m.subscribe(ai.batchCalls(w)),[m]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),P=ee.useCallback((w,l)=>{m.mutate(w,l).catch(js)},[m]);if(b.error&&pb(m.options.throwOnError,[b.error]))throw b.error;return{...b,mutate:P,mutateAsync:b.mutate}}const zS=n=>ee.createElement("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 79.01 44.97",...n},ee.createElement("path",{fill:"currentColor",d:"M77.99,23.97l-10.75,3.73c-19.59,2-37.09-7.1-56.73-5.73-3.23.22-6.41,2.4-9.52,1.49,25.02-16.29,50.86,4.05,77.01.51Z"}),ee.createElement("path",{fill:"currentColor",d:"M75.99,6.97l-9.73,3.75C43.83,13.96,22.14-.46,0,6.95c23.28-17.55,50.69,4.19,75.99.02Z"}),ee.createElement("path",{fill:"currentColor",d:"M78.99,40.97c.24,1.44-1.73,1.35-2.78,1.69-19.44,6.32-32.53-2.19-50.73-3.69-6.82-.56-13.72.47-20.48.49,24-14.93,49.01,4.92,73.99,1.51Z"})),RS=n=>ee.createElement("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 792 391",...n},ee.createElement("defs",null,ee.createElement("style",null,`
      .st0 {
        fill: #e11418;
      }

      .st1 { fill: currentColor; }

      .st2 {
        fill: #e33232;
      }

      .st3 {
        fill: #d91c1e;
      }

      .st4 {
        fill: #e53c3d;
      }

      .st5 {
        fill: #d91b1d;
      }

      .st6 { fill: currentColor; }

      .st7 { fill: currentColor; }

      .st8 {
        fill: #e33034;
      }

      .st9 {
        fill: #e02122;
      }

      .st10 {
        fill: #df2a2b;
      }

      .st11 {
        fill: #de3532;
      }

      .st12 {
        fill: #e03535;
      }

      .st13 {
        fill: #e23b3e;
      }

      .st14 {
        fill: #e42e30;
      }

      .st15 { fill: currentColor; }
    `)),ee.createElement("path",{className:"st7",d:"M388.36,35c7.45,5.94,14.26,12.62,20.92,19.42,1.74,1.71,3.55,3.31,5.4,4.91,4.27,3.72,8.39,7.57,12.5,11.47,7.22,6.82,14.49,13.59,21.81,20.31,1.04.96,2.08,1.91,3.12,2.87,8.2,7.53,16.44,15.01,24.83,22.33,3.19,2.8,6.33,5.64,9.48,8.48,1.71,1.54,3.43,3.08,5.16,4.62,2.49,2.22,4.96,4.46,7.42,6.71.71.65,1.43,1.29,2.16,1.96,11.16,10.56,15.83,22.01,17.71,36.92,2.83,20.34,7.64,38.11,21.36,53.98,1.86,2.26,3.31,4.61,4.76,7.15-6.68.42-12.66-1.16-19.12-2.75-8.43-2.01-16.86-3.94-25.38-5.56-.82-.16-1.63-.32-2.47-.48-34.04-6.38-70.41-2.59-102.87,8.81-12.49,4.37-22.96,6.03-36.16,4.98-.87-.06-1.74-.13-2.64-.19-9.53-.74-19.01-1.79-28.36-3.81v-3c2.44-1.95,4.85-3.7,7.44-5.44,1.58-1.08,3.15-2.17,4.73-3.25.81-.55,1.62-1.11,2.45-1.67,3.59-2.46,7.14-4.99,10.7-7.51,4.51-3.19,9.04-6.37,13.57-9.54,8.89-6.21,17.75-12.46,26.52-18.82,5.85-4.24,11.74-8.42,17.66-12.57,5.04-3.54,10.01-7.17,14.93-10.87,1.33-.89,2.67-1.33,4-1.33-2.64-5.17-5.77-9.1-9.68-13.38-2.63-2.97-5.07-6.05-7.51-9.19-4.04-5.2-8.15-10.34-12.31-15.44-5.07-6.21-10.05-12.49-15-18.8-2.91-3.71-5.83-7.42-8.82-11.06-1.12-1.42-2.09-2.78-2.9-4.08s-2.08-2.65-3.79-4.05c-7.53-1-15.08.49-22.44,2-1.09.22-2.18.44-3.3.66-3.07.62-6.14,1.26-9.2,1.91-2.19.46-4.38.92-6.57,1.38-3.98.83-7.96,1.69-11.94,2.55-1.56.34-3.11.67-4.67,1-12.19,2.09-23.09,6.55-32.68,13.37-3.41,6.08-5.8,12.5-7.64,19.2-3.76,13.02-11.55,21.61-22.68,28.91-1.25.69-2.55,1.03-3.88,1.03.2-.66.41-1.33.62-2.01.27-.88.54-1.77.82-2.68.27-.87.53-1.74.81-2.64,1.37-4.85,1.93-9.31,2-14.36.03-1.14.05-2.29.08-3.45-.11-.94-.22-1.89-.33-2.86-2.91-1.94-4.41-2.56-7.87-2.43-8.04,1.62-15,7.66-21.49,12.38-4.82,3.5-9.72,6.84-14.7,10.11-.71.48-1.43.95-2.16,1.45-3.56,2.32-6.44,4.08-10.77,4.49,1.44-8.96,5.14-16.87,9-25,.31-.65.61-1.3.93-1.96,18.7-38.79,57.96-53.22,95.12-69.91,4.88-2.19,9.75-4.41,14.62-6.64,3.52-1.61,7.04-3.21,10.56-4.81,1.68-.77,3.37-1.54,5.05-2.31,30.99-14.25,51.35-18.08,61.08-11.47v-.04Z"}),ee.createElement("path",{className:"st7",d:"M559,268.11c44.74,26.17,88.77,38.07,140.29,25.01,19.97-5.46,38.96-13.3,57.71-22.01.9-.42,1.8-.83,2.73-1.26,4.77-2.22,9.53-4.46,14.27-6.74,0,1.33-.45,2.46-1.36,3.38-.64.54-1.29,1.07-1.95,1.62-3.4,2.89-6.72,5.85-10,8.88-4.46,4.06-9.01,7.95-13.71,11.73-2.11,1.69-4.19,3.4-6.27,5.13-39.94,33.03-88.07,56.1-140.71,53.26-6.5-.69-12.74-2.18-19-4-.75-.21-1.5-.43-2.27-.65-17.28-5.06-32.46-13.06-47.91-22.2-8.11-4.79-16.26-9.22-24.81-13.15-1.17-.54-2.33-1.08-3.54-1.64-10.79-4.66-21.96-7.11-33.46-9.36-1.22-.25-2.43-.5-3.69-.75-55.28-9.32-110.4,14.11-160.28,34.91-9.65,4.02-19.32,8-29.03,11.85-.87.35-1.74.69-2.64,1.05-14.72,5.76-29.88,8.91-45.36,11.95-.79.18-1.57.37-2.38.56-3.47.59-6.91.66-10.43.72-.75.01-1.51.03-2.29.04-16.87.23-32.74.08-48.9-5.31-.89-.29-1.77-.58-2.68-.88-15.65-5.24-29.85-12.59-43.32-22.12,3.95-1.32,6.76-.2,10.62.88,23.54,6.53,51.87,4.82,75.38-.88.74-.17,1.48-.34,2.23-.52,24.39-5.78,47.88-15.45,70.77-25.48,2.3-1,4.59-1.99,6.89-2.99,1.18-.51,2.36-1.02,3.58-1.55,1.21-.52,2.42-1.05,3.66-1.59s2.48-1.08,3.73-1.62c4.05-1.76,8.1-3.51,12.15-5.26.76-.33,1.52-.66,2.3-1,80.2-34.68,165.02-69.31,249.7-20h-.02Z"}),ee.createElement("path",{className:"st7",d:"M273.4,254.39c8.36,5.04,16.78,9.55,25.6,13.72,2.67,1.32,5.34,2.66,8,4-3.26,2.71-6.6,4.24-10.5,5.86-.63.26-1.27.53-1.91.8-2.05.85-4.1,1.69-6.15,2.54-1.41.59-2.83,1.17-4.24,1.76-2.79,1.16-5.59,2.32-8.38,3.47-4.8,1.99-9.59,4-14.38,6.02-.74.31-1.48.62-2.24.94-3.44,1.44-6.86,2.92-10.24,4.48-.64.29-1.28.58-1.94.88-1.68.77-3.36,1.55-5.04,2.34-3.64,1.14-5.33,1.06-8.98-.07-2.9-1.52-5.63-3.28-8.38-5.06-38.86-24.41-81.35-30.39-126.19-20.38-28.91,6.83-56.82,17.86-83.37,31.09-.89.44-1.78.88-2.69,1.33-.78.39-1.55.78-2.35,1.18-1.35.56-3.02.84-5.02.84,6.33-5.87,12.75-11.51,19.47-16.93,2.13-1.74,4.18-3.53,6.22-5.38,11.23-9.88,23.78-18.26,36.31-26.39,1.7-1.1,3.39-2.22,5.08-3.34,67.69-43.46,133.17-44.87,201.32-3.68v-.02Z"}),ee.createElement("path",{className:"st1",d:"M536,148.11c7.05.86,13.91,3.03,20.69,5.06,2.13.63,4.26,1.26,6.38,1.89,1.12.33,2.25.67,3.4,1.01,5.54,1.64,11.09,3.24,16.64,4.85,3.28.95,6.57,1.9,9.85,2.86.66.19,1.32.38,2,.58,4.05,1.17,8.09,2.35,12.14,3.53,2.68.78,5.37,1.56,8.05,2.34l3.93,1.14c6.49,1.89,12.99,3.77,19.5,5.61.99.28,1.98.56,3,.85,1.82.51,3.63,1.02,5.45,1.53,3.91,1.1,6.24,2.02,6.98,2.76-.5,15.15-9.1,27.93-19.81,38.16-13.41,11.28-28.83,15.89-46.19,14.84-16.76-1.55-30.3-9.34-41.87-21.4-10.39-12.68-14.44-26.13-14.57-42.29-.01-1.06-.02-2.11-.03-3.2.12-10.55,1.61-17.25,4.47-20.11h0Z"}),ee.createElement("path",{className:"st9",d:"M625.94,116.36c1.72,1.21,3.4,2.46,5.06,3.75.85.65,1.7,1.29,2.57,1.96,11.16,9.21,19.2,22.66,21.43,37.04.07,2.44.09,4.88.06,7.31,0,1.25-.02,2.51-.03,3.8-.01.95-.02,1.91-.04,2.89-6.88-.55-13.17-2.36-19.77-4.34-4.3-1.28-8.61-2.53-12.92-3.79-1-.29-1.99-.58-3.02-.88-9.32-2.72-18.65-5.39-27.98-8.05-.75-.22-1.51-.43-2.29-.65-7.16-2.04-14.31-4.08-21.47-6.12-9.22-2.62-18.41-5.29-27.55-8.17,5.28-14.34,18.1-23.39,31.47-29.62,17.72-6.83,38.18-4.92,54.46,4.87h.02Z"}),ee.createElement("path",{className:"st11",d:"M652,151.11c3.3,4.95,3.12,9.46,3.06,15.31,0,1.25-.02,2.51-.03,3.8-.01.95-.02,1.91-.04,2.89-5.24-.55-9.97-1.43-15-3l2-1v-2c2.31-.33,4.65-.66,7-1,.51-1.56,1.01-3.12,1.5-4.69.28-.87.56-1.74.84-2.64.65-2.67.77-4.94.66-7.68h.01Z"}),ee.createElement("path",{className:"st2",d:"M614.69,157.99c1.18.02,2.36.04,3.57.05.91.02,1.82.04,2.74.07.66,1.65,1.32,3.3,2,5-3.97,1.32-6.81.18-10.69-.94-.7-.19-1.41-.39-2.13-.59-1.73-.48-3.46-.98-5.19-1.47,3.63-2.42,5.38-2.21,9.69-2.12h.01Z"}),ee.createElement("path",{className:"st3",d:"M650,150.11h2c1.27,6.47.69,9.98-2,16-.99-.33-1.98-.66-3-1,.11-2.13.24-4.25.38-6.38.07-1.18.14-2.37.21-3.59.27-2.03,1.08-3.71,2.41-5.04h0Z"}),ee.createElement("path",{className:"st13",d:"M583,110.11c-.99.33-1.98.66-3,1v3c-.63-.02-1.25-.05-1.9-.07-.82-.02-1.63-.04-2.48-.05-.81-.02-1.63-.04-2.46-.07-1.59-.01-2.97.72-4.16,2.2-1.75.08-3.41.08-5,0,3-2.46,5.86-3.91,9.5-5.25.94-.36,1.88-.71,2.84-1.08,2.73-.69,4.05-.63,6.66.33h0Z"}),ee.createElement("path",{className:"st4",d:"M582.26,148.25c.8.22,1.6.44,2.43.67.81.21,1.62.43,2.45.64.61.18,1.23.36,1.86.54-.33,1.32-.66,2.64-1,4-4.06-.47-7.47-.88-11-3,1.58-2.03,3.33-2.98,5.26-2.86h0Z"}),ee.createElement("path",{className:"st5",d:"M637,164.11h8v3h-3v2c-1.98-.33-3.98-.66-6-1l1-4Z"}),ee.createElement("path",{className:"st12",d:"M640,129.11c3.08,2.77,4.69,5.06,6,9h-6c.33-1.98.66-3.96,1-6l-2-1,1-2Z"}),ee.createElement("path",{className:"st6",d:"M773,263.11l1,2c-2.64,2.31-5.28,4.62-8,7-.99-1.32-1.98-2.64-3-4l10-5Z"}),ee.createElement("path",{className:"st15",d:"M16,300.11l2,1c-3.82,5.05-7.03,7.85-13,10l11-11Z"}),ee.createElement("path",{className:"st8",d:"M563,116.11v3c-.66.66-1.32,1.32-2,2h-3v2c-1.65.33-3.3.66-5,1,3.11-3.29,6.02-5.84,10-8Z"}),ee.createElement("path",{className:"st14",d:"M580,148.11c2.31.66,4.62,1.32,7,2-1.33,1.33-2.65,2.07-3.95,2.2-2.02-.07-4.04-.13-6.05-.2.99-1.32,1.98-2.64,3-4Z"}),ee.createElement("path",{className:"st10",d:"M609,110.11l8,2c-.33.66-.66,1.32-1,2-2.64-.33-5.28-.66-8-1,.33-.99.66-1.98,1-3Z"}),ee.createElement("path",{className:"st0",d:"M571,113.11c3.83.5,6.5,1.5,8,3h-8v-3Z"}));function Sx(n){const o=ee.useRef(null);return ee.useEffect(()=>{function u(m){o.current&&!o.current.contains(m.target)&&n()}return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[n]),o}function DS(){const[n,o]=ee.useState(()=>document.documentElement.classList.contains("dark"));return ee.useEffect(()=>{document.documentElement.classList.toggle("dark",n)},[n]),{isDark:n,setIsDark:o}}function LS({languageSwitcher:n}){const[o,u]=ee.useState(!1),[m,b]=ee.useState(!1),P=Sx(()=>u(!1)),w=Sx(()=>b(!1)),{isDark:l,setIsDark:L}=DS(),B=Uy(fe=>fe.search),V=Uy(fe=>fe.setSearch),{token:G,clearToken:te}=lc(),q=!!G,Se=hu();function ye(){te(),Se.clear(),b(!1)}return J.jsxs(J.Fragment,{children:[J.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-accent focus:text-white focus:px-4 focus:py-2 focus:rounded focus:underline",children:"Skip to main content"}),J.jsxs("header",{className:"bg-surface sticky top-0 z-50 border-b border-border",role:"banner",children:[J.jsxs("div",{className:"mx-auto max-w-screen-lg px-3 py-2 flex items-center justify-between gap-2",children:[J.jsxs("div",{className:"relative",ref:P,children:[J.jsx("button",{"aria-label":"Open menu",className:"p-2 rounded-full hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/50 text-ink",onClick:()=>u(fe=>!fe),children:J.jsx(zS,{width:30,height:30,"aria-hidden":"true"})}),o&&J.jsxs("div",{role:"menu",className:"absolute left-0 mt-2 w-56 rounded-2xl border border-border bg-surface shadow p-2",children:[J.jsx("div",{className:"px-2 py-1.5 text-xs text-ink-muted",children:"Menu"}),J.jsx("div",{className:"h-px bg-border my-1"}),J.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[J.jsx("span",{className:"text-sm",children:"Language"}),n??J.jsx("span",{className:"text-xs text-ink-muted",children:"SV / EN"})]}),J.jsx(eu,{to:"/what-is-eu-beach",children:"What is an EU Beach?"}),J.jsx(eu,{to:"/about",children:"About BADA"}),J.jsx(eu,{to:"/terms",children:"Terms of Use"}),J.jsx(eu,{to:"/contact",children:"Contact"})]})]}),J.jsx("div",{className:"flex-1 min-w-0",children:J.jsxs("div",{className:"flex items-center justify-center gap-2",children:[J.jsx(li,{to:"/",className:"font-spectral text-4xl font-bold tracking-[-0.06em] leading-none text-ink shrink-0","aria-label":"BADA – home",children:"BADA"}),J.jsxs("div",{className:"text-left text-sm text-ink-muted leading-[1.1] shrink-0",children:["EU Beaches",J.jsx("br",{}),"in Sweden"]})]})}),J.jsxs("div",{className:"relative",ref:w,children:[J.jsx("button",{"aria-label":"User menu",className:"p-2 rounded-full hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/50 text-ink",onClick:()=>b(fe=>!fe),children:J.jsx(RS,{width:40,height:40,"aria-hidden":"true"})}),m&&J.jsxs("div",{role:"menu",className:"absolute right-0 mt-2 w-60 rounded-2xl border border-border bg-surface shadow p-2",children:[J.jsx("div",{className:"px-2 py-1.5 text-xs text-ink-muted",children:q?"KONTO / USER":"USER"}),J.jsx("div",{className:"h-px bg-border my-1"}),q?J.jsxs(J.Fragment,{children:[J.jsx(eu,{to:"/favorites",children:"Favourite beaches"}),J.jsx(eu,{to:"/profile",children:"Profile"}),J.jsx(eu,{to:"/settings",children:"Settings"}),J.jsx("div",{className:"h-px bg-border my-1"}),J.jsx("button",{className:"w-full text-left px-2 py-1.5 rounded-lg hover:bg-surface-muted text-sm",onClick:ye,children:"Log out"})]}):J.jsxs(J.Fragment,{children:[J.jsx(eu,{to:"/login",children:"Sign in"}),J.jsx(eu,{to:"/register",children:"Register"})]}),J.jsx("button",{className:"w-full text-left px-2 py-1.5 rounded-lg hover:bg-surface-muted text-sm",onClick:()=>L(!l),children:l?"Dark theme: on":"Dark theme: off"})]})]})]}),J.jsx("div",{className:"mx-auto max-w-screen-lg px-3 pb-2",children:J.jsxs("div",{className:"flex gap-2 items-center",children:[J.jsx("input",{type:"search",placeholder:"Search beaches…","aria-label":"Search beaches",className:"flex-1 rounded-2xl border border-border bg-surface-muted px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent/40",value:B,onChange:fe=>V(fe.target.value)}),B&&J.jsx("button",{className:"rounded-2xl border border-border bg-surface px-3 py-2 hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40",onClick:()=>V(""),"aria-label":"Clear search",title:"Clear",children:"Clear"})]})})]})]})}function eu({to:n,children:o}){return J.jsx(li,{to:n,className:"block px-2 py-1.5 rounded-lg hover:bg-surface-muted text-sm",role:"menuitem",children:o})}class FS extends ee.Component{constructor(){super(...arguments);Xv(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,m){console.error("ErrorBoundary caught an error:",u,m)}render(){return this.state.hasError?J.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:J.jsx("div",{className:"max-w-md w-full space-y-6",children:J.jsxs("div",{className:"card p-8 text-center space-y-4",children:[J.jsx("h1",{className:"font-spectral text-3xl text-red-600",children:"Oops! Something went wrong"}),J.jsx("p",{className:"text-ink-muted",children:"We encountered an unexpected error. Please try refreshing the page or return to the homepage."}),this.state.error&&J.jsxs("details",{className:"text-left bg-surface p-3 rounded-lg overflow-auto",children:[J.jsx("summary",{className:"cursor-pointer font-medium mb-2",children:"Technical details"}),J.jsx("pre",{className:"text-xs text-ink-muted whitespace-pre-wrap",children:this.state.error.toString()})]}),J.jsxs("div",{className:"flex gap-3 justify-center pt-4",children:[J.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"Reload Page"}),J.jsx(li,{to:"/",className:"px-4 py-2 rounded-lg border border-border hover:bg-surface-muted",children:"Go Home"})]})]})})}):this.props.children}}function OS(){const n=_l();return rS()?J.jsx(_2,{}):J.jsx(y2,{to:"/login",replace:!0,state:{from:n}})}var wg={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.7.1/LICENSE.txt
 */var jS=wg.exports,Tx;function NS(){return Tx||(Tx=1,(function(n,o){(function(u,m){n.exports=m()})(jS,(function(){var u={},m={};function b(w,l,L){if(m[w]=L,w==="index"){var B="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",V={};return m.shared(V),m.index(u,V),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([B],{type:"text/javascript"}))),u}}b("shared",["exports"],(function(w){function l(i,t,r,c){return new(r||(r=Promise))((function(f,_){function v(I){try{E(c.next(I))}catch(A){_(A)}}function T(I){try{E(c.throw(I))}catch(A){_(A)}}function E(I){var A;I.done?f(I.value):(A=I.value,A instanceof r?A:new r((function(F){F(A)}))).then(v,T)}E((c=c.apply(i,t||[])).next())}))}function L(i,t){this.x=i,this.y=t}function B(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var V,G;typeof SuppressedError=="function"&&SuppressedError,L.prototype={clone(){return new L(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,t){return this.clone()._rotateAround(i,t)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult(i){const t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const t=Math.cos(i),r=Math.sin(i),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround(i,t){const r=Math.cos(i),c=Math.sin(i),f=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=f,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:L},L.convert=function(i){if(i instanceof L)return i;if(Array.isArray(i))return new L(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new L(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var te=(function(){if(G)return V;function i(t,r,c,f){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=f}return G=1,V=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,f=0;f<8;f++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<r)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=_/v}var T=0,E=1;for(c=t,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<r));f++)t>_?T=c:E=c,c=.5*(E-T)+T;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},V})(),q=B(te);let Se,ye;function fe(){return Se==null&&(Se=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Se}function Fe(){if(ye==null&&(ye=!1,fe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<25;c++){const f=4*c;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let c=0;c<100;c++)if(c%4!=3&&r[c]!==c){ye=!0;break}}}return ye||!1}var Ce=1e-6,Ie=typeof Float32Array<"u"?Float32Array:Array;function Le(){var i=new Ie(9);return Ie!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Xe(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function mt(){var i=new Ie(3);return Ie!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function yt(i){var t=i[0],r=i[1],c=i[2];return Math.sqrt(t*t+r*r+c*c)}function Qe(i,t,r){var c=new Ie(3);return c[0]=i,c[1]=t,c[2]=r,c}function it(i,t,r){return i[0]=t[0]+r[0],i[1]=t[1]+r[1],i[2]=t[2]+r[2],i}function at(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i}function It(i,t,r){var c=t[0],f=t[1],_=t[2],v=r[0],T=r[1],E=r[2];return i[0]=f*E-_*T,i[1]=_*v-c*E,i[2]=c*T-f*v,i}var Rt,At=yt;function Ht(i,t,r){var c=t[0],f=t[1],_=t[2],v=t[3];return i[0]=r[0]*c+r[4]*f+r[8]*_+r[12]*v,i[1]=r[1]*c+r[5]*f+r[9]*_+r[13]*v,i[2]=r[2]*c+r[6]*f+r[10]*_+r[14]*v,i[3]=r[3]*c+r[7]*f+r[11]*_+r[15]*v,i}function Rr(){var i=new Ie(4);return Ie!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ar(i,t,r,c){var f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;t*=_,c*=_,r*=_;var v=Math.sin(t),T=Math.cos(t),E=Math.sin(r),I=Math.cos(r),A=Math.sin(c),F=Math.cos(c);switch(f){case"xyz":i[0]=v*I*F+T*E*A,i[1]=T*E*F-v*I*A,i[2]=T*I*A+v*E*F,i[3]=T*I*F-v*E*A;break;case"xzy":i[0]=v*I*F-T*E*A,i[1]=T*E*F-v*I*A,i[2]=T*I*A+v*E*F,i[3]=T*I*F+v*E*A;break;case"yxz":i[0]=v*I*F+T*E*A,i[1]=T*E*F-v*I*A,i[2]=T*I*A-v*E*F,i[3]=T*I*F+v*E*A;break;case"yzx":i[0]=v*I*F+T*E*A,i[1]=T*E*F+v*I*A,i[2]=T*I*A-v*E*F,i[3]=T*I*F-v*E*A;break;case"zxy":i[0]=v*I*F-T*E*A,i[1]=T*E*F+v*I*A,i[2]=T*I*A+v*E*F,i[3]=T*I*F-v*E*A;break;case"zyx":i[0]=v*I*F-T*E*A,i[1]=T*E*F+v*I*A,i[2]=T*I*A-v*E*F,i[3]=T*I*F+v*E*A;break;default:throw new Error("Unknown angle order "+f)}return i}function Zt(){var i=new Ie(2);return Ie!=Float32Array&&(i[0]=0,i[1]=0),i}function _t(i,t){var r=new Ie(2);return r[0]=i,r[1]=t,r}mt(),Rt=new Ie(4),Ie!=Float32Array&&(Rt[0]=0,Rt[1]=0,Rt[2]=0,Rt[3]=0),mt(),Qe(1,0,0),Qe(0,1,0),Rr(),Rr(),Le(),Zt();const ht=8192;function Ct(i,t,r){return t*(ht/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function Me(i,t){return(i%t+t)%t}function Ye(i,t,r){return i*(1-r)+t*r}function jt(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,r=t*i;return 4*(i<.5?r:3*(i-t)+r-.75)}function tr(i,t,r,c){const f=new q(i,t,r,c);return _=>f.solve(_)}const fr=tr(.25,.1,.25,1);function Kt(i,t,r){return Math.min(r,Math.max(t,i))}function Lr(i,t,r){const c=r-t,f=((i-t)%c+c)%c+t;return f===t?r:f}function sr(i,...t){for(const r of t)for(const c in r)i[c]=r[c];return i}let yr=1;function lr(i,t,r){const c={};for(const f in i)c[f]=t.call(this,i[f],f,i);return c}function ci(i,t,r){const c={};for(const f in i)t.call(this,i[f],f,i)&&(c[f]=i[f]);return c}function ln(i){return Array.isArray(i)?i.map(ln):typeof i=="object"&&i?lr(i,ln):i}const Vr={};function Nr(i){Vr[i]||(typeof console<"u"&&console.warn(i),Vr[i]=!0)}function Cn(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function jn(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Xi=null;function zi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Zn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function xe(i,t,r,c,f){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const v=_==null?void 0:_.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const T=v.startsWith("BGR"),E=new Uint8ClampedArray(c*f*4);if(yield _.copyTo(E,(function(I,A,F,U,Z){const H=4*Math.max(-A,0),Y=(Math.max(0,F)-F)*U*4+H,ie=4*U,ce=Math.max(0,A),Re=Math.max(0,F);return{rect:{x:ce,y:Re,width:Math.min(I.width,A+U)-ce,height:Math.min(I.height,F+Z)-Re},layout:[{offset:Y,stride:ie}]}})(i,t,r,c,f)),T)for(let I=0;I<E.length;I+=4){const A=E[I];E[I]=E[I+2],E[I+2]=A}return E}finally{_.close()}}))}let Be,Ke;function kt(i,t,r,c){return i.addEventListener(t,r,c),{unsubscribe:()=>{i.removeEventListener(t,r,c)}}}function vt(i){return i*Math.PI/180}function pt(i){return i/Math.PI*180}const Bt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},_r={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Sr="AbortError";function Te(){return new Error(Sr)}const K={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function X(i){return K.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ne="global-dispatcher";class ue extends Error{constructor(t,r,c,f){super(`AJAXError: ${r} (${t}): ${c}`),this.status=t,this.statusText=r,this.url=c,this.body=f}}const ve=()=>jn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ae=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const c=X(i.url);if(c)return c(i,t);if(jn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ne},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ve())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(c,f){return l(this,void 0,void 0,(function*(){const _=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ve(),signal:f.signal});let v,T;c.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{v=yield fetch(_)}catch(I){throw new ue(0,I.message,c.url,new Blob)}if(!v.ok){const I=yield v.blob();throw new ue(v.status,v.statusText,c.url,I)}T=c.type==="arrayBuffer"||c.type==="image"?v.arrayBuffer():c.type==="json"?v.json():v.text();const E=yield T;if(f.signal.aborted)throw Te();return{data:E,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}}))})(i,t);if(jn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ne},t)}var r;return(function(c,f){return new Promise(((_,v)=>{var T;const E=new XMLHttpRequest;E.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(E.responseType="arraybuffer");for(const I in c.headers)E.setRequestHeader(I,c.headers[I]);c.type==="json"&&(E.responseType="text",!((T=c.headers)===null||T===void 0)&&T.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=c.credentials==="include",E.onerror=()=>{v(new Error(E.statusText))},E.onload=()=>{if(!f.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let I=E.response;if(c.type==="json")try{I=JSON.parse(E.response)}catch(A){return void v(A)}_({data:I,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const I=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});v(new ue(E.status,E.statusText,c.url,I))}},f.signal.addEventListener("abort",(()=>{E.abort(),v(Te())})),E.send(c.body)}))})(i,t)};function Oe(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function ze(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function qe(i,t,r){if(r&&r[i]){const c=r[i].indexOf(t);c!==-1&&r[i].splice(c,1)}}class rt{constructor(t,r={}){sr(this,r),this.type=t}}class Je extends rt{constructor(t,r={}){super("error",sr({error:t},r))}}class zt{on(t,r){return this._listeners=this._listeners||{},ze(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return qe(t,r,this._listeners),qe(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ze(t,r,this._oneTimeListeners),this):new Promise((c=>this.once(t,c)))}fire(t,r){typeof t=="string"&&(t=new rt(t,r||{}));const c=t.type;if(this.listens(c)){t.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const T of f)T.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const T of _)qe(c,T,this._oneTimeListeners),T.call(this,t);const v=this._eventedParent;v&&(sr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof Je&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $t=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function rr(i,t){const r={};for(const c in i)c!=="ref"&&(r[c]=i[c]);return $t.forEach((c=>{c in t&&(r[c]=t[c])})),r}function Dt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Dt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Dt(i[r],t[r]))return!1;return!0}return i===t}function Xt(i,t){i.push(t)}function Cr(i,t,r){Xt(r,{command:"addSource",args:[i,t[i]]})}function Kr(i,t,r){Xt(t,{command:"removeSource",args:[i]}),r[i]=!0}function dn(i,t,r,c){Kr(i,r,c),Cr(i,t,r)}function Tr(i,t,r){let c;for(c in i[r])if(Object.prototype.hasOwnProperty.call(i[r],c)&&c!=="data"&&!Dt(i[r][c],t[r][c]))return!1;for(c in t[r])if(Object.prototype.hasOwnProperty.call(t[r],c)&&c!=="data"&&!Dt(i[r][c],t[r][c]))return!1;return!0}function cr(i,t,r,c,f,_){i=i||{},t=t||{};for(const v in i)Object.prototype.hasOwnProperty.call(i,v)&&(Dt(i[v],t[v])||r.push({command:_,args:[c,v,t[v],f]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(i,v)&&(Dt(i[v],t[v])||r.push({command:_,args:[c,v,t[v],f]}))}function or(i){return i.id}function en(i,t){return i[t.id]=t,i}class st{constructor(t,r,c,f){this.message=(t?`${t}: `:"")+c,f&&(this.identifier=f),r!=null&&r.__line__&&(this.line=r.__line__)}}function _n(i,...t){for(const r of t)for(const c in r)i[c]=r[c];return i}class $r extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class vi{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[c,f]of r)this.bindings[c]=f}concat(t){return new vi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ao={kind:"null"},Pt={kind:"number"},Dr={kind:"string"},pr={kind:"boolean"},ti={kind:"color"},aa={kind:"projectionDefinition"},la={kind:"object"},xr={kind:"value"},uc={kind:"collator"},Io={kind:"formatted"},hc={kind:"padding"},lo={kind:"colorArray"},vl={kind:"numberArray"},Er={kind:"resolvedImage"},du={kind:"variableAnchorOffsetCollection"};function xi(i,t){return{kind:"array",itemType:i,N:t}}function on(i){if(i.kind==="array"){const t=on(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const dc=[ao,Pt,Dr,pr,ti,aa,Io,la,xi(xr),hc,vl,lo,Er,du];function fc(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!fc(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of dc)if(!fc(r,t))return null}}return`Expected ${on(i)} but found ${on(t)} instead.`}function fu(i,t){return t.some((r=>r.kind===i.kind))}function Ns(i,t){return t.some((r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i))}function ui(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const gh=.96422,Es=.82521,Ud=4/29,xl=6/29,Vd=3*xl*xl,pu=xl*xl*xl,mu=Math.PI/180,pc=180/Math.PI;function bl(i){return(i%=360)<0&&(i+=360),i}function wl([i,t,r,c]){let f,_;const v=mc((.2225045*(i=yh(i))+.7168786*(t=yh(t))+.0606169*(r=yh(r)))/1);i===t&&t===r?f=_=v:(f=mc((.4360747*i+.3850649*t+.1430804*r)/gh),_=mc((.0139322*i+.0971045*t+.7141733*r)/Es));const T=116*v-16;return[T<0?0:T,500*(f-v),200*(v-_),c]}function yh(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function mc(i){return i>pu?Math.pow(i,1/3):i/Vd+Ud}function Oa([i,t,r,c]){let f=(i+16)/116,_=isNaN(t)?f:f+t/500,v=isNaN(r)?f:f-r/200;return f=1*ja(f),_=gh*ja(_),v=Es*ja(v),[gc(3.1338561*_-1.6168667*f-.4906146*v),gc(-.9787684*_+1.9161415*f+.033454*v),gc(.0719453*_-.2289914*f+1.4052427*v),c]}function gc(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ja(i){return i>xl?i*i*i:Vd*(i-Ud)}const Yf=Object.hasOwn||function(i,t){return Object.prototype.hasOwnProperty.call(i,t)};function ca(i,t){return Yf(i,t)?i[t]:void 0}function qr(i){return parseInt(i.padEnd(2,i),16)/255}function ks(i,t){return kr(t?i/100:i,0,1)}function kr(i,t,r){return Math.min(Math.max(t,i),r)}function Ao(i){return!i.some(Number.isNaN)}const zo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function co(i,t,r){return i+r*(t-i)}function ua(i,t,r){return i.map(((c,f)=>co(c,t[f],r)))}class Pr{constructor(t,r,c,f=1,_=!0){this.r=t,this.g=r,this.b=c,this.a=f,_||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,r,c,f]))}static parse(t){if(t instanceof Pr)return t;if(typeof t!="string")return;const r=(function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=ca(zo,c);if(f){const[v,T,E]=f;return[v/255,T/255,E/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const v=c.length<6?1:2;let T=1;return[qr(c.slice(T,T+=v)),qr(c.slice(T,T+=v)),qr(c.slice(T,T+=v)),qr(c.slice(T,T+v)||"ff")]}if(c.startsWith("rgb")){const v=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[T,E,I,A,F,U,Z,H,Y,ie,ce,Re]=v,pe=[A||" ",Z||" ",ie].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const be=[I,U,Y].join(""),Ue=be==="%%%"?100:be===""?255:0;if(Ue){const We=[kr(+E/Ue,0,1),kr(+F/Ue,0,1),kr(+H/Ue,0,1),ce?ks(+ce,Re):1];if(Ao(We))return We}}return}}const _=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,T,E,I,A,F,U,Z,H]=_,Y=[E||" ",A||" ",U].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const ie=[+T,kr(+I,0,100),kr(+F,0,100),Z?ks(+Z,H):1];if(Ao(ie))return(function([ce,Re,pe,be]){function Ue(We){const nt=(We+ce/30)%12,Tt=Re*Math.min(pe,1-pe);return pe-Tt*Math.max(-1,Math.min(nt-3,9-nt,1))}return ce=bl(ce),Re/=100,pe/=100,[Ue(0),Ue(8),Ue(4),be]})(ie)}}})(t);return r?new Pr(...r,!1):void 0}get rgb(){const{r:t,g:r,b:c,a:f}=this,_=f||1/0;return this.overwriteGetter("rgb",[t/_,r/_,c/_,f])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,c,f,_]=wl(t),v=Math.sqrt(c*c+f*f);return[Math.round(1e4*v)?bl(Math.atan2(f,c)*pc):NaN,v,r,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",wl(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,c,f]=this.rgb;return`rgba(${[t,r,c].map((_=>Math.round(255*_))).join(",")},${f})`}static interpolate(t,r,c,f="rgb"){switch(f){case"rgb":{const[_,v,T,E]=ua(t.rgb,r.rgb,c);return new Pr(_,v,T,E,!1)}case"hcl":{const[_,v,T,E]=t.hcl,[I,A,F,U]=r.hcl;let Z,H;if(isNaN(_)||isNaN(I))isNaN(_)?isNaN(I)?Z=NaN:(Z=I,T!==1&&T!==0||(H=A)):(Z=_,F!==1&&F!==0||(H=v));else{let pe=I-_;I>_&&pe>180?pe-=360:I<_&&_-I>180&&(pe+=360),Z=_+c*pe}const[Y,ie,ce,Re]=(function([pe,be,Ue,We]){return pe=isNaN(pe)?0:pe*mu,Oa([Ue,Math.cos(pe)*be,Math.sin(pe)*be,We])})([Z,H??co(v,A,c),co(T,F,c),co(E,U,c)]);return new Pr(Y,ie,ce,Re,!1)}case"lab":{const[_,v,T,E]=Oa(ua(t.lab,r.lab,c));return new Pr(_,v,T,E,!1)}}}}Pr.black=new Pr(0,0,0,1),Pr.white=new Pr(1,1,1,1),Pr.transparent=new Pr(0,0,0,0),Pr.red=new Pr(1,0,0,1);class uo{constructor(t,r,c){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Bs=["bottom","center","top"];class $s{constructor(t,r,c,f,_,v){this.text=t,this.image=r,this.scale=c,this.fontStack=f,this.textColor=_,this.verticalAlign=v}}class En{constructor(t){this.sections=t}static fromString(t){return new En([new $s(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof En?t:En.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class kn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kn)return t;if(typeof t=="number")return new kn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new kn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c){return new kn(ua(t.values,r.values,c))}}class Gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Gn)return t;if(typeof t=="number")return new Gn([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new Gn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c){return new Gn(ua(t.values,r.values,c))}}class fn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof fn)return t;if(typeof t=="string"){const c=Pr.parse(t);return c?new fn([c]):void 0}if(!Array.isArray(t))return;const r=[];for(const c of t){if(typeof c!="string")return;const f=Pr.parse(c);if(!f)return;r.push(f)}return new fn(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c,f="rgb"){const _=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let v=0;v<t.values.length;v++)_.push(Pr.interpolate(t.values[v],r.values[v],c,f));return new fn(_)}}class cn extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const _h=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof qn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const c=t[r],f=t[r+1];if(typeof c!="string"||!_h.has(c)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new qn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c){const f=t.values,_=r.values;if(f.length!==_.length)throw new cn(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const v=[];for(let T=0;T<f.length;T+=2){if(f[T]!==_[T])throw new cn(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${f[T]}, to[${T}]: ${_[T]}`);v.push(f[T]);const[E,I]=f[T+1],[A,F]=_[T+1];v.push([co(E,A,c),co(I,F,c)])}return new qn(v)}}class ds{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ds({name:t,available:!1}):null}}class hi{constructor(t,r,c){this.from=t,this.to=r,this.transition=c}static interpolate(t,r,c){return new hi(t,r,c)}static parse(t){return t instanceof hi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new hi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new hi(t.from,t.to,t.transition):typeof t=="string"?new hi(t,t,1):void 0}}function an(i,t,r,c){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[i,t,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[i,t,r,c]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ha(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof hi||i instanceof Pr||i instanceof uo||i instanceof En||i instanceof kn||i instanceof Gn||i instanceof fn||i instanceof qn||i instanceof ds)return!0;if(Array.isArray(i)){for(const t of i)if(!ha(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!ha(i[t]))return!1;return!0}return!1}function nr(i){if(i===null)return ao;if(typeof i=="string")return Dr;if(typeof i=="boolean")return pr;if(typeof i=="number")return Pt;if(i instanceof Pr)return ti;if(i instanceof hi)return aa;if(i instanceof uo)return uc;if(i instanceof En)return Io;if(i instanceof kn)return hc;if(i instanceof Gn)return vl;if(i instanceof fn)return lo;if(i instanceof qn)return du;if(i instanceof ds)return Er;if(Array.isArray(i)){const t=i.length;let r;for(const c of i){const f=nr(c);if(r){if(r===f)continue;r=xr;break}r=f}return xi(r||xr,t)}return la}function ur(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Pr||i instanceof hi||i instanceof En||i instanceof kn||i instanceof Gn||i instanceof fn||i instanceof qn||i instanceof ds?i.toString():JSON.stringify(i)}class fs{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ha(t[1]))return r.error("invalid value");const c=t[1];let f=nr(c);const _=r.expectedType;return f.kind!=="array"||f.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(f=_),new fs(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Mr={string:Dr,number:Pt,boolean:pr,object:la};class bi{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c,f=1;const _=t[0];if(_==="array"){let T,E;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in Mr)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);T=Mr[I],f++}else T=xr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=t[2],f++}c=xi(T,E)}else{if(!Mr[_])throw new Error(`Types doesn't contain name = ${_}`);c=Mr[_]}const v=[];for(;f<t.length;f++){const T=r.parse(t[f],f,xr);if(!T)return null;v.push(T)}return new bi(c,v)}evaluate(t){for(let r=0;r<this.args.length;r++){const c=this.args[r].evaluate(t);if(!fc(this.type,nr(c)))return c;if(r===this.args.length-1)throw new cn(`Expected value to be of type ${on(this.type)}, but found ${on(nr(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ho={"to-boolean":pr,"to-color":ti,"to-number":Pt,"to-string":Dr};class fo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[0];if(!ho[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return r.error("Expected one argument.");const f=ho[c],_=[];for(let v=1;v<t.length;v++){const T=r.parse(t[v],v,xr);if(!T)return null;_.push(T)}return new fo(f,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,c;for(const f of this.args){if(r=f.evaluate(t),c=null,r instanceof Pr)return r;if(typeof r=="string"){const _=t.parseColor(r);if(_)return _}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:an(r[0],r[1],r[2],r[3]),!c))return new Pr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new cn(c||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const c of this.args){r=c.evaluate(t);const f=kn.parse(r);if(f)return f}throw new cn(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const c of this.args){r=c.evaluate(t);const f=Gn.parse(r);if(f)return f}throw new cn(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const c of this.args){r=c.evaluate(t);const f=fn.parse(r);if(f)return f}throw new cn(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const c of this.args){r=c.evaluate(t);const f=qn.parse(r);if(f)return f}throw new cn(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const c of this.args){if(r=c.evaluate(t),r===null)return 0;const f=Number(r);if(!isNaN(f))return f}throw new cn(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return En.fromString(ur(this.args[0].evaluate(t)));case"resolvedImage":return ds.fromString(ur(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ur(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Sl=["Unknown","Point","LineString","Polygon"];class Tl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Sl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=Pr.parse(t),this._parseColorCache.set(t,r)),r}}class da{constructor(t,r,c=[],f,_=new vi,v=[]){this.registry=t,this.path=c,this.key=c.map((T=>`[${T}]`)).join(""),this.scope=_,this.errors=v,this.expectedType=f,this._isConstant=r}parse(t,r,c,f,_={}){return r?this.concat(r,c,f)._parse(t,_):this._parse(t,_)}_parse(t,r){function c(f,_,v){return v==="assert"?new bi(_,[f]):v==="coerce"?new fo(_,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const T=this.expectedType,E=v.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||E.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(E.kind)||T.kind==="colorArray"&&["value","string","array"].includes(E.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))v=c(v,T,r.typeAnnotation||"coerce");else if(this.checkSubtype(T,E))return null}else v=c(v,T,r.typeAnnotation||"assert")}if(!(v instanceof fs)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const T=new Tl;try{v=new fs(v.type,v.evaluate(T))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,c){const f=typeof t=="number"?this.path.concat(t):this.path,_=c?this.scope.concat(c):this.scope;return new da(this.registry,this._isConstant,f,r||null,_,this.errors)}error(t,...r){const c=`${this.key}${r.map((f=>`[${f}]`)).join("")}`;this.errors.push(new $r(c,t))}checkSubtype(t,r){const c=fc(t,r);return c&&this.error(c),c}}class Pl{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return r.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return r.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=r.parse(t[_+1],_+1);if(!T)return null;c.push([v,T])}const f=r.parse(t[t.length-1],t.length-1,r.expectedType,c);return f?new Pl(c,f):null}outputDefined(){return this.result.outputDefined()}}class Us{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const c=t[1];return r.scope.has(c)?new Us(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Cl{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Pt),f=r.parse(t[2],2,xi(r.expectedType||xr));return c&&f?new Cl(f.type.itemType,c,f):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new cn(`Array index out of bounds: ${r} < 0.`);if(r>=c.length)throw new cn(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r!==Math.floor(r))throw new cn(`Array index must be an integer, but found ${r} instead.`);return c[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Na{constructor(t,r){this.type=pr,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,xr),f=r.parse(t[2],2,xr);return c&&f?fu(c.type,[pr,Dr,Pt,ao,xr])?new Na(c,f):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(c.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!Ns(r,["boolean","string","number","null"]))throw new cn(`Expected first argument to be of type boolean, string, number or null, but found ${on(nr(r))} instead.`);if(!Ns(c,["string","array"]))throw new cn(`Expected second argument to be of type array or string, but found ${on(nr(c))} instead.`);return c.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ms{constructor(t,r,c){this.type=Pt,this.needle=t,this.haystack=r,this.fromIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,xr),f=r.parse(t[2],2,xr);if(!c||!f)return null;if(!fu(c.type,[pr,Dr,Pt,ao,xr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(c.type)} instead`);if(t.length===4){const _=r.parse(t[3],3,Pt);return _?new Ms(c,f,_):null}return new Ms(c,f)}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Ns(r,["boolean","string","number","null"]))throw new cn(`Expected first argument to be of type boolean, string, number or null, but found ${on(nr(r))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),Ns(c,["string"])){const _=c.indexOf(r,f);return _===-1?-1:[...c.slice(0,_)].length}if(Ns(c,["array"]))return c.indexOf(r,f);throw new cn(`Expected second argument to be of type array or string, but found ${on(nr(c))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class zn{constructor(t,r,c,f,_,v){this.inputType=t,this.type=r,this.input=c,this.cases=f,this.outputs=_,this.otherwise=v}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let c,f;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);const _={},v=[];for(let I=2;I<t.length-1;I+=2){let A=t[I];const F=t[I+1];Array.isArray(A)||(A=[A]);const U=r.concat(I);if(A.length===0)return U.error("Expected at least one branch label.");for(const H of A){if(typeof H!="number"&&typeof H!="string")return U.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return U.error("Numeric branch labels must be integer values.");if(c){if(U.checkSubtype(c,nr(H)))return null}else c=nr(H);if(_[String(H)]!==void 0)return U.error("Branch labels must be unique.");_[String(H)]=v.length}const Z=r.parse(F,I,f);if(!Z)return null;f=f||Z.type,v.push(Z)}const T=r.parse(t[1],1,xr);if(!T)return null;const E=r.parse(t[t.length-1],t.length-1,f);return E?T.type.kind!=="value"&&r.concat(1).checkSubtype(c,T.type)?null:new zn(c,f,T,_,v,E):null}evaluate(t){const r=this.input.evaluate(t);return(nr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Ro{constructor(t,r,c){this.type=t,this.branches=r,this.otherwise=c}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const f=[];for(let v=1;v<t.length-1;v+=2){const T=r.parse(t[v],v,pr);if(!T)return null;const E=r.parse(t[v+1],v+1,c);if(!E)return null;f.push([T,E]),c=c||E.type}const _=r.parse(t[t.length-1],t.length-1,c);if(!_)return null;if(!c)throw new Error("Can't infer output type");return new Ro(c,f,_)}evaluate(t){for(const[r,c]of this.branches)if(r.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,c]of this.branches)t(r),t(c);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class El{constructor(t,r,c,f){this.type=t,this.input=r,this.beginIndex=c,this.endIndex=f}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,xr),f=r.parse(t[2],2,Pt);if(!c||!f)return null;if(!fu(c.type,[xi(xr),Dr,xr]))return r.error(`Expected first argument to be of type array or string, but found ${on(c.type)} instead`);if(t.length===4){const _=r.parse(t[3],3,Pt);return _?new El(c.type,c,f,_):null}return new El(c.type,c,f)}evaluate(t){const r=this.input.evaluate(t),c=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),Ns(r,["string"]))return[...r].slice(c,f).join("");if(Ns(r,["array"]))return r.slice(c,f);throw new cn(`Expected first argument to be of type array or string, but found ${on(nr(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Wn(i,t){const r=i.length-1;let c,f,_=0,v=r,T=0;for(;_<=v;)if(T=Math.floor((_+v)/2),c=i[T],f=i[T+1],c<=t){if(T===r||t<f)return T;_=T+1}else{if(!(c>t))throw new cn("Input is not a number.");v=T-1}return 0}class pn{constructor(t,r,c){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[f,_]of c)this.labels.push(f),this.outputs.push(_)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const c=r.parse(t[1],1,Pt);if(!c)return null;const f=[];let _=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let v=1;v<t.length;v+=2){const T=v===1?-1/0:t[v],E=t[v+1],I=v,A=v+1;if(typeof T!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=T)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const F=r.parse(E,A,_);if(!F)return null;_=_||F.type,f.push([T,F])}return new pn(_,c,f)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=r[0])return c[0].evaluate(t);const _=r.length;return f>=r[_-1]?c[_-1].evaluate(t):c[Wn(r,f)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function gu(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Do,vh,xh=(function(){if(vh)return Do;function i(t,r,c,f){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=f}return vh=1,Do=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,f=0;f<8;f++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<r)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=_/v}var T=0,E=1;for(c=t,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<r));f++)t>_?T=c:E=c,c=.5*(E-T)+T;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Do})(),fa=gu(xh);class Rn{constructor(t,r,c,f,_){this.type=t,this.operator=r,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[v,T]of _)this.labels.push(v),this.outputs.push(T)}static interpolationFactor(t,r,c,f){let _=0;if(t.name==="exponential")_=pa(r,t.base,c,f);else if(t.name==="linear")_=pa(r,1,c,f);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new fa(v[0],v[1],v[2],v[3]).solve(pa(r,1,c,f))}return _}static parse(t,r){let[c,f,_,...v]=t;if(!Array.isArray(f)||f.length===0)return r.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const I=f[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:I}}else{if(f[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const I=f.slice(1);if(I.length!==4||I.some((A=>typeof A!="number"||A<0||A>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(_=r.parse(_,2,Pt),!_)return null;const T=[];let E=null;c!=="interpolate-hcl"&&c!=="interpolate-lab"||r.expectedType==lo?r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType):E=ti;for(let I=0;I<v.length;I+=2){const A=v[I],F=v[I+1],U=I+3,Z=I+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(T.length&&T[T.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const H=r.parse(F,Z,E);if(!H)return null;E=E||H.type,T.push([A,H])}return ui(E,Pt)||ui(E,aa)||ui(E,ti)||ui(E,hc)||ui(E,vl)||ui(E,lo)||ui(E,du)||ui(E,xi(Pt))?new Rn(E,c,f,_,T):r.error(`Type ${on(E)} is not interpolatable.`)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=r[0])return c[0].evaluate(t);const _=r.length;if(f>=r[_-1])return c[_-1].evaluate(t);const v=Wn(r,f),T=Rn.interpolationFactor(this.interpolation,f,r[v],r[v+1]),E=c[v].evaluate(t),I=c[v+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return co(E,I,T);case"color":return Pr.interpolate(E,I,T);case"padding":return kn.interpolate(E,I,T);case"colorArray":return fn.interpolate(E,I,T);case"numberArray":return Gn.interpolate(E,I,T);case"variableAnchorOffsetCollection":return qn.interpolate(E,I,T);case"array":return ua(E,I,T);case"projectionDefinition":return hi.interpolate(E,I,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return Pr.interpolate(E,I,T,"hcl");case"colorArray":return fn.interpolate(E,I,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Pr.interpolate(E,I,T,"lab");case"colorArray":return fn.interpolate(E,I,T,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function pa(i,t,r,c){const f=c-r,_=i-r;return f===0?0:t===1?_/f:(Math.pow(t,_)-1)/(Math.pow(t,f)-1)}const Vs={color:Pr.interpolate,number:co,padding:kn.interpolate,numberArray:Gn.interpolate,colorArray:fn.interpolate,variableAnchorOffsetCollection:qn.interpolate,array:ua};class yc{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c=null;const f=r.expectedType;f&&f.kind!=="value"&&(c=f);const _=[];for(const T of t.slice(1)){const E=r.parse(T,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,_.push(E)}if(!c)throw new Error("No output type");const v=f&&_.some((T=>fc(f,T.type)));return new yc(v?xr:c,_)}evaluate(t){let r,c=null,f=0;for(const _ of this.args)if(f++,c=_.evaluate(t),c&&c instanceof ds&&!c.available&&(r||(r=c.name),c=null,f===this.args.length&&(c=r)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function _c(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vc(i,t,r,c){return c.compare(t,r)===0}function ri(i,t,r){const c=i!=="=="&&i!=="!=";return class Ib{constructor(_,v,T){this.type=pr,this.lhs=_,this.rhs=v,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const T=_[0];let E=v.parse(_[1],1,xr);if(!E)return null;if(!_c(T,E.type))return v.concat(1).error(`"${T}" comparisons are not supported for type '${on(E.type)}'.`);let I=v.parse(_[2],2,xr);if(!I)return null;if(!_c(T,I.type))return v.concat(2).error(`"${T}" comparisons are not supported for type '${on(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${on(E.type)}' and '${on(I.type)}'.`);c&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new bi(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new bi(E.type,[I])));let A=null;if(_.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(A=v.parse(_[3],3,uc),!A)return null}return new Ib(E,I,A)}evaluate(_){const v=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const E=nr(v),I=nr(T);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new cn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=nr(v),I=nr(T);if(E.kind!=="string"||I.kind!=="string")return t(_,v,T)}return this.collator?r(_,v,T,this.collator.evaluate(_)):t(_,v,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Zd=ri("==",(function(i,t,r){return t===r}),vc),yu=ri("!=",(function(i,t,r){return t!==r}),(function(i,t,r,c){return!vc(0,t,r,c)})),Qf=ri("<",(function(i,t,r){return t<r}),(function(i,t,r,c){return c.compare(t,r)<0})),bh=ri(">",(function(i,t,r){return t>r}),(function(i,t,r,c){return c.compare(t,r)>0})),Jf=ri("<=",(function(i,t,r){return t<=r}),(function(i,t,r,c){return c.compare(t,r)<=0})),Gd=ri(">=",(function(i,t,r){return t>=r}),(function(i,t,r,c){return c.compare(t,r)>=0}));class _u{constructor(t,r,c){this.type=uc,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");const f=r.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,pr);if(!f)return null;const _=r.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,pr);if(!_)return null;let v=null;return c.locale&&(v=r.parse(c.locale,1,Dr),!v)?null:new _u(f,_,v)}evaluate(t){return new uo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class wh{constructor(t,r,c,f,_){this.type=Dr,this.number=t,this.locale=r,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const c=r.parse(t[1],1,Pt);if(!c)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return r.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=r.parse(f.locale,1,Dr),!_))return null;let v=null;if(f.currency&&(v=r.parse(f.currency,1,Dr),!v))return null;let T=null;if(f["min-fraction-digits"]&&(T=r.parse(f["min-fraction-digits"],1,Pt),!T))return null;let E=null;return f["max-fraction-digits"]&&(E=r.parse(f["max-fraction-digits"],1,Pt),!E)?null:new wh(c,_,v,T,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ba{constructor(t){this.type=Io,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");const f=[];let _=!1;for(let v=1;v<=t.length-1;++v){const T=t[v];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let E=null;if(T["font-scale"]&&(E=r.parse(T["font-scale"],1,Pt),!E))return null;let I=null;if(T["text-font"]&&(I=r.parse(T["text-font"],1,xi(Dr)),!I))return null;let A=null;if(T["text-color"]&&(A=r.parse(T["text-color"],1,ti),!A))return null;let F=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!Bs.includes(T["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(F=r.parse(T["vertical-align"],1,Dr),!F)return null}const U=f[f.length-1];U.scale=E,U.font=I,U.textColor=A,U.verticalAlign=F}else{const E=r.parse(t[v],1,xr);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ba(f)}evaluate(t){return new En(this.sections.map((r=>{const c=r.content.evaluate(t);return nr(c)===Er?new $s("",c,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new $s(ur(c),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Sh{constructor(t){this.type=Er,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const c=r.parse(t[1],1,Dr);return c?new Sh(c):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),c=ds.fromString(r);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(r)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class kl{constructor(t){this.type=Pt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=r.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${on(c.type)} instead.`):new kl(c):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new cn(`Expected value to be of type string or array, but found ${on(nr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Zs=8192;function ep(i,t){const r=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(r*f*Zs),Math.round(c*f*Zs)]}function vu(i,t){const r=Math.pow(2,t.z);return[(f=(i[0]/Zs+t.x)/r,360*f-180),(c=(i[1]/Zs+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,f}function Ml(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function xc(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function tp(i,t,r){const c=i[0]-t[0],f=i[1]-t[1],_=i[0]-r[0],v=i[1]-r[1];return c*v-_*f==0&&c*_<=0&&f*v<=0}function xu(i,t,r,c){return(f=[c[0]-r[0],c[1]-r[1]])[0]*(_=[t[0]-i[0],t[1]-i[1]])[1]-f[1]*_[0]!=0&&!(!Il(i,t,r,c)||!Il(r,c,i,t));var f,_}function rp(i,t,r){for(const c of r)for(let f=0;f<c.length-1;++f)if(xu(i,t,c[f],c[f+1]))return!0;return!1}function $a(i,t,r=!1){let c=!1;for(const T of t)for(let E=0;E<T.length-1;E++){if(tp(i,T[E],T[E+1]))return r;(_=T[E])[1]>(f=i)[1]!=(v=T[E+1])[1]>f[1]&&f[0]<(v[0]-_[0])*(f[1]-_[1])/(v[1]-_[1])+_[0]&&(c=!c)}var f,_,v;return c}function qd(i,t){for(const r of t)if($a(i,r))return!0;return!1}function Th(i,t){for(const r of i)if(!$a(r,t))return!1;for(let r=0;r<i.length-1;++r)if(rp(i[r],i[r+1],t))return!1;return!0}function Ph(i,t){for(const r of t)if(Th(i,r))return!0;return!1}function Il(i,t,r,c){const f=c[0]-r[0],_=c[1]-r[1],v=(i[0]-r[0])*_-f*(i[1]-r[1]),T=(t[0]-r[0])*_-f*(t[1]-r[1]);return v>0&&T<0||v<0&&T>0}function Ch(i,t,r){const c=[];for(let f=0;f<i.length;f++){const _=[];for(let v=0;v<i[f].length;v++){const T=ep(i[f][v],r);Ml(t,T),_.push(T)}c.push(_)}return c}function Eh(i,t,r){const c=[];for(let f=0;f<i.length;f++){const _=Ch(i[f],t,r);c.push(_)}return c}function bc(i,t,r,c){if(i[0]<r[0]||i[0]>r[2]){const f=.5*c;let _=i[0]-r[0]>f?-c:r[0]-i[0]>f?c:0;_===0&&(_=i[0]-r[2]>f?-c:r[2]-i[0]>f?c:0),i[0]+=_}Ml(t,i)}function kh(i,t,r,c){const f=Math.pow(2,c.z)*Zs,_=[c.x*Zs,c.y*Zs],v=[];for(const T of i)for(const E of T){const I=[E.x+_[0],E.y+_[1]];bc(I,t,r,f),v.push(I)}return v}function Mh(i,t,r,c){const f=Math.pow(2,c.z)*Zs,_=[c.x*Zs,c.y*Zs],v=[];for(const E of i){const I=[];for(const A of E){const F=[A.x+_[0],A.y+_[1]];Ml(t,F),I.push(F)}v.push(I)}if(t[2]-t[0]<=f/2){(T=t)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const E of v)for(const I of E)bc(I,t,r,f)}var T;return v}class ma{constructor(t,r){this.type=pr,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ha(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const f=[];for(const _ of c.features){const{type:v,coordinates:T}=_.geometry;v==="Polygon"&&f.push(T),v==="MultiPolygon"&&f.push(...T)}if(f.length)return new ma(c,{type:"MultiPolygon",coordinates:f})}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ma(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new ma(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,c){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(c.type==="Polygon"){const T=Ch(c.coordinates,_,v),E=kh(r.geometry(),f,_,v);if(!xc(f,_))return!1;for(const I of E)if(!$a(I,T))return!1}if(c.type==="MultiPolygon"){const T=Eh(c.coordinates,_,v),E=kh(r.geometry(),f,_,v);if(!xc(f,_))return!1;for(const I of E)if(!qd(I,T))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,c){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(c.type==="Polygon"){const T=Ch(c.coordinates,_,v),E=Mh(r.geometry(),f,_,v);if(!xc(f,_))return!1;for(const I of E)if(!Th(I,T))return!1}if(c.type==="MultiPolygon"){const T=Eh(c.coordinates,_,v),E=Mh(r.geometry(),f,_,v);if(!xc(f,_))return!1;for(const I of E)if(!Ph(I,T))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ga=class{constructor(i=[],t=(r,c)=>r<c?-1:r>c?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,c=t[i];for(;i>0;){const f=i-1>>1,_=t[f];if(r(c,_)>=0)break;t[i]=_,i=f}t[i]=c}_down(i){const{data:t,compare:r}=this,c=this.length>>1,f=t[i];for(;i<c;){let _=1+(i<<1);const v=_+1;if(v<this.length&&r(t[v],t[_])<0&&(_=v),r(t[_],f)>=0)break;t[i]=t[_],i=_}t[i]=f}};function Ih(i,t,r=0,c=i.length-1,f=np){for(;c>r;){if(c-r>600){const E=c-r+1,I=t-r+1,A=Math.log(E),F=.5*Math.exp(2*A/3),U=.5*Math.sqrt(A*F*(E-F)/E)*(I-E/2<0?-1:1);Ih(i,t,Math.max(r,Math.floor(t-I*F/E+U)),Math.min(c,Math.floor(t+(E-I)*F/E+U)),f)}const _=i[t];let v=r,T=c;for(wc(i,r,t),f(i[c],_)>0&&wc(i,r,c);v<T;){for(wc(i,v,T),v++,T--;f(i[v],_)<0;)v++;for(;f(i[T],_)>0;)T--}f(i[r],_)===0?wc(i,r,T):(T++,wc(i,T,c)),T<=t&&(r=T+1),t<=T&&(c=T-1)}}function wc(i,t,r){const c=i[t];i[t]=i[r],i[r]=c}function np(i,t){return i<t?-1:i>t?1:0}function Al(i,t){if(i.length<=1)return[i];const r=[];let c,f;for(const _ of i){const v=Sc(_);v!==0&&(_.area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(c&&r.push(c),c=[_]):c.push(_))}if(c&&r.push(c),t>1)for(let _=0;_<r.length;_++)r[_].length<=t||(Ih(r[_],t,1,r[_].length-1,Ah),r[_]=r[_].slice(0,t));return r}function Ah(i,t){return t.area-i.area}function Sc(i){let t=0;for(let r,c,f=0,_=i.length,v=_-1;f<_;v=f++)r=i[f],c=i[v],t+=(c.x-r.x)*(r.y+c.y);return t}const zl=1/298.257223563,Wd=zl*(2-zl),Rl=Math.PI/180;class zh{constructor(t){const r=6378.137*Rl*1e3,c=Math.cos(t*Rl),f=1/(1-Wd*(1-c*c)),_=Math.sqrt(f);this.kx=r*_*c,this.ky=r*_*f*(1-Wd)}distance(t,r){const c=this.wrap(t[0]-r[0])*this.kx,f=(t[1]-r[1])*this.ky;return Math.sqrt(c*c+f*f)}pointOnLine(t,r){let c,f,_,v,T=1/0;for(let E=0;E<t.length-1;E++){let I=t[E][0],A=t[E][1],F=this.wrap(t[E+1][0]-I)*this.kx,U=(t[E+1][1]-A)*this.ky,Z=0;F===0&&U===0||(Z=(this.wrap(r[0]-I)*this.kx*F+(r[1]-A)*this.ky*U)/(F*F+U*U),Z>1?(I=t[E+1][0],A=t[E+1][1]):Z>0&&(I+=F/this.kx*Z,A+=U/this.ky*Z)),F=this.wrap(r[0]-I)*this.kx,U=(r[1]-A)*this.ky;const H=F*F+U*U;H<T&&(T=H,c=I,f=A,_=E,v=Z)}return{point:[c,f],index:_,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Rh(i,t){return t[0]-i[0]}function Dl(i){return i[1]-i[0]+1}function Gs(i,t){return i[1]>=i[0]&&i[1]<t}function Ur(i,t){if(i[0]>i[1])return[null,null];const r=Dl(i);if(t){if(r===2)return[i,null];const f=Math.floor(r/2);return[[i[0],i[0]+f],[i[0]+f,i[1]]]}if(r===1)return[i,null];const c=Math.floor(r/2)-1;return[[i[0],i[0]+c],[i[0]+c+1,i[1]]]}function bu(i,t){if(!Gs(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let c=t[0];c<=t[1];++c)Ml(r,i[c]);return r}function wu(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const c of r)Ml(t,c);return t}function Hd(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Dh(i,t,r){if(!Hd(i)||!Hd(t))return NaN;let c=0,f=0;return i[2]<t[0]&&(c=t[0]-i[2]),i[0]>t[2]&&(c=i[0]-t[2]),i[1]>t[3]&&(f=i[1]-t[3]),i[3]<t[1]&&(f=t[1]-i[3]),r.distance([0,0],[c,f])}function Ua(i,t,r){const c=r.pointOnLine(t,i);return r.distance(i,c.point)}function Lh(i,t,r,c,f){const _=Math.min(Ua(i,[r,c],f),Ua(t,[r,c],f)),v=Math.min(Ua(r,[i,t],f),Ua(c,[i,t],f));return Math.min(_,v)}function ip(i,t,r,c,f){if(!Gs(t,i.length)||!Gs(c,r.length))return 1/0;let _=1/0;for(let v=t[0];v<t[1];++v){const T=i[v],E=i[v+1];for(let I=c[0];I<c[1];++I){const A=r[I],F=r[I+1];if(xu(T,E,A,F))return 0;_=Math.min(_,Lh(T,E,A,F,f))}}return _}function qs(i,t,r,c,f){if(!Gs(t,i.length)||!Gs(c,r.length))return NaN;let _=1/0;for(let v=t[0];v<=t[1];++v)for(let T=c[0];T<=c[1];++T)if(_=Math.min(_,f.distance(i[v],r[T])),_===0)return _;return _}function Tc(i,t,r){if($a(i,t,!0))return 0;let c=1/0;for(const f of t){const _=f[0],v=f[f.length-1];if(_!==v&&(c=Math.min(c,Ua(i,[v,_],r)),c===0))return c;const T=r.pointOnLine(f,i);if(c=Math.min(c,r.distance(i,T.point)),c===0)return c}return c}function Kd(i,t,r,c){if(!Gs(t,i.length))return NaN;for(let _=t[0];_<=t[1];++_)if($a(i[_],r,!0))return 0;let f=1/0;for(let _=t[0];_<t[1];++_){const v=i[_],T=i[_+1];for(const E of r)for(let I=0,A=E.length,F=A-1;I<A;F=I++){const U=E[F],Z=E[I];if(xu(v,T,U,Z))return 0;f=Math.min(f,Lh(v,T,U,Z,c))}}return f}function Fh(i,t){for(const r of i)for(const c of r)if($a(c,t,!0))return!0;return!1}function Xd(i,t,r,c=1/0){const f=wu(i),_=wu(t);if(c!==1/0&&Dh(f,_,r)>=c)return c;if(xc(f,_)){if(Fh(i,t))return 0}else if(Fh(t,i))return 0;let v=1/0;for(const T of i)for(let E=0,I=T.length,A=I-1;E<I;A=E++){const F=T[A],U=T[E];for(const Z of t)for(let H=0,Y=Z.length,ie=Y-1;H<Y;ie=H++){const ce=Z[ie],Re=Z[H];if(xu(F,U,ce,Re))return 0;v=Math.min(v,Lh(F,U,ce,Re,r))}}return v}function Oh(i,t,r,c,f,_){if(!_)return;const v=Dh(bu(c,_),f,r);v<t&&i.push([v,_,[0,0]])}function Ll(i,t,r,c,f,_,v){if(!_||!v)return;const T=Dh(bu(c,_),bu(f,v),r);T<t&&i.push([T,_,v])}function Su(i,t,r,c,f=1/0){let _=Math.min(c.distance(i[0],r[0][0]),f);if(_===0)return _;const v=new ga([[0,[0,i.length-1],[0,0]]],Rh),T=wu(r);for(;v.length>0;){const E=v.pop();if(E[0]>=_)continue;const I=E[1],A=t?50:100;if(Dl(I)<=A){if(!Gs(I,i.length))return NaN;if(t){const F=Kd(i,I,r,c);if(isNaN(F)||F===0)return F;_=Math.min(_,F)}else for(let F=I[0];F<=I[1];++F){const U=Tc(i[F],r,c);if(_=Math.min(_,U),_===0)return 0}}else{const F=Ur(I,t);Oh(v,_,c,i,T,F[0]),Oh(v,_,c,i,T,F[1])}}return _}function Tu(i,t,r,c,f,_=1/0){let v=Math.min(_,f.distance(i[0],r[0]));if(v===0)return v;const T=new ga([[0,[0,i.length-1],[0,r.length-1]]],Rh);for(;T.length>0;){const E=T.pop();if(E[0]>=v)continue;const I=E[1],A=E[2],F=t?50:100,U=c?50:100;if(Dl(I)<=F&&Dl(A)<=U){if(!Gs(I,i.length)&&Gs(A,r.length))return NaN;let Z;if(t&&c)Z=ip(i,I,r,A,f),v=Math.min(v,Z);else if(t&&!c){const H=i.slice(I[0],I[1]+1);for(let Y=A[0];Y<=A[1];++Y)if(Z=Ua(r[Y],H,f),v=Math.min(v,Z),v===0)return v}else if(!t&&c){const H=r.slice(A[0],A[1]+1);for(let Y=I[0];Y<=I[1];++Y)if(Z=Ua(i[Y],H,f),v=Math.min(v,Z),v===0)return v}else Z=qs(i,I,r,A,f),v=Math.min(v,Z)}else{const Z=Ur(I,t),H=Ur(A,c);Ll(T,v,f,i,r,Z[0],H[0]),Ll(T,v,f,i,r,Z[0],H[1]),Ll(T,v,f,i,r,Z[1],H[0]),Ll(T,v,f,i,r,Z[1],H[1])}}return v}function ya(i){return i.type==="MultiPolygon"?i.coordinates.map((t=>({type:"Polygon",coordinates:t}))):i.type==="MultiLineString"?i.coordinates.map((t=>({type:"LineString",coordinates:t}))):i.type==="MultiPoint"?i.coordinates.map((t=>({type:"Point",coordinates:t}))):[i]}class Lo{constructor(t,r){this.type=Pt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ha(t[1])){const c=t[1];if(c.type==="FeatureCollection")return new Lo(c,c.features.map((f=>ya(f.geometry))).flat());if(c.type==="Feature")return new Lo(c,ya(c.geometry));if("type"in c&&"coordinates"in c)return new Lo(c,ya(c))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,c){const f=r.geometry(),_=f.flat().map((E=>vu([E.x,E.y],r.canonical)));if(f.length===0)return NaN;const v=new zh(_[0][1]);let T=1/0;for(const E of c){switch(E.type){case"Point":T=Math.min(T,Tu(_,!1,[E.coordinates],!1,v,T));break;case"LineString":T=Math.min(T,Tu(_,!1,E.coordinates,!0,v,T));break;case"Polygon":T=Math.min(T,Su(_,!1,E.coordinates,v,T))}if(T===0)return T}return T})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,c){const f=r.geometry(),_=f.flat().map((E=>vu([E.x,E.y],r.canonical)));if(f.length===0)return NaN;const v=new zh(_[0][1]);let T=1/0;for(const E of c){switch(E.type){case"Point":T=Math.min(T,Tu(_,!0,[E.coordinates],!1,v,T));break;case"LineString":T=Math.min(T,Tu(_,!0,E.coordinates,!0,v,T));break;case"Polygon":T=Math.min(T,Su(_,!0,E.coordinates,v,T))}if(T===0)return T}return T})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,c){const f=r.geometry();if(f.length===0||f[0].length===0)return NaN;const _=Al(f,0).map((E=>E.map((I=>I.map((A=>vu([A.x,A.y],r.canonical))))))),v=new zh(_[0][0][0][1]);let T=1/0;for(const E of c)for(const I of _){switch(E.type){case"Point":T=Math.min(T,Su([E.coordinates],!1,I,v,T));break;case"LineString":T=Math.min(T,Su(E.coordinates,!0,I,v,T));break;case"Polygon":T=Math.min(T,Xd(I,E.coordinates,v,T))}if(T===0)return T}return T})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Fo{constructor(t){this.type=xr,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=t[1];return c==null?r.error("Global state property must be defined."):typeof c!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Fo(c)}evaluate(t){var r;const c=(r=t.globals)===null||r===void 0?void 0:r.globalState;return c&&Object.keys(c).length!==0?ca(c,this.key):null}eachChild(){}outputDefined(){return!1}}const _a={"==":Zd,"!=":yu,">":bh,"<":Qf,">=":Gd,"<=":Jf,array:bi,at:Cl,boolean:bi,case:Ro,coalesce:yc,collator:_u,format:Ba,image:Sh,in:Na,"index-of":Ms,interpolate:Rn,"interpolate-hcl":Rn,"interpolate-lab":Rn,length:kl,let:Pl,literal:fs,match:zn,number:bi,"number-format":wh,object:bi,slice:El,step:pn,string:bi,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:Us,within:ma,distance:Lo,"global-state":Fo};class ps{constructor(t,r,c,f){this.name=t,this.type=r,this._evaluate=c,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const c=t[0],f=ps.definitions[c];if(!f)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,T=v.filter((([I])=>!Array.isArray(I)||I.length===t.length-1));let E=null;for(const[I,A]of T){E=new da(r.registry,Za,r.path,null,r.scope);const F=[];let U=!1;for(let Z=1;Z<t.length;Z++){const H=t[Z],Y=Array.isArray(I)?I[Z-1]:I.type,ie=E.parse(H,1+F.length,Y);if(!ie){U=!0;break}F.push(ie)}if(!U)if(Array.isArray(I)&&I.length!==F.length)E.error(`Expected ${I.length} arguments, but found ${F.length} instead.`);else{for(let Z=0;Z<F.length;Z++){const H=Array.isArray(I)?I[Z]:I.type,Y=F[Z];E.concat(Z+1).checkSubtype(H,Y.type)}if(E.errors.length===0)return new ps(c,_,A,F)}}if(T.length===1)r.errors.push(...E.errors);else{const I=(T.length?T:v).map((([F])=>{return U=F,Array.isArray(U)?`(${U.map(on).join(", ")})`:`(${on(U.type)}...)`;var U})).join(" | "),A=[];for(let F=1;F<t.length;F++){const U=r.parse(t[F],1+A.length);if(!U)return null;A.push(on(U.type))}r.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){ps.definitions=r;for(const c in r)t[c]=ps}}function Pc(i,[t,r,c,f]){t=t.evaluate(i),r=r.evaluate(i),c=c.evaluate(i);const _=f?f.evaluate(i):1,v=an(t,r,c,_);if(v)throw new cn(v);return new Pr(t/255,r/255,c/255,_,!1)}function Va(i,t){return i in t}function Cc(i,t){const r=t[i];return r===void 0?null:r}function va(i){return{type:i}}function Za(i){if(i instanceof Us)return Za(i.boundExpression);if(i instanceof ps&&i.name==="error"||i instanceof _u||i instanceof ma||i instanceof Lo||i instanceof Fo)return!1;const t=i instanceof fo||i instanceof bi;let r=!0;return i.eachChild((c=>{r=t?r&&Za(c):r&&c instanceof fs})),!!r&&Ec(i)&&kc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ec(i){if(i instanceof ps&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ma||i instanceof Lo)return!1;let t=!0;return i.eachChild((r=>{t&&!Ec(r)&&(t=!1)})),t}function Fl(i){if(i instanceof ps&&i.name==="feature-state")return!1;let t=!0;return i.eachChild((r=>{t&&!Fl(r)&&(t=!1)})),t}function kc(i,t){if(i instanceof ps&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild((c=>{r&&!kc(c,t)&&(r=!1)})),r}function jh(i){return{result:"success",value:i}}function Ga(i){return{result:"error",value:i}}function Oo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function jo(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Mc(i){return!!i.expression&&i.expression.interpolated}function Ir(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ic(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&nr(i)===la}function sp(i){return i}function Ol(i,t){const r=i.stops&&typeof i.stops[0][0]=="object",c=r||!(r||i.property!==void 0),f=i.type||(Mc(t)?"exponential":"interval"),_=(function(A){switch(A.type){case"color":return Pr.parse;case"padding":return kn.parse;case"numberArray":return Gn.parse;case"colorArray":return fn.parse;default:return null}})(t);if(_&&((i=_n({},i)).stops&&(i.stops=i.stops.map((A=>[A[0],_(A[1])]))),i.default=_(i.default?i.default:t.default)),i.colorSpace&&(v=i.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var v;const T=(function(A){switch(A){case"exponential":return gn;case"interval":return Yd;case"categorical":return Nh;case"identity":return Bh;default:throw new Error(`Unknown function type "${A}"`)}})(f);let E,I;if(f==="categorical"){E=Object.create(null);for(const A of i.stops)E[A[0]]=A[1];I=typeof i.stops[0][0]}if(r){const A={},F=[];for(let H=0;H<i.stops.length;H++){const Y=i.stops[H],ie=Y[0].zoom;A[ie]===void 0&&(A[ie]={zoom:ie,type:i.type,property:i.property,default:i.default,stops:[]},F.push(ie)),A[ie].stops.push([Y[0].value,Y[1]])}const U=[];for(const H of F)U.push([A[H].zoom,Ol(A[H],t)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:Rn.interpolationFactor.bind(void 0,Z),zoomStops:U.map((H=>H[0])),evaluate:({zoom:H},Y)=>gn({stops:U,base:i.base},t,H).evaluate(H,Y)}}if(c){const A=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Rn.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map((F=>F[0])),evaluate:({zoom:F})=>T(i,t,F,E,I)}}return{kind:"source",evaluate(A,F){const U=F&&F.properties?F.properties[i.property]:void 0;return U===void 0?xa(i.default,t.default):T(i,t,U,E,I)}}}function xa(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Nh(i,t,r,c,f){return xa(typeof r===f?c[r]:void 0,i.default,t.default)}function Yd(i,t,r){if(Ir(r)!=="number")return xa(i.default,t.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const f=Wn(i.stops.map((_=>_[0])),r);return i.stops[f][1]}function gn(i,t,r){const c=i.base!==void 0?i.base:1;if(Ir(r)!=="number")return xa(i.default,t.default);const f=i.stops.length;if(f===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[f-1][0])return i.stops[f-1][1];const _=Wn(i.stops.map((A=>A[0])),r),v=(function(A,F,U,Z){const H=Z-U,Y=A-U;return H===0?0:F===1?Y/H:(Math.pow(F,Y)-1)/(Math.pow(F,H)-1)})(r,c,i.stops[_][0],i.stops[_+1][0]),T=i.stops[_][1],E=i.stops[_+1][1],I=Vs[t.type]||sp;return typeof T.evaluate=="function"?{evaluate(...A){const F=T.evaluate.apply(void 0,A),U=E.evaluate.apply(void 0,A);if(F!==void 0&&U!==void 0)return I(F,U,v,i.colorSpace)}}:I(T,E,v,i.colorSpace)}function Bh(i,t,r){switch(t.type){case"color":r=Pr.parse(r);break;case"formatted":r=En.fromString(r.toString());break;case"resolvedImage":r=ds.fromString(r.toString());break;case"padding":r=kn.parse(r);break;case"colorArray":r=fn.parse(r);break;case"numberArray":r=Gn.parse(r);break;default:Ir(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return xa(r,i.default,t.default)}ps.register(_a,{error:[{kind:"error"},[Dr],(i,[t])=>{throw new cn(t.evaluate(i))}],typeof:[Dr,[xr],(i,[t])=>on(nr(t.evaluate(i)))],"to-rgba":[xi(Pt,4),[ti],(i,[t])=>{const[r,c,f,_]=t.evaluate(i).rgb;return[255*r,255*c,255*f,_]}],rgb:[ti,[Pt,Pt,Pt],Pc],rgba:[ti,[Pt,Pt,Pt,Pt],Pc],has:{type:pr,overloads:[[[Dr],(i,[t])=>Va(t.evaluate(i),i.properties())],[[Dr,la],(i,[t,r])=>Va(t.evaluate(i),r.evaluate(i))]]},get:{type:xr,overloads:[[[Dr],(i,[t])=>Cc(t.evaluate(i),i.properties())],[[Dr,la],(i,[t,r])=>Cc(t.evaluate(i),r.evaluate(i))]]},"feature-state":[xr,[Dr],(i,[t])=>Cc(t.evaluate(i),i.featureState||{})],properties:[la,[],i=>i.properties()],"geometry-type":[Dr,[],i=>i.geometryType()],id:[xr,[],i=>i.id()],zoom:[Pt,[],i=>i.globals.zoom],"heatmap-density":[Pt,[],i=>i.globals.heatmapDensity||0],elevation:[Pt,[],i=>i.globals.elevation||0],"line-progress":[Pt,[],i=>i.globals.lineProgress||0],accumulated:[xr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Pt,va(Pt),(i,t)=>{let r=0;for(const c of t)r+=c.evaluate(i);return r}],"*":[Pt,va(Pt),(i,t)=>{let r=1;for(const c of t)r*=c.evaluate(i);return r}],"-":{type:Pt,overloads:[[[Pt,Pt],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[Pt],(i,[t])=>-t.evaluate(i)]]},"/":[Pt,[Pt,Pt],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[Pt,[Pt,Pt],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[Pt,[],()=>Math.LN2],pi:[Pt,[],()=>Math.PI],e:[Pt,[],()=>Math.E],"^":[Pt,[Pt,Pt],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[Pt,[Pt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Pt,[Pt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Pt,[Pt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Pt,[Pt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Pt,[Pt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Pt,[Pt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Pt,[Pt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Pt,[Pt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Pt,[Pt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Pt,[Pt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Pt,va(Pt),(i,t)=>Math.min(...t.map((r=>r.evaluate(i))))],max:[Pt,va(Pt),(i,t)=>Math.max(...t.map((r=>r.evaluate(i))))],abs:[Pt,[Pt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Pt,[Pt],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pt,[Pt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Pt,[Pt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[pr,[Dr,xr],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[pr,[xr],(i,[t])=>i.id()===t.value],"filter-type-==":[pr,[Dr],(i,[t])=>i.geometryType()===t.value],"filter-<":[pr,[Dr,xr],(i,[t,r])=>{const c=i.properties()[t.value],f=r.value;return typeof c==typeof f&&c<f}],"filter-id-<":[pr,[xr],(i,[t])=>{const r=i.id(),c=t.value;return typeof r==typeof c&&r<c}],"filter->":[pr,[Dr,xr],(i,[t,r])=>{const c=i.properties()[t.value],f=r.value;return typeof c==typeof f&&c>f}],"filter-id->":[pr,[xr],(i,[t])=>{const r=i.id(),c=t.value;return typeof r==typeof c&&r>c}],"filter-<=":[pr,[Dr,xr],(i,[t,r])=>{const c=i.properties()[t.value],f=r.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[pr,[xr],(i,[t])=>{const r=i.id(),c=t.value;return typeof r==typeof c&&r<=c}],"filter->=":[pr,[Dr,xr],(i,[t,r])=>{const c=i.properties()[t.value],f=r.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[pr,[xr],(i,[t])=>{const r=i.id(),c=t.value;return typeof r==typeof c&&r>=c}],"filter-has":[pr,[xr],(i,[t])=>t.value in i.properties()],"filter-has-id":[pr,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[pr,[xi(Dr)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[pr,[xi(xr)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[pr,[Dr,xi(xr)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[pr,[Dr,xi(xr)],(i,[t,r])=>(function(c,f,_,v){for(;_<=v;){const T=_+v>>1;if(f[T]===c)return!0;f[T]>c?v=T-1:_=T+1}return!1})(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:pr,overloads:[[[pr,pr],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[va(pr),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:pr,overloads:[[[pr,pr],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[va(pr),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[pr,[pr],(i,[t])=>!t.evaluate(i)],"is-supported-script":[pr,[Dr],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Dr,[Dr],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Dr,[Dr],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Dr,va(xr),(i,t)=>t.map((r=>ur(r.evaluate(i)))).join("")],"resolved-locale":[Dr,[uc],(i,[t])=>t.evaluate(i).resolvedLocale()]});class jl{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new Tl,this._defaultValue=r?(function(c){if(c.type==="color"&&Ic(c.default))return new Pr(0,0,0,0);switch(c.type){case"color":return Pr.parse(c.default)||null;case"padding":return kn.parse(c.default)||null;case"numberArray":return Gn.parse(c.default)||null;case"colorArray":return fn.parse(c.default)||null;case"variableAnchorOffsetCollection":return qn.parse(c.default)||null;case"projectionDefinition":return hi.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,c,f,_,v){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,r,c,f,_,v){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new cn(`Expected value to be one of ${Object.keys(this._enumValues).map((E=>JSON.stringify(E))).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function ba(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in _a}function Nl(i,t){const r=new da(_a,Za,[],t?(function(f){const _={color:ti,string:Dr,number:Pt,enum:Dr,boolean:pr,formatted:Io,padding:hc,numberArray:vl,colorArray:lo,projectionDefinition:aa,resolvedImage:Er,variableAnchorOffsetCollection:du};return f.type==="array"?xi(_[f.value]||xr,f.length):_[f.type]})(t):void 0),c=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?jh(new jl(c,t)):Ga(r.errors)}class qa{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Fl(r.expression),this.globalStateRefs=zc(r.expression)}evaluateWithoutErrorHandling(t,r,c,f,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,f,_,v)}evaluate(t,r,c,f,_,v){return this._styleExpression.evaluate(t,r,c,f,_,v)}}class Wa{constructor(t,r,c,f){this.kind=t,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Fl(r.expression),this.globalStateRefs=zc(r.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,r,c,f,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,f,_,v)}evaluate(t,r,c,f,_,v){return this._styleExpression.evaluate(t,r,c,f,_,v)}interpolationFactor(t,r,c){return this.interpolationType?Rn.interpolationFactor(this.interpolationType,t,r,c):0}}function Ac(i,t){const r=Nl(i,t);if(r.result==="error")return r;const c=r.value.expression,f=Ec(c);if(!f&&!Oo(t))return Ga([new $r("","data expressions not supported")]);const _=kc(c,["zoom"]);if(!_&&!jo(t))return Ga([new $r("","zoom expressions not supported")]);const v=Bl(c);return v||_?v instanceof $r?Ga([v]):v instanceof Rn&&!Mc(t)?Ga([new $r("",'"interpolate" expressions cannot be used with this property')]):jh(v?new Wa(f?"camera":"composite",r.value,v.labels,v instanceof Rn?v.interpolation:void 0):new qa(f?"constant":"source",r.value)):Ga([new $r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class po{constructor(t,r){this._parameters=t,this._specification=r,_n(this,Ol(this._parameters,this._specification))}static deserialize(t){return new po(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Bl(i){let t=null;if(i instanceof Pl)t=Bl(i.result);else if(i instanceof yc){for(const r of i.args)if(t=Bl(r),t)break}else(i instanceof pn||i instanceof Rn)&&i.input instanceof ps&&i.input.name==="zoom"&&(t=i);return t instanceof $r||i.eachChild((r=>{const c=Bl(r);c instanceof $r?t=c:!t&&c?t=new $r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new $r("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function zc(i,t=new Set){return i instanceof Fo&&t.add(i.key),i.eachChild((r=>{zc(r,t)})),t}function Pu(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Pu(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Cu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mo(i){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Pu(i)||(i=No(i));const t=Nl(i,Cu);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,c,f)=>t.value.evaluate(r,c,{},f),needGeometry:Ul(i),getGlobalStateRefs:()=>zc(t.value.expression)}}function $l(i,t){return i<t?-1:i>t?1:0}function Ul(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Ul(i[t]))return!0;return!1}function No(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Rc(i[1],i[2],"=="):t==="!="?Dc(Rc(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Rc(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(No))):t==="all"?["all"].concat(i.slice(1).map(No)):t==="none"?["all"].concat(i.slice(1).map(No).map(Dc)):t==="in"?Eu(i[1],i.slice(2)):t==="!in"?Dc(Eu(i[1],i.slice(2))):t==="has"?Qd(i[1]):t!=="!has"||Dc(Qd(i[1]));var r}function Rc(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Eu(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",i,["literal",t.sort($l)]]:["filter-in-small",i,["literal",t]]}}function Qd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Dc(i){return["!",i]}function $h(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let f="[";for(const _ of i)f+=`${$h(_)},`;return`${f}]`}const r=Object.keys(i).sort();let c="{";for(let f=0;f<r.length;f++)c+=`${JSON.stringify(r[f])}:${$h(i[r[f]])},`;return`${c}}`}function op(i){let t="";for(const r of $t)t+=`/${$h(i[r])}`;return t}function Lc(i){const t=i.value;return t?[new st(i.key,t,"constants have been deprecated as of v8")]:[]}function tn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ws(i){if(Array.isArray(i))return i.map(Ws);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=Ws(i[r]);return t}return tn(i)}function di(i){const t=i.key,r=i.value,c=i.valueSpec||{},f=i.objectElementValidators||{},_=i.style,v=i.styleSpec,T=i.validateSpec;let E=[];const I=Ir(r);if(I!=="object")return[new st(t,r,`object expected, ${I} found`)];for(const A in r){const F=A.split(".")[0],U=ca(c,F)||c["*"];let Z;if(ca(f,F))Z=f[F];else if(ca(c,F))Z=T;else if(f["*"])Z=f["*"];else{if(!c["*"]){E.push(new st(t,r[A],`unknown property "${A}"`));continue}Z=T}E=E.concat(Z({key:(t&&`${t}.`)+A,value:r[A],valueSpec:U,style:_,styleSpec:v,object:r,objectKey:A,validateSpec:T},r))}for(const A in c)f[A]||c[A].required&&c[A].default===void 0&&r[A]===void 0&&E.push(new st(t,r,`missing required property "${A}"`));return E}function ms(i){const t=i.value,r=i.valueSpec,c=i.style,f=i.styleSpec,_=i.key,v=i.arrayElementValidator||i.validateSpec;if(Ir(t)!=="array")return[new st(_,t,`array expected, ${Ir(t)} found`)];if(r.length&&t.length!==r.length)return[new st(_,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new st(_,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let T={type:r.value,values:r.values};f.$version<7&&(T.function=r.function),Ir(r.value)==="object"&&(T=r.value);let E=[];for(let I=0;I<t.length;I++)E=E.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:T,validateSpec:i.validateSpec,style:c,styleSpec:f,key:`${_}[${I}]`}));return E}function Bo(i){const t=i.key,r=i.value,c=i.valueSpec;let f=Ir(r);return f==="number"&&r!=r&&(f="NaN"),f!=="number"?[new st(t,r,`number expected, ${f} found`)]:"minimum"in c&&r<c.minimum?[new st(t,r,`${r} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&r>c.maximum?[new st(t,r,`${r} is greater than the maximum value ${c.maximum}`)]:[]}function go(i){const t=i.valueSpec,r=tn(i.value.type);let c,f,_,v={};const T=r!=="categorical"&&i.value.property===void 0,E=!T,I=Ir(i.value.stops)==="array"&&Ir(i.value.stops[0])==="array"&&Ir(i.value.stops[0][0])==="object",A=di({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new st(Z.key,Z.value,'identity function may not have a "stops" property')];let H=[];const Y=Z.value;return H=H.concat(ms({key:Z.key,value:Y,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:F})),Ir(Y)==="array"&&Y.length===0&&H.push(new st(Z.key,Y,"array must have at least one stop")),H},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:t,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&T&&A.push(new st(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||A.push(new st(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Mc(i.valueSpec)&&A.push(new st(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!Oo(i.valueSpec)?A.push(new st(i.key,i.value,"property functions not supported")):T&&!jo(i.valueSpec)&&A.push(new st(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||A.push(new st(i.key,i.value,'"property" property is required')),A;function F(Z){let H=[];const Y=Z.value,ie=Z.key;if(Ir(Y)!=="array")return[new st(ie,Y,`array expected, ${Ir(Y)} found`)];if(Y.length!==2)return[new st(ie,Y,`array length 2 expected, length ${Y.length} found`)];if(I){if(Ir(Y[0])!=="object")return[new st(ie,Y,`object expected, ${Ir(Y[0])} found`)];if(Y[0].zoom===void 0)return[new st(ie,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new st(ie,Y,"object stop key must have value")];if(_&&_>tn(Y[0].zoom))return[new st(ie,Y[0].zoom,"stop zoom values must appear in ascending order")];tn(Y[0].zoom)!==_&&(_=tn(Y[0].zoom),f=void 0,v={}),H=H.concat(di({key:`${ie}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Bo,value:U}}))}else H=H.concat(U({key:`${ie}[0]`,value:Y[0],validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},Y));return ba(Ws(Y[1]))?H.concat([new st(`${ie}[1]`,Y[1],"expressions are not allowed in function stops.")]):H.concat(Z.validateSpec({key:`${ie}[1]`,value:Y[1],valueSpec:t,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function U(Z,H){const Y=Ir(Z.value),ie=tn(Z.value),ce=Z.value!==null?Z.value:H;if(c){if(Y!==c)return[new st(Z.key,ce,`${Y} stop domain type must match previous stop domain type ${c}`)]}else c=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new st(Z.key,ce,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&r!=="categorical"){let Re=`number expected, ${Y} found`;return Oo(t)&&r===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(Z.key,ce,Re)]}return r!=="categorical"||Y!=="number"||isFinite(ie)&&Math.floor(ie)===ie?r!=="categorical"&&Y==="number"&&f!==void 0&&ie<f?[new st(Z.key,ce,"stop domain values must appear in ascending order")]:(f=ie,r==="categorical"&&ie in v?[new st(Z.key,ce,"stop domain values must be unique")]:(v[ie]=!0,[])):[new st(Z.key,ce,`integer expected, found ${ie}`)]}}function $o(i){const t=(i.expressionContext==="property"?Ac:Nl)(Ws(i.value),i.valueSpec);if(t.result==="error")return t.value.map((c=>new st(`${i.key}${c.key}`,i.value,c.message)));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new st(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Fl(r))return[new st(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Fl(r))return[new st(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!kc(r,["zoom","feature-state"]))return[new st(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ec(r))return[new st(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ku(i){const t=i.key,r=i.value,c=Ir(r);return c!=="string"?[new st(t,r,`color expected, ${c} found`)]:Pr.parse(String(r))?[]:[new st(t,r,`color expected, "${r}" found`)]}function Uo(i){const t=i.key,r=i.value,c=i.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(tn(r))===-1&&f.push(new st(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(tn(r))===-1&&f.push(new st(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),f}function Vo(i){return Pu(Ws(i.value))?$o(_n({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Vl(i)}function Vl(i){const t=i.value,r=i.key;if(Ir(t)!=="array")return[new st(r,t,`array expected, ${Ir(t)} found`)];const c=i.styleSpec;let f,_=[];if(t.length<1)return[new st(r,t,"filter array must have at least 1 element")];switch(_=_.concat(Uo({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator,style:i.style,styleSpec:i.styleSpec})),tn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&tn(t[1])==="$type"&&_.push(new st(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new st(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=Ir(t[1]),f!=="string"&&_.push(new st(`${r}[1]`,t[1],`string expected, ${f} found`)));for(let v=2;v<t.length;v++)f=Ir(t[v]),tn(t[1])==="$type"?_=_.concat(Uo({key:`${r}[${v}]`,value:t[v],valueSpec:c.geometry_type,style:i.style,styleSpec:i.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&_.push(new st(`${r}[${v}]`,t[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Vl({key:`${r}[${v}]`,value:t[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":f=Ir(t[1]),t.length!==2?_.push(new st(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&_.push(new st(`${r}[1]`,t[1],`string expected, ${f} found`))}return _}function Ha(i,t){const r=i.key,c=i.validateSpec,f=i.style,_=i.styleSpec,v=i.value,T=i.objectKey,E=_[`${t}_${i.layerType}`];if(!E)return[];const I=T.match(/^(.*)-transition$/);if(t==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return c({key:r,value:v,valueSpec:_.transition,style:f,styleSpec:_});const A=i.valueSpec||E[T];if(!A)return[new st(r,v,`unknown property "${T}"`)];let F;if(Ir(v)==="string"&&Oo(A)&&!A.tokens&&(F=/^{([^}]+)}$/.exec(v)))return[new st(r,v,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const U=[];return i.layerType==="symbol"&&(T==="text-field"&&f&&!f.glyphs&&U.push(new st(r,v,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Ic(Ws(v))&&tn(v.type)==="identity"&&U.push(new st(r,v,'"text-font" does not support identity functions'))),U.concat(c({key:i.key,value:v,valueSpec:A,style:f,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:T}))}function Fc(i){return Ha(i,"paint")}function Mu(i){return Ha(i,"layout")}function Ka(i){let t=[];const r=i.value,c=i.key,f=i.style,_=i.styleSpec;if(Ir(r)!=="object")return[new st(c,r,`object expected, ${Ir(r)} found`)];r.type||r.ref||t.push(new st(c,r,'either "type" or "ref" is required'));let v=tn(r.type);const T=tn(r.ref);if(r.id){const E=tn(r.id);for(let I=0;I<i.arrayIndex;I++){const A=f.layers[I];tn(A.id)===E&&t.push(new st(c,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let E;["type","source","source-layer","filter","layout"].forEach((I=>{I in r&&t.push(new st(c,r[I],`"${I}" is prohibited for ref layers`))})),f.layers.forEach((I=>{tn(I.id)===T&&(E=I)})),E?E.ref?t.push(new st(c,r.ref,"ref cannot reference another ref layer")):v=tn(E.type):t.push(new st(c,r.ref,`ref layer "${T}" not found`))}else if(v!=="background")if(r.source){const E=f.sources&&f.sources[r.source],I=E&&tn(E.type);E?I==="vector"&&v==="raster"?t.push(new st(c,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"||I!=="raster-dem"&&v==="color-relief"?t.push(new st(c,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?t.push(new st(c,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?t.push(new st(c,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&E.lineMetrics||t.push(new st(c,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new st(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new st(c,r.source,`source "${r.source}" not found`))}else t.push(new st(c,r,'missing required property "source"'));return t=t.concat(di({key:c,value:r,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${c}.type`,value:r.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Vo,layout:E=>di({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>Mu(_n({layerType:v},I))}}),paint:E=>di({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>Fc(_n({layerType:v},I))}})}})),t}function ni(i){const t=i.value,r=i.key,c=Ir(t);return c!=="string"?[new st(r,t,`string expected, ${c} found`)]:[]}const rn={promoteId:function({key:i,value:t}){if(Ir(t)==="string")return ni({key:i,value:t});{const r=[];for(const c in t)r.push(...ni({key:`${i}.${c}`,value:t[c]}));return r}}};function Or(i){const t=i.value,r=i.key,c=i.styleSpec,f=i.style,_=i.validateSpec;if(!t.type)return[new st(r,t,'"type" is required')];const v=tn(t.type);let T;switch(v){case"vector":case"raster":return T=di({key:r,value:t,valueSpec:c[`source_${v.replace("-","_")}`],style:i.style,styleSpec:c,objectElementValidators:rn,validateSpec:_}),T;case"raster-dem":return T=(function(E){var I;const A=(I=E.sourceName)!==null&&I!==void 0?I:"",F=E.value,U=E.styleSpec,Z=U.source_raster_dem,H=E.style;let Y=[];const ie=Ir(F);if(F===void 0)return Y;if(ie!=="object")return Y.push(new st("source_raster_dem",F,`object expected, ${ie} found`)),Y;const ce=tn(F.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],pe=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const be in F)!ce&&Re.includes(be)?Y.push(new st(be,F[be],`In "${A}": "${be}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):Z[be]?Y=Y.concat(E.validateSpec({key:be,value:F[be],valueSpec:Z[be],validateSpec:E.validateSpec,style:H,styleSpec:U})):Y.push(new st(be,F[be],`unknown property "${be}"`));return Y})({sourceName:r,value:t,style:i.style,styleSpec:c,validateSpec:_}),T;case"geojson":if(T=di({key:r,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,validateSpec:_,objectElementValidators:rn}),t.cluster)for(const E in t.clusterProperties){const[I,A]=t.clusterProperties[E],F=typeof I=="string"?[I,["accumulated"],["get",E]]:I;T.push(...$o({key:`${r}.${E}.map`,value:A,expressionContext:"cluster-map"})),T.push(...$o({key:`${r}.${E}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return T;case"video":return di({key:r,value:t,valueSpec:c.source_video,style:f,validateSpec:_,styleSpec:c});case"image":return di({key:r,value:t,valueSpec:c.source_image,style:f,validateSpec:_,styleSpec:c});case"canvas":return[new st(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function gs(i){const t=i.value,r=i.styleSpec,c=r.light,f=i.style;let _=[];const v=Ir(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new st("light",t,`object expected, ${v} found`)]),_;for(const T in t){const E=T.match(/^(.*)-transition$/);_=_.concat(E&&c[E[1]]&&c[E[1]].transition?i.validateSpec({key:T,value:t[T],valueSpec:r.transition,validateSpec:i.validateSpec,style:f,styleSpec:r}):c[T]?i.validateSpec({key:T,value:t[T],valueSpec:c[T],validateSpec:i.validateSpec,style:f,styleSpec:r}):[new st(T,t[T],`unknown property "${T}"`)])}return _}function ii(i){const t=i.value,r=i.styleSpec,c=r.sky,f=i.style,_=Ir(t);if(t===void 0)return[];if(_!=="object")return[new st("sky",t,`object expected, ${_} found`)];let v=[];for(const T in t)v=v.concat(c[T]?i.validateSpec({key:T,value:t[T],valueSpec:c[T],style:f,styleSpec:r}):[new st(T,t[T],`unknown property "${T}"`)]);return v}function Ri(i){const t=i.value,r=i.styleSpec,c=r.terrain,f=i.style;let _=[];const v=Ir(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new st("terrain",t,`object expected, ${v} found`)]),_;for(const T in t)_=_.concat(c[T]?i.validateSpec({key:T,value:t[T],valueSpec:c[T],validateSpec:i.validateSpec,style:f,styleSpec:r}):[new st(T,t[T],`unknown property "${T}"`)]);return _}function wa(i){let t=[];const r=i.value,c=i.key;if(Array.isArray(r)){const f=[],_=[];for(const v in r)r[v].id&&f.includes(r[v].id)&&t.push(new st(c,r,`all the sprites' ids must be unique, but ${r[v].id} is duplicated`)),f.push(r[v].id),r[v].url&&_.includes(r[v].url)&&t.push(new st(c,r,`all the sprites' URLs must be unique, but ${r[v].url} is duplicated`)),_.push(r[v].url),t=t.concat(di({key:`${c}[${v}]`,value:r[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return ni({key:c,value:r})}function Hs(i){return t=i.value,t&&t.constructor===Object?[]:[new st(i.key,i.value,`object expected, ${Ir(i.value)} found`)];var t}const wi={"*":()=>[],array:ms,boolean:function(i){const t=i.value,r=i.key,c=Ir(t);return c!=="boolean"?[new st(r,t,`boolean expected, ${c} found`)]:[]},number:Bo,color:ku,constants:Lc,enum:Uo,filter:Vo,function:go,layer:Ka,object:di,source:Or,light:gs,sky:ii,terrain:Ri,projection:function(i){const t=i.value,r=i.styleSpec,c=r.projection,f=i.style,_=Ir(t);if(t===void 0)return[];if(_!=="object")return[new st("projection",t,`object expected, ${_} found`)];let v=[];for(const T in t)v=v.concat(c[T]?i.validateSpec({key:T,value:t[T],valueSpec:c[T],style:f,styleSpec:r}):[new st(T,t[T],`unknown property "${T}"`)]);return v},projectionDefinition:function(i){const t=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const c=Ir(r);return c!=="array"||(function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"})(r)||(function(f){return!!["interpolate","step","literal"].includes(f[0])})(r)?["array","string"].includes(c)?[]:[new st(t,r,`projection expected, invalid type "${c}" found`)]:[new st(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:ni,formatted:function(i){return ni(i).length===0?[]:$o(i)},resolvedImage:function(i){return ni(i).length===0?[]:$o(i)},padding:function(i){const t=i.key,r=i.value;if(Ir(r)==="array"){if(r.length<1||r.length>4)return[new st(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const c={type:"number"};let f=[];for(let _=0;_<r.length;_++)f=f.concat(i.validateSpec({key:`${t}[${_}]`,value:r[_],validateSpec:i.validateSpec,valueSpec:c}));return f}return Bo({key:t,value:r,valueSpec:{}})},numberArray:function(i){const t=i.key,r=i.value;if(Ir(r)==="array"){const c={type:"number"};if(r.length<1)return[new st(t,r,"array length at least 1 expected, length 0 found")];let f=[];for(let _=0;_<r.length;_++)f=f.concat(i.validateSpec({key:`${t}[${_}]`,value:r[_],validateSpec:i.validateSpec,valueSpec:c}));return f}return Bo({key:t,value:r,valueSpec:{}})},colorArray:function(i){const t=i.key,r=i.value;if(Ir(r)==="array"){if(r.length<1)return[new st(t,r,"array length at least 1 expected, length 0 found")];let c=[];for(let f=0;f<r.length;f++)c=c.concat(ku({key:`${t}[${f}]`,value:r[f]}));return c}return ku({key:t,value:r})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,c=Ir(r),f=i.styleSpec;if(c!=="array"||r.length<1||r.length%2!=0)return[new st(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<r.length;v+=2)_=_.concat(Uo({key:`${t}[${v}]`,value:r[v],valueSpec:f.layout_symbol["text-anchor"]})),_=_.concat(ms({key:`${t}[${v+1}]`,value:r[v+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:f}));return _},sprite:wa,state:Hs};function Zo(i){const t=i.value,r=i.valueSpec,c=i.styleSpec;return i.validateSpec=Zo,r.expression&&Ic(tn(t))?go(i):r.expression&&ba(Ws(t))?$o(i):r.type&&wi[r.type]?wi[r.type](i):di(_n({},i,{valueSpec:r.type?c[r.type]:r}))}function Uh(i){const t=i.value,r=i.key,c=ni(i);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new st(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new st(r,t,'"glyphs" url must include a "{range}" token'))),c}function Di(i,t=Pe){let r=[];return r=r.concat(Zo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Zo,objectElementValidators:{glyphs:Uh,"*":()=>[]}})),i.constants&&(r=r.concat(Lc({key:"constants",value:i.constants}))),Xa(r)}function Yi(i){return function(t){return i({...t,validateSpec:Zo})}}function Xa(i){return[].concat(i).sort(((t,r)=>t.line-r.line))}function Hn(i){return function(...t){return Xa(i.apply(this,t))}}Di.source=Hn(Yi(Or)),Di.sprite=Hn(Yi(wa)),Di.glyphs=Hn(Yi(Uh)),Di.light=Hn(Yi(gs)),Di.sky=Hn(Yi(ii)),Di.terrain=Hn(Yi(Ri)),Di.state=Hn(Yi(Hs)),Di.layer=Hn(Yi(Ka)),Di.filter=Hn(Yi(Vo)),Di.paintProperty=Hn(Yi(Fc)),Di.layoutProperty=Hn(Yi(Mu));const Go=Di,Vh=Go.light,Zl=Go.sky,ap=Go.paintProperty,Sa=Go.layoutProperty;function yo(i,t){let r=!1;if(t&&t.length)for(const c of t)i.fire(new Je(new Error(c.message))),r=!0;return r}class _o{constructor(t,r,c){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(r=v[1])+2*(c=v[2]);for(let E=0;E<this.d*this.d;E++){const I=v[3+E],A=v[3+E+1];f.push(I===A?null:v.subarray(I,A))}const T=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],T),this.bboxes=v.subarray(T),this.insert=this._insertReadonly}else{this.d=r+2*c;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=c,this.scale=r/t,this.uid=0;const _=c/r*t;this.min=-_,this.max=t+_}insert(t,r,c,f,_){this._forEachCell(r,c,f,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,c,f,_,v){this.cells[_].push(v)}query(t,r,c,f,_){const v=this.min,T=this.max;if(t<=v&&r<=v&&T<=c&&T<=f&&!_)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(t,r,c,f,this._queryCell,E,{},_),E}}_queryCell(t,r,c,f,_,v,T,E){const I=this.cells[_];if(I!==null){const A=this.keys,F=this.bboxes;for(let U=0;U<I.length;U++){const Z=I[U];if(T[Z]===void 0){const H=4*Z;(E?E(F[H+0],F[H+1],F[H+2],F[H+3]):t<=F[H+2]&&r<=F[H+3]&&c>=F[H+0]&&f>=F[H+1])?(T[Z]=!0,v.push(A[Z])):T[Z]=!1}}}}_forEachCell(t,r,c,f,_,v,T,E){const I=this._convertToCellCoord(t),A=this._convertToCellCoord(r),F=this._convertToCellCoord(c),U=this._convertToCellCoord(f);for(let Z=I;Z<=F;Z++)for(let H=A;H<=U;H++){const Y=this.d*H+Z;if((!E||E(this._convertFromCellCoord(Z),this._convertFromCellCoord(H),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(H+1)))&&_.call(this,t,r,c,f,Y,v,T,E))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let c=0;for(let v=0;v<this.cells.length;v++)c+=this.cells[v].length;const f=new Int32Array(r+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let _=r;for(let v=0;v<t.length;v++){const T=t[v];f[3+v]=_,f.set(T,_),_+=T.length}return f[3+t.length]=_,f.set(this.keys,_),_+=this.keys.length,f[3+t.length+1]=_,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer}static serialize(t,r){const c=t.toArrayBuffer();return r&&r.push(c),{buffer:c}}static deserialize(t){return new _o(t.buffer)}}const Qi={};function Et(i,t,r={}){if(Qi[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Qi[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Et("Object",Object),Et("Set",Set),Et("TransferableGridIndex",_o),Et("Color",Pr),Et("Error",Error),Et("AJAXError",ue),Et("ResolvedImage",ds),Et("StylePropertyFunction",po),Et("StyleExpression",jl,{omit:["_evaluator"]}),Et("ZoomDependentExpression",Wa),Et("ZoomConstantExpression",qa),Et("CompoundExpression",ps,{omit:["_evaluate"]});for(const i in _a)_a[i]._classRegistryKey||Et(`Expression_${i}`,_a[i]);function Ji(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Li(i){return i.$name||i.constructor._classRegistryKey}function qo(i){return!(function(t){if(t===null||typeof t!="object")return!1;const r=Li(t);return!(!r||r==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Ji(i)||zi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function es(i,t){if(qo(i))return(Ji(i)||zi(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const _=[];for(const v of i)_.push(es(v,t));return _}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Li(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Qi[r])throw new Error(`${r} is not registered.`);const{klass:c}=Qi[r],f=c.serialize?c.serialize(i,t):{};if(c.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||Qi[r].omit.indexOf(_)>=0)continue;const v=i[_];f[_]=Qi[r].shallow.indexOf(_)>=0?v:es(v,t)}i instanceof Error&&(f.message=i.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(f.$name=r),f}function Fi(i){if(qo(i))return i;if(Array.isArray(i))return i.map(Fi);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Li(i)||"Object";if(!Qi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Qi[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const c=Object.create(r.prototype);for(const f of Object.keys(i)){if(f==="$name")continue;const _=i[f];c[f]=Qi[t].shallow.indexOf(f)>=0?_:Fi(_)}return c}class vo{constructor(){this.first=!0}update(t,r){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const Fr={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Hangul Syllables":i=>i>=44032&&i<=55215,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Gl(i){for(const t of i)if(Iu(t.charCodeAt(0)))return!0;return!1}function Zh(i){for(const t of i)if(!vn(t.charCodeAt(0)))return!1;return!0}function Si(i){const t=i.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const ys=Si(["Arab","Dupl","Mong","Ougr","Syrc"]);function vn(i){return!ys.test(String.fromCodePoint(i))}const _s=Si(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Iu(i){return!(i!==746&&i!==747&&(i<4352||!(Fr["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Fr["CJK Compatibility"](i)||Fr["CJK Strokes"](i)||!(!Fr["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Fr["Enclosed CJK Letters and Months"](i)||Fr["Ideographic Description Characters"](i)||Fr.Kanbun(i)||Fr.Katakana(i)&&i!==12540||!(!Fr["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Fr["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Fr["Vertical Forms"](i)||Fr["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||_s.test(String.fromCodePoint(i)))))}function Gh(i){return!(Iu(i)||(function(t){return!!(Fr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Fr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Fr["Letterlike Symbols"](t)||Fr["Number Forms"](t)||Fr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Fr["Control Pictures"](t)&&t!==9251||Fr["Optical Character Recognition"](t)||Fr["Enclosed Alphanumerics"](t)||Fr["Geometric Shapes"](t)||Fr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Fr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Fr["CJK Symbols and Punctuation"](t)||Fr.Katakana(t)||Fr["Private Use Area"](t)||Fr["CJK Compatibility Forms"](t)||Fr["Small Form Variants"](t)||Fr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(i))}const Au=Si(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Oc(i){return Au.test(String.fromCodePoint(i))}function qh(i,t){return!(!t&&Oc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Fr.Khmer(i))}function jc(i){for(const t of i)if(Oc(t.charCodeAt(0)))return!0;return!1}const Is=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Is.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,t){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,c=new Promise((_=>{this.loadScriptResolve=_}));t(r);const f=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([c,f]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:r};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Wr{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new vo,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vo,this.transition={},this.globalState={})}isSupportedScript(t){return(function(r,c){for(const f of r)if(!qh(f.charCodeAt(0),c))return!1;return!0})(t,Is.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*r}}}class Ta{constructor(t,r){this.property=t,this.value=r,this.expression=(function(c,f){if(Ic(c))return new po(c,f);if(ba(c)){const _=Ac(c,f);if(_.result==="error")throw new Error(_.value.map((v=>`${v.key}: ${v.message}`)).join(", "));return _.value}{let _=c;return f.type==="color"&&typeof c=="string"?_=Pr.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?f.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?_=qn.parse(c):f.type==="projectionDefinition"&&typeof c=="string"&&(_=hi.parse(c)):_=fn.parse(c):_=Gn.parse(c):_=kn.parse(c),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}})(r===void 0?t.specification.default:r,t.specification),this._evaluate=this.expression.evaluate}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,c){return this.property.possiblyEvaluate(this,t,r,c)}setGlobalState(t){this.expression.evaluate=(r,c,f,_,v,T)=>(r.globalState=t,this._evaluate.call(this.expression,r,c,f,_,v,T))}}class Wh{constructor(t){this.property=t,this.value=new Ta(t,void 0)}transitioned(t,r){return new Wl(this.property,this.value,r,sr({},t.transition,this.transition),t.now)}untransitioned(){return new Wl(this.property,this.value,null,{},0)}}class ql{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ln(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Wh(this._values[t].property)),this._values[t].value=new Ta(this._values[t].property,r===null?void 0:ln(r))}getTransition(t){return ln(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Wh(this._values[t].property)),this._values[t].transition=ln(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c);const f=this.getTransition(r);f!==void 0&&(t[`${r}-transition`]=f)}return t}transitioned(t,r){const c=new zu(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(t,r._values[f]);return c}untransitioned(){const t=new zu(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Wl{constructor(t,r,c,f,_){this.property=t,this.value=r,this.begin=_+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(t,r,c){const f=t.now||0,_=this.value.possiblyEvaluate(t,r,c),v=this.prior;if(v){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return v.possiblyEvaluate(t,r,c);{const T=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,r,c),_,jt(T))}}return _}}class zu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,c){const f=new Nc(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(t,r,c);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Hh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState={}}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ln(this._values[t].value)}setValue(t,r){this._values[t]=new Ta(this._values[t].property,r===null?void 0:ln(r)),this._values[t].setGlobalState(this._globalState)}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c)}return t}possiblyEvaluate(t,r,c){const f=new Nc(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(t,r,c);return f}setGlobalState(t){this._globalState=t;for(const r of Object.values(this._values))r.setGlobalState(t)}}class Oi{constructor(t,r,c){this.property=t,this.value=r,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,c,f){return this.property.evaluate(this.value,this.parameters,t,r,c,f)}}class Nc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Lt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,c){const f=Vs[this.specification.type];return f?f(t,r,c):t}}class Yt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,c,f){return new Oi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},c,f)}:t.expression,r)}interpolate(t,r,c){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Oi(this,{kind:"constant",value:void 0},t.parameters);const f=Vs[this.specification.type];if(f){const _=f(t.value.value,r.value.value,c);return new Oi(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,r,c,f,_,v){return t.kind==="constant"?t.value:t.evaluate(r,c,f,_,v)}}class Wo extends Yt{possiblyEvaluate(t,r,c,f){if(t.value===void 0)return new Oi(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const _=t.expression.evaluate(r,null,{},c,f),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,T=this._calculate(v,v,v,r);return new Oi(this,{kind:"constant",value:T},r)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Oi(this,{kind:"constant",value:_},r)}return new Oi(this,t.expression,r)}evaluate(t,r,c,f,_,v){if(t.kind==="source"){const T=t.evaluate(r,c,f,_,v);return this._calculate(T,T,T,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},c,f),t.evaluate({zoom:Math.floor(r.zoom)},c,f),t.evaluate({zoom:Math.floor(r.zoom)+1},c,f),r):t.value}_calculate(t,r,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:c,to:r}}interpolate(t){return t}}class xo{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(r,null,{},c,f);return this._calculate(_,_,_,r)}return this._calculate(t.expression.evaluate(new Wr(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Wr(Math.floor(r.zoom),r)),t.expression.evaluate(new Wr(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:c,to:r}}interpolate(t){return t}}class Hl{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,f){return!!t.expression.evaluate(r,null,{},c,f)}interpolate(){return!1}}class fi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const c=t[r];c.specification.overridable&&this.overridableProperties.push(r);const f=this.defaultPropertyValues[r]=new Ta(c,void 0),_=this.defaultTransitionablePropertyValues[r]=new Wh(c);this.defaultTransitioningPropertyValues[r]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=f.possiblyEvaluate({})}}}Et("DataDrivenProperty",Yt),Et("DataConstantProperty",Lt),Et("CrossFadedDataDrivenProperty",Wo),Et("CrossFadedProperty",xo),Et("ColorRampProperty",Hl);const Ru="-transition";class pi extends zt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this._globalState={},t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=mo(t.filter)),r.layout&&(this._unevaluatedLayout=new Hh(r.layout)),r.paint)){this._transitionablePaint=new ql(r.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nc(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=mo(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const c=this._unevaluatedLayout._values[r];for(const f of c.getGlobalStateRefs())t.add(f)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}getPaintAffectingGlobalStateRefs(){var t;const r=new globalThis.Map;if(this._transitionablePaint)for(const c in this._transitionablePaint._values){const f=this._transitionablePaint._values[c].value;for(const _ of f.getGlobalStateRefs()){const v=(t=r.get(_))!==null&&t!==void 0?t:[];v.push({name:c,value:f.value}),r.set(_,v)}}return r}setLayoutProperty(t,r,c={}){r!=null&&this._validate(Sa,`layers.${this.id}.layout.${t}`,t,r,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(Ru)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,c={}){if(r!=null&&this._validate(ap,`layers.${this.id}.paint.${t}`,t,r,c))return!1;if(t.endsWith(Ru))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const f=this._transitionablePaint._values[t],_=f.property.specification["property-type"]==="cross-faded-data-driven",v=f.value.isDataDriven(),T=f.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const E=this._transitionablePaint._values[t].value;return E.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,T,E)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.globalState=this._globalState,t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}setGlobalState(t){this._globalState=t,this._unevaluatedLayout&&this._unevaluatedLayout.setGlobalState(t)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ci(t,((r,c)=>!(r===void 0||c==="layout"&&!Object.keys(r).length||c==="paint"&&!Object.keys(r).length)))}_validate(t,r,c,f,_={}){return(!_||_.validate!==!1)&&yo(this,t.call(Go,{key:r,layerType:this.type,objectKey:c,value:f,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Oi&&Oo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const As={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ks{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wn(i,t=1){let r=0,c=0;return{members:i.map((f=>{const _=As[f.type].BYTES_PER_ELEMENT,v=r=zs(r,Math.max(t,_)),T=f.components||1;return c=Math.max(c,_),r+=_*T,{name:f.name,type:f.type,components:T,offset:v}})),size:zs(r,Math.max(c,t)),alignment:t}}function zs(i,t){return Math.ceil(i/t)*t}class vs extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const f=2*t;return this.int16[f+0]=r,this.int16[f+1]=c,t}}vs.prototype.bytesPerElement=4,Et("StructArrayLayout2i4",vs);class Pa extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const _=3*t;return this.int16[_+0]=r,this.int16[_+1]=c,this.int16[_+2]=f,t}}Pa.prototype.bytesPerElement=6,Et("StructArrayLayout3i6",Pa);class Du extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,f)}emplace(t,r,c,f,_){const v=4*t;return this.int16[v+0]=r,this.int16[v+1]=c,this.int16[v+2]=f,this.int16[v+3]=_,t}}Du.prototype.bytesPerElement=8,Et("StructArrayLayout4i8",Du);class ts extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,_,v)}emplace(t,r,c,f,_,v,T){const E=6*t;return this.int16[E+0]=r,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+3]=_,this.int16[E+4]=v,this.int16[E+5]=T,t}}ts.prototype.bytesPerElement=12,Et("StructArrayLayout2i4i12",ts);class rs extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,_,v)}emplace(t,r,c,f,_,v,T){const E=4*t,I=8*t;return this.int16[E+0]=r,this.int16[E+1]=c,this.uint8[I+4]=f,this.uint8[I+5]=_,this.uint8[I+6]=v,this.uint8[I+7]=T,t}}rs.prototype.bytesPerElement=8,Et("StructArrayLayout2i4ub8",rs);class Ca extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const f=2*t;return this.float32[f+0]=r,this.float32[f+1]=c,t}}Ca.prototype.bytesPerElement=8,Et("StructArrayLayout2f8",Ca);class Bc extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v,T,E,I,A){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,c,f,_,v,T,E,I,A)}emplace(t,r,c,f,_,v,T,E,I,A,F){const U=10*t;return this.uint16[U+0]=r,this.uint16[U+1]=c,this.uint16[U+2]=f,this.uint16[U+3]=_,this.uint16[U+4]=v,this.uint16[U+5]=T,this.uint16[U+6]=E,this.uint16[U+7]=I,this.uint16[U+8]=A,this.uint16[U+9]=F,t}}Bc.prototype.bytesPerElement=20,Et("StructArrayLayout10ui20",Bc);class bo extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v,T,E,I,A,F,U){const Z=this.length;return this.resize(Z+1),this.emplace(Z,t,r,c,f,_,v,T,E,I,A,F,U)}emplace(t,r,c,f,_,v,T,E,I,A,F,U,Z){const H=12*t;return this.int16[H+0]=r,this.int16[H+1]=c,this.int16[H+2]=f,this.int16[H+3]=_,this.uint16[H+4]=v,this.uint16[H+5]=T,this.uint16[H+6]=E,this.uint16[H+7]=I,this.int16[H+8]=A,this.int16[H+9]=F,this.int16[H+10]=U,this.int16[H+11]=Z,t}}bo.prototype.bytesPerElement=24,Et("StructArrayLayout4i4ui4i24",bo);class Lu extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const _=3*t;return this.float32[_+0]=r,this.float32[_+1]=c,this.float32[_+2]=f,t}}Lu.prototype.bytesPerElement=12,Et("StructArrayLayout3f12",Lu);class Ya extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Ya.prototype.bytesPerElement=4,Et("StructArrayLayout1ul4",Ya);class xs extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v,T,E,I){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,c,f,_,v,T,E,I)}emplace(t,r,c,f,_,v,T,E,I,A){const F=10*t,U=5*t;return this.int16[F+0]=r,this.int16[F+1]=c,this.int16[F+2]=f,this.int16[F+3]=_,this.int16[F+4]=v,this.int16[F+5]=T,this.uint32[U+3]=E,this.uint16[F+8]=I,this.uint16[F+9]=A,t}}xs.prototype.bytesPerElement=20,Et("StructArrayLayout6i1ul2ui20",xs);class Qa extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,_,v)}emplace(t,r,c,f,_,v,T){const E=6*t;return this.int16[E+0]=r,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+3]=_,this.int16[E+4]=v,this.int16[E+5]=T,t}}Qa.prototype.bytesPerElement=12,Et("StructArrayLayout2i2i2i12",Qa);class g extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,f,_)}emplace(t,r,c,f,_,v){const T=4*t,E=8*t;return this.float32[T+0]=r,this.float32[T+1]=c,this.float32[T+2]=f,this.int16[E+6]=_,this.int16[E+7]=v,t}}g.prototype.bytesPerElement=16,Et("StructArrayLayout2f1f2i16",g);class e extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,_,v)}emplace(t,r,c,f,_,v,T){const E=16*t,I=4*t,A=8*t;return this.uint8[E+0]=r,this.uint8[E+1]=c,this.float32[I+1]=f,this.float32[I+2]=_,this.int16[A+6]=v,this.int16[A+7]=T,t}}e.prototype.bytesPerElement=16,Et("StructArrayLayout2ub2f2i16",e);class s extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const _=3*t;return this.uint16[_+0]=r,this.uint16[_+1]=c,this.uint16[_+2]=f,t}}s.prototype.bytesPerElement=6,Et("StructArrayLayout3ui6",s);class h extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce){const Re=this.length;return this.resize(Re+1),this.emplace(Re,t,r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce)}emplace(t,r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce,Re){const pe=24*t,be=12*t,Ue=48*t;return this.int16[pe+0]=r,this.int16[pe+1]=c,this.uint16[pe+2]=f,this.uint16[pe+3]=_,this.uint32[be+2]=v,this.uint32[be+3]=T,this.uint32[be+4]=E,this.uint16[pe+10]=I,this.uint16[pe+11]=A,this.uint16[pe+12]=F,this.float32[be+7]=U,this.float32[be+8]=Z,this.uint8[Ue+36]=H,this.uint8[Ue+37]=Y,this.uint8[Ue+38]=ie,this.uint32[be+10]=ce,this.int16[pe+22]=Re,t}}h.prototype.bytesPerElement=48,Et("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",h);class p extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce,Re,pe,be,Ue,We,nt,Tt,gt,wt,qt,xt){const St=this.length;return this.resize(St+1),this.emplace(St,t,r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce,Re,pe,be,Ue,We,nt,Tt,gt,wt,qt,xt)}emplace(t,r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce,Re,pe,be,Ue,We,nt,Tt,gt,wt,qt,xt,St){const et=32*t,ir=16*t;return this.int16[et+0]=r,this.int16[et+1]=c,this.int16[et+2]=f,this.int16[et+3]=_,this.int16[et+4]=v,this.int16[et+5]=T,this.int16[et+6]=E,this.int16[et+7]=I,this.uint16[et+8]=A,this.uint16[et+9]=F,this.uint16[et+10]=U,this.uint16[et+11]=Z,this.uint16[et+12]=H,this.uint16[et+13]=Y,this.uint16[et+14]=ie,this.uint16[et+15]=ce,this.uint16[et+16]=Re,this.uint16[et+17]=pe,this.uint16[et+18]=be,this.uint16[et+19]=Ue,this.uint16[et+20]=We,this.uint16[et+21]=nt,this.uint16[et+22]=Tt,this.uint32[ir+12]=gt,this.float32[ir+13]=wt,this.float32[ir+14]=qt,this.uint16[et+30]=xt,this.uint16[et+31]=St,t}}p.prototype.bytesPerElement=64,Et("StructArrayLayout8i15ui1ul2f2ui64",p);class y extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}y.prototype.bytesPerElement=4,Et("StructArrayLayout1f4",y);class S extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const _=3*t;return this.uint16[6*t+0]=r,this.float32[_+1]=c,this.float32[_+2]=f,t}}S.prototype.bytesPerElement=12,Et("StructArrayLayout1ui2f12",S);class k extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const _=4*t;return this.uint32[2*t+0]=r,this.uint16[_+2]=c,this.uint16[_+3]=f,t}}k.prototype.bytesPerElement=8,Et("StructArrayLayout1ul2ui8",k);class M extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const f=2*t;return this.uint16[f+0]=r,this.uint16[f+1]=c,t}}M.prototype.bytesPerElement=4,Et("StructArrayLayout2ui4",M);class R extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}R.prototype.bytesPerElement=2,Et("StructArrayLayout1ui2",R);class D extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,f)}emplace(t,r,c,f,_){const v=4*t;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=f,this.float32[v+3]=_,t}}D.prototype.bytesPerElement=16,Et("StructArrayLayout4f16",D);class N extends Ks{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}N.prototype.size=20;class j extends xs{get(t){return new N(this,t)}}Et("CollisionBoxArray",j);class $ extends Ks{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$.prototype.size=48;class W extends h{get(t){return new $(this,t)}}Et("PlacedSymbolArray",W);class re extends Ks{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}re.prototype.size=64;class se extends p{get(t){return new re(this,t)}}Et("SymbolInstanceArray",se);class oe extends y{getoffsetX(t){return this.float32[1*t+0]}}Et("GlyphOffsetArray",oe);class ae extends Pa{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Et("SymbolLineVertexArray",ae);class de extends Ks{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}de.prototype.size=12;class le extends S{get(t){return new de(this,t)}}Et("TextAnchorOffsetArray",le);class ge extends Ks{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ge.prototype.size=8;class we extends k{get(t){return new ge(this,t)}}Et("FeatureIndexArray",we);class he extends vs{}class Ee extends vs{}class $e extends vs{}class je extends ts{}class Ne extends rs{}class Ze extends Ca{}class ct extends Bc{}class ft extends bo{}class tt extends Lu{}class Ft extends Ya{}class br extends Qa{}class Zr extends e{}class nn extends s{}class Qr extends M{}const un=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:xn}=un;class mr{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,c,f){const _=this.segments[this.segments.length-1];return t>mr.MAX_VERTEX_ARRAY_LENGTH&&Nr(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${mr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>mr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f?this.createNewSegment(r,c,f):_}createNewSegment(t,r,c){const f={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return c!==void 0&&(f.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(t,r,c){return this.prepareSegment(0,t,r,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,c,f){return new mr([{vertexOffset:t,primitiveOffset:r,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function Xr(i,t){return 256*(i=Kt(Math.floor(i),0,255))+Kt(Math.floor(t),0,255)}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et("SegmentVector",mr);const Dn=wn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ln,Kn,Ti,Rs={exports:{}},Ho={exports:{}},wo={exports:{}},Ja=(function(){if(Ti)return Rs.exports;Ti=1;var i=(Ln||(Ln=1,Ho.exports=function(r,c){var f,_,v,T,E,I,A,F;for(_=r.length-(f=3&r.length),v=c,E=3432918353,I=461845907,F=0;F<_;)A=255&r.charCodeAt(F)|(255&r.charCodeAt(++F))<<8|(255&r.charCodeAt(++F))<<16|(255&r.charCodeAt(++F))<<24,++F,v=27492+(65535&(T=5*(65535&(v=(v^=A=(65535&(A=(A=(65535&A)*E+(((A>>>16)*E&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(A=0,f){case 3:A^=(255&r.charCodeAt(F+2))<<16;case 2:A^=(255&r.charCodeAt(F+1))<<8;case 1:v^=A=(65535&(A=(A=(65535&(A^=255&r.charCodeAt(F)))*E+(((A>>>16)*E&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295}return v^=r.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),Ho.exports),t=(Kn||(Kn=1,wo.exports=function(r,c){for(var f,_=r.length,v=c^_,T=0;_>=4;)f=1540483477*(65535&(f=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24))+((1540483477*(f>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),_-=4,++T;switch(_){case 3:v^=(255&r.charCodeAt(T+2))<<16;case 2:v^=(255&r.charCodeAt(T+1))<<8;case 1:v=1540483477*(65535&(v^=255&r.charCodeAt(T)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),wo.exports);return Rs.exports=i,Rs.exports.murmur3=i,Rs.exports.murmur2=t,Rs.exports})(),el=B(Ja);class Ea{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,c,f){this.ids.push(tl(t)),this.positions.push(r,c,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=tl(t);let c=0,f=this.ids.length-1;for(;c<f;){const v=c+f>>1;this.ids[v]>=r?f=v:c=v+1}const _=[];for(;this.ids[c]===r;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(t,r){const c=new Float64Array(t.ids),f=new Uint32Array(t.positions);return ji(c,f,0,c.length-1),r&&r.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(t){const r=new Ea;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function tl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:el(String(i))}function ji(i,t,r,c){for(;r<c;){const f=i[r+c>>1];let _=r-1,v=c+1;for(;;){do _++;while(i[_]<f);do v--;while(i[v]>f);if(_>=v)break;Xs(i,_,v),Xs(t,3*_,3*v),Xs(t,3*_+1,3*v+1),Xs(t,3*_+2,3*v+2)}v-r<c-v?(ji(i,t,r,v),r=v+1):(ji(i,t,v+1,c),c=v)}}function Xs(i,t,r){const c=i[t];i[t]=i[r],i[r]=c}Et("FeaturePositionMap",Ea);class Ni{constructor(t,r){this.gl=t.gl,this.location=r}}class Ko extends Ni{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Fn extends Ni{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Nn extends Ni{constructor(t,r){super(t,r),this.current=Pr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Bi=new Float32Array(16);function Bn(i){return[Xr(255*i.r,255*i.g),Xr(255*i.b,255*i.a)]}class $c{constructor(t,r,c){this.value=t,this.uniformNames=r.map((f=>`u_${f}`)),this.type=c}setUniform(t,r,c){t.set(c.constantOr(this.value))}getBinding(t,r,c){return this.type==="color"?new Nn(t,r):new Ko(t,r)}}class Kl{constructor(t,r){this.uniformNames=r.map((c=>`u_${c}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,c,f){const _=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,r,c){return c.substr(0,9)==="u_pattern"?new Fn(t,r):new Ko(t,r)}}class Xn{constructor(t,r,c,f){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map((_=>({name:`a_${_}`,type:"Float32",components:c==="color"?2:1,offset:0}))),this.paintVertexArray=new f}populatePaintArray(t,r,c){const f=this.paintVertexArray.length,_=this.expression.evaluate(new Wr(0,c),r,{},c.canonical,[],c.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(f,t,_)}updatePaintArray(t,r,c,f,_){const v=this.expression.evaluate(new Wr(0,_),c,f);this._setPaintValue(t,r,v)}_setPaintValue(t,r,c){if(this.type==="color"){const f=Bn(c);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bs{constructor(t,r,c,f,_,v){this.expression=t,this.uniformNames=r.map((T=>`u_${T}_t`)),this.type=c,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map((T=>({name:`a_${T}`,type:"Float32",components:c==="color"?4:2,offset:0}))),this.paintVertexArray=new v}populatePaintArray(t,r,c){const f=this.expression.evaluate(new Wr(this.zoom,c),r,{},c.canonical,[],c.formattedSection),_=this.expression.evaluate(new Wr(this.zoom+1,c),r,{},c.canonical,[],c.formattedSection),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,f,_)}updatePaintArray(t,r,c,f,_){const v=this.expression.evaluate(new Wr(this.zoom,_),c,f),T=this.expression.evaluate(new Wr(this.zoom+1,_),c,f);this._setPaintValue(t,r,v,T)}_setPaintValue(t,r,c,f){if(this.type==="color"){const _=Bn(c),v=Bn(f);for(let T=t;T<r;T++)this.paintVertexArray.emplace(T,_[0],_[1],v[0],v[1])}else{for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const c=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,f=Kt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,r,c){return new Ko(t,r)}}class Ys{constructor(t,r,c,f,_,v){this.expression=t,this.type=r,this.useIntegerZoom=c,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,r,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,r.patterns&&r.patterns[this.layerId],c.imagePositions)}updatePaintArray(t,r,c,f,_){this._setPaintValues(t,r,c.patterns&&c.patterns[this.layerId],_.imagePositions)}_setPaintValues(t,r,c,f){if(!f||!c)return;const{min:_,mid:v,max:T}=c,E=f[_],I=f[v],A=f[T];if(E&&I&&A)for(let F=t;F<r;F++)this.zoomInPaintVertexArray.emplace(F,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Dn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Dn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Kh{constructor(t,r,c){this.binders={},this._buffers=[];const f=[];for(const _ in t.paint._values){if(!c(_))continue;const v=t.paint.get(_);if(!(v instanceof Oi&&Oo(v.property.specification)))continue;const T=Xh(_,t.type),E=v.value,I=v.property.specification.type,A=v.property.useIntegerZoom,F=v.property.specification["property-type"],U=F==="cross-faded"||F==="cross-faded-data-driven";if(E.kind==="constant")this.binders[_]=U?new Kl(E.value,T):new $c(E.value,T,I),f.push(`/u_${_}`);else if(E.kind==="source"||U){const Z=Uc(_,I,"source");this.binders[_]=U?new Ys(E,I,A,r,Z,t.id):new Xn(E,T,I,Z),f.push(`/a_${_}`)}else{const Z=Uc(_,I,"composite");this.binders[_]=new bs(E,T,I,A,r,Z),f.push(`/z_${_}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Xn||r instanceof bs?r.maxValue:0}populatePaintArrays(t,r,c){for(const f in this.binders){const _=this.binders[f];(_ instanceof Xn||_ instanceof bs||_ instanceof Ys)&&_.populatePaintArray(t,r,c)}}setConstantPatternPositions(t,r){for(const c in this.binders){const f=this.binders[c];f instanceof Kl&&f.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,c,f,_){let v=!1;for(const T in t){const E=r.getPositions(T);for(const I of E){const A=c.feature(I.index);for(const F in this.binders){const U=this.binders[F];if((U instanceof Xn||U instanceof bs||U instanceof Ys)&&U.expression.isStateDependent===!0){const Z=f.paint.get(F);U.expression=Z.value,U.updatePaintArray(I.start,I.end,A,t[T],_),v=!0}}}}return v}defines(){const t=[];for(const r in this.binders){const c=this.binders[r];(c instanceof $c||c instanceof Kl)&&t.push(...c.uniformNames.map((f=>`#define HAS_UNIFORM_${f}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof Xn||c instanceof bs)for(let f=0;f<c.paintVertexAttributes.length;f++)t.push(c.paintVertexAttributes[f].name);else if(c instanceof Ys)for(let f=0;f<Dn.members.length;f++)t.push(Dn.members[f].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof $c||c instanceof Kl||c instanceof bs)for(const f of c.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const c=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof $c||_ instanceof Kl||_ instanceof bs){for(const v of _.uniformNames)if(r[v]){const T=_.getBinding(t,r[v],v);c.push({name:v,property:f,binding:T})}}}return c}setUniforms(t,r,c,f){for(const{name:_,property:v,binding:T}of r)this.binders[v].setUniform(T,f,c.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const c=this.binders[r];if(t&&c instanceof Ys){const f=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof Xn||c instanceof bs)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const r in this.binders){const c=this.binders[r];(c instanceof Xn||c instanceof bs||c instanceof Ys)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Xn||r instanceof bs||r instanceof Ys)&&r.destroy()}}}class ns{constructor(t,r,c=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new Kh(f,r,c);this.needsUpload=!1,this._featureMap=new Ea,this._bufferOffset=0}populatePaintArrays(t,r,c,f){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,f);r.id!==void 0&&this._featureMap.add(r.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,c,f){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,r,_,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Xh(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Uc(i,t,r){const c={color:{source:Ca,composite:D},number:{source:y,composite:Ca}},f=(function(_){return{"line-pattern":{source:ct,composite:ct},"fill-pattern":{source:ct,composite:ct},"fill-extrusion-pattern":{source:ct,composite:ct}}[_]})(i);return f&&f[r]||c[t][r]}Et("ConstantBinder",$c),Et("CrossFadedConstantBinder",Kl),Et("SourceExpressionBinder",Xn),Et("CrossFadedCompositeBinder",Ys),Et("CompositeExpressionBinder",bs),Et("ProgramConfiguration",Kh,{omit:["_buffers"]}),Et("ProgramConfigurationSet",ns);const Xo=Math.pow(2,14)-1,Xl=-Xo-1;function So(i){const t=ht/i.extent,r=i.loadGeometry();for(let c=0;c<r.length;c++){const f=r[c];for(let _=0;_<f.length;_++){const v=f[_],T=Math.round(v.x*t),E=Math.round(v.y*t);v.x=Kt(T,Xl,Xo),v.y=Kt(E,Xl,Xo),(T<v.x||T>v.x+1||E<v.y||E>v.y+1)&&Nr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Yo(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?So(i):[]}}const lp=-32768;function Tm(i,t,r,c,f){i.emplaceBack(lp+8*t+c,lp+8*r+f)}class Jd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ee,this.indexArray=new nn,this.segments=new mr,this.programConfigurations=new ns(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){const f=this.layers[0],_=[];let v=null,T=!1,E=f.type==="heatmap";if(f.type==="circle"){const A=f;v=A.layout.get("circle-sort-key"),T=!v.isConstant(),E=E||A.paint.get("circle-pitch-alignment")==="map"}const I=E?r.subdivisionGranularity.circle:1;for(const{feature:A,id:F,index:U,sourceLayerIndex:Z}of t){const H=this.layers[0]._featureFilter.needGeometry,Y=Yo(A,H);if(!this.layers[0]._featureFilter.filter(new Wr(this.zoom,{globalState:this.globalState}),Y,c))continue;const ie=T?v.evaluate(Y,{},c):void 0,ce={id:F,properties:A.properties,type:A.type,sourceLayerIndex:Z,index:U,geometry:H?Y.geometry:So(A),patterns:{},sortKey:ie};_.push(ce)}T&&_.sort(((A,F)=>A.sortKey-F.sortKey));for(const A of _){const{geometry:F,index:U,sourceLayerIndex:Z}=A,H=t[U].feature;this.addFeature(A,F,U,c,I),r.featureIndex.insert(H,F,U,Z,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:c,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,c,f,_=1){let v;switch(_){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const T=v.length;for(const E of r)for(const I of E){const A=I.x,F=I.y;if(A<0||A>=ht||F<0||F>=ht)continue;const U=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,t.sortKey),Z=U.vertexLength;for(let H=0;H<T;H++)for(let Y=0;Y<T;Y++)Tm(this.layoutVertexArray,A,F,v[Y],v[H]);for(let H=0;H<T-1;H++)for(let Y=0;Y<T-1;Y++){const ie=Z+H*T+Y,ce=Z+(H+1)*T+Y;this.indexArray.emplaceBack(ie,ce+1,ie+1),this.indexArray.emplaceBack(ie,ce,ce+1)}U.vertexLength+=T*T,U.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{imagePositions:{},canonical:f,globalState:this.globalState})}}function cp(i,t){for(let r=0;r<i.length;r++)if(Vc(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Vc(i,t[r]))return!0;return!!$i(i,t)}function Pm(i,t,r){return!!Vc(i,t)||!!ef(t,i,r)}function Cm(i,t){if(i.length===1)return hp(t,i[0]);for(let r=0;r<t.length;r++){const c=t[r];for(let f=0;f<c.length;f++)if(Vc(i,c[f]))return!0}for(let r=0;r<i.length;r++)if(hp(t,i[r]))return!0;for(let r=0;r<t.length;r++)if($i(i,t[r]))return!0;return!1}function Ds(i,t,r){if(i.length>1){if($i(i,t))return!0;for(let c=0;c<t.length;c++)if(ef(t[c],i,r))return!0}for(let c=0;c<i.length;c++)if(ef(i[c],t,r))return!0;return!1}function $i(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const c=i[r],f=i[r+1];for(let _=0;_<t.length-1;_++)if(Em(c,f,t[_],t[_+1]))return!0}return!1}function Em(i,t,r,c){return Cn(i,r,c)!==Cn(t,r,c)&&Cn(i,t,r)!==Cn(i,t,c)}function ef(i,t,r){const c=r*r;if(t.length===1)return i.distSqr(t[0])<c;for(let f=1;f<t.length;f++)if(up(i,t[f-1],t[f])<c)return!0;return!1}function up(i,t,r){const c=t.distSqr(r);if(c===0)return i.distSqr(t);const f=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/c;return i.distSqr(f<0?t:f>1?r:r.sub(t)._mult(f)._add(t))}function hp(i,t){let r,c,f,_=!1;for(let v=0;v<i.length;v++){r=i[v];for(let T=0,E=r.length-1;T<r.length;E=T++)c=r[T],f=r[E],c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(_=!_)}return _}function Vc(i,t){let r=!1;for(let c=0,f=i.length-1;c<i.length;f=c++){const _=i[c],v=i[f];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(r=!r)}return r}function dp(i,t,r){const c=r[0],f=r[2];if(i.x<c.x&&t.x<c.x||i.x>f.x&&t.x>f.x||i.y<c.y&&t.y<c.y||i.y>f.y&&t.y>f.y)return!1;const _=Cn(i,t,r[0]);return _!==Cn(i,t,r[1])||_!==Cn(i,t,r[2])||_!==Cn(i,t,r[3])}function Fu(i,t,r){const c=t.paint.get(i).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Ou(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Yh(i,t,r,c,f){if(!t[0]&&!t[1])return i;const _=L.convert(t)._mult(f);r==="viewport"&&_._rotate(-c);const v=[];for(let T=0;T<i.length;T++)v.push(i[T].sub(_));return v}let fp,tf;Et("CircleBucket",Jd,{omit:["layers"]});var pp={get paint(){return tf=tf||new fi({"circle-radius":new Yt(Pe.paint_circle["circle-radius"]),"circle-color":new Yt(Pe.paint_circle["circle-color"]),"circle-blur":new Yt(Pe.paint_circle["circle-blur"]),"circle-opacity":new Yt(Pe.paint_circle["circle-opacity"]),"circle-translate":new Lt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return fp=fp||new fi({"circle-sort-key":new Yt(Pe.layout_circle["circle-sort-key"])})}};class km extends pi{constructor(t){super(t,pp)}createBucket(t){return new Jd(t)}queryRadius(t){const r=t;return Fu("circle-radius",this,r)+Fu("circle-stroke-width",this,r)+Ou(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:c,geometry:f,transform:_,pixelsToTileUnits:v,unwrappedTileID:T,getElevation:E}){const I=Yh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,v),A=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c),F=this.paint.get("circle-pitch-alignment")==="map",U=F?I:(function(H,Y,ie,ce){return H.map((Re=>rf(Re,Y,ie,ce)))})(I,_,T,E),Z=F?A*v:A;for(const H of f)for(const Y of H){const ie=F?Y:rf(Y,_,T,E);let ce=Z;const Re=_.projectTileCoordinates(Y.x,Y.y,T,E).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ce*=Re/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ce*=_.cameraToCenterDistance/Re),Pm(U,ie,ce))return!0}return!1}}function rf(i,t,r,c){const f=t.projectTileCoordinates(i.x,i.y,r,c).point;return new L((.5*f.x+.5)*t.width,(.5*-f.y+.5)*t.height)}class Qh extends Jd{}let Mm;Et("HeatmapBucket",Qh,{omit:["layers"]});var Im={get paint(){return Mm=Mm||new fi({"heatmap-radius":new Yt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hl(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt(Pe.paint_heatmap["heatmap-opacity"])})}};function Jh(i,{width:t,height:r},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*r*c)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*r*c}`)}else f=new Uint8Array(t*r*c);return i.width=t,i.height=r,i.data=f,i}function mp(i,{width:t,height:r},c){if(t===i.width&&r===i.height)return;const f=Jh({},{width:t,height:r},c);ju(i,f,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},c),i.width=t,i.height=r,i.data=f.data}function ju(i,t,r,c,f,_){if(f.width===0||f.height===0)return t;if(f.width>i.width||f.height>i.height||r.x>i.width-f.width||r.y>i.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||c.x>t.width-f.width||c.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,T=t.data;if(v===T)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<f.height;E++){const I=((r.y+E)*i.width+r.x)*_,A=((c.y+E)*t.width+c.x)*_;for(let F=0;F<f.width*_;F++)T[A+F]=v[I+F]}return t}class Qs{constructor(t,r){Jh(this,t,1,r)}resize(t){mp(this,t,1)}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,f,_){ju(t,r,c,f,_,1)}}class ws{constructor(t,r){Jh(this,t,4,r)}resize(t){mp(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,f,_){ju(t,r,c,f,_,4)}setPixel(t,r,c){const f=4*(t*this.width+r);this.data[f+0]=Math.round(255*c.r/c.a),this.data[f+1]=Math.round(255*c.g/c.a),this.data[f+2]=Math.round(255*c.b/c.a),this.data[f+3]=Math.round(255*c.a)}}function gp(i){const t={},r=i.resolution||256,c=i.clips?i.clips.length:1,f=i.image||new ws({width:r,height:c});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const _=(v,T,E)=>{t[i.evaluationKey]=E;const I=i.expression.evaluate(t);f.setPixel(v/4/r,T/4,I)};if(i.clips)for(let v=0,T=0;v<c;++v,T+=4*r)for(let E=0,I=0;E<r;E++,I+=4){const A=E/(r-1),{start:F,end:U}=i.clips[v];_(T,I,F*(1-A)+U*A)}else for(let v=0,T=0;v<r;v++,T+=4)_(0,T,v/(r-1));return f}Et("AlphaImage",Qs),Et("RGBAImage",ws);const ed="big-fb";class Am extends pi{createBucket(t){return new Qh(t)}constructor(t){super(t,Im),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ed)&&this.heatmapFbos.delete(ed)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let yp;var td={get paint(){return yp=yp||new fi({"hillshade-illumination-direction":new Lt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Lt(Pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Lt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Lt(Pe.paint_hillshade["hillshade-method"])})}};class is extends pi{constructor(t){super(t,td),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,c=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const _=Math.max(t.length,r.length,c.length,f.length);t=t.concat(Array(_-t.length).fill(t.at(-1))),r=r.concat(Array(_-r.length).fill(r.at(-1))),c=c.concat(Array(_-c.length).fill(c.at(-1))),f=f.concat(Array(_-f.length).fill(f.at(-1)));const v=r.map(vt);return{directionRadians:t.map(vt),altitudeRadians:v,shadowColor:f,highlightColor:c}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let zm;var ny={get paint(){return zm=zm||new fi({"color-relief-opacity":new Lt(Pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Hl(Pe["paint_color-relief"]["color-relief-color"])})}};class Nu{constructor(t,r,c,f){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(r,f)}update(t,r,c){const{width:f,height:_}=t,v=!(this.size&&this.size[0]===f&&this.size[1]===_||c),{context:T}=this,{gl:E}=T;if(this.useMipmap=!!(r&&r.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!r||r.premultiply!==!1)),v)this.size=[f,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||zi(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,f,_,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:I,y:A}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||zi(t)?E.texSubImage2D(E.TEXTURE_2D,0,I,A,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,I,A,f,_,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,c){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),c!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,c||t),this.filter=t),r!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ui{constructor(t,r,c,f=1,_=1,v=1,T=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void Nr(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const E=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=_,this.blueFactor=v,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<E;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(E,I)]=this.data[this._idx(E-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,E)]=this.data[this._idx(I,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<E;I++)for(let A=0;A<E;A++){const F=this.get(I,A);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(t,r){const c=new Uint8Array(this.data.buffer),f=4*this._idx(t,r);return this.unpack(c[f],c[f+1],c[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,c){return t*this.redFactor+r*this.greenFactor+c*this.blueFactor-this.baseShift}pack(t){return Rm(t,this.getUnpackVector())}getPixels(){return new ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=r*this.dim,_=r*this.dim+this.dim,v=c*this.dim,T=c*this.dim+this.dim;switch(r){case-1:f=_-1;break;case 1:_=f+1}switch(c){case-1:v=T-1;break;case 1:T=v+1}const E=-r*this.dim,I=-c*this.dim;for(let A=v;A<T;A++)for(let F=f;F<_;F++)this.data[this._idx(F,A)]=t.data[this._idx(F+E,A+I)]}}function Rm(i,t){const r=t[0],c=t[1],f=t[2],_=t[3],v=Math.min(r,c,f),T=Math.round((i+_)/v);return{r:Math.floor(T*v/r)%256,g:Math.floor(T*v/c)%256,b:Math.floor(T*v/f)%256}}Et("DEMData",Ui);class Ut extends pi{constructor(t){super(t,ny)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},c=this._transitionablePaint._values["color-relief-color"].value.expression;if(c instanceof qa&&c._styleExpression.expression instanceof Rn){this.colorRampExpression=c;const v=c._styleExpression.expression;r.elevationStops=v.labels,r.colorStops=[];for(const T of r.elevationStops)r.colorStops.push(v.evaluate({globals:{elevation:T}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Pr.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const f={elevationStops:[],colorStops:[]},_=(r.elevationStops.length-1)/(t-1);for(let v=0;v<r.elevationStops.length-.5;v+=_)f.elevationStops.push(r.elevationStops[Math.round(v)]),f.colorStops.push(r.colorStops[Math.round(v)]);return Nr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,c){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(r),_=new ws({width:f.colorStops.length,height:1}),v=new ws({width:f.colorStops.length,height:1});for(let T=0;T<f.elevationStops.length;T++){const E=Rm(f.elevationStops[T],c);v.setPixel(0,T,new Pr(E.r/255,E.g/255,E.b/255,1)),_.setPixel(0,T,f.colorStops[T])}return this.colorRampTextures={elevationTexture:new Nu(t,v,t.gl.RGBA),colorTexture:new Nu(t,_,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Bu=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:_p}=Bu;function nf(i,t,r){const c=r.patternDependencies;let f=!1;for(const _ of t){const v=_.paint.get(`${i}-pattern`);v.isConstant()||(f=!0);const T=v.constantOr(null);T&&(f=!0,c[T.to]=!0,c[T.from]=!0)}return f}function vp(i,t,r,c,f){const{zoom:_,globalState:v}=c,T=f.patternDependencies;for(const E of t){const I=E.paint.get(`${i}-pattern`).value;if(I.kind!=="constant"){let A=I.evaluate({zoom:_-1,globalState:v},r,{},f.availableImages),F=I.evaluate({zoom:_,globalState:v},r,{},f.availableImages),U=I.evaluate({zoom:_+1,globalState:v},r,{},f.availableImages);A=A&&A.name?A.name:A,F=F&&F.name?F.name:F,U=U&&U.name?U.name:U,T[A]=!0,T[F]=!0,T[U]=!0,r.patterns[E.id]={min:A,mid:F,max:U}}}return r}function $u(i,t,r,c,f){let _;if(f===(function(v,T,E,I){let A=0;for(let F=T,U=E-I;F<E;F+=I)A+=(v[U]-v[F])*(v[F+1]+v[U+1]),U=F;return A})(i,t,r,c)>0)for(let v=t;v<r;v+=c)_=id(v/c|0,i[v],i[v+1],_);else for(let v=r-c;v>=t;v-=c)_=id(v/c|0,i[v],i[v+1],_);return _&&Uu(_,_.next)&&(Gc(_),_=_.next),_}function ka(i,t){if(!i)return i;t||(t=i);let r,c=i;do if(r=!1,c.steiner||!Uu(c,c.next)&&sn(c.prev,c,c.next)!==0)c=c.next;else{if(Gc(c),c=t=c.prev,c===c.next)break;r=!0}while(r||c!==t);return t}function Zc(i,t,r,c,f,_,v){if(!i)return;!v&&_&&(function(E,I,A,F){let U=E;do U.z===0&&(U.z=Ma(U.x,U.y,I,A,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==E);U.prevZ.nextZ=null,U.prevZ=null,(function(Z){let H,Y=1;do{let ie,ce=Z;Z=null;let Re=null;for(H=0;ce;){H++;let pe=ce,be=0;for(let We=0;We<Y&&(be++,pe=pe.nextZ,pe);We++);let Ue=Y;for(;be>0||Ue>0&&pe;)be!==0&&(Ue===0||!pe||ce.z<=pe.z)?(ie=ce,ce=ce.nextZ,be--):(ie=pe,pe=pe.nextZ,Ue--),Re?Re.nextZ=ie:Z=ie,ie.prevZ=Re,Re=ie;ce=pe}Re.nextZ=null,Y*=2}while(H>1)})(U)})(i,c,f,_);let T=i;for(;i.prev!==i.next;){const E=i.prev,I=i.next;if(_?Lm(i,c,f,_):Dm(i))t.push(E.i,i.i,I.i),Gc(i),i=I.next,T=I.next;else if((i=I)===T){v?v===1?Zc(i=Fm(ka(i),t),t,r,c,f,_,2):v===2&&xp(i,t,r,c,f,_):Zc(ka(i),t,r,c,f,_,1);break}}}function Dm(i){const t=i.prev,r=i,c=i.next;if(sn(t,r,c)>=0)return!1;const f=t.x,_=r.x,v=c.x,T=t.y,E=r.y,I=c.y,A=Math.min(f,_,v),F=Math.min(T,E,I),U=Math.max(f,_,v),Z=Math.max(T,E,I);let H=c.next;for(;H!==t;){if(H.x>=A&&H.x<=U&&H.y>=F&&H.y<=Z&&Ss(f,T,_,E,v,I,H.x,H.y)&&sn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Lm(i,t,r,c){const f=i.prev,_=i,v=i.next;if(sn(f,_,v)>=0)return!1;const T=f.x,E=_.x,I=v.x,A=f.y,F=_.y,U=v.y,Z=Math.min(T,E,I),H=Math.min(A,F,U),Y=Math.max(T,E,I),ie=Math.max(A,F,U),ce=Ma(Z,H,t,r,c),Re=Ma(Y,ie,t,r,c);let pe=i.prevZ,be=i.nextZ;for(;pe&&pe.z>=ce&&be&&be.z<=Re;){if(pe.x>=Z&&pe.x<=Y&&pe.y>=H&&pe.y<=ie&&pe!==f&&pe!==v&&Ss(T,A,E,F,I,U,pe.x,pe.y)&&sn(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,be.x>=Z&&be.x<=Y&&be.y>=H&&be.y<=ie&&be!==f&&be!==v&&Ss(T,A,E,F,I,U,be.x,be.y)&&sn(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;pe&&pe.z>=ce;){if(pe.x>=Z&&pe.x<=Y&&pe.y>=H&&pe.y<=ie&&pe!==f&&pe!==v&&Ss(T,A,E,F,I,U,pe.x,pe.y)&&sn(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;be&&be.z<=Re;){if(be.x>=Z&&be.x<=Y&&be.y>=H&&be.y<=ie&&be!==f&&be!==v&&Ss(T,A,E,F,I,U,be.x,be.y)&&sn(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function Fm(i,t){let r=i;do{const c=r.prev,f=r.next.next;!Uu(c,f)&&Sp(c,r,r.next,f)&&Vu(c,f)&&Vu(f,c)&&(t.push(c.i,r.i,f.i),Gc(r),Gc(r.next),r=i=f),r=r.next}while(r!==i);return ka(r)}function xp(i,t,r,c,f,_){let v=i;do{let T=v.next.next;for(;T!==v.prev;){if(v.i!==T.i&&jm(v,T)){let E=Nm(v,T);return v=ka(v,v.next),E=ka(E,E.next),Zc(v,t,r,c,f,_,0),void Zc(E,t,r,c,f,_,0)}T=T.next}v=v.next}while(v!==i)}function bp(i,t){let r=i.x-t.x;return r===0&&(r=i.y-t.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Vi(i,t){const r=(function(f,_){let v=_;const T=f.x,E=f.y;let I,A=-1/0;if(Uu(f,v))return v;do{if(Uu(f,v.next))return v.next;if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){const Y=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(Y<=T&&Y>A&&(A=Y,I=v.x<v.next.x?v:v.next,Y===T))return I}v=v.next}while(v!==_);if(!I)return null;const F=I,U=I.x,Z=I.y;let H=1/0;v=I;do{if(T>=v.x&&v.x>=U&&T!==v.x&&wp(E<Z?T:A,E,U,Z,E<Z?A:T,E,v.x,v.y)){const Y=Math.abs(E-v.y)/(T-v.x);Vu(v,f)&&(Y<H||Y===H&&(v.x>I.x||v.x===I.x&&Qo(I,v)))&&(I=v,H=Y)}v=v.next}while(v!==F);return I})(i,t);if(!r)return t;const c=Nm(r,i);return ka(c,c.next),ka(r,r.next)}function Qo(i,t){return sn(i.prev,i,t.prev)<0&&sn(t.next,i,i.next)<0}function Ma(i,t,r,c,f){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Om(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function wp(i,t,r,c,f,_,v,T){return(f-v)*(t-T)>=(i-v)*(_-T)&&(i-v)*(c-T)>=(r-v)*(t-T)&&(r-v)*(_-T)>=(f-v)*(c-T)}function Ss(i,t,r,c,f,_,v,T){return!(i===v&&t===T)&&wp(i,t,r,c,f,_,v,T)}function jm(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!(function(r,c){let f=r;do{if(f.i!==r.i&&f.next.i!==r.i&&f.i!==c.i&&f.next.i!==c.i&&Sp(f,f.next,r,c))return!0;f=f.next}while(f!==r);return!1})(i,t)&&(Vu(i,t)&&Vu(t,i)&&(function(r,c){let f=r,_=!1;const v=(r.x+c.x)/2,T=(r.y+c.y)/2;do f.y>T!=f.next.y>T&&f.next.y!==f.y&&v<(f.next.x-f.x)*(T-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next;while(f!==r);return _})(i,t)&&(sn(i.prev,i,t.prev)||sn(i,t.prev,t))||Uu(i,t)&&sn(i.prev,i,i.next)>0&&sn(t.prev,t,t.next)>0)}function sn(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Uu(i,t){return i.x===t.x&&i.y===t.y}function Sp(i,t,r,c){const f=nd(sn(i,t,r)),_=nd(sn(i,t,c)),v=nd(sn(r,c,i)),T=nd(sn(r,c,t));return f!==_&&v!==T||!(f!==0||!rd(i,r,t))||!(_!==0||!rd(i,c,t))||!(v!==0||!rd(r,i,c))||!(T!==0||!rd(r,t,c))}function rd(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function nd(i){return i>0?1:i<0?-1:0}function Vu(i,t){return sn(i.prev,i,i.next)<0?sn(i,t,i.next)>=0&&sn(i,i.prev,t)>=0:sn(i,t,i.prev)<0||sn(i,i.next,t)<0}function Nm(i,t){const r=Ls(i.i,i.x,i.y),c=Ls(t.i,t.x,t.y),f=i.next,_=t.prev;return i.next=t,t.prev=i,r.next=f,f.prev=r,c.next=r,r.prev=c,_.next=c,c.prev=_,c}function id(i,t,r,c){const f=Ls(i,t,r);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Gc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ls(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Br{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Yn{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Yn.noSubdivision=new Yn({fill:new Br(0,0),line:new Br(0,0),tile:new Br(0,0),stencil:new Br(0,0),circle:1}),Et("SubdivisionGranularityExpression",Br),Et("SubdivisionGranularitySetting",Yn);const Sn=-32768,Qn=32767;class Js{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ht/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const c=0|Math.round(t),f=0|Math.round(r),_=this._getKey(c,f);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,v),this._vertexBuffer.push(c,f),v}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(f,_){const v=[];for(let T=0;T<_.length;T+=3){const E=_[T],I=_[T+1],A=_[T+2],F=f[2*E],U=f[2*E+1];(f[2*I]-F)*(f[2*A+1]-U)-(f[2*I+1]-U)*(f[2*A]-F)>0?(v.push(E),v.push(A),v.push(I)):(v.push(E),v.push(I),v.push(A))}return v})(this._vertexBuffer,t);const r=[],c=t.length;for(let f=0;f<c;f+=3){const _=[t[f+0],t[f+1],t[f+2]],v=[this._vertexBuffer[2*t[f+0]+0],this._vertexBuffer[2*t[f+0]+1],this._vertexBuffer[2*t[f+1]+0],this._vertexBuffer[2*t[f+1]+1],this._vertexBuffer[2*t[f+2]+0],this._vertexBuffer[2*t[f+2]+1]];let T=1/0,E=1/0,I=-1/0,A=-1/0;for(let Y=0;Y<3;Y++){const ie=v[2*Y],ce=v[2*Y+1];T=Math.min(T,ie),I=Math.max(I,ie),E=Math.min(E,ce),A=Math.max(A,ce)}if(T===I||E===A)continue;const F=Math.floor(T/this._granularityCellSize),U=Math.ceil(I/this._granularityCellSize),Z=Math.floor(E/this._granularityCellSize),H=Math.ceil(A/this._granularityCellSize);if(F!==U||Z!==H)for(let Y=Z;Y<H;Y++){const ie=this._scanlineGenerateVertexRingForCellRow(Y,v,_);sd(this._vertexBuffer,ie,r)}else r.push(..._)}return r}_scanlineGenerateVertexRingForCellRow(t,r,c){const f=t*this._granularityCellSize,_=f+this._granularityCellSize,v=[];for(let T=0;T<3;T++){const E=r[2*T],I=r[2*T+1],A=r[2*(T+1)%6],F=r[(2*(T+1)+1)%6],U=r[2*(T+2)%6],Z=r[(2*(T+2)+1)%6],H=A-E,Y=F-I,ie=H===0,ce=Y===0,Re=(f-I)/Y,pe=(_-I)/Y,be=Math.min(Re,pe),Ue=Math.max(Re,pe);if(!ce&&(be>=1||Ue<=0)||ce&&(I<f||I>_)){F>=f&&F<=_&&v.push(c[(T+1)%3]);continue}!ce&&be>0&&v.push(this._vertexToIndex(E+H*be,I+Y*be));const We=E+H*Math.max(be,0),nt=E+H*Math.min(Ue,1);ie||this._generateIntraEdgeVertices(v,E,I,A,F,We,nt),!ce&&Ue<1&&v.push(this._vertexToIndex(E+H*Ue,I+Y*Ue)),(ce||F>=f&&F<=_)&&v.push(c[(T+1)%3]),!ce&&(F<=f||F>=_)&&this._generateInterEdgeVertices(v,E,I,A,F,U,Z,nt,f,_)}return v}_generateIntraEdgeVertices(t,r,c,f,_,v,T){const E=f-r,I=_-c,A=I===0,F=A?Math.min(r,f):Math.min(v,T),U=A?Math.max(r,f):Math.max(v,T),Z=Math.floor(F/this._granularityCellSize)+1,H=Math.ceil(U/this._granularityCellSize)-1;if(A?r<f:v<T)for(let Y=Z;Y<=H;Y++){const ie=Y*this._granularityCellSize;t.push(this._vertexToIndex(ie,c+I*(ie-r)/E))}else for(let Y=H;Y>=Z;Y--){const ie=Y*this._granularityCellSize;t.push(this._vertexToIndex(ie,c+I*(ie-r)/E))}}_generateInterEdgeVertices(t,r,c,f,_,v,T,E,I,A){const F=_-c,U=v-f,Z=T-_,H=(I-_)/Z,Y=(A-_)/Z,ie=Math.min(H,Y),ce=Math.max(H,Y),Re=f+U*ie;let pe=Math.floor(Math.min(Re,E)/this._granularityCellSize)+1,be=Math.ceil(Math.max(Re,E)/this._granularityCellSize)-1,Ue=E<Re;const We=Z===0;if(We&&(T===I||T===A))return;if(We||ie>=1||ce<=0){const Tt=c-T,gt=v+(r-v)*Math.min((I-T)/Tt,(A-T)/Tt);pe=Math.floor(Math.min(gt,E)/this._granularityCellSize)+1,be=Math.ceil(Math.max(gt,E)/this._granularityCellSize)-1,Ue=E<gt}const nt=F>0?A:I;if(Ue)for(let Tt=pe;Tt<=be;Tt++)t.push(this._vertexToIndex(Tt*this._granularityCellSize,nt));else for(let Tt=be;Tt>=pe;Tt--)t.push(this._vertexToIndex(Tt*this._granularityCellSize,nt))}_generateOutline(t){const r=[];for(const c of t){const f=Tn(c,this._granularity,!0),_=this._pointArrayToIndices(f),v=[];for(let T=1;T<_.length;T++)v.push(_[T-1]),v.push(_[T]);r.push(v)}return r}_handlePoles(t){let r=!1,c=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(r||c)&&this._fillPoles(t,r,c)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const c=t[r+1];c===Sn&&(t[r+1]=-32767),c===Qn&&(t[r+1]=32766)}}_generatePoleQuad(t,r,c,f,_,v){f>_!=(v===Sn)?(t.push(r),t.push(c),t.push(this._vertexToIndex(f,v)),t.push(c),t.push(this._vertexToIndex(_,v)),t.push(this._vertexToIndex(f,v))):(t.push(c),t.push(r),t.push(this._vertexToIndex(f,v)),t.push(this._vertexToIndex(_,v)),t.push(c),t.push(this._vertexToIndex(f,v)))}_fillPoles(t,r,c){const f=this._vertexBuffer,_=ht,v=t.length;for(let T=2;T<v;T+=3){const E=t[T-2],I=t[T-1],A=t[T],F=f[2*E],U=f[2*E+1],Z=f[2*I],H=f[2*I+1],Y=f[2*A],ie=f[2*A+1];r&&(U===0&&H===0&&this._generatePoleQuad(t,E,I,F,Z,Sn),H===0&&ie===0&&this._generatePoleQuad(t,I,A,Z,Y,Sn),ie===0&&U===0&&this._generatePoleQuad(t,A,E,Y,F,Sn)),c&&(U===_&&H===_&&this._generatePoleQuad(t,E,I,F,Z,Qn),H===_&&ie===_&&this._generatePoleQuad(t,I,A,Z,Y,Qn),ie===_&&U===_&&this._generatePoleQuad(t,A,E,Y,F,Qn))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:c,holeIndices:f}=(function(T){const E=[],I=[];for(const A of T)if(A.length!==0){A!==T[0]&&E.push(I.length/2);for(let F=0;F<A.length;F++)I.push(A[F].x),I.push(A[F].y)}return{flattened:I,holeIndices:E}})(t);let _;this._initializeVertices(c);try{const T=(function(I,A,F=2){const U=A&&A.length,Z=U?A[0]*F:I.length;let H=$u(I,0,Z,F,!0);const Y=[];if(!H||H.next===H.prev)return Y;let ie,ce,Re;if(U&&(H=(function(pe,be,Ue,We){const nt=[];for(let Tt=0,gt=be.length;Tt<gt;Tt++){const wt=$u(pe,be[Tt]*We,Tt<gt-1?be[Tt+1]*We:pe.length,We,!1);wt===wt.next&&(wt.steiner=!0),nt.push(Om(wt))}nt.sort(bp);for(let Tt=0;Tt<nt.length;Tt++)Ue=Vi(nt[Tt],Ue);return Ue})(I,A,H,F)),I.length>80*F){ie=I[0],ce=I[1];let pe=ie,be=ce;for(let Ue=F;Ue<Z;Ue+=F){const We=I[Ue],nt=I[Ue+1];We<ie&&(ie=We),nt<ce&&(ce=nt),We>pe&&(pe=We),nt>be&&(be=nt)}Re=Math.max(pe-ie,be-ce),Re=Re!==0?32767/Re:0}return Zc(H,Y,F,ie,ce,Re,0),Y})(c,f),E=this._convertIndices(c,T);_=this._subdivideTrianglesScanline(E)}catch(T){console.error(T)}let v=[];return r&&(v=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:v}}_convertIndices(t,r){const c=[];for(let f=0;f<r.length;f++)c.push(this._vertexToIndex(t[2*r[f]],t[2*r[f]+1]));return c}_pointArrayToIndices(t){const r=[];for(let c=0;c<t.length;c++){const f=t[c];r.push(this._vertexToIndex(f.x,f.y))}return r}}function qc(i,t,r,c=!0){return new Js(r,t).subdividePolygonInternal(i,c)}function Tn(i,t,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const c=i[0],f=i[i.length-1],_=r&&(c.x!==f.x||c.y!==f.y);if(t<2)return _?[...i,i[0]]:[...i];const v=Math.floor(ht/t),T=[];T.push(new L(i[0].x,i[0].y));const E=i.length,I=_?E:E-1;for(let A=0;A<I;A++){const F=i[A],U=A<E-1?i[A+1]:i[0],Z=F.x,H=F.y,Y=U.x,ie=U.y,ce=Z!==Y,Re=H!==ie;if(!ce&&!Re)continue;const pe=Y-Z,be=ie-H,Ue=Math.abs(pe),We=Math.abs(be);let nt=Z,Tt=H;for(;;){const wt=pe>0?(Math.floor(nt/v)+1)*v:(Math.ceil(nt/v)-1)*v,qt=be>0?(Math.floor(Tt/v)+1)*v:(Math.ceil(Tt/v)-1)*v,xt=Math.abs(nt-wt),St=Math.abs(Tt-qt),et=Math.abs(nt-Y),ir=Math.abs(Tt-ie),gr=ce?xt/Ue:Number.POSITIVE_INFINITY,er=Re?St/We:Number.POSITIVE_INFINITY;if((et<=xt||!ce)&&(ir<=St||!Re))break;if(gr<er&&ce||!Re){nt=wt,Tt+=be*gr;const Nt=new L(nt,Math.round(Tt));T[T.length-1].x===Nt.x&&T[T.length-1].y===Nt.y||T.push(Nt)}else{nt+=pe*er,Tt=qt;const Nt=new L(Math.round(nt),Tt);T[T.length-1].x===Nt.x&&T[T.length-1].y===Nt.y||T.push(Nt)}}const gt=new L(Y,ie);T[T.length-1].x===gt.x&&T[T.length-1].y===gt.y||T.push(gt)}return T}function sd(i,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let c=0,f=i[2*t[0]];for(let E=1;E<t.length;E++){const I=i[2*t[E]];I<f&&(f=I,c=E)}const _=t.length;let v=c,T=(v+1)%_;for(;;){const E=v-1>=0?v-1:_-1,I=(T+1)%_,A=i[2*t[E]],F=i[2*t[I]],U=i[2*t[v]],Z=i[2*t[v]+1],H=i[2*t[T]+1];let Y=!1;if(A<F)Y=!0;else if(A>F)Y=!1;else{const ie=H-Z,ce=-(i[2*t[T]]-U),Re=Z<H?1:-1;((A-U)*ie+(i[2*t[E]+1]-Z)*ce)*Re>((F-U)*ie+(i[2*t[I]+1]-Z)*ce)*Re&&(Y=!0)}if(Y){const ie=t[E],ce=t[v],Re=t[T];ie!==ce&&ie!==Re&&ce!==Re&&r.push(Re,ce,ie),v--,v<0&&(v=_-1)}else{const ie=t[I],ce=t[v],Re=t[T];ie!==ce&&ie!==Re&&ce!==Re&&r.push(Re,ce,ie),T++,T>=_&&(T=0)}if(E===I)break}}function Yl(i,t,r,c,f,_,v,T,E){const I=f.length/2,A=v&&T&&E;if(I<mr.MAX_VERTEX_ARRAY_LENGTH){const F=t.prepareSegment(I,r,c),U=F.vertexLength;for(let Y=0;Y<_.length;Y+=3)c.emplaceBack(U+_[Y],U+_[Y+1],U+_[Y+2]);let Z,H;F.vertexLength+=I,F.primitiveLength+=_.length/3,A&&(H=v.prepareSegment(I,r,T),Z=H.vertexLength,H.vertexLength+=I);for(let Y=0;Y<f.length;Y+=2)i(f[Y],f[Y+1]);if(A)for(let Y=0;Y<E.length;Y++){const ie=E[Y];for(let ce=1;ce<ie.length;ce+=2)T.emplaceBack(Z+ie[ce-1],Z+ie[ce]);H.primitiveLength+=ie.length/2}}else(function(F,U,Z,H,Y,ie){const ce=[];for(let We=0;We<H.length/2;We++)ce.push(-1);const Re={count:0};let pe=0,be=F.getOrCreateLatestSegment(U,Z),Ue=be.vertexLength;for(let We=2;We<Y.length;We+=3){const nt=Y[We-2],Tt=Y[We-1],gt=Y[We];let wt=ce[nt]<pe,qt=ce[Tt]<pe,xt=ce[gt]<pe;be.vertexLength+((wt?1:0)+(qt?1:0)+(xt?1:0))>mr.MAX_VERTEX_ARRAY_LENGTH&&(be=F.createNewSegment(U,Z),pe=Re.count,wt=!0,qt=!0,xt=!0,Ue=0);const St=Ql(ce,H,ie,Re,nt,wt,be),et=Ql(ce,H,ie,Re,Tt,qt,be),ir=Ql(ce,H,ie,Re,gt,xt,be);Z.emplaceBack(Ue+St-pe,Ue+et-pe,Ue+ir-pe),be.primitiveLength++}})(t,r,c,f,_,i),A&&(function(F,U,Z,H,Y,ie){const ce=[];for(let We=0;We<H.length/2;We++)ce.push(-1);const Re={count:0};let pe=0,be=F.getOrCreateLatestSegment(U,Z),Ue=be.vertexLength;for(let We=0;We<Y.length;We++){const nt=Y[We];for(let Tt=1;Tt<Y[We].length;Tt+=2){const gt=nt[Tt-1],wt=nt[Tt];let qt=ce[gt]<pe,xt=ce[wt]<pe;be.vertexLength+((qt?1:0)+(xt?1:0))>mr.MAX_VERTEX_ARRAY_LENGTH&&(be=F.createNewSegment(U,Z),pe=Re.count,qt=!0,xt=!0,Ue=0);const St=Ql(ce,H,ie,Re,gt,qt,be),et=Ql(ce,H,ie,Re,wt,xt,be);Z.emplaceBack(Ue+St-pe,Ue+et-pe),be.primitiveLength++}}})(v,r,T,f,E,i),t.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function Ql(i,t,r,c,f,_,v){if(_){const T=c.count;return r(t[2*f],t[2*f+1]),i[f]=c.count,c.count++,v.vertexLength++,T}return i[f]}class od{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $e,this.indexArray=new nn,this.indexArray2=new Qr,this.programConfigurations=new ns(t.layers,t.zoom),this.segments=new mr,this.segments2=new mr,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){this.hasPattern=nf("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),_=!f.isConstant(),v=[];for(const{feature:T,id:E,index:I,sourceLayerIndex:A}of t){const F=this.layers[0]._featureFilter.needGeometry,U=Yo(T,F);if(!this.layers[0]._featureFilter.filter(new Wr(this.zoom,{globalState:this.globalState}),U,c))continue;const Z=_?f.evaluate(U,{},c,r.availableImages):void 0,H={id:E,properties:T.properties,type:T.type,sourceLayerIndex:A,index:I,geometry:F?U.geometry:So(T),patterns:{},sortKey:Z};v.push(H)}_&&v.sort(((T,E)=>T.sortKey-E.sortKey));for(const T of v){const{geometry:E,index:I,sourceLayerIndex:A}=T;if(this.hasPattern){const F=vp("fill",this.layers,T,{zoom:this.zoom,globalState:this.globalState},r);this.patternFeatures.push(F)}else this.addFeature(T,E,I,c,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,E,I,A,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:c,globalState:this.globalState})}addFeatures(t,r,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_p),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,c,f,_,v){for(const T of Al(r,500)){const E=qc(T,f,v.fill.getGranularityForZoomLevel(f.z)),I=this.layoutVertexArray;Yl(((A,F)=>{I.emplaceBack(A,F)}),this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{imagePositions:_,canonical:f,globalState:this.globalState})}}let Zu,Ts;Et("FillBucket",od,{omit:["layers","patternFeatures"]});var Tp={get paint(){return Ts=Ts||new fi({"fill-antialias":new Lt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new Yt(Pe.paint_fill["fill-opacity"]),"fill-color":new Yt(Pe.paint_fill["fill-color"]),"fill-outline-color":new Yt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Lt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wo(Pe.paint_fill["fill-pattern"])})},get layout(){return Zu=Zu||new fi({"fill-sort-key":new Yt(Pe.layout_fill["fill-sort-key"])})}};class Gu extends pi{constructor(t){super(t,Tp)}recalculate(t,r){super.recalculate(t,r);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new od(t)}queryRadius(){return Ou(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:c,pixelsToTileUnits:f}){return Cm(Yh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,f),r)}isTileClipped(){return!0}}const rl=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sf=wn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Pp}=rl;class eo{constructor(t,r,c,f,_){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=f,this._values=_,t.readFields(of,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,c=[];let f,_=1,v=0,T=0,E=0;for(;t.pos<r;){if(v<=0){const I=t.readVarint();_=7&I,v=I>>3}if(v--,_===1||_===2)T+=t.readSVarint(),E+=t.readSVarint(),_===1&&(f&&c.push(f),f=[]),f&&f.push(new L(T,E));else{if(_!==7)throw new Error(`unknown command ${_}`);f&&f.push(f[0].clone())}}return f&&c.push(f),c}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let c=1,f=0,_=0,v=0,T=1/0,E=-1/0,I=1/0,A=-1/0;for(;t.pos<r;){if(f<=0){const F=t.readVarint();c=7&F,f=F>>3}if(f--,c===1||c===2)_+=t.readSVarint(),v+=t.readSVarint(),_<T&&(T=_),_>E&&(E=_),v<I&&(I=v),v>A&&(A=v);else if(c!==7)throw new Error(`unknown command ${c}`)}return[T,I,E,A]}toGeoJSON(t,r,c){const f=this.extent*Math.pow(2,c),_=this.extent*t,v=this.extent*r,T=this.loadGeometry();function E(U){return[360*(U.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+v)/f)*Math.PI))-90]}function I(U){return U.map(E)}let A;if(this.type===1){const U=[];for(const H of T)U.push(H[0]);const Z=I(U);A=U.length===1?{type:"Point",coordinates:Z[0]}:{type:"MultiPoint",coordinates:Z}}else if(this.type===2){const U=T.map(I);A=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=(function(H){const Y=H.length;if(Y<=1)return[H];const ie=[];let ce,Re;for(let pe=0;pe<Y;pe++){const be=Jl(H[pe]);be!==0&&(Re===void 0&&(Re=be<0),Re===be<0?(ce&&ie.push(ce),ce=[H[pe]]):ce&&ce.push(H[pe]))}return ce&&ie.push(ce),ie})(T),Z=[];for(const H of U)Z.push(H.map(I));A=Z.length===1?{type:"Polygon",coordinates:Z[0]}:{type:"MultiPolygon",coordinates:Z}}}const F={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function of(i,t,r){i===1?t.id=r.readVarint():i===2?(function(c,f){const _=c.readVarint()+c.pos;for(;c.pos<_;){const v=f._keys[c.readVarint()],T=f._values[c.readVarint()];f.properties[v]=T}})(r,t):i===3?t.type=r.readVarint():i===4&&(t._geometry=r.pos)}function Jl(i){let t=0;for(let r,c,f=0,_=i.length,v=_-1;f<_;v=f++)r=i[f],c=i[v],t+=(c.x-r.x)*(r.y+c.y);return t}eo.types=["Unknown","Point","LineString","Polygon"];class ad{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ld,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new eo(this._pbf,r,this.extent,this._keys,this._values)}}function ld(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push((function(c){let f=null;const _=c.readVarint()+c.pos;for(;c.pos<_;){const v=c.readVarint()>>3;f=v===1?c.readString():v===2?c.readFloat():v===3?c.readDouble():v===4?c.readVarint64():v===5?c.readVarint():v===6?c.readSVarint():v===7?c.readBoolean():null}if(f==null)throw new Error("unknown feature value");return f})(r))}class af{constructor(t,r){this.layers=t.readFields(lf,{},r)}}function lf(i,t,r){if(i===3){const c=new ad(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}const qu=Math.pow(2,13);function mi(i,t,r,c,f,_,v,T){i.emplaceBack(t,r,2*Math.floor(c*qu)+v,f*qu*2,_*qu*2,Math.round(T))}class Ia{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new je,this.centroidVertexArray=new he,this.indexArray=new nn,this.programConfigurations=new ns(t.layers,t.zoom),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){this.features=[],this.hasPattern=nf("fill-extrusion",this.layers,r);for(const{feature:f,id:_,index:v,sourceLayerIndex:T}of t){const E=this.layers[0]._featureFilter.needGeometry,I=Yo(f,E);if(!this.layers[0]._featureFilter.filter(new Wr(this.zoom,{globalState:this.globalState}),I,c))continue;const A={id:_,sourceLayerIndex:T,index:v,geometry:E?I.geometry:So(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(vp("fill-extrusion",this.layers,A,{zoom:this.zoom,globalState:this.globalState},r)):this.addFeature(A,A.geometry,v,c,{},r.subdivisionGranularity),r.featureIndex.insert(f,A.geometry,v,T,this.index,!0)}}addFeatures(t,r,c){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,r,c,t.subdivisionGranularity)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:c,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,sf.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,c,f,_,v){for(const T of Al(r,500)){const E={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(E,f,t,T,v);const A=this.layoutVertexArray.length-I,F=Math.floor(E.x/E.sampleCount),U=Math.floor(E.y/E.sampleCount);for(let Z=0;Z<A;Z++)this.centroidVertexArray.emplaceBack(F,U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{imagePositions:_,canonical:f,globalState:this.globalState})}processPolygon(t,r,c,f,_){if(f.length<1||Cp(f[0]))return;for(const F of f)F.length!==0&&Jo(t,F);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=_.fill.getGranularityForZoomLevel(r.z),E=eo.types[c.type]==="Polygon";for(const F of f){if(F.length===0||Cp(F))continue;const U=Tn(F,T,E);this._generateSideFaces(U,v)}if(!E)return;const I=qc(f,r,T,!1),A=this.layoutVertexArray;Yl(((F,U)=>{mi(A,F,U,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(t,r){let c=0;for(let f=1;f<t.length;f++){const _=t[f],v=t[f-1];if(Fs(_,v))continue;r.segment.vertexLength+4>mr.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const T=_.sub(v)._perp()._unit(),E=v.dist(_);c+E>32768&&(c=0),mi(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,0,c),mi(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,1,c),c+=E,mi(this.layoutVertexArray,v.x,v.y,T.x,T.y,0,0,c),mi(this.layoutVertexArray,v.x,v.y,T.x,T.y,0,1,c);const I=r.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Jo(i,t){for(let r=0;r<t.length;r++){const c=t[r];r===t.length-1&&t[0].x===c.x&&t[0].y===c.y||(i.x+=c.x,i.y+=c.y,i.sampleCount++)}}function Fs(i,t){return i.x===t.x&&(i.x<0||i.x>ht)||i.y===t.y&&(i.y<0||i.y>ht)}function Cp(i){return i.every((t=>t.x<0))||i.every((t=>t.x>ht))||i.every((t=>t.y<0))||i.every((t=>t.y>ht))}let cf;Et("FillExtrusionBucket",Ia,{omit:["layers","features"]});var Ep={get paint(){return cf=cf||new fi({"fill-extrusion-opacity":new Lt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wo(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Lt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class iy extends pi{constructor(t){super(t,Ep)}createBucket(t){return new Ia(t)}queryRadius(){return Ou(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:c,geometry:f,transform:_,pixelsToTileUnits:v,pixelPosMatrix:T}){const E=Yh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,v),I=this.paint.get("fill-extrusion-height").evaluate(r,c),A=this.paint.get("fill-extrusion-base").evaluate(r,c),F=(function(Z,H){const Y=[];for(const ie of Z){const ce=[ie.x,ie.y,0,1];Ht(ce,ce,H),Y.push(new L(ce[0]/ce[3],ce[1]/ce[3]))}return Y})(E,T),U=(function(Z,H,Y,ie){const ce=[],Re=[],pe=ie[8]*H,be=ie[9]*H,Ue=ie[10]*H,We=ie[11]*H,nt=ie[8]*Y,Tt=ie[9]*Y,gt=ie[10]*Y,wt=ie[11]*Y;for(const qt of Z){const xt=[],St=[];for(const et of qt){const ir=et.x,gr=et.y,er=ie[0]*ir+ie[4]*gr+ie[12],Nt=ie[1]*ir+ie[5]*gr+ie[13],jr=ie[2]*ir+ie[6]*gr+ie[14],On=ie[3]*ir+ie[7]*gr+ie[15],yi=jr+Ue,os=On+We,ta=er+nt,ro=Nt+Tt,Zi=jr+gt,In=On+wt,Pi=new L((er+pe)/os,(Nt+be)/os);Pi.z=yi/os,xt.push(Pi);const Gi=new L(ta/In,ro/In);Gi.z=Zi/In,St.push(Gi)}ce.push(xt),Re.push(St)}return[ce,Re]})(f,A,I,T);return(function(Z,H,Y){let ie=1/0;Cm(Y,H)&&(ie=kp(Y,H[0]));for(let ce=0;ce<H.length;ce++){const Re=H[ce],pe=Z[ce];for(let be=0;be<Re.length-1;be++){const Ue=Re[be],We=[Ue,Re[be+1],pe[be+1],pe[be],Ue];cp(Y,We)&&(ie=Math.min(ie,kp(Y,We)))}}return ie!==1/0&&ie})(U[0],U[1],F)}}function To(i,t){return i.x*t.x+i.y*t.y}function kp(i,t){if(i.length===1){let r=0;const c=t[r++];let f;for(;!f||c.equals(f);)if(f=t[r++],!f)return 1/0;for(;r<t.length;r++){const _=t[r],v=i[0],T=f.sub(c),E=_.sub(c),I=v.sub(c),A=To(T,T),F=To(T,E),U=To(E,E),Z=To(I,T),H=To(I,E),Y=A*U-F*F,ie=(U*Z-F*H)/Y,ce=(A*H-F*Z)/Y,Re=c.z*(1-ie-ce)+f.z*ie+_.z*ce;if(isFinite(Re))return Re}return 1/0}{let r=1/0;for(const c of t)r=Math.min(r,c.z);return r}}const Mp=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Wc}=Mp,Ip=wn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Hc}=Ip,Bm=Math.cos(Math.PI/180*37.5),Ap=Math.pow(2,14)/.5;class cd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new Ne,this.layoutVertexArray2=new Ze,this.indexArray=new nn,this.programConfigurations=new ns(t.layers,t.zoom),this.segments=new mr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){this.hasPattern=nf("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),_=!f.isConstant(),v=[];for(const{feature:T,id:E,index:I,sourceLayerIndex:A}of t){const F=this.layers[0]._featureFilter.needGeometry,U=Yo(T,F);if(!this.layers[0]._featureFilter.filter(new Wr(this.zoom,{globalState:this.globalState}),U,c))continue;const Z=_?f.evaluate(U,{},c):void 0,H={id:E,properties:T.properties,type:T.type,sourceLayerIndex:A,index:I,geometry:F?U.geometry:So(T),patterns:{},sortKey:Z};v.push(H)}_&&v.sort(((T,E)=>T.sortKey-E.sortKey));for(const T of v){const{geometry:E,index:I,sourceLayerIndex:A}=T;if(this.hasPattern){const F=vp("line",this.layers,T,{zoom:this.zoom,globalState:this.globalState},r);this.patternFeatures.push(F)}else this.addFeature(T,E,I,c,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,E,I,A,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:c,globalState:this.globalState})}addFeatures(t,r,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Hc)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,c,f,_,v){const T=this.layers[0].layout,E=T.get("line-join").evaluate(t,{}),I=T.get("line-cap"),A=T.get("line-miter-limit"),F=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const U of r)this.addLine(U,t,E,I,A,F,f,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{imagePositions:_,canonical:f,globalState:this.globalState})}addLine(t,r,c,f,_,v,T,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Tn(t,T?E.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<t.length-1;pe++)this.totalDistance+=t[pe].dist(t[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=eo.types[r.type]==="Polygon";let A=t.length;for(;A>=2&&t[A-1].equals(t[A-2]);)A--;let F=0;for(;F<A-1&&t[F].equals(t[F+1]);)F++;if(A<(I?3:2))return;c==="bevel"&&(_=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let H,Y,ie,ce,Re;this.e1=this.e2=-1,I&&(H=t[A-2],Re=t[F].sub(H)._unit()._perp());for(let pe=F;pe<A;pe++){if(ie=pe===A-1?I?t[F+1]:void 0:t[pe+1],ie&&t[pe].equals(ie))continue;Re&&(ce=Re),H&&(Y=H),H=t[pe],Re=ie?ie.sub(H)._unit()._perp():ce,ce=ce||Re;let be=ce.add(Re);be.x===0&&be.y===0||be._unit();const Ue=ce.x*Re.x+ce.y*Re.y,We=be.x*Re.x+be.y*Re.y,nt=We!==0?1/We:1/0,Tt=2*Math.sqrt(2-2*We),gt=We<Bm&&Y&&ie,wt=ce.x*Re.y-ce.y*Re.x>0;if(gt&&pe>F){const St=H.dist(Y);if(St>2*U){const et=H.sub(H.sub(Y)._mult(U/St)._round());this.updateDistance(Y,et),this.addCurrentVertex(et,ce,0,0,Z),Y=et}}const qt=Y&&ie;let xt=qt?c:I?"butt":f;if(qt&&xt==="round"&&(nt<v?xt="miter":nt<=2&&(xt="fakeround")),xt==="miter"&&nt>_&&(xt="bevel"),xt==="bevel"&&(nt>2&&(xt="flipbevel"),nt<_&&(xt="miter")),Y&&this.updateDistance(Y,H),xt==="miter")be._mult(nt),this.addCurrentVertex(H,be,0,0,Z);else if(xt==="flipbevel"){if(nt>100)be=Re.mult(-1);else{const St=nt*ce.add(Re).mag()/ce.sub(Re).mag();be._perp()._mult(St*(wt?-1:1))}this.addCurrentVertex(H,be,0,0,Z),this.addCurrentVertex(H,be.mult(-1),0,0,Z)}else if(xt==="bevel"||xt==="fakeround"){const St=-Math.sqrt(nt*nt-1),et=wt?St:0,ir=wt?0:St;if(Y&&this.addCurrentVertex(H,ce,et,ir,Z),xt==="fakeround"){const gr=Math.round(180*Tt/Math.PI/20);for(let er=1;er<gr;er++){let Nt=er/gr;if(Nt!==.5){const On=Nt-.5;Nt+=Nt*On*(Nt-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*On*On+(.848013+Ue*(.215638*Ue-1.06021)))}const jr=Re.sub(ce)._mult(Nt)._add(ce)._unit()._mult(wt?-1:1);this.addHalfVertex(H,jr.x,jr.y,!1,wt,0,Z)}}ie&&this.addCurrentVertex(H,Re,-et,-ir,Z)}else if(xt==="butt")this.addCurrentVertex(H,be,0,0,Z);else if(xt==="square"){const St=Y?1:-1;this.addCurrentVertex(H,be,St,St,Z)}else xt==="round"&&(Y&&(this.addCurrentVertex(H,ce,0,0,Z),this.addCurrentVertex(H,ce,1,1,Z,!0)),ie&&(this.addCurrentVertex(H,Re,-1,-1,Z,!0),this.addCurrentVertex(H,Re,0,0,Z)));if(gt&&pe<A-1){const St=H.dist(ie);if(St>2*U){const et=H.add(ie.sub(H)._mult(U/St)._round());this.updateDistance(H,et),this.addCurrentVertex(et,Re,0,0,Z),H=et}}}}addCurrentVertex(t,r,c,f,_,v=!1){const T=r.y*f-r.x,E=-r.y-r.x*f;this.addHalfVertex(t,r.x+r.y*c,r.y-r.x*c,v,!1,c,_),this.addHalfVertex(t,T,E,v,!0,-f,_),this.distance>Ap/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,c,f,_,v))}addHalfVertex({x:t,y:r},c,f,_,v,T,E){const I=.5*(this.lineClips?this.scaledDistance*(Ap-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(r<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(T===0?0:T<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),E.primitiveLength++),v?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let ud,$m;Et("LineBucket",cd,{omit:["layers","patternFeatures"]});var Um={get paint(){return $m=$m||new fi({"line-opacity":new Yt(Pe.paint_line["line-opacity"]),"line-color":new Yt(Pe.paint_line["line-color"]),"line-translate":new Lt(Pe.paint_line["line-translate"]),"line-translate-anchor":new Lt(Pe.paint_line["line-translate-anchor"]),"line-width":new Yt(Pe.paint_line["line-width"]),"line-gap-width":new Yt(Pe.paint_line["line-gap-width"]),"line-offset":new Yt(Pe.paint_line["line-offset"]),"line-blur":new Yt(Pe.paint_line["line-blur"]),"line-dasharray":new xo(Pe.paint_line["line-dasharray"]),"line-pattern":new Wo(Pe.paint_line["line-pattern"]),"line-gradient":new Hl(Pe.paint_line["line-gradient"])})},get layout(){return ud=ud||new fi({"line-cap":new Lt(Pe.layout_line["line-cap"]),"line-join":new Yt(Pe.layout_line["line-join"]),"line-miter-limit":new Lt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Lt(Pe.layout_line["line-round-limit"]),"line-sort-key":new Yt(Pe.layout_line["line-sort-key"])})}};class Vm extends Yt{possiblyEvaluate(t,r){return r=new Wr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,c,f){return r=sr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,c,f)}}let hd;class Kc extends pi{constructor(t){super(t,Um),this.gradientVersion=0,hd||(hd=new Vm(Um.paint.properties["line-width"].specification),hd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(c){return c._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof pn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=hd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new cd(t)}queryRadius(t){const r=t,c=Zm(Fu("line-width",this,r),Fu("line-gap-width",this,r)),f=Fu("line-offset",this,r);return c/2+Math.abs(f)+Ou(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:c,geometry:f,transform:_,pixelsToTileUnits:v}){const T=Yh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,v),E=v/2*Zm(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),I=this.paint.get("line-offset").evaluate(r,c);return I&&(f=(function(A,F){const U=[];for(let Z=0;Z<A.length;Z++){const H=A[Z],Y=[];for(let ie=0;ie<H.length;ie++){const ce=H[ie-1],Re=H[ie],pe=H[ie+1],be=ie===0?new L(0,0):Re.sub(ce)._unit()._perp(),Ue=ie===H.length-1?new L(0,0):pe.sub(Re)._unit()._perp(),We=be._add(Ue)._unit(),nt=We.x*Ue.x+We.y*Ue.y;nt!==0&&We._mult(1/nt),Y.push(We._mult(F)._add(Re))}U.push(Y)}return U})(f,I*v)),(function(A,F,U){for(let Z=0;Z<F.length;Z++){const H=F[Z];if(A.length>=3){for(let Y=0;Y<H.length;Y++)if(Vc(A,H[Y]))return!0}if(Ds(A,H,U))return!0}return!1})(T,f,E)}isTileClipped(){return!0}}function Zm(i,t){return t>0?t+2*i:i}const Wu=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gm=wn([{name:"a_projected_pos",components:3,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $n=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);wn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qm=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wm=wn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function sy(i,t,r){return i.sections.forEach((c=>{c.text=(function(f,_,v){const T=_.layout.get("text-transform").evaluate(v,{});return T==="uppercase"?f=f.toLocaleUpperCase():T==="lowercase"&&(f=f.toLocaleLowerCase()),Is.applyArabicShaping&&(f=Is.applyArabicShaping(f)),f})(c.text,t,r)})),i}wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const dd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Jn=24;const uf=4294967296,Hm=1/uf,to=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class fd{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,c=this.length){for(;this.pos<c;){const f=this.readVarint(),_=f>>3,v=this.pos;this.type=7&f,t(_,r,this),this.pos===v&&this.skip(f)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*uf;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*uf;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const r=this.buf;let c,f;return f=r[this.pos++],c=127&f,f<128?c:(f=r[this.pos++],c|=(127&f)<<7,f<128?c:(f=r[this.pos++],c|=(127&f)<<14,f<128?c:(f=r[this.pos++],c|=(127&f)<<21,f<128?c:(f=r[this.pos],c|=(15&f)<<28,(function(_,v,T){const E=T.buf;let I,A;if(A=E[T.pos++],I=(112&A)>>4,A<128||(A=E[T.pos++],I|=(127&A)<<3,A<128)||(A=E[T.pos++],I|=(127&A)<<10,A<128)||(A=E[T.pos++],I|=(127&A)<<17,A<128)||(A=E[T.pos++],I|=(127&A)<<24,A<128)||(A=E[T.pos++],I|=(1&A)<<31,A<128))return Hu(_,I,v);throw new Error("Expected varint not more than 10 bytes")})(c,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&to?to.decode(this.buf.subarray(r,t)):(function(c,f,_){let v="",T=f;for(;T<_;){const E=c[T];let I,A,F,U=null,Z=E>239?4:E>223?3:E>191?2:1;if(T+Z>_)break;Z===1?E<128&&(U=E):Z===2?(I=c[T+1],(192&I)==128&&(U=(31&E)<<6|63&I,U<=127&&(U=null))):Z===3?(I=c[T+1],A=c[T+2],(192&I)==128&&(192&A)==128&&(U=(15&E)<<12|(63&I)<<6|63&A,(U<=2047||U>=55296&&U<=57343)&&(U=null))):Z===4&&(I=c[T+1],A=c[T+2],F=c[T+3],(192&I)==128&&(192&A)==128&&(192&F)==128&&(U=(15&E)<<18|(63&I)<<12|(63&A)<<6|63&F,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,Z=1):U>65535&&(U-=65536,v+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),v+=String.fromCharCode(U),T+=Z}return v})(this.buf,r,t)}readBytes(){const t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){const c=this.readPackedEnd();for(;this.pos<c;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const r=7&t;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){const c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Hm),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Hm),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(r,c){let f,_;if(r>=0?(f=r%4294967296|0,_=r/4294967296|0):(f=~(-r%4294967296),_=~(-r/4294967296),4294967295^f?f=f+1|0:(f=0,_=_+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),(function(v,T,E){E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,E.buf[E.pos]=127&(v>>>=7)})(f,0,c),(function(v,T){const E=(7&v)<<4;T.buf[T.pos++]|=E|((v>>>=3)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v)))))})(_,c)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const r=this.pos;this.pos=(function(f,_,v){for(let T,E,I=0;I<_.length;I++){if(T=_.charCodeAt(I),T>55295&&T<57344){if(!E){T>56319||I+1===_.length?(f[v++]=239,f[v++]=191,f[v++]=189):E=T;continue}if(T<56320){f[v++]=239,f[v++]=191,f[v++]=189,E=T;continue}T=E-55296<<10|T-56320|65536,E=null}else E&&(f[v++]=239,f[v++]=191,f[v++]=189,E=null);T<128?f[v++]=T:(T<2048?f[v++]=T>>6|192:(T<65536?f[v++]=T>>12|224:(f[v++]=T>>18|240,f[v++]=T>>12&63|128),f[v++]=T>>6&63|128),f[v++]=63&T|128)}return v})(this.buf,t,this.pos);const c=this.pos-r;c>=128&&nl(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const r=t.length;this.writeVarint(r),this.realloc(r);for(let c=0;c<r;c++)this.buf[this.pos++]=t[c]}writeRawMessage(t,r){this.pos++;const c=this.pos;t(r,this);const f=this.pos-c;f>=128&&nl(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f}writeMessage(t,r,c){this.writeTag(t,2),this.writeRawMessage(r,c)}writePackedVarint(t,r){r.length&&this.writeMessage(t,hf,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,Xc,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,Rp,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,df,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,zp,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,oy,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,Dp,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,ay,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,Km,r)}writeBytesField(t,r){this.writeTag(t,2),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,5),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,5),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,1),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,1),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,0),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,0),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,2),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,5),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,1),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}}function Hu(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function nl(i,t,r){const c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(let f=r.pos-1;f>=i;f--)r.buf[f+c]=r.buf[f]}function hf(i,t){for(let r=0;r<i.length;r++)t.writeVarint(i[r])}function Xc(i,t){for(let r=0;r<i.length;r++)t.writeSVarint(i[r])}function df(i,t){for(let r=0;r<i.length;r++)t.writeFloat(i[r])}function zp(i,t){for(let r=0;r<i.length;r++)t.writeDouble(i[r])}function Rp(i,t){for(let r=0;r<i.length;r++)t.writeBoolean(i[r])}function oy(i,t){for(let r=0;r<i.length;r++)t.writeFixed32(i[r])}function Dp(i,t){for(let r=0;r<i.length;r++)t.writeSFixed32(i[r])}function ay(i,t){for(let r=0;r<i.length;r++)t.writeFixed64(i[r])}function Km(i,t){for(let r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Xm(i,t,r){i===1&&r.readMessage(ff,t)}function ff(i,t,r){if(i===3){const{id:c,bitmap:f,width:_,height:v,left:T,top:E,advance:I}=r.readMessage(pf,{});t.push({id:c,bitmap:new Qs({width:_+6,height:v+6},f),metrics:{width:_,height:v,left:T,top:E,advance:I}})}}function pf(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}function Lp(i){let t=0,r=0;for(const v of i)t+=v.w*v.h,r=Math.max(r,v.w);i.sort(((v,T)=>T.h-v.h));const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let f=0,_=0;for(const v of i)for(let T=c.length-1;T>=0;T--){const E=c[T];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,_=Math.max(_,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===E.w&&v.h===E.h){const I=c.pop();I&&T<c.length&&(c[T]=I)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(c.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:f,h:_,fill:t/(f*_)||0}}class pd{constructor(t,{pixelRatio:r,version:c,stretchX:f,stretchY:_,content:v,textFitWidth:T,textFitHeight:E}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=f,this.stretchY=_,this.content=v,this.version=c,this.textFitWidth=T,this.textFitHeight=E}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ym{constructor(t,r){const c={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,c,_),this.addImages(r,f,_);const{w:v,h:T}=Lp(_),E=new ws({width:v||1,height:T||1});for(const I in t){const A=t[I],F=c[I].paddedRect;ws.copy(A.data,E,{x:0,y:0},{x:F.x+1,y:F.y+1},A.data)}for(const I in r){const A=r[I],F=f[I].paddedRect,U=F.x+1,Z=F.y+1,H=A.data.width,Y=A.data.height;ws.copy(A.data,E,{x:0,y:0},{x:U,y:Z},A.data),ws.copy(A.data,E,{x:0,y:Y-1},{x:U,y:Z-1},{width:H,height:1}),ws.copy(A.data,E,{x:0,y:0},{x:U,y:Z+Y},{width:H,height:1}),ws.copy(A.data,E,{x:H-1,y:0},{x:U-1,y:Z},{width:1,height:Y}),ws.copy(A.data,E,{x:0,y:0},{x:U+H,y:Z},{width:1,height:Y})}this.image=E,this.iconPositions=c,this.patternPositions=f}addImages(t,r,c){for(const f in t){const _=t[f],v={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(v),r[f]=new pd(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),r),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),r)}patchUpdatedImage(t,r,c){if(!t||!r||t.version===r.version)return;t.version=r.version;const[f,_]=t.tl;c.update(r.data,void 0,{x:f,y:_})}}var il;Et("ImagePosition",pd),Et("ImageAtlas",Ym),w.ao=void 0,(il=w.ao||(w.ao={}))[il.none=0]="none",il[il.horizontal=1]="horizontal",il[il.vertical=2]="vertical",il[il.horizontalOnly=3]="horizontalOnly";class Yc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,c){const f=new Yc;return f.scale=t||1,f.fontStack=r,f.verticalAlign=c||"bottom",f}static forImage(t,r){const c=new Yc;return c.imageName=t,c.verticalAlign=r||"bottom",c}}class sl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const c=new sl;for(let f=0;f<t.sections.length;f++){const _=t.sections[f];_.image?c.addImageSection(_):c.addTextSection(_,r)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let c=0;c<t.length;c++){const f=t.charCodeAt(c+1)||null,_=t.charCodeAt(c-1)||null;r+=f&&Gh(f)&&!dd[t[c+1]]||_&&Gh(_)&&!dd[t[c-1]]||!dd[t[c]]?t[c]:dd[t[c]]}return r})(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&Qc[this.text.charCodeAt(c)];c++)t++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Qc[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const c=new sl;return c.text=this.text.substring(t,r),c.sectionIndex=this.sectionIndex.slice(t,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}getMaxImageSize(t){let r=0,c=0;for(let f=0;f<this.length();f++){const _=this.getSection(f);if(_.imageName){const v=t[_.imageName];if(!v)continue;const T=v.displaySize;r=Math.max(r,T[0]),c=Math.max(c,T[1])}}return{maxImageWidth:r,maxImageHeight:c}}addTextSection(t,r){this.text+=t.text,this.sections.push(Yc.forText(t.scale,t.fontStack||r,t.verticalAlign));const c=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(c)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Nr("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Yc.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Nr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ku(i,t,r,c,f,_,v,T,E,I,A,F,U,Z,H){const Y=sl.fromFeature(i,f);let ie;F===w.ao.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:ce,processStyledBidirectionalText:Re}=Is;if(ce&&Y.sections.length===1){ie=[];const Ue=ce(Y.toString(),a(Y,I,_,t,c,Z));for(const We of Ue){const nt=new sl;nt.text=We,nt.sections=Y.sections;for(let Tt=0;Tt<We.length;Tt++)nt.sectionIndex.push(0);ie.push(nt)}}else if(Re){ie=[];const Ue=Re(Y.text,Y.sectionIndex,a(Y,I,_,t,c,Z));for(const We of Ue){const nt=new sl;nt.text=We[0],nt.sectionIndex=We[1],nt.sections=Y.sections,ie.push(nt)}}else ie=(function(Ue,We){const nt=[],Tt=Ue.text;let gt=0;for(const wt of We)nt.push(Ue.substring(gt,wt)),gt=wt;return gt<Tt.length&&nt.push(Ue.substring(gt,Tt.length)),nt})(Y,a(Y,I,_,t,c,Z));const pe=[],be={positionedLines:pe,text:Y.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:F,iconsInText:!1,verticalizable:!1};return(function(Ue,We,nt,Tt,gt,wt,qt,xt,St,et,ir,gr){let er=0,Nt=0,jr=0,On=0;const yi=xt==="right"?1:xt==="left"?0:.5,os=Jn/gr;let ta=0;for(const In of gt){In.trim();const Pi=In.getMaxScale(),Gi={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[ta]=Gi;const qi=Gi.positionedGlyphs;let Os=0;if(!In.length()){Nt+=wt,++ta;continue}const ra=x(Tt,In,os);for(let no=0;no<In.length();no++){const _i=In.getSection(no),Ei=In.getSectionIndex(no),ki=In.getCharCode(no),si=z(St,ir,ki);let bn;if(_i.imageName){if(Ue.iconsInText=!0,_i.scale=_i.scale*os,bn=Q(_i,si,Pi,ra,Tt),!bn)continue;Os=Math.max(Os,bn.imageOffset)}else if(bn=O(_i,ki,si,ra,We,nt),!bn)continue;const{rect:al,metrics:yf,baselineOffset:ll}=bn;qi.push({glyph:ki,imageName:_i.imageName,x:er,y:Nt+ll+-17,vertical:si,scale:_i.scale,fontStack:_i.fontStack,sectionIndex:Ei,metrics:yf,rect:al}),si?(Ue.verticalizable=!0,er+=(_i.imageName?yf.advance:Jn)*_i.scale+et):er+=yf.advance*_i.scale+et}qi.length!==0&&(jr=Math.max(er-et,jr),me(qi,0,qi.length-1,yi)),er=0,Gi.lineOffset=Math.max(Os,(Pi-1)*Jn);const Ci=wt*Pi+Os;Nt+=Ci,On=Math.max(Ci,On),++ta}const{horizontalAlign:ro,verticalAlign:Zi}=d(qt);(function(In,Pi,Gi,qi,Os,ra,Ci,no,_i){const Ei=(Pi-Gi)*Os;let ki=0;ki=ra!==Ci?-no*qi- -17:-qi*_i*Ci+.5*Ci;for(const si of In)for(const bn of si.positionedGlyphs)bn.x+=Ei,bn.y+=ki})(Ue.positionedLines,yi,ro,Zi,jr,On,wt,Nt,gt.length),Ue.top+=-Zi*Nt,Ue.bottom=Ue.top+Nt,Ue.left+=-ro*jr,Ue.right=Ue.left+jr})(be,t,r,c,ie,v,T,E,F,I,U,H),!(function(Ue){for(const We of Ue)if(We.positionedGlyphs.length!==0)return!1;return!0})(pe)&&be}const Qc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ly={40:!0};function md(i,t,r,c,f,_){if(t.imageName){const v=c[t.imageName];return v?v.displaySize[0]*t.scale*Jn/_+f:0}{const v=r[t.fontStack],T=v&&v[i];return T?T.metrics.advance*t.scale+f:0}}function Jm(i,t,r,c){const f=Math.pow(i-t,2);return c?i<t?f/2:2*f:f+Math.abs(r)*r}function gd(i,t,r){let c=0;return i===10&&(c-=1e4),r&&(c+=150),i!==40&&i!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function eg(i,t,r,c,f,_){let v=null,T=Jm(t,r,f,_);for(const E of c){const I=Jm(t-E.x,r,f,_)+E.badness;I<=T&&(v=E,T=I)}return{index:i,x:t,priorBreak:v,badness:T}}function yd(i){return i?yd(i.priorBreak).concat(i.index):[]}function a(i,t,r,c,f,_){if(!i)return[];const v=[],T=(function(F,U,Z,H,Y,ie){let ce=0;for(let Re=0;Re<F.length();Re++){const pe=F.getSection(Re);ce+=md(F.getCharCode(Re),pe,H,Y,U,ie)}return ce/Math.max(1,Math.ceil(ce/Z))})(i,t,r,c,f,_),E=i.text.indexOf("​")>=0;let I=0;for(let F=0;F<i.length();F++){const U=i.getSection(F),Z=i.getCharCode(F);if(Qc[Z]||(I+=md(Z,U,c,f,t,_)),F<i.length()-1){const H=!((A=Z)<11904)&&(!!Fr["CJK Compatibility Forms"](A)||!!Fr["CJK Compatibility"](A)||!!Fr["CJK Strokes"](A)||!!Fr["CJK Symbols and Punctuation"](A)||!!Fr["Enclosed CJK Letters and Months"](A)||!!Fr["Halfwidth and Fullwidth Forms"](A)||!!Fr["Ideographic Description Characters"](A)||!!Fr["Vertical Forms"](A)||_s.test(String.fromCodePoint(A)));(Qm[Z]||H||U.imageName||F!==i.length()-2&&ly[i.getCharCode(F+1)])&&v.push(eg(F+1,I,T,v,gd(Z,i.getCharCode(F+1),H&&E),!1))}}var A;return yd(eg(i.length(),I,T,v,0,!0))}function d(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function x(i,t,r){const c=t.getMaxScale()*Jn,{maxImageWidth:f,maxImageHeight:_}=t.getMaxImageSize(i),v=Math.max(c,_*r);return{verticalLineContentWidth:Math.max(c,f*r),horizontalLineContentHeight:v}}function C(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function z(i,t,r){return!(i===w.ao.horizontal||!t&&!Iu(r)||t&&(Qc[r]||(c=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(c)))));var c}function O(i,t,r,c,f,_){const v=_[i.fontStack],T=(function(I,A,F,U){if(I&&I.rect)return I;const Z=A[F.fontStack],H=Z&&Z[U];return H?{rect:null,metrics:H.metrics}:null})(v&&v[t],f,i,t);if(T===null)return null;let E;if(r)E=c.verticalLineContentWidth-i.scale*Jn;else{const I=C(i.verticalAlign);E=(c.horizontalLineContentHeight-i.scale*Jn)*I}return{rect:T.rect,metrics:T.metrics,baselineOffset:E}}function Q(i,t,r,c,f){const _=f[i.imageName];if(!_)return null;const v=_.paddedRect,T=_.displaySize,E={width:T[0],height:T[1],left:1,top:-3,advance:t?T[1]:T[0]};let I;if(t)I=c.verticalLineContentWidth-T[1]*i.scale;else{const A=C(i.verticalAlign);I=(c.horizontalLineContentHeight-T[1]*i.scale)*A}return{rect:v,metrics:E,baselineOffset:I,imageOffset:(t?T[0]:T[1])*i.scale-Jn*r}}function me(i,t,r,c){if(c===0)return;const f=i[r],_=(i[r].x+f.metrics.advance*f.scale)*c;for(let v=t;v<=r;v++)i[v].x-=_}function ke(i,t,r){const{horizontalAlign:c,verticalAlign:f}=d(r),_=t[0]-i.displaySize[0]*c,v=t[1]-i.displaySize[1]*f;return{image:i,top:v,bottom:v+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function He(i){var t,r;let c=i.left,f=i.top,_=i.right-c,v=i.bottom-f;const T=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",E=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(E==="proportional"){if(T==="stretchOnly"&&_/v<I||T==="proportional"){const A=Math.ceil(v*I);c*=A/_,_=A}}else if(T==="proportional"&&E==="stretchOnly"&&I!==0&&_/v>I){const A=Math.ceil(_/I);f*=A/v,v=A}return{x1:c,y1:f,x2:c+_,y2:f+v}}function ut(i,t,r,c,f,_){const v=i.image;let T;if(v.content){const ie=v.content,ce=v.pixelRatio||1;T=[ie[0]/ce,ie[1]/ce,v.displaySize[0]-ie[2]/ce,v.displaySize[1]-ie[3]/ce]}const E=t.left*_,I=t.right*_;let A,F,U,Z;r==="width"||r==="both"?(Z=f[0]+E-c[3],F=f[0]+I+c[1]):(Z=f[0]+(E+I-v.displaySize[0])/2,F=Z+v.displaySize[0]);const H=t.top*_,Y=t.bottom*_;return r==="height"||r==="both"?(A=f[1]+H-c[0],U=f[1]+Y+c[2]):(A=f[1]+(H+Y-v.displaySize[1])/2,U=A+v.displaySize[1]),{image:v,top:A,right:F,bottom:U,left:Z,collisionPadding:T}}const lt=128,ot=32640;function Ot(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Wr(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=r;let _=0;for(;_<c.length&&c[_]<=i;)_++;_=Math.max(0,_-1);let v=_;for(;v<c.length&&c[v]<i+1;)v++;v=Math.min(c.length-1,v);const T=c[_],E=c[v];return r.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:T,maxZoom:E,minSize:r.evaluate(new Wr(T)),maxSize:r.evaluate(new Wr(E)),interpolationType:f}}}function Vt(i,t,r){let c="never";const f=i.get(t);return f?c=f:i.get(r)&&(c="always"),c}const Qt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mn(i,t,r,c,f,_,v,T,E,I,A,F,U){const Z=T?Math.min(ot,Math.round(T[0])):0,H=T?Math.min(ot,Math.round(T[1])):0;i.emplaceBack(t,r,Math.round(32*c),Math.round(32*f),_,v,(Z<<1)+(E?1:0),H,16*I,16*A,256*F,256*U)}function Ve(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function De(i){for(const t of i.sections)if(jc(t.text))return!0;return!1}class Ge{constructor(t){this.layoutVertexArray=new ft,this.indexArray=new nn,this.programConfigurations=t,this.segments=new mr,this.dynamicLayoutVertexArray=new tt,this.opacityVertexArray=new Ft,this.hasVisibleVertices=!1,this.placedSymbolArray=new W}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wu.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Gm.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Qt,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Et("SymbolBuffers",Ge);class bt{constructor(t,r,c){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new c,this.segments=new mr,this.collisionVertexArray=new Zr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$n.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Et("CollisionBuffers",bt);class Gt{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((v=>v.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ot(this.zoom,r["text-size"]),this.iconSizeData=Ot(this.zoom,r["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=Vt(c,"text-overlap","text-allow-overlap")!=="never"||Vt(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map((v=>w.ao[v]))),this.stateDependentLayerIds=this.layers.filter((v=>v.isStateDependent())).map((v=>v.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Ge(new ns(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Ge(new ns(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new oe,this.lineVertexArray=new ae,this.symbolInstances=new se,this.textAnchorOffsets=new le}calculateGlyphDependencies(t,r,c,f,_){for(let v=0;v<t.length;v++)if(r[t.charCodeAt(v)]=!0,(c||f)&&_){const T=dd[t.charAt(v)];T&&(r[T.charCodeAt(0)]=!0)}}populate(t,r,c){const f=this.layers[0],_=f.layout,v=_.get("text-font"),T=_.get("text-field"),E=_.get("icon-image"),I=(T.value.kind!=="constant"||T.value.value instanceof En&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),A=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,F=_.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const U=r.iconDependencies,Z=r.glyphDependencies,H=r.availableImages,Y=new Wr(this.zoom,{globalState:this.globalState});for(const{feature:ie,id:ce,index:Re,sourceLayerIndex:pe}of t){const be=f._featureFilter.needGeometry,Ue=Yo(ie,be);if(!f._featureFilter.filter(Y,Ue,c))continue;let We,nt;if(be||(Ue.geometry=So(ie)),I){const gt=f.getValueAndResolveTokens("text-field",Ue,c,H),wt=En.factory(gt),qt=this.hasRTLText=this.hasRTLText||De(wt);(!qt||Is.getRTLTextPluginStatus()==="unavailable"||qt&&Is.isParsed())&&(We=sy(wt,f,Ue))}if(A){const gt=f.getValueAndResolveTokens("icon-image",Ue,c,H);nt=gt instanceof ds?gt:ds.fromString(gt)}if(!We&&!nt)continue;const Tt=this.sortFeaturesByKey?F.evaluate(Ue,{},c):void 0;if(this.features.push({id:ce,text:We,icon:nt,index:Re,sourceLayerIndex:pe,geometry:Ue.geometry,properties:ie.properties,type:eo.types[ie.type],sortKey:Tt}),nt&&(U[nt.name]=!0),We){const gt=v.evaluate(Ue,{},c).join(","),wt=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ao.vertical)>=0;for(const qt of We.sections)if(qt.image)U[qt.image.name]=!0;else{const xt=Gl(We.toString()),St=qt.fontStack||gt,et=Z[St]=Z[St]||{};this.calculateGlyphDependencies(qt.text,et,wt,this.allowVerticalPlacement,xt)}}}_.get("symbol-placement")==="line"&&(this.features=(function(ie){const ce={},Re={},pe=[];let be=0;function Ue(gt){pe.push(ie[gt]),be++}function We(gt,wt,qt){const xt=Re[gt];return delete Re[gt],Re[wt]=xt,pe[xt].geometry[0].pop(),pe[xt].geometry[0]=pe[xt].geometry[0].concat(qt[0]),xt}function nt(gt,wt,qt){const xt=ce[wt];return delete ce[wt],ce[gt]=xt,pe[xt].geometry[0].shift(),pe[xt].geometry[0]=qt[0].concat(pe[xt].geometry[0]),xt}function Tt(gt,wt,qt){const xt=qt?wt[0][wt[0].length-1]:wt[0][0];return`${gt}:${xt.x}:${xt.y}`}for(let gt=0;gt<ie.length;gt++){const wt=ie[gt],qt=wt.geometry,xt=wt.text?wt.text.toString():null;if(!xt){Ue(gt);continue}const St=Tt(xt,qt),et=Tt(xt,qt,!0);if(St in Re&&et in ce&&Re[St]!==ce[et]){const ir=nt(St,et,qt),gr=We(St,et,pe[ir].geometry);delete ce[St],delete Re[et],Re[Tt(xt,pe[gr].geometry,!0)]=gr,pe[ir].geometry=null}else St in Re?We(St,et,qt):et in ce?nt(St,et,qt):(Ue(gt),ce[St]=be-1,Re[et]=be-1)}return pe.filter((gt=>gt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ie,ce)=>ie.sortKey-ce.sortKey))}update(t,r,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,{imagePositions:c,globalState:this.globalState}),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,{imagePositions:c,globalState:this.globalState}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const c=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(r[t.segment+1]),_=t.dist(r[t.segment]);const v={};for(let T=t.segment+1;T<r.length;T++)v[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:f},T<r.length-1&&(f+=r[T+1].dist(r[T]));for(let T=t.segment||0;T>=0;T--)v[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:_},T>0&&(_+=r[T-1].dist(r[T]));for(let T=0;T<r.length;T++){const E=v[T];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,r,c,f,_,v,T,E,I,A,F,U){const Z=t.indexArray,H=t.layoutVertexArray,Y=t.segments.prepareSegment(4*r.length,H,Z,this.canOverlap?v.sortKey:void 0),ie=this.glyphOffsetArray.length,ce=Y.vertexLength,Re=this.allowVerticalPlacement&&T===w.ao.vertical?Math.PI/2:0,pe=v.text&&v.text.sections;for(let be=0;be<r.length;be++){const{tl:Ue,tr:We,bl:nt,br:Tt,tex:gt,pixelOffsetTL:wt,pixelOffsetBR:qt,minFontScaleX:xt,minFontScaleY:St,glyphOffset:et,isSDF:ir,sectionIndex:gr}=r[be],er=Y.vertexLength,Nt=et[1];Mn(H,E.x,E.y,Ue.x,Nt+Ue.y,gt.x,gt.y,c,ir,wt.x,wt.y,xt,St),Mn(H,E.x,E.y,We.x,Nt+We.y,gt.x+gt.w,gt.y,c,ir,qt.x,wt.y,xt,St),Mn(H,E.x,E.y,nt.x,Nt+nt.y,gt.x,gt.y+gt.h,c,ir,wt.x,qt.y,xt,St),Mn(H,E.x,E.y,Tt.x,Nt+Tt.y,gt.x+gt.w,gt.y+gt.h,c,ir,qt.x,qt.y,xt,St),Ve(t.dynamicLayoutVertexArray,E,Re),Z.emplaceBack(er,er+2,er+1),Z.emplaceBack(er+1,er+2,er+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(et[0]),be!==r.length-1&&gr===r[be+1].sectionIndex||t.programConfigurations.populatePaintArrays(H.length,v,v.index,{imagePositions:{},canonical:U,formattedSection:pe&&pe[gr],globalState:this.globalState})}t.placedSymbolArray.emplaceBack(E.x,E.y,ie,this.glyphOffsetArray.length-ie,ce,I,A,E.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],T,0,!1,0,F)}_addCollisionDebugVertex(t,r,c,f,_,v){return r.emplaceBack(0,0),t.emplaceBack(c.x,c.y,f,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,r,c,f,_,v,T){const E=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),I=E.vertexLength,A=_.layoutVertexArray,F=_.collisionVertexArray,U=T.anchorX,Z=T.anchorY;this._addCollisionDebugVertex(A,F,v,U,Z,new L(t,r)),this._addCollisionDebugVertex(A,F,v,U,Z,new L(c,r)),this._addCollisionDebugVertex(A,F,v,U,Z,new L(c,f)),this._addCollisionDebugVertex(A,F,v,U,Z,new L(t,f)),E.vertexLength+=4;const H=_.indexArray;H.emplaceBack(I,I+1),H.emplaceBack(I+1,I+2),H.emplaceBack(I+2,I+3),H.emplaceBack(I+3,I),E.primitiveLength+=4}addDebugCollisionBoxes(t,r,c,f){for(let _=t;_<r;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bt(br,qm.members,Qr),this.iconCollisionBox=new bt(br,qm.members,Qr);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,c,f,_,v,T,E,I){const A={};for(let F=r;F<c;F++){const U=t.get(F);A.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},A.textFeatureIndex=U.featureIndex;break}for(let F=f;F<_;F++){const U=t.get(F);A.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},A.verticalTextFeatureIndex=U.featureIndex;break}for(let F=v;F<T;F++){const U=t.get(F);A.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},A.iconFeatureIndex=U.featureIndex;break}for(let F=E;F<I;F++){const U=t.get(F);A.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},A.verticalIconFeatureIndex=U.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const c=t.placedSymbolArray.get(r),f=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<f;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),c=Math.cos(t),f=[],_=[],v=[];for(let T=0;T<this.symbolInstances.length;++T){v.push(T);const E=this.symbolInstances.get(T);f.push(0|Math.round(r*E.anchorX+c*E.anchorY)),_.push(E.featureIndex)}return v.sort(((T,E)=>f[T]-f[E]||_[E]-_[T])),v}addToSortKeyRanges(t,r){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach(((f,_,v)=>{f>=0&&v.indexOf(f)===_&&this.addIndicesForPlacedSymbol(this.text,f)})),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let hr,dr;Et("SymbolBucket",Gt,{omit:["layers","collisionBoxArray","features","compareText"]}),Gt.MAX_GLYPHS=65535,Gt.addDynamicAttributes=Ve;var vr={get paint(){return dr=dr||new fi({"icon-opacity":new Yt(Pe.paint_symbol["icon-opacity"]),"icon-color":new Yt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new Yt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yt(Pe.paint_symbol["text-opacity"]),"text-color":new Yt(Pe.paint_symbol["text-color"],{runtimeType:ti,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Yt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Lt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Lt(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return hr=hr||new fi({"symbol-placement":new Lt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Lt(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Lt(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Lt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new Lt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(Pe.layout_symbol["icon-image"]),"icon-rotate":new Yt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Yt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new Yt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(Pe.layout_symbol["text-field"]),"text-font":new Yt(Pe.layout_symbol["text-font"]),"text-size":new Yt(Pe.layout_symbol["text-size"]),"text-max-width":new Yt(Pe.layout_symbol["text-max-width"]),"text-line-height":new Lt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new Yt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Yt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Yt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Lt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(Pe.layout_symbol["text-rotate"]),"text-padding":new Lt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Lt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new Yt(Pe.layout_symbol["text-transform"]),"text-offset":new Yt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Lt(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Lt(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Lt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Lt(Pe.layout_symbol["text-optional"])})}};class gi{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ao,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et("FormatSectionOverride",gi,{omit:["defaultValue"]});class Hr extends pi{constructor(t){super(t,vr)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const _ of c)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,c,f){const _=this.layout.get(t).evaluate(r,{},c,f),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||ba(v.value)||!_?_:(function(T,E){return E.replace(/{([^{}]+)}/g,((I,A)=>T&&A in T?String(T[A]):""))})(r.properties,_)}createBucket(t){return new Gt(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of vr.paint.overridableProperties){if(!Hr.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),c=new gi(r),f=new jl(c,r.property.specification);let _=null;_=r.value.kind==="constant"||r.value.kind==="source"?new qa("source",f):new Wa("composite",f,r.value.zoomStops),this.paint._values[t]=new Oi(r.property,_,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&Hr.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const c=t.get("text-field"),f=vr.paint.properties[r];let _=!1;const v=T=>{for(const E of T)if(f.overrides&&f.overrides.hasOverride(E))return void(_=!0)};if(c.value.kind==="constant"&&c.value.value instanceof En)v(c.value.value.sections);else if(c.value.kind==="source"||c.value.kind==="composite"){const T=I=>{_||(I instanceof fs&&nr(I.value)===Io?v(I.value.sections):I instanceof Ba?v(I.sections):I.eachChild(T))},E=c.value;E._styleExpression&&T(E._styleExpression.expression)}return _}}let ol;var cy={get paint(){return ol=ol||new fi({"background-color":new Lt(Pe.paint_background["background-color"]),"background-pattern":new xo(Pe.paint_background["background-pattern"]),"background-opacity":new Lt(Pe.paint_background["background-opacity"])})}};class U1 extends pi{constructor(t){super(t,cy)}}let pv;var V1={get paint(){return pv=pv||new fi({"raster-opacity":new Lt(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Lt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Lt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Lt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt(Pe.paint_raster["raster-fade-duration"])})}};class Z1 extends pi{constructor(t){super(t,V1)}}class G1 extends pi{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class q1{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const W1={once:!0},uy=63710088e-1;class Xu{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xu(Lr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,c=this.lat*r,f=t.lat*r,_=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((t.lng-this.lng)*r);return uy*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof Xu)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Xu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Xu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const mv=2*Math.PI*uy;function gv(i){return mv*Math.cos(i*Math.PI/180)}function yv(i){return(180+i)/360}function _v(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function vv(i,t){return i/gv(t)}function hy(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function xv(i,t){return i*gv(hy(t))}class Fp{constructor(t,r,c=0){this.x=+t,this.y=+r,this.z=+c}static fromLngLat(t,r=0){const c=Xu.convert(t);return new Fp(yv(c.lng),_v(c.lat),vv(r,c.lat))}toLngLat(){return new Xu(360*this.x-180,hy(this.y))}toAltitude(){return xv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/mv*(t=hy(this.y),1/Math.cos(t*Math.PI/180));var t}}function bv(i,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[i*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class dy{constructor(t,r,c){if(!(function(f,_,v){return!(f<0||f>25||v<0||v>=Math.pow(2,f)||_<0||_>=Math.pow(2,f))})(t,r,c))throw new Error(`x=${r}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=c,this.key=mf(0,t,t,r,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,c){const f=(v=this.y,T=this.z,E=bv(256*(_=this.x),256*(v=Math.pow(2,T)-v-1),T),I=bv(256*(_+1),256*(v+1),T),E[0]+","+E[1]+","+I[0]+","+I[1]);var _,v,T,E,I;const A=(function(F,U,Z){let H,Y="";for(let ie=F;ie>0;ie--)H=1<<ie-1,Y+=(U&H?1:0)+(Z&H?2:0);return Y})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new L((t.x*r-this.x)*ht,(t.y*r-this.y)*ht)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wv{constructor(t,r){this.wrap=t,this.canonical=r,this.key=mf(t,r.z,r.z,r.x,r.y)}}class ea{constructor(t,r,c,f,_){if(this.terrainRttPosMatrix32f=null,t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=r,this.canonical=new dy(c,+f,+_),this.key=mf(r,t,c,f,_)}clone(){return new ea(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new ea(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ea(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?mf(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):mf(this.wrap*+r,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new ea(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new ea(r,this.wrap,r,c,f),new ea(r,this.wrap,r,c+1,f),new ea(r,this.wrap,r,c,f+1),new ea(r,this.wrap,r,c+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ea(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ea(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Fp(t.x-this.wrap,t.y))}}function mf(i,t,r,c,f){(i*=2)<0&&(i=-1*i-1);const _=1<<r;return(_*_*i+_*f+c).toString(36)+r.toString(36)+t.toString(36)}function Op(i,t){return t?i.properties[t]:i.id}Et("CanonicalTileID",dy),Et("OverscaledTileID",ea,{omit:["terrainRttPosMatrix32f"]});class _d{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new _d;return r.extend(t(new L(this.minX,this.minY))),r.extend(t(new L(this.maxX,this.minY))),r.extend(t(new L(this.minX,this.maxY))),r.extend(t(new L(this.maxX,this.maxY))),r}static fromPoints(t){const r=new _d;for(const c of t)r.extend(c);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Sv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const c=t[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Tv{constructor(t,r,c,f,_){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=c,t._y=f,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Pv{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new _o(ht,16,0),this.grid3D=new _o(ht,16,0),this.featureIndexArray=new we,this.promoteId=r}insert(t,r,c,f,_,v){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,_);const E=v?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const A=r[I],F=[1/0,1/0,-1/0,-1/0];for(let U=0;U<A.length;U++){const Z=A[U];F[0]=Math.min(F[0],Z.x),F[1]=Math.min(F[1],Z.y),F[2]=Math.max(F[2],Z.x),F[3]=Math.max(F[3],Z.y)}F[0]<ht&&F[1]<ht&&F[2]>=0&&F[3]>=0&&E.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new af(new fd(this.rawTileData)).layers,this.sourceLayerCoder=new Sv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,c,f){this.loadVTLayers();const _=t.params,v=ht/t.tileSize/t.scale,T=mo(_.filter),E=t.queryGeometry,I=t.queryPadding*v,A=_d.fromPoints(E),F=this.grid.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I),U=_d.fromPoints(t.cameraQueryGeometry).expandBy(I),Z=this.grid3D.query(U.minX,U.minY,U.maxX,U.maxY,((ie,ce,Re,pe)=>(function(be,Ue,We,nt,Tt){for(const wt of be)if(Ue<=wt.x&&We<=wt.y&&nt>=wt.x&&Tt>=wt.y)return!0;const gt=[new L(Ue,We),new L(Ue,Tt),new L(nt,Tt),new L(nt,We)];if(be.length>2){for(const wt of gt)if(Vc(be,wt))return!0}for(let wt=0;wt<be.length-1;wt++)if(dp(be[wt],be[wt+1],gt))return!0;return!1})(t.cameraQueryGeometry,ie-I,ce-I,Re+I,pe+I)));for(const ie of Z)F.push(ie);F.sort(H1);const H={};let Y;for(let ie=0;ie<F.length;ie++){const ce=F[ie];if(ce===Y)continue;Y=ce;const Re=this.featureIndexArray.get(ce);let pe=null;this.loadMatchingFeature(H,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,T,_.layers,_.availableImages,r,c,f,((be,Ue,We)=>(pe||(pe=So(be)),Ue.queryIntersectsFeature({queryGeometry:E,feature:be,featureState:We,geometry:pe,zoom:this.z,transform:t.transform,pixelsToTileUnits:v,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return H}loadMatchingFeature(t,r,c,f,_,v,T,E,I,A,F){const U=this.bucketLayerIDs[r];if(v&&!U.some((ie=>v.has(ie))))return;const Z=this.sourceLayerCoder.decode(c),H=this.vtLayers[Z].feature(f);if(_.needGeometry){const ie=Yo(H,!0);if(!_.filter(new Wr(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!_.filter(new Wr(this.tileID.overscaledZ),H))return;const Y=this.getId(H,Z);for(let ie=0;ie<U.length;ie++){const ce=U[ie];if(v&&!v.has(ce))continue;const Re=E[ce];if(!Re)continue;let pe={};Y&&A&&(pe=A.getState(Re.sourceLayer||"_geojsonTileLayer",Y));const be=sr({},I[ce]);be.paint=Cv(be.paint,Re.paint,H,pe,T),be.layout=Cv(be.layout,Re.layout,H,pe,T);const Ue=!F||F(H,Re,pe);if(!Ue)continue;const We=new Tv(H,this.z,this.x,this.y,Y);We.layer=be;let nt=t[ce];nt===void 0&&(nt=t[ce]=[]),nt.push({featureIndex:f,feature:We,intersectionZ:Ue})}}lookupSymbolFeatures(t,r,c,f,_,v,T,E){const I={};this.loadVTLayers();const A=mo(_);for(const F of t)this.loadMatchingFeature(I,c,f,F,A,v,T,E,r);return I}hasLayer(t){for(const r of this.bucketLayerIDs)for(const c of r)if(t===c)return!0;return!1}getId(t,r){var c;let f=t.id;return this.promoteId&&(f=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((c=t.properties)===null||c===void 0)&&c.cluster)&&this.promoteId&&(f=Number(t.properties.cluster_id))),f}}function Cv(i,t,r,c,f){return lr(i,((_,v)=>{const T=t instanceof Nc?t.get(v):null;return T&&T.evaluate?T.evaluate(r,c,f):T}))}function H1(i,t){return t-i}function Ev(i,t,r,c,f){const _=[];for(let v=0;v<i.length;v++){const T=i[v];let E;for(let I=0;I<T.length-1;I++){let A=T[I],F=T[I+1];A.x<t&&F.x<t||(A.x<t?A=new L(t,A.y+(t-A.x)/(F.x-A.x)*(F.y-A.y))._round():F.x<t&&(F=new L(t,A.y+(t-A.x)/(F.x-A.x)*(F.y-A.y))._round()),A.y<r&&F.y<r||(A.y<r?A=new L(A.x+(r-A.y)/(F.y-A.y)*(F.x-A.x),r)._round():F.y<r&&(F=new L(A.x+(r-A.y)/(F.y-A.y)*(F.x-A.x),r)._round()),A.x>=c&&F.x>=c||(A.x>=c?A=new L(c,A.y+(c-A.x)/(F.x-A.x)*(F.y-A.y))._round():F.x>=c&&(F=new L(c,A.y+(c-A.x)/(F.x-A.x)*(F.y-A.y))._round()),A.y>=f&&F.y>=f||(A.y>=f?A=new L(A.x+(f-A.y)/(F.y-A.y)*(F.x-A.x),f)._round():F.y>=f&&(F=new L(A.x+(f-A.y)/(F.y-A.y)*(F.x-A.x),f)._round()),E&&A.equals(E[E.length-1])||(E=[A],_.push(E)),E.push(F)))))}}return _}Et("FeatureIndex",Pv,{omit:["rawTileData","sourceLayerCoder"]});class Yu extends L{constructor(t,r,c,f){super(t,r),this.angle=c,f!==void 0&&(this.segment=f)}clone(){return new Yu(this.x,this.y,this.angle,this.segment)}}function kv(i,t,r,c,f){if(t.segment===void 0||r===0)return!0;let _=t,v=t.segment+1,T=0;for(;T>-r/2;){if(v--,v<0)return!1;T-=i[v].dist(_),_=i[v]}T+=i[v].dist(i[v+1]),v++;const E=[];let I=0;for(;T<r/2;){const A=i[v],F=i[v+1];if(!F)return!1;let U=i[v-1].angleTo(A)-A.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:T,angleDelta:U}),I+=U;T-E[0].distance>c;)I-=E.shift().angleDelta;if(I>f)return!1;v++,T+=A.dist(F)}return!0}function Mv(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Iv(i,t,r){return i?.6*t*r:0}function Av(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function K1(i,t,r,c,f,_){const v=Iv(r,f,_),T=Av(r,c)*_;let E=0;const I=Mv(i)/2;for(let A=0;A<i.length-1;A++){const F=i[A],U=i[A+1],Z=F.dist(U);if(E+Z>I){const H=(I-E)/Z,Y=Vs.number(F.x,U.x,H),ie=Vs.number(F.y,U.y,H),ce=new Yu(Y,ie,U.angleTo(F),A);return ce._round(),!v||kv(i,ce,T,v,t)?ce:void 0}E+=Z}}function X1(i,t,r,c,f,_,v,T,E){const I=Iv(c,_,v),A=Av(c,f),F=A*v,U=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return t-F<t/4&&(t=F+t/4),zv(i,U?t/2*T%t:(A/2+2*_)*v*T%t,t,I,r,F,U,!1,E)}function zv(i,t,r,c,f,_,v,T,E){const I=_/2,A=Mv(i);let F=0,U=t-r,Z=[];for(let H=0;H<i.length-1;H++){const Y=i[H],ie=i[H+1],ce=Y.dist(ie),Re=ie.angleTo(Y);for(;U+r<F+ce;){U+=r;const pe=(U-F)/ce,be=Vs.number(Y.x,ie.x,pe),Ue=Vs.number(Y.y,ie.y,pe);if(be>=0&&be<E&&Ue>=0&&Ue<E&&U-I>=0&&U+I<=A){const We=new Yu(be,Ue,Re,H);We._round(),c&&!kv(i,We,_,c,f)||Z.push(We)}}F+=ce}return T||Z.length||v||(Z=zv(i,F/2,r,c,f,_,v,!0,E)),Z}function Rv(i,t,r,c){const f=[],_=i.image,v=_.pixelRatio,T=_.paddedRect.w-2,E=_.paddedRect.h-2;let I={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=_.stretchX||[[0,T]],F=_.stretchY||[[0,E]],U=(et,ir)=>et+ir[1]-ir[0],Z=A.reduce(U,0),H=F.reduce(U,0),Y=T-Z,ie=E-H;let ce=0,Re=Z,pe=0,be=H,Ue=0,We=Y,nt=0,Tt=ie;if(_.content&&c){const et=_.content,ir=et[2]-et[0],gr=et[3]-et[1];(_.textFitWidth||_.textFitHeight)&&(I=He(i)),ce=tg(A,0,et[0]),pe=tg(F,0,et[1]),Re=tg(A,et[0],et[2]),be=tg(F,et[1],et[3]),Ue=et[0]-ce,nt=et[1]-pe,We=ir-Re,Tt=gr-be}const gt=I.x1,wt=I.y1,qt=I.x2-gt,xt=I.y2-wt,St=(et,ir,gr,er)=>{const Nt=rg(et.stretch-ce,Re,qt,gt),jr=ng(et.fixed-Ue,We,et.stretch,Z),On=rg(ir.stretch-pe,be,xt,wt),yi=ng(ir.fixed-nt,Tt,ir.stretch,H),os=rg(gr.stretch-ce,Re,qt,gt),ta=ng(gr.fixed-Ue,We,gr.stretch,Z),ro=rg(er.stretch-pe,be,xt,wt),Zi=ng(er.fixed-nt,Tt,er.stretch,H),In=new L(Nt,On),Pi=new L(os,On),Gi=new L(os,ro),qi=new L(Nt,ro),Os=new L(jr/v,yi/v),ra=new L(ta/v,Zi/v),Ci=t*Math.PI/180;if(Ci){const Ei=Math.sin(Ci),ki=Math.cos(Ci),si=[ki,-Ei,Ei,ki];In._matMult(si),Pi._matMult(si),qi._matMult(si),Gi._matMult(si)}const no=et.stretch+et.fixed,_i=ir.stretch+ir.fixed;return{tl:In,tr:Pi,bl:qi,br:Gi,tex:{x:_.paddedRect.x+1+no,y:_.paddedRect.y+1+_i,w:gr.stretch+gr.fixed-no,h:er.stretch+er.fixed-_i},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Os,pixelOffsetBR:ra,minFontScaleX:We/v/qt,minFontScaleY:Tt/v/xt,isSDF:r}};if(c&&(_.stretchX||_.stretchY)){const et=Dv(A,Y,Z),ir=Dv(F,ie,H);for(let gr=0;gr<et.length-1;gr++){const er=et[gr],Nt=et[gr+1];for(let jr=0;jr<ir.length-1;jr++)f.push(St(er,ir[jr],Nt,ir[jr+1]))}}else f.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:E+1}));return f}function tg(i,t,r){let c=0;for(const f of i)c+=Math.max(t,Math.min(r,f[1]))-Math.max(t,Math.min(r,f[0]));return c}function Dv(i,t,r){const c=[{fixed:-1,stretch:0}];for(const[f,_]of i){const v=c[c.length-1];c.push({fixed:f-v.stretch,stretch:v.stretch}),c.push({fixed:f-v.stretch,stretch:v.stretch+(_-f)})}return c.push({fixed:t+1,stretch:r}),c}function rg(i,t,r,c){return i/t*r+c}function ng(i,t,r,c){return i-t*r/c}Et("Anchor",Yu);class ig{constructor(t,r,c,f,_,v,T,E,I,A){var F;if(this.boxStartIndex=t.length,I){let U=v.top,Z=v.bottom;const H=v.collisionPadding;H&&(U-=H[1],Z+=H[3]);let Y=Z-U;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{const U=!((F=v.image)===null||F===void 0)&&F.content&&(v.image.textFitWidth||v.image.textFitHeight)?He(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};U.y1=U.y1*T-E[0],U.y2=U.y2*T+E[2],U.x1=U.x1*T-E[3],U.x2=U.x2*T+E[1];const Z=v.collisionPadding;if(Z&&(U.x1-=Z[0]*T,U.y1-=Z[1]*T,U.x2+=Z[2]*T,U.y2+=Z[3]*T),A){const H=new L(U.x1,U.y1),Y=new L(U.x2,U.y1),ie=new L(U.x1,U.y2),ce=new L(U.x2,U.y2),Re=A*Math.PI/180;H._rotate(Re),Y._rotate(Re),ie._rotate(Re),ce._rotate(Re),U.x1=Math.min(H.x,Y.x,ie.x,ce.x),U.x2=Math.max(H.x,Y.x,ie.x,ce.x),U.y1=Math.min(H.y,Y.y,ie.y,ce.y),U.y2=Math.max(H.y,Y.y,ie.y,ce.y)}t.emplaceBack(r.x,r.y,U.x1,U.y1,U.x2,U.y2,c,f,_)}this.boxEndIndex=t.length}}class Y1{constructor(t=[],r=(c,f)=>c<f?-1:c>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:c}=this,f=r[t];for(;t>0;){const _=t-1>>1,v=r[_];if(c(f,v)>=0)break;r[t]=v,t=_}r[t]=f}_down(t){const{data:r,compare:c}=this,f=this.length>>1,_=r[t];for(;t<f;){let v=1+(t<<1);const T=v+1;if(T<this.length&&c(r[T],r[v])<0&&(v=T),c(r[v],_)>=0)break;r[t]=r[v],t=v}r[t]=_}}function Q1(i,t=1,r=!1){const c=_d.fromPoints(i[0]),f=Math.min(c.width(),c.height());let _=f/2;const v=new Y1([],J1),{minX:T,minY:E,maxX:I,maxY:A}=c;if(f===0)return new L(T,E);for(let Z=T;Z<I;Z+=f)for(let H=E;H<A;H+=f)v.push(new gf(Z+_,H+_,_,i));let F=(function(Z){let H=0,Y=0,ie=0;const ce=Z[0];for(let Re=0,pe=ce.length,be=pe-1;Re<pe;be=Re++){const Ue=ce[Re],We=ce[be],nt=Ue.x*We.y-We.x*Ue.y;Y+=(Ue.x+We.x)*nt,ie+=(Ue.y+We.y)*nt,H+=3*nt}return new gf(Y/H,ie/H,0,Z)})(i),U=v.length;for(;v.length;){const Z=v.pop();(Z.d>F.d||!F.d)&&(F=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,U)),Z.max-F.d<=t||(_=Z.h/2,v.push(new gf(Z.p.x-_,Z.p.y-_,_,i)),v.push(new gf(Z.p.x+_,Z.p.y-_,_,i)),v.push(new gf(Z.p.x-_,Z.p.y+_,_,i)),v.push(new gf(Z.p.x+_,Z.p.y+_,_,i)),U+=4)}return r&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function J1(i,t){return t.max-i.max}function gf(i,t,r,c){this.p=new L(i,t),this.h=r,this.d=(function(f,_){let v=!1,T=1/0;for(let E=0;E<_.length;E++){const I=_[E];for(let A=0,F=I.length,U=F-1;A<F;U=A++){const Z=I[A],H=I[U];Z.y>f.y!=H.y>f.y&&f.x<(H.x-Z.x)*(f.y-Z.y)/(H.y-Z.y)+Z.x&&(v=!v),T=Math.min(T,up(f,Z,H))}}return(v?1:-1)*Math.sqrt(T)})(this.p,c),this.max=this.d+this.h*Math.SQRT2}var ss;w.aE=void 0,(ss=w.aE||(w.aE={}))[ss.center=1]="center",ss[ss.left=2]="left",ss[ss.right=3]="right",ss[ss.top=4]="top",ss[ss.bottom=5]="bottom",ss[ss["top-left"]=6]="top-left",ss[ss["top-right"]=7]="top-right",ss[ss["bottom-left"]=8]="bottom-left",ss[ss["bottom-right"]=9]="bottom-right";const fy=Number.POSITIVE_INFINITY;function Lv(i,t){return t[1]!==fy?(function(r,c,f){let _=0,v=0;switch(c=Math.abs(c),f=Math.abs(f),r){case"top-right":case"top-left":case"top":v=f-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-f}switch(r){case"top-right":case"bottom-right":case"right":_=-c;break;case"top-left":case"bottom-left":case"left":_=c}return[_,v]})(i,t[0],t[1]):(function(r,c){let f=0,_=0;c<0&&(c=0);const v=c/Math.SQRT2;switch(r){case"top-right":case"top-left":_=v-7;break;case"bottom-right":case"bottom-left":_=7-v;break;case"bottom":_=7-c;break;case"top":_=c-7}switch(r){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=c;break;case"right":f=-c}return[f,_]})(i,t[0])}function Fv(i,t,r){var c;const f=i.layout,_=(c=f.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},r);if(_){const T=_.values,E=[];for(let I=0;I<T.length;I+=2){const A=E[I]=T[I],F=T[I+1].map((U=>U*Jn));A.startsWith("top")?F[1]-=7:A.startsWith("bottom")&&(F[1]+=7),E[I+1]=F}return new qn(E)}const v=f.get("text-variable-anchor");if(v){let T;T=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},r)*Jn,fy]:f.get("text-offset").evaluate(t,{},r).map((I=>I*Jn));const E=[];for(const I of v)E.push(I,Lv(I,T));return new qn(E)}return null}function py(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ew(i,t,r,c,f,_,v,T,E,I,A,F){let U=_.textMaxSize.evaluate(t,{});U===void 0&&(U=v);const Z=i.layers[0].layout,H=Z.get("icon-offset").evaluate(t,{},A),Y=jv(r.horizontal),ie=v/24,ce=i.tilePixelRatio*ie,Re=i.tilePixelRatio*U/24,pe=i.tilePixelRatio*T,be=i.tilePixelRatio*Z.get("symbol-spacing"),Ue=Z.get("text-padding")*i.tilePixelRatio,We=(function(gr,er,Nt,jr=1){const On=gr.get("icon-padding").evaluate(er,{},Nt),yi=On&&On.values;return[yi[0]*jr,yi[1]*jr,yi[2]*jr,yi[3]*jr]})(Z,t,A,i.tilePixelRatio),nt=Z.get("text-max-angle")/180*Math.PI,Tt=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",gt=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",wt=Z.get("symbol-placement"),qt=be/2,xt=Z.get("icon-text-fit");let St;c&&xt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(St=ut(c,r.vertical,xt,Z.get("icon-text-fit-padding"),H,ie)),Y&&(c=ut(c,Y,xt,Z.get("icon-text-fit-padding"),H,ie)));const et=A?F.line.getGranularityForZoomLevel(A.z):1,ir=(gr,er)=>{er.x<0||er.x>=ht||er.y<0||er.y>=ht||(function(Nt,jr,On,yi,os,ta,ro,Zi,In,Pi,Gi,qi,Os,ra,Ci,no,_i,Ei,ki,si,bn,al,yf,ll,nw){const _f=Nt.addToLineVertexArray(jr,On);let vd,vf,xf,bf,Uv=0,Vv=0,Zv=0,Gv=0,wy=-1,Sy=-1;const Jc={};let qv=el("");if(Nt.allowVerticalPlacement&&yi.vertical){const Ps=Zi.layout.get("text-rotate").evaluate(bn,{},ll)+90;xf=new ig(In,jr,Pi,Gi,qi,yi.vertical,Os,ra,Ci,Ps),ro&&(bf=new ig(In,jr,Pi,Gi,qi,ro,_i,Ei,Ci,Ps))}if(os){const Ps=Zi.layout.get("icon-rotate").evaluate(bn,{}),na=Zi.layout.get("icon-text-fit")!=="none",xd=Rv(os,Ps,yf,na),ul=ro?Rv(ro,Ps,yf,na):void 0;vf=new ig(In,jr,Pi,Gi,qi,os,_i,Ei,!1,Ps),Uv=4*xd.length;const bd=Nt.iconSizeData;let ec=null;bd.kind==="source"?(ec=[lt*Zi.layout.get("icon-size").evaluate(bn,{})],ec[0]>ot&&Nr(`${Nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):bd.kind==="composite"&&(ec=[lt*al.compositeIconSizes[0].evaluate(bn,{},ll),lt*al.compositeIconSizes[1].evaluate(bn,{},ll)],(ec[0]>ot||ec[1]>ot)&&Nr(`${Nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Nt.addSymbols(Nt.icon,xd,ec,si,ki,bn,w.ao.none,jr,_f.lineStartIndex,_f.lineLength,-1,ll),wy=Nt.icon.placedSymbolArray.length-1,ul&&(Vv=4*ul.length,Nt.addSymbols(Nt.icon,ul,ec,si,ki,bn,w.ao.vertical,jr,_f.lineStartIndex,_f.lineLength,-1,ll),Sy=Nt.icon.placedSymbolArray.length-1)}const Wv=Object.keys(yi.horizontal);for(const Ps of Wv){const na=yi.horizontal[Ps];if(!vd){qv=el(na.text);const ul=Zi.layout.get("text-rotate").evaluate(bn,{},ll);vd=new ig(In,jr,Pi,Gi,qi,na,Os,ra,Ci,ul)}const xd=na.positionedLines.length===1;if(Zv+=Ov(Nt,jr,na,ta,Zi,Ci,bn,no,_f,yi.vertical?w.ao.horizontal:w.ao.horizontalOnly,xd?Wv:[Ps],Jc,wy,al,ll),xd)break}yi.vertical&&(Gv+=Ov(Nt,jr,yi.vertical,ta,Zi,Ci,bn,no,_f,w.ao.vertical,["vertical"],Jc,Sy,al,ll));const iw=vd?vd.boxStartIndex:Nt.collisionBoxArray.length,sw=vd?vd.boxEndIndex:Nt.collisionBoxArray.length,ow=xf?xf.boxStartIndex:Nt.collisionBoxArray.length,aw=xf?xf.boxEndIndex:Nt.collisionBoxArray.length,lw=vf?vf.boxStartIndex:Nt.collisionBoxArray.length,cw=vf?vf.boxEndIndex:Nt.collisionBoxArray.length,uw=bf?bf.boxStartIndex:Nt.collisionBoxArray.length,hw=bf?bf.boxEndIndex:Nt.collisionBoxArray.length;let cl=-1;const og=(Ps,na)=>Ps&&Ps.circleDiameter?Math.max(Ps.circleDiameter,na):na;cl=og(vd,cl),cl=og(xf,cl),cl=og(vf,cl),cl=og(bf,cl);const Hv=cl>-1?1:0;Hv&&(cl*=nw/Jn),Nt.glyphOffsetArray.length>=Gt.MAX_GLYPHS&&Nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bn.sortKey!==void 0&&Nt.addToSortKeyRanges(Nt.symbolInstances.length,bn.sortKey);const dw=Fv(Zi,bn,ll),[fw,pw]=(function(Ps,na){const xd=Ps.length,ul=na==null?void 0:na.values;if((ul==null?void 0:ul.length)>0)for(let bd=0;bd<ul.length;bd+=2){const ec=ul[bd+1];Ps.emplaceBack(w.aE[ul[bd]],ec[0],ec[1])}return[xd,Ps.length]})(Nt.textAnchorOffsets,dw);Nt.symbolInstances.emplaceBack(jr.x,jr.y,Jc.right>=0?Jc.right:-1,Jc.center>=0?Jc.center:-1,Jc.left>=0?Jc.left:-1,Jc.vertical||-1,wy,Sy,qv,iw,sw,ow,aw,lw,cw,uw,hw,Pi,Zv,Gv,Uv,Vv,Hv,0,Os,cl,fw,pw)})(i,er,gr,r,c,f,St,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ce,[Ue,Ue,Ue,Ue],Tt,E,pe,We,gt,H,t,_,I,A,v)};if(wt==="line")for(const gr of Ev(t.geometry,0,0,ht,ht)){const er=Tn(gr,et),Nt=X1(er,be,nt,r.vertical||Y,c,24,Re,i.overscaling,ht);for(const jr of Nt)Y&&tw(i,Y.text,qt,jr)||ir(er,jr)}else if(wt==="line-center"){for(const gr of t.geometry)if(gr.length>1){const er=Tn(gr,et),Nt=K1(er,nt,r.vertical||Y,c,24,Re);Nt&&ir(er,Nt)}}else if(t.type==="Polygon")for(const gr of Al(t.geometry,0)){const er=Q1(gr,16);ir(Tn(gr[0],et,!0),new Yu(er.x,er.y,0))}else if(t.type==="LineString")for(const gr of t.geometry){const er=Tn(gr,et);ir(er,new Yu(er[0].x,er[0].y,0))}else if(t.type==="Point")for(const gr of t.geometry)for(const er of gr)ir([er],new Yu(er.x,er.y,0))}function Ov(i,t,r,c,f,_,v,T,E,I,A,F,U,Z,H){const Y=(function(Re,pe,be,Ue,We,nt,Tt,gt){const wt=Ue.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,qt=[];for(const xt of pe.positionedLines)for(const St of xt.positionedGlyphs){if(!St.rect)continue;const et=St.rect||{};let ir=4,gr=!0,er=1,Nt=0;const jr=(We||gt)&&St.vertical,On=St.metrics.advance*St.scale/2;if(gt&&pe.verticalizable&&(Nt=xt.lineOffset/2-(St.imageName?-(Jn-St.metrics.width*St.scale)/2:(St.scale-1)*Jn)),St.imageName){const Ei=Tt[St.imageName];gr=Ei.sdf,er=Ei.pixelRatio,ir=1/er}const yi=We?[St.x+On,St.y]:[0,0];let os=We?[0,0]:[St.x+On+be[0],St.y+be[1]-Nt],ta=[0,0];jr&&(ta=os,os=[0,0]);const ro=St.metrics.isDoubleResolution?2:1,Zi=(St.metrics.left-ir)*St.scale-On+os[0],In=(-St.metrics.top-ir)*St.scale+os[1],Pi=Zi+et.w/ro*St.scale/er,Gi=In+et.h/ro*St.scale/er,qi=new L(Zi,In),Os=new L(Pi,In),ra=new L(Zi,Gi),Ci=new L(Pi,Gi);if(jr){const Ei=new L(-On,On- -17),ki=-Math.PI/2,si=12-On,bn=new L(22-si,-(St.imageName?si:0)),al=new L(...ta);qi._rotateAround(ki,Ei)._add(bn)._add(al),Os._rotateAround(ki,Ei)._add(bn)._add(al),ra._rotateAround(ki,Ei)._add(bn)._add(al),Ci._rotateAround(ki,Ei)._add(bn)._add(al)}if(wt){const Ei=Math.sin(wt),ki=Math.cos(wt),si=[ki,-Ei,Ei,ki];qi._matMult(si),Os._matMult(si),ra._matMult(si),Ci._matMult(si)}const no=new L(0,0),_i=new L(0,0);qt.push({tl:qi,tr:Os,bl:ra,br:Ci,tex:et,writingMode:pe.writingMode,glyphOffset:yi,sectionIndex:St.sectionIndex,isSDF:gr,pixelOffsetTL:no,pixelOffsetBR:_i,minFontScaleX:0,minFontScaleY:0})}return qt})(0,r,T,f,_,v,c,i.allowVerticalPlacement),ie=i.textSizeData;let ce=null;ie.kind==="source"?(ce=[lt*f.layout.get("text-size").evaluate(v,{})],ce[0]>ot&&Nr(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(ce=[lt*Z.compositeTextSizes[0].evaluate(v,{},H),lt*Z.compositeTextSizes[1].evaluate(v,{},H)],(ce[0]>ot||ce[1]>ot)&&Nr(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Y,ce,T,_,v,I,t,E.lineStartIndex,E.lineLength,U,H);for(const Re of A)F[Re]=i.text.placedSymbolArray.length-1;return 4*Y.length}function jv(i){for(const t in i)return i[t];return null}function tw(i,t,r,c){const f=i.compareText;if(t in f){const _=f[t];for(let v=_.length-1;v>=0;v--)if(c.dist(_[v])<r)return!0}else f[t]=[];return f[t].push(c),!1}const Nv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class my{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,c]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const _=Nv[15&c];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[T]=new Uint32Array(t,4,1);return new my(T,v,_,t)}constructor(t,r=64,c=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Nv.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,T=t*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+E,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+T+E),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+E,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=r,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:T}=this,E=[0,_.length-1,0],I=[];for(;E.length;){const A=E.pop()||0,F=E.pop()||0,U=E.pop()||0;if(F-U<=T){for(let ie=U;ie<=F;ie++){const ce=v[2*ie],Re=v[2*ie+1];ce>=t&&ce<=c&&Re>=r&&Re<=f&&I.push(_[ie])}continue}const Z=U+F>>1,H=v[2*Z],Y=v[2*Z+1];H>=t&&H<=c&&Y>=r&&Y<=f&&I.push(_[Z]),(A===0?t<=H:r<=Y)&&(E.push(U),E.push(Z-1),E.push(1-A)),(A===0?c>=H:f>=Y)&&(E.push(Z+1),E.push(F),E.push(1-A))}return I}within(t,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:v}=this,T=[0,f.length-1,0],E=[],I=c*c;for(;T.length;){const A=T.pop()||0,F=T.pop()||0,U=T.pop()||0;if(F-U<=v){for(let ie=U;ie<=F;ie++)$v(_[2*ie],_[2*ie+1],t,r)<=I&&E.push(f[ie]);continue}const Z=U+F>>1,H=_[2*Z],Y=_[2*Z+1];$v(H,Y,t,r)<=I&&E.push(f[Z]),(A===0?t-c<=H:r-c<=Y)&&(T.push(U),T.push(Z-1),T.push(1-A)),(A===0?t+c>=H:r+c>=Y)&&(T.push(Z+1),T.push(F),T.push(1-A))}return E}}function gy(i,t,r,c,f,_){if(f-c<=r)return;const v=c+f>>1;Bv(i,t,v,c,f,_),gy(i,t,r,c,v-1,1-_),gy(i,t,r,v+1,f,1-_)}function Bv(i,t,r,c,f,_){for(;f>c;){if(f-c>600){const I=f-c+1,A=r-c+1,F=Math.log(I),U=.5*Math.exp(2*F/3),Z=.5*Math.sqrt(F*U*(I-U)/I)*(A-I/2<0?-1:1);Bv(i,t,r,Math.max(c,Math.floor(r-A*U/I+Z)),Math.min(f,Math.floor(r+(I-A)*U/I+Z)),_)}const v=t[2*r+_];let T=c,E=f;for(jp(i,t,c,r),t[2*f+_]>v&&jp(i,t,c,f);T<E;){for(jp(i,t,T,E),T++,E--;t[2*T+_]<v;)T++;for(;t[2*E+_]>v;)E--}t[2*c+_]===v?jp(i,t,c,E):(E++,jp(i,t,E,f)),E<=r&&(c=E+1),r<=E&&(f=E-1)}}function jp(i,t,r,c){yy(i,r,c),yy(t,2*r,2*c),yy(t,2*r+1,2*c+1)}function yy(i,t,r){const c=i[t];i[t]=i[r],i[r]=c}function $v(i,t,r,c){const f=i-r,_=t-c;return f*f+_*_}var _y;w.cx=void 0,(_y=w.cx||(w.cx={})).create="create",_y.load="load",_y.fullLoad="fullLoad";let sg=null,Np=[];const vy=1e3/60,xy="loadTime",by="fullLoadTime",rw={mark(i){performance.mark(i)},frame(i){const t=i;sg!=null&&Np.push(t-sg),sg=t},clearMetrics(){sg=null,Np=[],performance.clearMeasures(xy),performance.clearMeasures(by);for(const i in w.cx)performance.clearMarks(w.cx[i])},getPerformanceMetrics(){performance.measure(xy,w.cx.create,w.cx.load),performance.measure(by,w.cx.create,w.cx.fullLoad);const i=performance.getEntriesByName(xy)[0].duration,t=performance.getEntriesByName(by)[0].duration,r=Np.length,c=1/(Np.reduce(((_,v)=>_+v),0)/r/1e3),f=Np.filter((_=>_>vy)).reduce(((_,v)=>_+(v-vy)/vy),0);return{loadTime:i,fullLoadTime:t,fps:c,percentDroppedFrames:f/(r+f)*100,totalFrames:r}}};w.$=ht,w.A=Ie,w.B=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.C=Vs,w.D=Lt,w.E=zt,w.F=Wr,w.G=Zl,w.H=function(i){if(Xi==null){const t=i.navigator?i.navigator.userAgent:null;Xi=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Xi},w.I=pd,w.J=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new q1((()=>this.process())),this.subscription=kt(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=jn(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise(((r,c)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?kt(t.signal,"abort",(()=>{_==null||_.unsubscribe(),delete this.resolveRejects[f];const E={id:f,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)}),W1):null;this.resolveRejects[f]={resolve:E=>{_==null||_.unsubscribe(),r(E)},reject:E=>{_==null||_.unsubscribe(),c(E)}};const v=[],T=Object.assign(Object.assign({},i),{id:f,sourceMapId:this.mapId,origin:location.origin,data:es(i.data,v)});this.target.postMessage(T,{transfer:v})}))}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const c=this.abortControllers[r];return delete this.abortControllers[r],void(c&&c.abort())}if(jn(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return l(this,void 0,void 0,(function*(){if(t.type==="<response>"){const f=this.resolveRejects[i];return delete this.resolveRejects[i],f?void(t.error?f.reject(Fi(t.error)):f.resolve(Fi(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Fi(t.data),c=new AbortController;this.abortControllers[i]=c;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,r,c);this.completeTask(i,null,f)}catch(f){this.completeTask(i,f)}}))}completeTask(i,t,r){const c=[];delete this.abortControllers[i];const f={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?es(t):null,data:es(r,c)};this.target.postMessage(f,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.K=ne,w.L=function(){var i=new Ie(16);return Ie!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.M=function(i,t,r){var c,f,_,v,T,E,I,A,F,U,Z,H,Y=r[0],ie=r[1],ce=r[2];return t===i?(i[12]=t[0]*Y+t[4]*ie+t[8]*ce+t[12],i[13]=t[1]*Y+t[5]*ie+t[9]*ce+t[13],i[14]=t[2]*Y+t[6]*ie+t[10]*ce+t[14],i[15]=t[3]*Y+t[7]*ie+t[11]*ce+t[15]):(f=t[1],_=t[2],v=t[3],T=t[4],E=t[5],I=t[6],A=t[7],F=t[8],U=t[9],Z=t[10],H=t[11],i[0]=c=t[0],i[1]=f,i[2]=_,i[3]=v,i[4]=T,i[5]=E,i[6]=I,i[7]=A,i[8]=F,i[9]=U,i[10]=Z,i[11]=H,i[12]=c*Y+T*ie+F*ce+t[12],i[13]=f*Y+E*ie+U*ce+t[13],i[14]=_*Y+I*ie+Z*ce+t[14],i[15]=v*Y+A*ie+H*ce+t[15]),i},w.N=function(i,t,r){var c=r[0],f=r[1],_=r[2];return i[0]=t[0]*c,i[1]=t[1]*c,i[2]=t[2]*c,i[3]=t[3]*c,i[4]=t[4]*f,i[5]=t[5]*f,i[6]=t[6]*f,i[7]=t[7]*f,i[8]=t[8]*_,i[9]=t[9]*_,i[10]=t[10]*_,i[11]=t[11]*_,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.O=function(i,t,r){var c=t[0],f=t[1],_=t[2],v=t[3],T=t[4],E=t[5],I=t[6],A=t[7],F=t[8],U=t[9],Z=t[10],H=t[11],Y=t[12],ie=t[13],ce=t[14],Re=t[15],pe=r[0],be=r[1],Ue=r[2],We=r[3];return i[0]=pe*c+be*T+Ue*F+We*Y,i[1]=pe*f+be*E+Ue*U+We*ie,i[2]=pe*_+be*I+Ue*Z+We*ce,i[3]=pe*v+be*A+Ue*H+We*Re,i[4]=(pe=r[4])*c+(be=r[5])*T+(Ue=r[6])*F+(We=r[7])*Y,i[5]=pe*f+be*E+Ue*U+We*ie,i[6]=pe*_+be*I+Ue*Z+We*ce,i[7]=pe*v+be*A+Ue*H+We*Re,i[8]=(pe=r[8])*c+(be=r[9])*T+(Ue=r[10])*F+(We=r[11])*Y,i[9]=pe*f+be*E+Ue*U+We*ie,i[10]=pe*_+be*I+Ue*Z+We*ce,i[11]=pe*v+be*A+Ue*H+We*Re,i[12]=(pe=r[12])*c+(be=r[13])*T+(Ue=r[14])*F+(We=r[15])*Y,i[13]=pe*f+be*E+Ue*U+We*ie,i[14]=pe*_+be*I+Ue*Z+We*ce,i[15]=pe*v+be*A+Ue*H+We*Re,i},w.P=L,w.Q=function(i,t){const r={};for(let c=0;c<t.length;c++){const f=t[c];f in i&&(r[f]=i[f])}return r},w.R=ws,w.S=Xu,w.T=Nu,w.U=_v,w.V=yv,w.W=fe,w.X=Fe,w.Y=xe,w.Z=ea,w._=l,w.a=K,w.a$=At,w.a0=function(i,t){var r,c,f,_,v;if(!i)return t??{};if(!t)return i;let T=Object.assign({},i);if(t.removeAll&&(T={removeAll:!0}),t.remove){const E=new Set(t.remove);T.add&&(T.add=T.add.filter((A=>!E.has(A.id)))),T.update&&(T.update=T.update.filter((A=>!E.has(A.id))));const I=new Set(((r=i.add)!==null&&r!==void 0?r:[]).map((A=>A.id)));t.remove=t.remove.filter((A=>!I.has(A)))}if(t.remove){const E=new Set(T.remove?T.remove.concat(t.remove):t.remove);T.remove=Array.from(E.values())}if(t.add){const E=T.add?T.add.concat(t.add):t.add,I=new Map(E.map((A=>[A.id,A])));T.add=Array.from(I.values())}if(t.update){const E=new Map((c=T.update)===null||c===void 0?void 0:c.map((I=>[I.id,I])));for(const I of t.update){const A=(f=E.get(I.id))!==null&&f!==void 0?f:{id:I.id};I.newGeometry&&(A.newGeometry=I.newGeometry),I.addOrUpdateProperties&&(A.addOrUpdateProperties=((_=A.addOrUpdateProperties)!==null&&_!==void 0?_:[]).concat(I.addOrUpdateProperties)),I.removeProperties&&(A.removeProperties=((v=A.removeProperties)!==null&&v!==void 0?v:[]).concat(I.removeProperties)),I.removeAllProperties&&(A.removeAllProperties=!0),E.set(I.id,A)}T.update=Array.from(E.values())}return T.remove&&T.add&&(T.remove=T.remove.filter((E=>T.add.findIndex((I=>I.id===E))===-1))),T},w.a1=Fp,w.a2=_d,w.a3=25,w.a4=dy,w.a5=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const c of i){const f=window.document.createElement("source");Oe(c)||(t.crossOrigin="Anonymous"),f.src=c,t.appendChild(f)}}))},w.a6=st,w.a7=function(){return yr++},w.a8=j,w.a9=Gt,w.aA=function(i){let t=1/0,r=1/0,c=-1/0,f=-1/0;for(const _ of i)t=Math.min(t,_.x),r=Math.min(r,_.y),c=Math.max(c,_.x),f=Math.max(f,_.y);return[t,r,c,f]},w.aB=Jn,w.aC=Ct,w.aD=function(i,t,r,c,f=!1){if(!r[0]&&!r[1])return[0,0];const _=f?c==="map"?-i.bearingInRadians:0:c==="viewport"?i.bearingInRadians:0;if(_){const v=Math.sin(_),T=Math.cos(_);r=[r[0]*T-r[1]*v,r[0]*v+r[1]*T]}return[f?r[0]:Ct(t,r[0],i.zoom),f?r[1]:Ct(t,r[1],i.zoom)]},w.aF=Vt,w.aG=py,w.aH=d,w.aI=my,w.aJ=wn,w.aK=Yn,w.aL=he,w.aM=mr,w.aN=nn,w.aO=Lr,w.aP=pt,w.aQ=xv,w.aR=at,w.aS=it,w.aT=function(i){var t=new Ie(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},w.aU=function(i,t,r){return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],i},w.aV=function(i,t){var r=t[0],c=t[1],f=t[2],_=r*r+c*c+f*f;return _>0&&(_=1/Math.sqrt(_)),i[0]=t[0]*_,i[1]=t[1]*_,i[2]=t[2]*_,i},w.aW=It,w.aX=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},w.aY=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.aZ=yt,w.a_=function(i,t,r){const c=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return c===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/c},w.aa=mo,w.ab=Yo,w.ac=Tv,w.ad=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,c,f,_)=>{const v=f||_;return t[c]=!v||v.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ae=vt,w.af=function(i){return Math.pow(2,i)},w.ag=Xe,w.ah=Kt,w.ai=85.051129,w.aj=vv,w.ak=function(i){return Math.log(i)/Math.LN2},w.al=function(i){var t=i[0],r=i[1];return t*t+r*r},w.am=function(i,t){const r=[];for(const c in i)c in t||r.push(c);return r},w.an=function(i,t){let r=0,c=0;if(i.kind==="constant")c=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:f,minZoom:_,maxZoom:v}=i,T=f?Kt(Rn.interpolationFactor(f,t,_,v),0,1):0;i.kind==="camera"?c=Vs.number(i.minSize,i.maxSize,T):r=T}return{uSizeT:r,uSize:c}},w.ap=function(i,{uSize:t,uSizeT:r},{lowerSize:c,upperSize:f}){return i.kind==="source"?c/lt:i.kind==="composite"?Vs.number(c/lt,f/lt,r):t},w.aq=function(i,t){var r=t[0],c=t[1],f=t[2],_=t[3],v=t[4],T=t[5],E=t[6],I=t[7],A=t[8],F=t[9],U=t[10],Z=t[11],H=t[12],Y=t[13],ie=t[14],ce=t[15],Re=r*T-c*v,pe=r*E-f*v,be=r*I-_*v,Ue=c*E-f*T,We=c*I-_*T,nt=f*I-_*E,Tt=A*Y-F*H,gt=A*ie-U*H,wt=A*ce-Z*H,qt=F*ie-U*Y,xt=F*ce-Z*Y,St=U*ce-Z*ie,et=Re*St-pe*xt+be*qt+Ue*wt-We*gt+nt*Tt;return et?(i[0]=(T*St-E*xt+I*qt)*(et=1/et),i[1]=(f*xt-c*St-_*qt)*et,i[2]=(Y*nt-ie*We+ce*Ue)*et,i[3]=(U*We-F*nt-Z*Ue)*et,i[4]=(E*wt-v*St-I*gt)*et,i[5]=(r*St-f*wt+_*gt)*et,i[6]=(ie*be-H*nt-ce*pe)*et,i[7]=(A*nt-U*be+Z*pe)*et,i[8]=(v*xt-T*wt+I*Tt)*et,i[9]=(c*wt-r*xt-_*Tt)*et,i[10]=(H*We-Y*be+ce*Re)*et,i[11]=(F*be-A*We-Z*Re)*et,i[12]=(T*gt-v*qt-E*Tt)*et,i[13]=(r*qt-c*gt+f*Tt)*et,i[14]=(Y*pe-H*Ue-ie*Re)*et,i[15]=(A*Ue-F*pe+U*Re)*et,i):null},w.ar=Zt,w.as=function(i){var t=i[0],r=i[1];return Math.sqrt(t*t+r*r)},w.at=function(i){return i[0]=0,i[1]=0,i},w.au=function(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i},w.av=Ve,w.aw=Ht,w.ax=function(i,t,r,c){const f=t.y-i.y,_=t.x-i.x,v=c.y-r.y,T=c.x-r.x,E=v*_-T*f;if(E===0)return null;const I=(T*(i.y-r.y)-v*(i.x-r.x))/E;return new L(i.x+I*_,i.y+I*f)},w.ay=Ev,w.az=cp,w.b=zi,w.b$=class extends g{},w.b0=function(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i},w.b1=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]},w.b2=wv,w.b3=mf,w.b4=function(i,t,r,c,f){var _=1/Math.tan(t/2);if(i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0){var v=1/(c-f);i[10]=(f+c)*v,i[14]=2*f*c*v}else i[10]=-1,i[14]=-2*c;return i},w.b5=function(i){var t=new Ie(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.b6=function(i,t,r){var c=Math.sin(r),f=Math.cos(r),_=t[0],v=t[1],T=t[2],E=t[3],I=t[4],A=t[5],F=t[6],U=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*f+I*c,i[1]=v*f+A*c,i[2]=T*f+F*c,i[3]=E*f+U*c,i[4]=I*f-_*c,i[5]=A*f-v*c,i[6]=F*f-T*c,i[7]=U*f-E*c,i},w.b7=function(i,t,r){var c=Math.sin(r),f=Math.cos(r),_=t[4],v=t[5],T=t[6],E=t[7],I=t[8],A=t[9],F=t[10],U=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=_*f+I*c,i[5]=v*f+A*c,i[6]=T*f+F*c,i[7]=E*f+U*c,i[8]=I*f-_*c,i[9]=A*f-v*c,i[10]=F*f-T*c,i[11]=U*f-E*c,i},w.b8=function(){const i=new Float32Array(16);return Xe(i),i},w.b9=function(){const i=new Float64Array(16);return Xe(i),i},w.bA=function(i,t){const r=Me(i,360),c=Me(t,360),f=c-r,_=c>r?f-360:f+360;return Math.abs(f)<Math.abs(_)?f:_},w.bB=function(i){return i[0]=0,i[1]=0,i[2]=0,i},w.bC=function(i,t,r,c){const f=Math.sqrt(i*i+t*t),_=Math.sqrt(r*r+c*c);i/=f,t/=f,r/=_,c/=_;const v=Math.acos(i*r+t*c);return-t*r+i*c>0?v:-v},w.bD=function(i,t){const r=Me(i,2*Math.PI),c=Me(t,2*Math.PI);return Math.min(Math.abs(r-c),Math.abs(r-c+2*Math.PI),Math.abs(r-c-2*Math.PI))},w.bE=function(){const i={},t=Pe.$version;for(const r in Pe.$root){const c=Pe.$root[r];if(c.required){let f=null;f=r==="version"?t:c.type==="array"?[]:{},f!=null&&(i[r]=f)}}return i},w.bF=vo,w.bG=ve,w.bH=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let c=0;c<t.length;c++)if(!i(t[c],r[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const c in t)if(!i(t[c],r[c]))return!1;return!0}return t===r},w.bI=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=rr(i[r],t[i[r].ref]));return i},w.bJ=function(i){if(i.type==="custom")return new G1(i);switch(i.type){case"background":return new U1(i);case"circle":return new km(i);case"color-relief":return new Ut(i);case"fill":return new Gu(i);case"fill-extrusion":return new iy(i);case"heatmap":return new Am(i);case"hillshade":return new is(i);case"line":return new Kc(i);case"raster":return new Z1(i);case"symbol":return new Hr(i)}},w.bK=ln,w.bL=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Dt(i.version,t.version))return[{command:"setStyle",args:[t]}];Dt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Dt(i.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),Dt(i.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Dt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Dt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Dt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Dt(i.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),Dt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Dt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Dt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Dt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Dt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Dt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Dt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const c={},f=[];(function(v,T,E,I){let A;for(A in T=T||{},v=v||{})Object.prototype.hasOwnProperty.call(v,A)&&(Object.prototype.hasOwnProperty.call(T,A)||Kr(A,E,I));for(A in T)Object.prototype.hasOwnProperty.call(T,A)&&(Object.prototype.hasOwnProperty.call(v,A)?Dt(v[A],T[A])||(v[A].type==="geojson"&&T[A].type==="geojson"&&Tr(v,T,A)?Xt(E,{command:"setGeoJSONSourceData",args:[A,T[A].data]}):dn(A,T,E,I)):Cr(A,T,E))})(i.sources,t.sources,f,c);const _=[];i.layers&&i.layers.forEach((v=>{"source"in v&&c[v.source]?r.push({command:"removeLayer",args:[v.id]}):_.push(v)})),r=r.concat(f),(function(v,T,E){T=T||[];const I=(v=v||[]).map(or),A=T.map(or),F=v.reduce(en,{}),U=T.reduce(en,{}),Z=I.slice(),H=Object.create(null);let Y,ie,ce,Re,pe;for(let be=0,Ue=0;be<I.length;be++)Y=I[be],Object.prototype.hasOwnProperty.call(U,Y)?Ue++:(Xt(E,{command:"removeLayer",args:[Y]}),Z.splice(Z.indexOf(Y,Ue),1));for(let be=0,Ue=0;be<A.length;be++)Y=A[A.length-1-be],Z[Z.length-1-be]!==Y&&(Object.prototype.hasOwnProperty.call(F,Y)?(Xt(E,{command:"removeLayer",args:[Y]}),Z.splice(Z.lastIndexOf(Y,Z.length-Ue),1)):Ue++,Re=Z[Z.length-be],Xt(E,{command:"addLayer",args:[U[Y],Re]}),Z.splice(Z.length-be,0,Y),H[Y]=!0);for(let be=0;be<A.length;be++)if(Y=A[be],ie=F[Y],ce=U[Y],!H[Y]&&!Dt(ie,ce))if(Dt(ie.source,ce.source)&&Dt(ie["source-layer"],ce["source-layer"])&&Dt(ie.type,ce.type)){for(pe in cr(ie.layout,ce.layout,E,Y,null,"setLayoutProperty"),cr(ie.paint,ce.paint,E,Y,null,"setPaintProperty"),Dt(ie.filter,ce.filter)||Xt(E,{command:"setFilter",args:[Y,ce.filter]}),Dt(ie.minzoom,ce.minzoom)&&Dt(ie.maxzoom,ce.maxzoom)||Xt(E,{command:"setLayerZoomRange",args:[Y,ce.minzoom,ce.maxzoom]}),ie)Object.prototype.hasOwnProperty.call(ie,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?cr(ie[pe],ce[pe],E,Y,pe.slice(6),"setPaintProperty"):Dt(ie[pe],ce[pe])||Xt(E,{command:"setLayerProperty",args:[Y,pe,ce[pe]]}));for(pe in ce)Object.prototype.hasOwnProperty.call(ce,pe)&&!Object.prototype.hasOwnProperty.call(ie,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?cr(ie[pe],ce[pe],E,Y,pe.slice(6),"setPaintProperty"):Dt(ie[pe],ce[pe])||Xt(E,{command:"setLayerProperty",args:[Y,pe,ce[pe]]}))}else Xt(E,{command:"removeLayer",args:[Y]}),Re=Z[Z.lastIndexOf(Y)+1],Xt(E,{command:"addLayer",args:[ce,Re]})})(_,t.layers,r)}catch(c){console.warn("Unable to compute style diff:",c),r=[{command:"setStyle",args:[t]}]}return r},w.bM=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.bN=lr,w.bO=ci,w.bP=class extends Ni{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.bQ=Nn,w.bR=class extends Ni{constructor(i,t){super(i,t),this.current=Bi}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.bS=Fn,w.bT=class extends Ni{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.bU=class extends Ni{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.bV=Le,w.bW=function(i,t){var r=Math.sin(t),c=Math.cos(t);return i[0]=c,i[1]=r,i[2]=0,i[3]=-r,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},w.bX=function(i,t,r){var c=t[0],f=t[1],_=t[2];return i[0]=c*r[0]+f*r[3]+_*r[6],i[1]=c*r[1]+f*r[4]+_*r[7],i[2]=c*r[2]+f*r[5]+_*r[8],i},w.bY=function(i,t,r,c,f,_,v){var T=1/(t-r),E=1/(c-f),I=1/(_-v);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(t+r)*T,i[13]=(f+c)*E,i[14]=(v+_)*I,i[15]=1,i},w.bZ=class extends Ni{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)t[4*r]=i[r].r,t[4*r+1]=i[r].g,t[4*r+2]=i[r].b,t[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,t)}}},w.b_=class extends Ni{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(i);this.gl.uniform1fv(this.location,t)}}},w.ba=function(){return new Float64Array(16)},w.bb=function(i,t,r){const c=new Float64Array(4);return ar(c,i,t-90,r),c},w.bc=function(i,t,r,c){var f,_,v,T,E,I=t[0],A=t[1],F=t[2],U=t[3],Z=r[0],H=r[1],Y=r[2],ie=r[3];return(_=I*Z+A*H+F*Y+U*ie)<0&&(_=-_,Z=-Z,H=-H,Y=-Y,ie=-ie),1-_>Ce?(f=Math.acos(_),v=Math.sin(f),T=Math.sin((1-c)*f)/v,E=Math.sin(c*f)/v):(T=1-c,E=c),i[0]=T*I+E*Z,i[1]=T*A+E*H,i[2]=T*F+E*Y,i[3]=T*U+E*ie,i},w.bd=function(i){const t=new Float64Array(9);var r,c,f,_,v,T,E,I,A,F,U,Z,H,Y,ie,ce,Re,pe;F=(f=(c=i)[0])*(E=f+f),U=(_=c[1])*E,H=(v=c[2])*E,Y=v*(I=_+_),ce=(T=c[3])*E,Re=T*I,pe=T*(A=v+v),(r=t)[0]=1-(Z=_*I)-(ie=v*A),r[3]=U-pe,r[6]=H+Re,r[1]=U+pe,r[4]=1-F-ie,r[7]=Y-ce,r[2]=H-Re,r[5]=Y+ce,r[8]=1-F-Z;const be=pt(-Math.asin(Kt(t[2],-1,1)));let Ue,We;return Math.hypot(t[5],t[8])<.001?(Ue=0,We=-pt(Math.atan2(t[3],t[4]))):(Ue=pt(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),We=pt(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Ue,pitch:be+90,bearing:We}},w.be=function(i,t){return i.roll==t.roll&&i.pitch==t.pitch&&i.bearing==t.bearing},w.bf=Pr,w.bg=Ko,w.bh=Sn,w.bi=Qn,w.bj=Br,w.bk=Ye,w.bl=jt,w.bm=hi,w.bn=function(i,t,r,c,f){return Ye(c,f,Kt((i-t)/(r-t),0,1))},w.bo=Me,w.bp=function(){return new Float64Array(3)},w.bq=function(i,t,r,c){return i[0]=t[0]+r[0]*c,i[1]=t[1]+r[1]*c,i[2]=t[2]+r[2]*c,i},w.br=ar,w.bs=function(i,t,r){var c=r[0],f=r[1],_=r[2],v=r[3],T=t[0],E=t[1],I=t[2],A=f*I-_*E,F=_*T-c*I,U=c*E-f*T;return i[0]=T+v*(A+=A)+f*(U+=U)-_*(F+=F),i[1]=E+v*F+_*A-c*U,i[2]=I+v*U+c*F-f*A,i},w.bt=function(i,t,r){const c=(f=[i[0],i[1],i[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((A=f[8])*(v=f[4])-(T=f[5])*(I=f[7]))+f[1]*(-A*(_=f[3])+T*(E=f[6]))+f[2]*(I*_-v*E);var f,_,v,T,E,I,A;if(c===0)return null;const F=It([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),U=It([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),Z=It([],[i[0],i[1],i[2]],[t[0],t[1],t[2]]),H=at([],F,-i[3]);return it(H,H,at([],U,-t[3])),it(H,H,at([],Z,-r[3])),at(H,H,1/c),H},w.bu=uy,w.bv=function(){return new Float64Array(4)},w.bw=function(i,t,r,c){var f=[],_=[];return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],_[0]=f[0]*Math.cos(c)-f[1]*Math.sin(c),_[1]=f[0]*Math.sin(c)+f[1]*Math.cos(c),_[2]=f[2],i[0]=_[0]+r[0],i[1]=_[1]+r[1],i[2]=_[2]+r[2],i},w.bx=function(i,t,r,c){var f=[],_=[];return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],_[0]=f[0],_[1]=f[1]*Math.cos(c)-f[2]*Math.sin(c),_[2]=f[1]*Math.sin(c)+f[2]*Math.cos(c),i[0]=_[0]+r[0],i[1]=_[1]+r[1],i[2]=_[2]+r[2],i},w.by=function(i,t,r,c){var f=[],_=[];return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],_[0]=f[2]*Math.sin(c)+f[0]*Math.cos(c),_[1]=f[1],_[2]=f[2]*Math.cos(c)-f[0]*Math.sin(c),i[0]=_[0]+r[0],i[1]=_[1]+r[1],i[2]=_[2]+r[2],i},w.bz=function(i,t,r){var c=Math.sin(r),f=Math.cos(r),_=t[0],v=t[1],T=t[2],E=t[3],I=t[8],A=t[9],F=t[10],U=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*f-I*c,i[1]=v*f-A*c,i[2]=T*f-F*c,i[3]=E*f-U*c,i[8]=_*c+I*f,i[9]=v*c+A*f,i[10]=T*c+F*f,i[11]=E*c+U*f,i},w.c=Te,w.c0=Wm,w.c1=class extends s{},w.c2=ed,w.c3=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.c4=gp,w.c5=function(i,t,r){var c=t[0],f=t[1],_=t[2],v=r[3]*c+r[7]*f+r[11]*_+r[15];return i[0]=(r[0]*c+r[4]*f+r[8]*_+r[12])/(v=v||1),i[1]=(r[1]*c+r[5]*f+r[9]*_+r[13])/v,i[2]=(r[2]*c+r[6]*f+r[10]*_+r[14])/v,i},w.c6=class extends Du{},w.c7=class extends R{},w.c8=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.c9=function(i,t){var r=i[0],c=i[1],f=i[2],_=i[3],v=i[4],T=i[5],E=i[6],I=i[7],A=i[8],F=i[9],U=i[10],Z=i[11],H=i[12],Y=i[13],ie=i[14],ce=i[15],Re=t[0],pe=t[1],be=t[2],Ue=t[3],We=t[4],nt=t[5],Tt=t[6],gt=t[7],wt=t[8],qt=t[9],xt=t[10],St=t[11],et=t[12],ir=t[13],gr=t[14],er=t[15];return Math.abs(r-Re)<=Ce*Math.max(1,Math.abs(r),Math.abs(Re))&&Math.abs(c-pe)<=Ce*Math.max(1,Math.abs(c),Math.abs(pe))&&Math.abs(f-be)<=Ce*Math.max(1,Math.abs(f),Math.abs(be))&&Math.abs(_-Ue)<=Ce*Math.max(1,Math.abs(_),Math.abs(Ue))&&Math.abs(v-We)<=Ce*Math.max(1,Math.abs(v),Math.abs(We))&&Math.abs(T-nt)<=Ce*Math.max(1,Math.abs(T),Math.abs(nt))&&Math.abs(E-Tt)<=Ce*Math.max(1,Math.abs(E),Math.abs(Tt))&&Math.abs(I-gt)<=Ce*Math.max(1,Math.abs(I),Math.abs(gt))&&Math.abs(A-wt)<=Ce*Math.max(1,Math.abs(A),Math.abs(wt))&&Math.abs(F-qt)<=Ce*Math.max(1,Math.abs(F),Math.abs(qt))&&Math.abs(U-xt)<=Ce*Math.max(1,Math.abs(U),Math.abs(xt))&&Math.abs(Z-St)<=Ce*Math.max(1,Math.abs(Z),Math.abs(St))&&Math.abs(H-et)<=Ce*Math.max(1,Math.abs(H),Math.abs(et))&&Math.abs(Y-ir)<=Ce*Math.max(1,Math.abs(Y),Math.abs(ir))&&Math.abs(ie-gr)<=Ce*Math.max(1,Math.abs(ie),Math.abs(gr))&&Math.abs(ce-er)<=Ce*Math.max(1,Math.abs(ce),Math.abs(er))},w.cA=function(i,t){K.REGISTERED_PROTOCOLS[i]=t},w.cB=function(i){delete K.REGISTERED_PROTOCOLS[i]},w.cC=function(i,t){const r={};for(let f=0;f<i.length;f++){const _=t&&t[i[f].id]||op(i[f]);t&&(t[i[f].id]=_);let v=r[_];v||(v=r[_]=[]),v.push(i[f])}const c=[];for(const f in r)c.push(r[f]);return c},w.cD=Et,w.cE=Sv,w.cF=Pv,w.cG=Ym,w.cH=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ht/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,c=t._unevaluatedLayout._values,f={layoutIconSize:c["icon-size"].possiblyEvaluate(new Wr(i.bucket.zoom+1),i.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Wr(i.bucket.zoom+1),i.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Wr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=i.bucket.textSizeData;f.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Wr(I),i.canonical),c["text-size"].possiblyEvaluate(new Wr(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=i.bucket.iconSizeData;f.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Wr(I),i.canonical),c["icon-size"].possiblyEvaluate(new Wr(A),i.canonical)]}const _=r.get("text-line-height")*Jn,v=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",T=r.get("text-keep-upright"),E=r.get("text-size");for(const I of i.bucket.features){const A=r.get("text-font").evaluate(I,{},i.canonical).join(","),F=E.evaluate(I,{},i.canonical),U=f.layoutTextSize.evaluate(I,{},i.canonical),Z=f.layoutIconSize.evaluate(I,{},i.canonical),H={horizontal:{},vertical:void 0},Y=I.text;let ie,ce=[0,0];if(Y){const be=Y.toString(),Ue=r.get("text-letter-spacing").evaluate(I,{},i.canonical)*Jn,We=Zh(be)?Ue:0,nt=r.get("text-anchor").evaluate(I,{},i.canonical),Tt=Fv(t,I,i.canonical);if(!Tt){const xt=r.get("text-radial-offset").evaluate(I,{},i.canonical);ce=xt?Lv(nt,[xt*Jn,fy]):r.get("text-offset").evaluate(I,{},i.canonical).map((St=>St*Jn))}let gt=v?"center":r.get("text-justify").evaluate(I,{},i.canonical);const wt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(I,{},i.canonical)*Jn:1/0,qt=()=>{i.bucket.allowVerticalPlacement&&Gl(be)&&(H.vertical=Ku(Y,i.glyphMap,i.glyphPositions,i.imagePositions,A,wt,_,nt,"left",We,ce,w.ao.vertical,!0,U,F))};if(!v&&Tt){const xt=new Set;if(gt==="auto")for(let et=0;et<Tt.values.length;et+=2)xt.add(py(Tt.values[et]));else xt.add(gt);let St=!1;for(const et of xt)if(!H.horizontal[et])if(St)H.horizontal[et]=H.horizontal[0];else{const ir=Ku(Y,i.glyphMap,i.glyphPositions,i.imagePositions,A,wt,_,"center",et,We,ce,w.ao.horizontal,!1,U,F);ir&&(H.horizontal[et]=ir,St=ir.positionedLines.length===1)}qt()}else{gt==="auto"&&(gt=py(nt));const xt=Ku(Y,i.glyphMap,i.glyphPositions,i.imagePositions,A,wt,_,nt,gt,We,ce,w.ao.horizontal,!1,U,F);xt&&(H.horizontal[gt]=xt),qt(),Gl(be)&&v&&T&&(H.vertical=Ku(Y,i.glyphMap,i.glyphPositions,i.imagePositions,A,wt,_,nt,gt,We,ce,w.ao.vertical,!1,U,F))}}let Re=!1;if(I.icon&&I.icon.name){const be=i.imageMap[I.icon.name];be&&(ie=ke(i.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},i.canonical),r.get("icon-anchor").evaluate(I,{},i.canonical)),Re=!!be.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Re:i.bucket.sdfIcons!==Re&&Nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const pe=jv(H.horizontal)||H.vertical;i.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||ie)&&ew(i.bucket,I,H,ie,i.imageMap,f,U,Z,ce,Re,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.cI=cd,w.cJ=od,w.cK=Ia,w.cL=af,w.cM=fd,w.cN=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.cO=function(i,t,r,c,f){return l(this,void 0,void 0,(function*(){if(Fe())try{return yield xe(i,t,r,c,f)}catch{}return(function(_,v,T,E,I){const A=_.width,F=_.height;Be&&Ke||(Be=new OffscreenCanvas(A,F),Ke=Be.getContext("2d",{willReadFrequently:!0})),Be.width=A,Be.height=F,Ke.drawImage(_,0,0,A,F);const U=Ke.getImageData(v,T,E,I);return Ke.clearRect(0,0,A,F),U.data})(i,t,r,c,f)}))},w.cP=Ui,w.cQ=B,w.cR=ad,w.cS=eo,w.cT=Nl,w.cU=function(i,t){const r=new Map;if(i!=null)if(i.type==="Feature")r.set(Op(i,t),i);else for(const c of i.features)r.set(Op(c,t),c);return r},w.cV=function(i,t){if(i==null)return!0;if(i.type==="Feature")return Op(i,t)!=null;if(i.type==="FeatureCollection"){const r=new Set;for(const c of i.features){const f=Op(c,t);if(f==null||r.has(f))return!1;r.add(f)}return!0}return!1},w.cW=function(i,t,r){var c,f,_,v;if(t.removeAll&&i.clear(),t.remove)for(const T of t.remove)i.delete(T);if(t.add)for(const T of t.add){const E=Op(T,r);E!=null&&i.set(E,T)}if(t.update)for(const T of t.update){let E=i.get(T.id);if(E==null)continue;const I=!T.removeAllProperties&&(((c=T.removeProperties)===null||c===void 0?void 0:c.length)>0||((f=T.addOrUpdateProperties)===null||f===void 0?void 0:f.length)>0);if((T.newGeometry||T.removeAllProperties||I)&&(E=Object.assign({},E),i.set(T.id,E),I&&(E.properties=Object.assign({},E.properties))),T.newGeometry&&(E.geometry=T.newGeometry),T.removeAllProperties)E.properties={};else if(((_=T.removeProperties)===null||_===void 0?void 0:_.length)>0)for(const A of T.removeProperties)Object.prototype.hasOwnProperty.call(E.properties,A)&&delete E.properties[A];if(((v=T.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0)for(const{key:A,value:F}of T.addOrUpdateProperties)E.properties[A]=F}},w.cX=Is,w.ca=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.cb=i=>i.type==="symbol",w.cc=i=>i.type==="circle",w.cd=i=>i.type==="heatmap",w.ce=i=>i.type==="line",w.cf=i=>i.type==="fill",w.cg=i=>i.type==="fill-extrusion",w.ch=i=>i.type==="hillshade",w.ci=i=>i.type==="color-relief",w.cj=i=>i.type==="raster",w.ck=i=>i.type==="background",w.cl=i=>i.type==="custom",w.cm=tr,w.cn=function(i,t,r){const c=_t(t.x-r.x,t.y-r.y),f=_t(i.x-r.x,i.y-r.y);var _,v;return pt(Math.atan2(c[0]*f[1]-c[1]*f[0],(_=c)[0]*(v=f)[0]+_[1]*v[1]))},w.co=fr,w.cp=function(i,t){return _r[t]&&(i instanceof MouseEvent||i instanceof WheelEvent)},w.cq=function(i,t){return Bt[t]&&"touches"in i},w.cr=function(i){return Bt[i]||_r[i]},w.cs=function(i,t,r){var c=t[0],f=t[1];return i[0]=r[0]*c+r[4]*f+r[12],i[1]=r[1]*c+r[5]*f+r[13],i},w.ct=function(i,t){const{x:r,y:c}=Fp.fromLngLat(t);return!(i<0||i>25||c<0||c>=1||r<0||r>=1)},w.cu=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.cv=class extends Pa{},w.cw=rw,w.cy=function(i){return i.message===Sr},w.cz=ue,w.d=Oe,w.e=sr,w.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),w.g=X,w.h=i=>new Promise(((t,r)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame((()=>{c.src=Zn}))},c.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(i)],{type:"image/png"});c.src=i.byteLength?URL.createObjectURL(f):Zn})),w.i=jn,w.j=(i,t)=>Ae(sr(i,{type:"json"}),t),w.k=Je,w.l=rt,w.m=Ae,w.n=(i,t)=>Ae(sr(i,{type:"arrayBuffer"}),t),w.o=function(i){return new fd(i).readFields(Xm,[])},w.p=Lp,w.q=Qs,w.r=fi,w.s=kt,w.t=ql,w.u=Fr,w.v=Pe,w.w=Nr,w.x=Vh,w.y=yo,w.z=Go})),b("worker",["./shared"],(function(w){class l{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,X){for(const ue of K){this._layerConfigs[ue.id]=ue;const ve=this._layers[ue.id]=w.bJ(ue);ve._featureFilter=w.aa(ve.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of X)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const ne=w.cC(Object.values(this._layerConfigs),this.keyCache);for(const ue of ne){const ve=ue.map((Je=>this._layers[Je.id])),Ae=ve[0];if(Ae.visibility==="none")continue;const Oe=Ae.source||"";let ze=this.familiesBySource[Oe];ze||(ze=this.familiesBySource[Oe]={});const qe=Ae.sourceLayer||"_geojsonTileLayer";let rt=ze[qe];rt||(rt=ze[qe]=[]),rt.push(ve)}}}class L{constructor(K){const X={},ne=[];for(const Oe in K){const ze=K[Oe],qe=X[Oe]={};for(const rt in ze){const Je=ze[+rt];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const zt={x:0,y:0,w:Je.bitmap.width+2,h:Je.bitmap.height+2};ne.push(zt),qe[rt]={rect:zt,metrics:Je.metrics}}}const{w:ue,h:ve}=w.p(ne),Ae=new w.q({width:ue||1,height:ve||1});for(const Oe in K){const ze=K[Oe];for(const qe in ze){const rt=ze[+qe];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Je=X[Oe][qe].rect;w.q.copy(rt.bitmap,Ae,{x:0,y:0},{x:Je.x+1,y:Je.y+1},rt.bitmap)}}this.image=Ae,this.positions=X}}w.cD("GlyphAtlas",L);class B{constructor(K){this.tileID=new w.Z(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[],this.globalState=K.globalState}parse(K,X,ne,ue,ve){return w._(this,void 0,void 0,(function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new w.a8;const Ae=new w.cE(Object.keys(K.layers).sort()),Oe=new w.cF(this.tileID,this.promoteId);Oe.bucketLayerIDs=[];const ze={},qe={featureIndex:Oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne,subdivisionGranularity:ve},rt=X.familiesBySource[this.source];for(const cr in rt){const or=K.layers[cr];if(!or)continue;or.version===1&&w.w(`Vector tile source "${this.source}" layer "${cr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const en=Ae.encode(cr),st=[];for(let _n=0;_n<or.length;_n++){const $r=or.feature(_n),vi=Oe.getId($r,cr);st.push({feature:$r,id:vi,index:_n,sourceLayerIndex:en})}for(const _n of rt[cr]){const $r=_n[0];$r.source!==this.source&&w.w(`layer.source = ${$r.source} does not equal this.source = ${this.source}`),$r.minzoom&&this.zoom<Math.floor($r.minzoom)||$r.maxzoom&&this.zoom>=$r.maxzoom||$r.visibility!=="none"&&(V(_n,this.zoom,ne,this.globalState),(ze[$r.id]=$r.createBucket({index:Oe.bucketLayerIDs.length,layers:_n,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:en,sourceID:this.source,globalState:this.globalState})).populate(st,qe,this.tileID.canonical),Oe.bucketLayerIDs.push(_n.map((vi=>vi.id))))}}const Je=w.bN(qe.glyphDependencies,(cr=>Object.keys(cr).map(Number)));this.inFlightDependencies.forEach((cr=>cr==null?void 0:cr.abort())),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(Je).length){const cr=new AbortController;this.inFlightDependencies.push(cr),zt=ue.sendAsync({type:"GG",data:{stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"}},cr)}const Pe=Object.keys(qe.iconDependencies);let $t=Promise.resolve({});if(Pe.length){const cr=new AbortController;this.inFlightDependencies.push(cr),$t=ue.sendAsync({type:"GI",data:{icons:Pe,source:this.source,tileID:this.tileID,type:"icons"}},cr)}const rr=Object.keys(qe.patternDependencies);let Dt=Promise.resolve({});if(rr.length){const cr=new AbortController;this.inFlightDependencies.push(cr),Dt=ue.sendAsync({type:"GI",data:{icons:rr,source:this.source,tileID:this.tileID,type:"patterns"}},cr)}const[Xt,Cr,Kr]=yield Promise.all([zt,$t,Dt]),dn=new L(Xt),Tr=new w.cG(Cr,Kr);for(const cr in ze){const or=ze[cr];or instanceof w.a9?(V(or.layers,this.zoom,ne,this.globalState),w.cH({bucket:or,glyphMap:Xt,glyphPositions:dn.positions,imageMap:Cr,imagePositions:Tr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:qe.subdivisionGranularity})):or.hasPattern&&(or instanceof w.cI||or instanceof w.cJ||or instanceof w.cK)&&(V(or.layers,this.zoom,ne,this.globalState),or.addFeatures(qe,this.tileID.canonical,Tr.patternPositions))}return this.status="done",{buckets:Object.values(ze).filter((cr=>!cr.isEmpty())),featureIndex:Oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dn.image,imageAtlas:Tr,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?Cr:null,glyphPositions:this.returnDependencies?dn.positions:null}}))}}function V(Te,K,X,ne){const ue=new w.F(K);for(const ve of Te)ve.setGlobalState(ne),ve.recalculate(ue,X)}class G{constructor(K,X,ne){this.actor=K,this.layerIndex=X,this.availableImages=ne,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,X){return w._(this,void 0,void 0,(function*(){const ne=yield w.n(K.request,X);try{return{vectorTile:new w.cL(new w.cM(ne.data)),rawData:ne.data,cacheControl:ne.cacheControl,expires:ne.expires}}catch(ue){const ve=new Uint8Array(ne.data);let Ae=`Unable to parse the tile at ${K.request.url}, `;throw Ae+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(Ae)}}))}loadTile(K){return w._(this,void 0,void 0,(function*(){const X=K.uid,ne=!!(K&&K.request&&K.request.collectResourceTiming)&&new w.cN(K.request),ue=new B(K);this.loading[X]=ue;const ve=new AbortController;ue.abort=ve;try{const Ae=yield this.loadVectorTile(K,ve);if(delete this.loading[X],!Ae)return null;const Oe=Ae.rawData,ze={};Ae.expires&&(ze.expires=Ae.expires),Ae.cacheControl&&(ze.cacheControl=Ae.cacheControl);const qe={};if(ne){const Je=ne.finish();Je&&(qe.resourceTiming=JSON.parse(JSON.stringify(Je)))}ue.vectorTile=Ae.vectorTile;const rt=ue.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);this.loaded[X]=ue,this.fetching[X]={rawTileData:Oe,cacheControl:ze,resourceTiming:qe};try{const Je=yield rt;return w.e({rawTileData:Oe.slice(0)},Je,ze,qe)}finally{delete this.fetching[X]}}catch(Ae){throw delete this.loading[X],ue.status="done",this.loaded[X]=ue,Ae}}))}reloadTile(K){return w._(this,void 0,void 0,(function*(){const X=K.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ne=this.loaded[X];if(ne.showCollisionBoxes=K.showCollisionBoxes,ne.globalState=K.globalState,ne.status==="parsing"){const ue=yield ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);let ve;if(this.fetching[X]){const{rawTileData:Ae,cacheControl:Oe,resourceTiming:ze}=this.fetching[X];delete this.fetching[X],ve=w.e({rawTileData:Ae.slice(0)},ue,Oe,ze)}else ve=ue;return ve}if(ne.status==="done"&&ne.vectorTile)return ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity)}))}abortTile(K){return w._(this,void 0,void 0,(function*(){const X=this.loading,ne=K.uid;X&&X[ne]&&X[ne].abort&&(X[ne].abort.abort(),delete X[ne])}))}removeTile(K){return w._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]}))}}class te{constructor(){this.loaded={}}loadTile(K){return w._(this,void 0,void 0,(function*(){const{uid:X,encoding:ne,rawImageData:ue,redFactor:ve,greenFactor:Ae,blueFactor:Oe,baseShift:ze}=K,qe=ue.width+2,rt=ue.height+2,Je=w.b(ue)?new w.R({width:qe,height:rt},yield w.cO(ue,-1,-1,qe,rt)):ue,zt=new w.cP(X,Je,ne,ve,Ae,Oe,ze);return this.loaded=this.loaded||{},this.loaded[X]=zt,zt}))}removeTile(K){const X=this.loaded,ne=K.uid;X&&X[ne]&&delete X[ne]}}var q,Se,ye=(function(){if(Se)return q;function Te(X,ne){if(X.length!==0){K(X[0],ne);for(var ue=1;ue<X.length;ue++)K(X[ue],!ne)}}function K(X,ne){for(var ue=0,ve=0,Ae=0,Oe=X.length,ze=Oe-1;Ae<Oe;ze=Ae++){var qe=(X[Ae][0]-X[ze][0])*(X[ze][1]+X[Ae][1]),rt=ue+qe;ve+=Math.abs(ue)>=Math.abs(qe)?ue-rt+qe:qe-rt+ue,ue=rt}ue+ve>=0!=!!ne&&X.reverse()}return Se=1,q=function X(ne,ue){var ve,Ae=ne&&ne.type;if(Ae==="FeatureCollection")for(ve=0;ve<ne.features.length;ve++)X(ne.features[ve],ue);else if(Ae==="GeometryCollection")for(ve=0;ve<ne.geometries.length;ve++)X(ne.geometries[ve],ue);else if(Ae==="Feature")X(ne.geometry,ue);else if(Ae==="Polygon")Te(ne.coordinates,ue);else if(Ae==="MultiPolygon")for(ve=0;ve<ne.coordinates.length;ve++)Te(ne.coordinates[ve],ue);return ne}})(),fe=w.cQ(ye);class Fe extends w.cS{constructor(K,X){super(new w.cM,0,X,[],[]),this.feature=K,this.type=K.type,this.properties=K.tags?K.tags:{},"id"in K&&(typeof K.id=="string"?this.id=parseInt(K.id,10):typeof K.id!="number"||isNaN(K.id)||(this.id=K.id))}loadGeometry(){const K=[],X=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ne of X){const ue=[];for(const ve of ne)ue.push(new w.P(ve[0],ve[1]));K.push(ue)}return K}}class Ce extends w.cR{constructor(K,X){super(new w.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=X?X.version:1,this.extent=X?X.extent:4096,this.length=K.length,this.features=K}feature(K){return new Fe(this.features[K],this.extent)}}function Ie(Te,K){K.writeVarintField(15,Te.version||1),K.writeStringField(1,Te.name||""),K.writeVarintField(5,Te.extent||4096);const X={keys:[],values:[],keycache:{},valuecache:{}};for(let ve=0;ve<Te.length;ve++)X.feature=Te.feature(ve),K.writeMessage(2,Le,X);const ne=X.keys;for(const ve of ne)K.writeStringField(3,ve);const ue=X.values;for(const ve of ue)K.writeMessage(4,it,ve)}function Le(Te,K){if(!Te.feature)return;const X=Te.feature;X.id!==void 0&&K.writeVarintField(1,X.id),K.writeMessage(2,Xe,Te),K.writeVarintField(3,X.type),K.writeMessage(4,Qe,X)}function Xe(Te,K){var X;for(const ne in(X=Te.feature)==null?void 0:X.properties){let ue=Te.feature.properties[ne],ve=Te.keycache[ne];if(ue===null)continue;ve===void 0&&(Te.keys.push(ne),ve=Te.keys.length-1,Te.keycache[ne]=ve),K.writeVarint(ve),typeof ue!="string"&&typeof ue!="boolean"&&typeof ue!="number"&&(ue=JSON.stringify(ue));const Ae=typeof ue+":"+ue;let Oe=Te.valuecache[Ae];Oe===void 0&&(Te.values.push(ue),Oe=Te.values.length-1,Te.valuecache[Ae]=Oe),K.writeVarint(Oe)}}function mt(Te,K){return(K<<3)+(7&Te)}function yt(Te){return Te<<1^Te>>31}function Qe(Te,K){const X=Te.loadGeometry(),ne=Te.type;let ue=0,ve=0;for(const Ae of X){let Oe=1;ne===1&&(Oe=Ae.length),K.writeVarint(mt(1,Oe));const ze=ne===3?Ae.length-1:Ae.length;for(let qe=0;qe<ze;qe++){qe===1&&ne!==1&&K.writeVarint(mt(2,ze-1));const rt=Ae[qe].x-ue,Je=Ae[qe].y-ve;K.writeVarint(yt(rt)),K.writeVarint(yt(Je)),ue+=rt,ve+=Je}Te.type===3&&K.writeVarint(mt(7,1))}}function it(Te,K){const X=typeof Te;X==="string"?K.writeStringField(1,Te):X==="boolean"?K.writeBooleanField(7,Te):X==="number"&&(Te%1!=0?K.writeDoubleField(3,Te):Te<0?K.writeSVarintField(6,Te):K.writeVarintField(5,Te))}const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Te=>Te},It=Math.fround||(Rt=new Float32Array(1),Te=>(Rt[0]=+Te,Rt[0]));var Rt;class At{constructor(K){this.options=Object.assign(Object.create(at),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:X,minZoom:ne,maxZoom:ue}=this.options;X&&console.time("total time");const ve=`prepare ${K.length} points`;X&&console.time(ve),this.points=K;const Ae=[];for(let ze=0;ze<K.length;ze++){const qe=K[ze];if(!qe.geometry)continue;const[rt,Je]=qe.geometry.coordinates,zt=It(ar(rt)),Pe=It(Zt(Je));Ae.push(zt,Pe,1/0,ze,-1,1),this.options.reduce&&Ae.push(0)}let Oe=this.trees[ue+1]=this._createTree(Ae);X&&console.timeEnd(ve);for(let ze=ue;ze>=ne;ze--){const qe=+Date.now();Oe=this.trees[ze]=this._createTree(this._cluster(Oe,ze)),X&&console.log("z%d: %d clusters in %dms",ze,Oe.numItems,+Date.now()-qe)}return X&&console.timeEnd("total time"),this}getClusters(K,X){let ne=((K[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,K[1]));let ve=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)ne=-180,ve=180;else if(ne>ve){const Je=this.getClusters([ne,ue,180,Ae],X),zt=this.getClusters([-180,ue,ve,Ae],X);return Je.concat(zt)}const Oe=this.trees[this._limitZoom(X)],ze=Oe.range(ar(ne),Zt(Ae),ar(ve),Zt(ue)),qe=Oe.data,rt=[];for(const Je of ze){const zt=this.stride*Je;rt.push(qe[zt+5]>1?Ht(qe,zt,this.clusterProps):this.points[qe[zt+3]])}return rt}getChildren(K){const X=this._getOriginId(K),ne=this._getOriginZoom(K),ue="No cluster with the specified id.",ve=this.trees[ne];if(!ve)throw new Error(ue);const Ae=ve.data;if(X*this.stride>=Ae.length)throw new Error(ue);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),ze=ve.within(Ae[X*this.stride],Ae[X*this.stride+1],Oe),qe=[];for(const rt of ze){const Je=rt*this.stride;Ae[Je+4]===K&&qe.push(Ae[Je+5]>1?Ht(Ae,Je,this.clusterProps):this.points[Ae[Je+3]])}if(qe.length===0)throw new Error(ue);return qe}getLeaves(K,X,ne){const ue=[];return this._appendLeaves(ue,K,X=X||10,ne=ne||0,0),ue}getTile(K,X,ne){const ue=this.trees[this._limitZoom(K)],ve=Math.pow(2,K),{extent:Ae,radius:Oe}=this.options,ze=Oe/Ae,qe=(ne-ze)/ve,rt=(ne+1+ze)/ve,Je={features:[]};return this._addTileFeatures(ue.range((X-ze)/ve,qe,(X+1+ze)/ve,rt),ue.data,X,ne,ve,Je),X===0&&this._addTileFeatures(ue.range(1-ze/ve,qe,1,rt),ue.data,ve,ne,ve,Je),X===ve-1&&this._addTileFeatures(ue.range(0,qe,ze/ve,rt),ue.data,-1,ne,ve,Je),Je.features.length?Je:null}getClusterExpansionZoom(K){let X=this._getOriginZoom(K)-1;for(;X<=this.options.maxZoom;){const ne=this.getChildren(K);if(X++,ne.length!==1)break;K=ne[0].properties.cluster_id}return X}_appendLeaves(K,X,ne,ue,ve){const Ae=this.getChildren(X);for(const Oe of Ae){const ze=Oe.properties;if(ze&&ze.cluster?ve+ze.point_count<=ue?ve+=ze.point_count:ve=this._appendLeaves(K,ze.cluster_id,ne,ue,ve):ve<ue?ve++:K.push(Oe),K.length===ne)break}return ve}_createTree(K){const X=new w.aI(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<K.length;ne+=this.stride)X.add(K[ne],K[ne+1]);return X.finish(),X.data=K,X}_addTileFeatures(K,X,ne,ue,ve,Ae){for(const Oe of K){const ze=Oe*this.stride,qe=X[ze+5]>1;let rt,Je,zt;if(qe)rt=Rr(X,ze,this.clusterProps),Je=X[ze],zt=X[ze+1];else{const rr=this.points[X[ze+3]];rt=rr.properties;const[Dt,Xt]=rr.geometry.coordinates;Je=ar(Dt),zt=Zt(Xt)}const Pe={type:1,geometry:[[Math.round(this.options.extent*(Je*ve-ne)),Math.round(this.options.extent*(zt*ve-ue))]],tags:rt};let $t;$t=qe||this.options.generateId?X[ze+3]:this.points[X[ze+3]].id,$t!==void 0&&(Pe.id=$t),Ae.features.push(Pe)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,X){const{radius:ne,extent:ue,reduce:ve,minPoints:Ae}=this.options,Oe=ne/(ue*Math.pow(2,X)),ze=K.data,qe=[],rt=this.stride;for(let Je=0;Je<ze.length;Je+=rt){if(ze[Je+2]<=X)continue;ze[Je+2]=X;const zt=ze[Je],Pe=ze[Je+1],$t=K.within(ze[Je],ze[Je+1],Oe),rr=ze[Je+5];let Dt=rr;for(const Xt of $t){const Cr=Xt*rt;ze[Cr+2]>X&&(Dt+=ze[Cr+5])}if(Dt>rr&&Dt>=Ae){let Xt,Cr=zt*rr,Kr=Pe*rr,dn=-1;const Tr=(Je/rt<<5)+(X+1)+this.points.length;for(const cr of $t){const or=cr*rt;if(ze[or+2]<=X)continue;ze[or+2]=X;const en=ze[or+5];Cr+=ze[or]*en,Kr+=ze[or+1]*en,ze[or+4]=Tr,ve&&(Xt||(Xt=this._map(ze,Je,!0),dn=this.clusterProps.length,this.clusterProps.push(Xt)),ve(Xt,this._map(ze,or)))}ze[Je+4]=Tr,qe.push(Cr/Dt,Kr/Dt,1/0,Tr,-1,Dt),ve&&qe.push(dn)}else{for(let Xt=0;Xt<rt;Xt++)qe.push(ze[Je+Xt]);if(Dt>1)for(const Xt of $t){const Cr=Xt*rt;if(!(ze[Cr+2]<=X)){ze[Cr+2]=X;for(let Kr=0;Kr<rt;Kr++)qe.push(ze[Cr+Kr])}}}}return qe}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,X,ne){if(K[X+5]>1){const Ae=this.clusterProps[K[X+6]];return ne?Object.assign({},Ae):Ae}const ue=this.points[K[X+3]].properties,ve=this.options.map(ue);return ne&&ve===ue?Object.assign({},ve):ve}}function Ht(Te,K,X){return{type:"Feature",id:Te[K+3],properties:Rr(Te,K,X),geometry:{type:"Point",coordinates:[(ne=Te[K],360*(ne-.5)),_t(Te[K+1])]}};var ne}function Rr(Te,K,X){const ne=Te[K+5],ue=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,ve=Te[K+6],Ae=ve===-1?{}:Object.assign({},X[ve]);return Object.assign(Ae,{cluster:!0,cluster_id:Te[K+3],point_count:ne,point_count_abbreviated:ue})}function ar(Te){return Te/360+.5}function Zt(Te){const K=Math.sin(Te*Math.PI/180),X=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return X<0?0:X>1?1:X}function _t(Te){const K=(180-360*Te)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function ht(Te,K,X,ne){let ue=ne;const ve=K+(X-K>>1);let Ae,Oe=X-K;const ze=Te[K],qe=Te[K+1],rt=Te[X],Je=Te[X+1];for(let zt=K+3;zt<X;zt+=3){const Pe=Ct(Te[zt],Te[zt+1],ze,qe,rt,Je);if(Pe>ue)Ae=zt,ue=Pe;else if(Pe===ue){const $t=Math.abs(zt-ve);$t<Oe&&(Ae=zt,Oe=$t)}}ue>ne&&(Ae-K>3&&ht(Te,K,Ae,ne),Te[Ae+2]=ue,X-Ae>3&&ht(Te,Ae,X,ne))}function Ct(Te,K,X,ne,ue,ve){let Ae=ue-X,Oe=ve-ne;if(Ae!==0||Oe!==0){const ze=((Te-X)*Ae+(K-ne)*Oe)/(Ae*Ae+Oe*Oe);ze>1?(X=ue,ne=ve):ze>0&&(X+=Ae*ze,ne+=Oe*ze)}return Ae=Te-X,Oe=K-ne,Ae*Ae+Oe*Oe}function Me(Te,K,X,ne){const ue={id:Te??null,type:K,geometry:X,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")Ye(ue,X);else if(K==="Polygon")Ye(ue,X[0]);else if(K==="MultiLineString")for(const ve of X)Ye(ue,ve);else if(K==="MultiPolygon")for(const ve of X)Ye(ue,ve[0]);return ue}function Ye(Te,K){for(let X=0;X<K.length;X+=3)Te.minX=Math.min(Te.minX,K[X]),Te.minY=Math.min(Te.minY,K[X+1]),Te.maxX=Math.max(Te.maxX,K[X]),Te.maxY=Math.max(Te.maxY,K[X+1])}function jt(Te,K,X,ne){if(!K.geometry)return;const ue=K.geometry.coordinates;if(ue&&ue.length===0)return;const ve=K.geometry.type,Ae=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Oe=[],ze=K.id;if(X.promoteId?ze=K.properties[X.promoteId]:X.generateId&&(ze=ne||0),ve==="Point")tr(ue,Oe);else if(ve==="MultiPoint")for(const qe of ue)tr(qe,Oe);else if(ve==="LineString")fr(ue,Oe,Ae,!1);else if(ve==="MultiLineString"){if(X.lineMetrics){for(const qe of ue)Oe=[],fr(qe,Oe,Ae,!1),Te.push(Me(ze,"LineString",Oe,K.properties));return}Kt(ue,Oe,Ae,!1)}else if(ve==="Polygon")Kt(ue,Oe,Ae,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const qe of K.geometry.geometries)jt(Te,{id:ze,geometry:qe,properties:K.properties},X,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of ue){const rt=[];Kt(qe,rt,Ae,!0),Oe.push(rt)}}Te.push(Me(ze,ve,Oe,K.properties))}function tr(Te,K){K.push(Lr(Te[0]),sr(Te[1]),0)}function fr(Te,K,X,ne){let ue,ve,Ae=0;for(let ze=0;ze<Te.length;ze++){const qe=Lr(Te[ze][0]),rt=sr(Te[ze][1]);K.push(qe,rt,0),ze>0&&(Ae+=ne?(ue*rt-qe*ve)/2:Math.sqrt(Math.pow(qe-ue,2)+Math.pow(rt-ve,2))),ue=qe,ve=rt}const Oe=K.length-3;K[2]=1,ht(K,0,Oe,X),K[Oe+2]=1,K.size=Math.abs(Ae),K.start=0,K.end=K.size}function Kt(Te,K,X,ne){for(let ue=0;ue<Te.length;ue++){const ve=[];fr(Te[ue],ve,X,ne),K.push(ve)}}function Lr(Te){return Te/360+.5}function sr(Te){const K=Math.sin(Te*Math.PI/180),X=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return X<0?0:X>1?1:X}function yr(Te,K,X,ne,ue,ve,Ae,Oe){if(ne/=K,ve>=(X/=K)&&Ae<ne)return Te;if(Ae<X||ve>=ne)return null;const ze=[];for(const qe of Te){const rt=qe.geometry;let Je=qe.type;const zt=ue===0?qe.minX:qe.minY,Pe=ue===0?qe.maxX:qe.maxY;if(zt>=X&&Pe<ne){ze.push(qe);continue}if(Pe<X||zt>=ne)continue;let $t=[];if(Je==="Point"||Je==="MultiPoint")lr(rt,$t,X,ne,ue);else if(Je==="LineString")ci(rt,$t,X,ne,ue,!1,Oe.lineMetrics);else if(Je==="MultiLineString")Vr(rt,$t,X,ne,ue,!1);else if(Je==="Polygon")Vr(rt,$t,X,ne,ue,!0);else if(Je==="MultiPolygon")for(const rr of rt){const Dt=[];Vr(rr,Dt,X,ne,ue,!0),Dt.length&&$t.push(Dt)}if($t.length){if(Oe.lineMetrics&&Je==="LineString"){for(const rr of $t)ze.push(Me(qe.id,Je,rr,qe.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||($t.length===1?(Je="LineString",$t=$t[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=$t.length===3?"Point":"MultiPoint"),ze.push(Me(qe.id,Je,$t,qe.tags))}}return ze.length?ze:null}function lr(Te,K,X,ne,ue){for(let ve=0;ve<Te.length;ve+=3){const Ae=Te[ve+ue];Ae>=X&&Ae<=ne&&Nr(K,Te[ve],Te[ve+1],Te[ve+2])}}function ci(Te,K,X,ne,ue,ve,Ae){let Oe=ln(Te);const ze=ue===0?Cn:jn;let qe,rt,Je=Te.start;for(let Dt=0;Dt<Te.length-3;Dt+=3){const Xt=Te[Dt],Cr=Te[Dt+1],Kr=Te[Dt+2],dn=Te[Dt+3],Tr=Te[Dt+4],cr=ue===0?Xt:Cr,or=ue===0?dn:Tr;let en=!1;Ae&&(qe=Math.sqrt(Math.pow(Xt-dn,2)+Math.pow(Cr-Tr,2))),cr<X?or>X&&(rt=ze(Oe,Xt,Cr,dn,Tr,X),Ae&&(Oe.start=Je+qe*rt)):cr>ne?or<ne&&(rt=ze(Oe,Xt,Cr,dn,Tr,ne),Ae&&(Oe.start=Je+qe*rt)):Nr(Oe,Xt,Cr,Kr),or<X&&cr>=X&&(rt=ze(Oe,Xt,Cr,dn,Tr,X),en=!0),or>ne&&cr<=ne&&(rt=ze(Oe,Xt,Cr,dn,Tr,ne),en=!0),!ve&&en&&(Ae&&(Oe.end=Je+qe*rt),K.push(Oe),Oe=ln(Te)),Ae&&(Je+=qe)}let zt=Te.length-3;const Pe=Te[zt],$t=Te[zt+1],rr=ue===0?Pe:$t;rr>=X&&rr<=ne&&Nr(Oe,Pe,$t,Te[zt+2]),zt=Oe.length-3,ve&&zt>=3&&(Oe[zt]!==Oe[0]||Oe[zt+1]!==Oe[1])&&Nr(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&K.push(Oe)}function ln(Te){const K=[];return K.size=Te.size,K.start=Te.start,K.end=Te.end,K}function Vr(Te,K,X,ne,ue,ve){for(const Ae of Te)ci(Ae,K,X,ne,ue,ve,!1)}function Nr(Te,K,X,ne){Te.push(K,X,ne)}function Cn(Te,K,X,ne,ue,ve){const Ae=(ve-K)/(ne-K);return Nr(Te,ve,X+(ue-X)*Ae,1),Ae}function jn(Te,K,X,ne,ue,ve){const Ae=(ve-X)/(ue-X);return Nr(Te,K+(ne-K)*Ae,ve,1),Ae}function Xi(Te,K){const X=[];for(let ne=0;ne<Te.length;ne++){const ue=Te[ne],ve=ue.type;let Ae;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ae=zi(ue.geometry,K);else if(ve==="MultiLineString"||ve==="Polygon"){Ae=[];for(const Oe of ue.geometry)Ae.push(zi(Oe,K))}else if(ve==="MultiPolygon"){Ae=[];for(const Oe of ue.geometry){const ze=[];for(const qe of Oe)ze.push(zi(qe,K));Ae.push(ze)}}X.push(Me(ue.id,ve,Ae,ue.tags))}return X}function zi(Te,K){const X=[];X.size=Te.size,Te.start!==void 0&&(X.start=Te.start,X.end=Te.end);for(let ne=0;ne<Te.length;ne+=3)X.push(Te[ne]+K,Te[ne+1],Te[ne+2]);return X}function Zn(Te,K){if(Te.transformed)return Te;const X=1<<Te.z,ne=Te.x,ue=Te.y;for(const ve of Te.features){const Ae=ve.geometry,Oe=ve.type;if(ve.geometry=[],Oe===1)for(let ze=0;ze<Ae.length;ze+=2)ve.geometry.push(xe(Ae[ze],Ae[ze+1],K,X,ne,ue));else for(let ze=0;ze<Ae.length;ze++){const qe=[];for(let rt=0;rt<Ae[ze].length;rt+=2)qe.push(xe(Ae[ze][rt],Ae[ze][rt+1],K,X,ne,ue));ve.geometry.push(qe)}}return Te.transformed=!0,Te}function xe(Te,K,X,ne,ue,ve){return[Math.round(X*(Te*ne-ue)),Math.round(X*(K*ne-ve))]}function Be(Te,K,X,ne,ue){const ve=K===ue.maxZoom?0:ue.tolerance/((1<<K)*ue.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:Te.length,source:null,x:X,y:ne,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of Te)Ke(Ae,Oe,ve,ue);return Ae}function Ke(Te,K,X,ne){const ue=K.geometry,ve=K.type,Ae=[];if(Te.minX=Math.min(Te.minX,K.minX),Te.minY=Math.min(Te.minY,K.minY),Te.maxX=Math.max(Te.maxX,K.maxX),Te.maxY=Math.max(Te.maxY,K.maxY),ve==="Point"||ve==="MultiPoint")for(let Oe=0;Oe<ue.length;Oe+=3)Ae.push(ue[Oe],ue[Oe+1]),Te.numPoints++,Te.numSimplified++;else if(ve==="LineString")kt(Ae,ue,Te,X,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let Oe=0;Oe<ue.length;Oe++)kt(Ae,ue[Oe],Te,X,ve==="Polygon",Oe===0);else if(ve==="MultiPolygon")for(let Oe=0;Oe<ue.length;Oe++){const ze=ue[Oe];for(let qe=0;qe<ze.length;qe++)kt(Ae,ze[qe],Te,X,!0,qe===0)}if(Ae.length){let Oe=K.tags||null;if(ve==="LineString"&&ne.lineMetrics){Oe={};for(const qe in K.tags)Oe[qe]=K.tags[qe];Oe.mapbox_clip_start=ue.start/ue.size,Oe.mapbox_clip_end=ue.end/ue.size}const ze={geometry:Ae,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:Oe};K.id!==null&&(ze.id=K.id),Te.features.push(ze)}}function kt(Te,K,X,ne,ue,ve){const Ae=ne*ne;if(ne>0&&K.size<(ue?Ae:ne))return void(X.numPoints+=K.length/3);const Oe=[];for(let ze=0;ze<K.length;ze+=3)(ne===0||K[ze+2]>Ae)&&(X.numSimplified++,Oe.push(K[ze],K[ze+1])),X.numPoints++;ue&&(function(ze,qe){let rt=0;for(let Je=0,zt=ze.length,Pe=zt-2;Je<zt;Pe=Je,Je+=2)rt+=(ze[Je]-ze[Pe])*(ze[Je+1]+ze[Pe+1]);if(rt>0===qe)for(let Je=0,zt=ze.length;Je<zt/2;Je+=2){const Pe=ze[Je],$t=ze[Je+1];ze[Je]=ze[zt-2-Je],ze[Je+1]=ze[zt-1-Je],ze[zt-2-Je]=Pe,ze[zt-1-Je]=$t}})(Oe,ve),Te.push(Oe)}const vt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class pt{constructor(K,X){const ne=(X=this.options=(function(ve,Ae){for(const Oe in Ae)ve[Oe]=Ae[Oe];return ve})(Object.create(vt),X)).debug;if(ne&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=(function(ve,Ae){const Oe=[];if(ve.type==="FeatureCollection")for(let ze=0;ze<ve.features.length;ze++)jt(Oe,ve.features[ze],Ae,ze);else jt(Oe,ve.type==="Feature"?ve:{geometry:ve},Ae);return Oe})(K,X);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=(function(ve,Ae){const Oe=Ae.buffer/Ae.extent;let ze=ve;const qe=yr(ve,1,-1-Oe,Oe,0,-1,2,Ae),rt=yr(ve,1,1-Oe,2+Oe,0,-1,2,Ae);return(qe||rt)&&(ze=yr(ve,1,-Oe,1+Oe,0,-1,2,Ae)||[],qe&&(ze=Xi(qe,1).concat(ze)),rt&&(ze=ze.concat(Xi(rt,-1)))),ze})(ue,X),ue.length&&this.splitTile(ue,0,0,0),ne&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,X,ne,ue,ve,Ae,Oe){const ze=[K,X,ne,ue],qe=this.options,rt=qe.debug;for(;ze.length;){ue=ze.pop(),ne=ze.pop(),X=ze.pop(),K=ze.pop();const Je=1<<X,zt=Bt(X,ne,ue);let Pe=this.tiles[zt];if(!Pe&&(rt>1&&console.time("creation"),Pe=this.tiles[zt]=Be(K,X,ne,ue,qe),this.tileCoords.push({z:X,x:ne,y:ue}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ne,ue,Pe.numFeatures,Pe.numPoints,Pe.numSimplified),console.timeEnd("creation"));const en=`z${X}`;this.stats[en]=(this.stats[en]||0)+1,this.total++}if(Pe.source=K,ve==null){if(X===qe.indexMaxZoom||Pe.numPoints<=qe.indexMaxPoints)continue}else{if(X===qe.maxZoom||X===ve)continue;if(ve!=null){const en=ve-X;if(ne!==Ae>>en||ue!==Oe>>en)continue}}if(Pe.source=null,K.length===0)continue;rt>1&&console.time("clipping");const $t=.5*qe.buffer/qe.extent,rr=.5-$t,Dt=.5+$t,Xt=1+$t;let Cr=null,Kr=null,dn=null,Tr=null,cr=yr(K,Je,ne-$t,ne+Dt,0,Pe.minX,Pe.maxX,qe),or=yr(K,Je,ne+rr,ne+Xt,0,Pe.minX,Pe.maxX,qe);K=null,cr&&(Cr=yr(cr,Je,ue-$t,ue+Dt,1,Pe.minY,Pe.maxY,qe),Kr=yr(cr,Je,ue+rr,ue+Xt,1,Pe.minY,Pe.maxY,qe),cr=null),or&&(dn=yr(or,Je,ue-$t,ue+Dt,1,Pe.minY,Pe.maxY,qe),Tr=yr(or,Je,ue+rr,ue+Xt,1,Pe.minY,Pe.maxY,qe),or=null),rt>1&&console.timeEnd("clipping"),ze.push(Cr||[],X+1,2*ne,2*ue),ze.push(Kr||[],X+1,2*ne,2*ue+1),ze.push(dn||[],X+1,2*ne+1,2*ue),ze.push(Tr||[],X+1,2*ne+1,2*ue+1)}}getTile(K,X,ne){K=+K,X=+X,ne=+ne;const ue=this.options,{extent:ve,debug:Ae}=ue;if(K<0||K>24)return null;const Oe=1<<K,ze=Bt(K,X=X+Oe&Oe-1,ne);if(this.tiles[ze])return Zn(this.tiles[ze],ve);Ae>1&&console.log("drilling down to z%d-%d-%d",K,X,ne);let qe,rt=K,Je=X,zt=ne;for(;!qe&&rt>0;)rt--,Je>>=1,zt>>=1,qe=this.tiles[Bt(rt,Je,zt)];return qe&&qe.source?(Ae>1&&(console.log("found parent tile z%d-%d-%d",rt,Je,zt),console.time("drilling down")),this.splitTile(qe.source,rt,Je,zt,K,X,ne),Ae>1&&console.timeEnd("drilling down"),this.tiles[ze]?Zn(this.tiles[ze],ve):null):null}}function Bt(Te,K,X){return 32*((1<<Te)*X+K)+Te}class _r extends G{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,X){return w._(this,void 0,void 0,(function*(){const ne=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!ue)return null;const ve=new Ce(ue.features,{version:2,extent:w.$});let Ae=(function(Oe){const ze=new w.cM;return(function(qe,rt){for(const Je in qe.layers)rt.writeMessage(3,Ie,qe.layers[Je])})(Oe,ze),ze.finish()})(ve);return Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),{vectorTile:ve,rawData:Ae.buffer}}))}loadData(K){return w._(this,void 0,void 0,(function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const ne=!!(K&&K.request&&K.request.collectResourceTiming)&&new w.cN(K.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(K,this._pendingRequest);const ue=yield this._pendingData;this._geoJSONIndex=K.cluster?new At((function({superclusterOptions:Ae,clusterProperties:Oe}){if(!Oe||!Ae)return Ae;const ze={},qe={},rt={accumulated:null,zoom:0},Je={properties:null},zt=Object.keys(Oe);for(const Pe of zt){const[$t,rr]=Oe[Pe],Dt=w.cT(rr),Xt=w.cT(typeof $t=="string"?[$t,["accumulated"],["get",Pe]]:$t);ze[Pe]=Dt.value,qe[Pe]=Xt.value}return Ae.map=Pe=>{Je.properties=Pe;const $t={};for(const rr of zt)$t[rr]=ze[rr].evaluate(rt,Je);return $t},Ae.reduce=(Pe,$t)=>{Je.properties=$t;for(const rr of zt)rt.accumulated=Pe[rr],Pe[rr]=qe[rr].evaluate(rt,Je)},Ae})(K)).load(ue.features):(function(Ae,Oe){return new pt(Ae,Oe)})(ue,K.geojsonVtOptions),this.loaded={};const ve={data:ue};if(ne){const Ae=ne.finish();Ae&&(ve.resourceTiming={},ve.resourceTiming[K.source]=JSON.parse(JSON.stringify(Ae)))}return ve}catch(ue){if(delete this._pendingRequest,w.cy(ue))return{abandoned:!0};throw ue}}))}getData(){return w._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(K){const X=this.loaded;return X&&X[K.uid]?super.reloadTile(K):this.loadTile(K)}loadAndProcessGeoJSON(K,X){return w._(this,void 0,void 0,(function*(){let ne=yield this.loadGeoJSON(K,X);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(fe(ne,!0),K.filter){const ue=w.cT(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map((Ae=>`${Ae.key}: ${Ae.message}`)).join(", "));ne={type:"FeatureCollection",features:ne.features.filter((Ae=>ue.value.evaluate({zoom:0},Ae)))}}return ne}))}loadGeoJSON(K,X){return w._(this,void 0,void 0,(function*(){const{promoteId:ne}=K;if(K.request){const ue=yield w.j(K.request,X);return this._dataUpdateable=w.cV(ue.data,ne)?w.cU(ue.data,ne):void 0,ue.data}if(typeof K.data=="string")try{const ue=JSON.parse(K.data);return this._dataUpdateable=w.cV(ue,ne)?w.cU(ue,ne):void 0,ue}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return w.cW(this._dataUpdateable,K.dataDiff,ne),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(K){return w._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class Sr{constructor(K){this.self=K,this.actor=new w.J(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,ne)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=ne},this.self.addProtocol=w.cA,this.self.removeProtocol=w.cB,this.self.registerRTLTextPlugin=X=>{w.cX.setMethods(X)},this.actor.registerMessageHandler("LDT",((X,ne)=>this._getDEMWorkerSource(X,ne.source).loadTile(ne))),this.actor.registerMessageHandler("RDT",((X,ne)=>w._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(X,ne.source).removeTile(ne)})))),this.actor.registerMessageHandler("GCEZ",((X,ne)=>w._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,ne.type,ne.source).getClusterExpansionZoom(ne)})))),this.actor.registerMessageHandler("GCC",((X,ne)=>w._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,ne.type,ne.source).getClusterChildren(ne)})))),this.actor.registerMessageHandler("GCL",((X,ne)=>w._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,ne.type,ne.source).getClusterLeaves(ne)})))),this.actor.registerMessageHandler("LD",((X,ne)=>this._getWorkerSource(X,ne.type,ne.source).loadData(ne))),this.actor.registerMessageHandler("GD",((X,ne)=>this._getWorkerSource(X,ne.type,ne.source).getData())),this.actor.registerMessageHandler("LT",((X,ne)=>this._getWorkerSource(X,ne.type,ne.source).loadTile(ne))),this.actor.registerMessageHandler("RT",((X,ne)=>this._getWorkerSource(X,ne.type,ne.source).reloadTile(ne))),this.actor.registerMessageHandler("AT",((X,ne)=>this._getWorkerSource(X,ne.type,ne.source).abortTile(ne))),this.actor.registerMessageHandler("RMT",((X,ne)=>this._getWorkerSource(X,ne.type,ne.source).removeTile(ne))),this.actor.registerMessageHandler("RS",((X,ne)=>w._(this,void 0,void 0,(function*(){if(!this.workerSources[X]||!this.workerSources[X][ne.type]||!this.workerSources[X][ne.type][ne.source])return;const ue=this.workerSources[X][ne.type][ne.source];delete this.workerSources[X][ne.type][ne.source],ue.removeSource!==void 0&&ue.removeSource(ne)})))),this.actor.registerMessageHandler("RM",(X=>w._(this,void 0,void 0,(function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})))),this.actor.registerMessageHandler("SR",((X,ne)=>w._(this,void 0,void 0,(function*(){this.referrer=ne})))),this.actor.registerMessageHandler("SRPS",((X,ne)=>this._syncRTLPluginState(X,ne))),this.actor.registerMessageHandler("IS",((X,ne)=>w._(this,void 0,void 0,(function*(){this.self.importScripts(ne)})))),this.actor.registerMessageHandler("SI",((X,ne)=>this._setImages(X,ne))),this.actor.registerMessageHandler("UL",((X,ne)=>w._(this,void 0,void 0,(function*(){this._getLayerIndex(X).update(ne.layers,ne.removedIds)})))),this.actor.registerMessageHandler("SL",((X,ne)=>w._(this,void 0,void 0,(function*(){this._getLayerIndex(X).replace(ne)}))))}_setImages(K,X){return w._(this,void 0,void 0,(function*(){this.availableImages[K]=X;for(const ne in this.workerSources[K]){const ue=this.workerSources[K][ne];for(const ve in ue)ue[ve].availableImages=X}}))}_syncRTLPluginState(K,X){return w._(this,void 0,void 0,(function*(){return yield w.cX.syncState(X,this.self.importScripts)}))}_getAvailableImages(K){let X=this.availableImages[K];return X||(X=[]),X}_getLayerIndex(K){let X=this.layerIndexes[K];return X||(X=this.layerIndexes[K]=new l),X}_getWorkerSource(K,X,ne){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][X]||(this.workerSources[K][X]={}),!this.workerSources[K][X][ne]){const ue={sendAsync:(ve,Ae)=>(ve.targetMapId=K,this.actor.sendAsync(ve,Ae))};switch(X){case"vector":this.workerSources[K][X][ne]=new G(ue,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][X][ne]=new _r(ue,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][X][ne]=new this.externalWorkerSourceTypes[X](ue,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][X][ne]}_getDEMWorkerSource(K,X){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][X]||(this.demWorkerSources[K][X]=new te),this.demWorkerSources[K][X]}}return w.i(self)&&(self.worker=new Sr(self)),Sr})),b("index",["exports","./shared"],(function(w,l){var L="5.7.1";function B(){var g=new l.A(4);return l.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let V,G;const te={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,e,s){const h=requestAnimationFrame((y=>{p(),e(y)})),{unsubscribe:p}=l.s(g.signal,"abort",(()=>{p(),cancelAnimationFrame(h),s(l.c())}),!1)},frameAsync(g){return new Promise(((e,s)=>{this.frame(g,e,s)}))},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,s.drawImage(g,0,0,g.width,g.height),s},resolveURL:g=>(V||(V=document.createElement("a")),V.href=g,V.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(G==null&&(G=matchMedia("(prefers-reduced-motion: reduce)")),G.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in q.docStyle)return e[s];return e[0]}static create(e,s,h){const p=window.document.createElement(e);return s!==void 0&&(p.className=s),h&&h.appendChild(p),p}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,s){e.style[q.transformProp]=s}static addEventListener(e,s,h,p={}){e.addEventListener(s,h,"passive"in p?p:p.capture)}static removeEventListener(e,s,h,p={}){e.removeEventListener(s,h,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",q.suppressClickInternal,!0)}),0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,h){const p=s.boundingClientRect;return new l.P((h.clientX-p.left)/s.x-e.clientLeft,(h.clientY-p.top)/s.y-e.clientTop)}static mousePos(e,s){const h=q.getScale(e);return q.getPoint(e,h,s)}static touchPos(e,s){const h=[],p=q.getScale(e);for(let y=0;y<s.length;y++)h.push(q.getPoint(e,p,s[y]));return h}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const s=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),h=s.querySelectorAll("script");for(const p of h)p.remove();return q.clean(s),s.innerHTML}static isPossiblyDangerous(e,s){const h=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!h.includes("javascript:")&&!h.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const s=e.children;for(const h of s)q.removeAttributes(h),q.clean(h)}static removeAttributes(e){for(const{name:s,value:h}of e.attributes)q.isPossiblyDangerous(s,h)&&e.removeAttribute(s)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const Se={supported:!1,testSupport:function(g){!Fe&&fe&&(Ce?Ie(g):ye=g)}};let ye,fe,Fe=!1,Ce=!1;function Ie(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,fe),g.isContextLost())return;Se.supported=!0}catch{}g.deleteTexture(e),Fe=!0}var Le;typeof document<"u"&&(fe=document.createElement("img"),fe.onload=()=>{ye&&Ie(ye),ye=null,Ce=!0},fe.onerror=()=>{Fe=!0,ye=null},fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let e,s,h,p;g.resetRequestQueue=()=>{e=[],s=0,h=0,p={}},g.addThrottleControl=M=>{const R=h++;return p[R]=M,R},g.removeThrottleControl=M=>{delete p[M],S()},g.getImage=(M,R,D=!0)=>new Promise(((N,j)=>{Se.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),l.e(M,{type:"image"}),e.push({abortController:R,requestParameters:M,supportImageRefresh:D,state:"queued",onError:$=>{j($)},onSuccess:$=>{N($)}}),S()}));const y=M=>l._(this,void 0,void 0,(function*(){M.state="running";const{requestParameters:R,supportImageRefresh:D,onError:N,onSuccess:j,abortController:$}=M,W=D===!1&&!l.i(self)&&!l.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce(((oe,ae)=>oe&&ae==="accept"),!0));s++;const re=W?k(R,$):l.m(R,$);try{const oe=yield re;delete M.abortController,M.state="completed",oe.data instanceof HTMLImageElement||l.b(oe.data)?j(oe):oe.data&&j({data:yield(se=oe.data,typeof createImageBitmap=="function"?l.f(se):l.h(se)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete M.abortController,N(oe)}finally{s--,S()}var se})),S=()=>{const M=(()=>{for(const R of Object.keys(p))if(p[R]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=s;R<M&&e.length>0;R++){const D=e.shift();D.abortController.signal.aborted?R--:y(D)}},k=(M,R)=>new Promise(((D,N)=>{const j=new Image,$=M.url,W=M.credentials;W&&W==="include"?j.crossOrigin="use-credentials":(W&&W==="same-origin"||!l.d($))&&(j.crossOrigin="anonymous"),R.signal.addEventListener("abort",(()=>{j.src="",N(l.c())})),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,D({data:j})},j.onerror=()=>{j.onerror=j.onload=null,R.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=$}))})(Le||(Le={})),Le.resetRequestQueue();class Xe{constructor(e){this._transformRequestFn=e??null}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function mt(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const s=[];for(const{id:h,url:p}of g){const y=`${h}${p}`;s.indexOf(y)===-1&&(s.push(y),e.push({id:h,url:p}))}}return e}function yt(g,e,s){try{const h=new URL(g);return h.pathname+=`${e}${s}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Qe(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class it extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:h}of this.requestors)h(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const h=s.spriteData;s.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let h=!0;const p=s.data||s.spriteData;return this._validateStretch(s.stretchX,p&&p.width)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,p&&p.height)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,s){if(!e)return!0;let h=0;for(const p of e){if(p[0]<h||p[1]<p[0]||s<p[1])return!1;h=p[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const h=s.spriteData,p=h&&h.width||s.data.width,y=h&&h.height||s.data.height;return!(e[0]<0||p<e[0]||e[1]<0||y<e[1]||e[2]<0||p<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,h=!0){const p=this.getImage(e);if(h&&(p.data.width!==s.data.width||p.data.height!==s.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=p.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((s,h)=>{let p=!0;if(!this.isLoaded())for(const y of e)this.images[y]||(p=!1);this.isLoaded()||p?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})}))}_getImagesForIds(e){const s={};for(const h of e){let p=this.getImage(h);p||(this.fire(new l.l("styleimagemissing",{id:h})),p=this.getImage(h)),p?s[h]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:l.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],h=this.getImage(e);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new l.I(p,h);this.patterns[e]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:s,h}=l.p(e),p=this.atlasImage;p.resize({width:s||1,height:h||1});for(const y in this.patterns){const{bin:S}=this.patterns[y],k=S.x+1,M=S.y+1,R=this.getImage(y).data,D=R.width,N=R.height;l.R.copy(R,p,{x:0,y:0},{x:k,y:M},{width:D,height:N}),l.R.copy(R,p,{x:0,y:N-1},{x:k,y:M-1},{width:D,height:1}),l.R.copy(R,p,{x:0,y:0},{x:k,y:M+N},{width:D,height:1}),l.R.copy(R,p,{x:D-1,y:0},{x:k-1,y:M},{width:1,height:N}),l.R.copy(R,p,{x:0,y:0},{x:k+D,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.getImage(s);h||l.w(`Image with ID: "${s}" was not found`),Qe(h)&&this.updateImage(s,h)}}}const at=1e20;function It(g,e,s,h,p,y,S,k,M){for(let R=e;R<e+h;R++)Rt(g,s*y+R,y,p,S,k,M);for(let R=s;R<s+p;R++)Rt(g,R*y+e,1,h,S,k,M)}function Rt(g,e,s,h,p,y,S){y[0]=0,S[0]=-at,S[1]=at,p[0]=g[e];for(let k=1,M=0,R=0;k<h;k++){p[k]=g[e+k*s];const D=k*k;do{const N=y[M];R=(p[k]-p[N]+D-N*N)/(k-N)/2}while(R<=S[M]&&--M>-1);M++,y[M]=k,S[M]=R,S[M+1]=at}for(let k=0,M=0;k<h;k++){for(;S[M+1]<k;)M++;const R=y[M],D=k-R;g[e+k*s]=p[R]+D*D}}class At{constructor(e,s,h){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={},this.lang=h}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,(function*(){const s=[];for(const y in e)for(const S of e[y])s.push(this._getAndCacheGlyphsPromise(y,S));const h=yield Promise.all(s),p={};for(const{stack:y,id:S,glyph:k}of h)p[y]||(p[y]={}),p[y][S]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return p}))}_getAndCacheGlyphsPromise(e,s){return l._(this,void 0,void 0,(function*(){let h=this.entries[e];h||(h=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=h.glyphs[s];if(p!==void 0)return{stack:e,id:s,glyph:p};if(p=this._tinySDF(h,e,s),p)return h.glyphs[s]=p,{stack:e,id:s,glyph:p};const y=Math.floor(s/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[y])return{stack:e,id:s,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[y]){const k=At.loadGlyphRange(e,y,this.url,this.requestManager);h.requests[y]=k}const S=yield h.requests[y];for(const k in S)this._doesCharSupportLocalGlyph(+k)||(h.glyphs[+k]=S[+k]);return h.ranges[y]=!0,{stack:e,id:s,glyph:S[s]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e)||l.u["CJK Symbols and Punctuation"](e)||l.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,s,h){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let y=e.tinySDF;if(!y){let k="400";/bold/i.test(s)?k="900":/medium/i.test(s)?k="500":/light/i.test(s)&&(k="200"),y=e.tinySDF=new At.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:p,fontWeight:k})}const S=y.draw(String.fromCharCode(h));return{id:h,bitmap:new l.q({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}At.loadGlyphRange=function(g,e,s,h){return l._(this,void 0,void 0,(function*(){const p=256*e,y=p+255,S=h.transformRequest(s.replace("{fontstack}",g).replace("{range}",`${p}-${y}`),"Glyphs"),k=yield l.n(S,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${y}`);const M={};for(const R of l.o(k.data))M[R.id]=R;return M}))},At.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:s=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:S="normal",lang:k=null}={}){this.buffer=e,this.cutoff=h,this.radius=s,this.lang=k;const M=this.size=g+4*e,R=this._createCanvas(M),D=this.ctx=R.getContext("2d",{willReadFrequently:!0});D.font=`${S} ${y} ${g}px ${p}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(g),S=Math.ceil(s),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),M=Math.min(this.size-this.buffer,S+Math.ceil(h)),R=k+2*this.buffer,D=M+2*this.buffer,N=Math.max(R*D,0),j=new Uint8ClampedArray(N),$={data:j,width:R,height:D,glyphWidth:k,glyphHeight:M,glyphTop:S,glyphLeft:0,glyphAdvance:e};if(k===0||M===0)return $;const{ctx:W,buffer:re,gridInner:se,gridOuter:oe}=this;this.lang&&(W.lang=this.lang),W.clearRect(re,re,k,M),W.fillText(g,re,re+S);const ae=W.getImageData(re,re,k,M);oe.fill(at,0,N),se.fill(0,0,N);for(let de=0;de<M;de++)for(let le=0;le<k;le++){const ge=ae.data[4*(de*k+le)+3]/255;if(ge===0)continue;const we=(de+re)*R+le+re;if(ge===1)oe[we]=0,se[we]=at;else{const he=.5-ge;oe[we]=he>0?he*he:0,se[we]=he<0?he*he:0}}It(oe,0,0,R,D,R,this.f,this.v,this.z),It(se,re,re,k,M,R,this.f,this.v,this.z);for(let de=0;de<N;de++){const le=Math.sqrt(oe[de])-Math.sqrt(se[de]);j[de]=Math.round(255-255*(le/this.radius+this.cutoff))}return $}};class Ht{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,s){return l.B(e.expression.evaluate(s))}interpolate(e,s,h){return{x:l.C.number(e.x,s.x,h),y:l.C.number(e.y,s.y,h),z:l.C.number(e.z,s.z,h)}}}let Rr;class ar extends l.E{constructor(e){super(),Rr=Rr||new l.r({anchor:new l.D(l.v.light.anchor),position:new Ht,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.t(Rr),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(l.x,e,s))for(const h in e){const p=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,h){return(!h||h.validate!==!1)&&l.y(this,e.call(l.z,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const Zt=new l.r({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class _t extends l.E{constructor(e){super(),this._transitionable=new l.t(Zt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0))}setSky(e,s={}){if(!this._validate(l.G,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const h in e){const p=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,h={}){return(h==null?void 0:h.validate)!==!1&&l.y(this,e.call(l.z,l.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ht{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const h=e.join(",")+String(s);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,s)),this.dashEntry[h]}getDashRanges(e,s,h){const p=[];let y=e.length%2==1?-e[e.length-1]*h:0,S=e[0]*h,k=!0;p.push({left:y,right:S,isDash:k,zeroLength:e[0]===0});let M=e[0];for(let R=1;R<e.length;R++){k=!k;const D=e[R];y=M*h,M+=D,S=M*h,p.push({left:y,right:S,isDash:k,zeroLength:D===0})}return p}addRoundDash(e,s,h){const p=s/2;for(let y=-h;y<=h;y++){const S=this.width*(this.nextRow+h+y);let k=0,M=e[k];for(let R=0;R<this.width;R++){R/M.right>1&&(M=e[++k]);const D=Math.abs(R-M.left),N=Math.abs(R-M.right),j=Math.min(D,N);let $;const W=y/h*(p+1);if(M.isDash){const re=p-Math.abs(W);$=Math.sqrt(j*j+re*re)}else $=p-Math.sqrt(j*j+W*W);this.data[S+R]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e){for(let k=e.length-1;k>=0;--k){const M=e[k],R=e[k+1];M.zeroLength?e.splice(k,1):R&&R.isDash===M.isDash&&(R.left=M.left,e.splice(k,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const p=this.width*this.nextRow;let y=0,S=e[y];for(let k=0;k<this.width;k++){k/S.right>1&&(S=e[++y]);const M=Math.abs(k-S.left),R=Math.abs(k-S.right),D=Math.min(M,R);this.data[p+k]=Math.max(0,Math.min(255,(S.isDash?D:-D)+128))}}addDash(e,s){const h=s?7:0,p=2*h+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let k=0;k<e.length;k++)y+=e[k];if(y!==0){const k=this.width/y,M=this.getDashRanges(e,this.width,k);s?this.addRoundDash(M,k,h):this.addRegularDash(M)}const S={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:y};return this.nextRow+=p,this.dirty=!0,S}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Ct="maplibre_preloaded_worker_pool";class Me{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Me.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}const Ye=Math.floor(te.hardwareConcurrency/2);let jt,tr;function fr(){return jt||(jt=new Me),jt}Me.workerCount=l.H(globalThis)?Math.max(Math.min(Ye,3),1):1;class Kt{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const h=this.workerPool.acquire(s);for(let p=0;p<h.length;p++){const y=new l.J(h[p],s);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const h=[];for(const p of this.actors)h.push(p.sendAsync({type:e,data:s}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const h of this.actors)h.registerMessageHandler(e,s)}}function Lr(){return tr||(tr=new Kt(fr(),l.K),tr.registerMessageHandler("GR",((g,e,s)=>l.m(e,s)))),tr}function sr(g,e){const s=l.L();return l.M(s,s,[1,1,0]),l.N(s,s,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?l.O(s,s,g.calculatePosMatrix(e.toUnwrapped())):s}function yr(g,e,s,h,p,y,S){var k;const M=(function(j,$,W){if(j)for(const re of j){const se=$[re];if(se&&se.source===W&&se.type==="fill-extrusion")return!0}else for(const re in $){const se=$[re];if(se.source===W&&se.type==="fill-extrusion")return!0}return!1})((k=p==null?void 0:p.layers)!==null&&k!==void 0?k:null,e,g.id),R=y.maxPitchScaleFactor(),D=g.tilesIn(h,R,M);D.sort(lr);const N=[];for(const j of D)N.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(e,s,g._state,j.queryGeometry,j.cameraQueryGeometry,j.scale,p,y,R,sr(g.transform,j.tileID),S?($,W)=>S(j.tileID,$,W):void 0)});return(function(j,$){for(const W in j)for(const re of j[W])ci(re,$);return j})((function(j){const $={},W={};for(const re of j){const se=re.queryResults,oe=re.wrappedTileID,ae=W[oe]=W[oe]||{};for(const de in se){const le=se[de],ge=ae[de]=ae[de]||{},we=$[de]=$[de]||[];for(const he of le)ge[he.featureIndex]||(ge[he.featureIndex]=!0,we.push(he))}}return $})(N),g)}function lr(g,e){const s=g.tileID,h=e.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function ci(g,e){const s=g.feature,h=e.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=h}function ln(g,e,s){return l._(this,void 0,void 0,(function*(){let h=g;if(g.url?h=(yield l.j(e.transformRequest(g.url,"Source"),s)).data:yield te.frameAsync(s),!h)return null;const p=l.Q(l.e(h,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(p.vectorLayerIds=h.vector_layers.map((y=>y.id))),p}))}class Vr{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}extend(e){const s=this._sw,h=this._ne;let p,y;if(e instanceof l.S)p=e,y=e;else{if(!(e instanceof Vr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Vr.convert(e)):this.extend(l.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.S.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return s||h?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),h.lng=Math.max(y.lng,h.lng),h.lat=Math.max(y.lat,h.lat)):(this._sw=new l.S(p.lng,p.lat),this._ne=new l.S(y.lng,y.lat)),this}getCenter(){return new l.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.S(this.getWest(),this.getNorth())}getSouthEast(){return new l.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:h}=l.S.convert(e);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(e){return e instanceof Vr?e:e&&new Vr(e)}static fromLngLat(e,s=0){const h=360*s/40075017,p=h/Math.cos(Math.PI/180*e.lat);return new Vr(new l.S(e.lng-p,e.lat-h),new l.S(e.lng+p,e.lat+h))}adjustAntiMeridian(){const e=new l.S(this._sw.lng,this._sw.lat),s=new l.S(this._ne.lng,this._ne.lat);return new Vr(e,e.lng>s.lng?new l.S(s.lng+360,s.lat):s)}}class Nr{constructor(e,s,h){this.bounds=Vr.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),h=Math.floor(l.V(this.bounds.getWest())*s),p=Math.floor(l.U(this.bounds.getNorth())*s),y=Math.ceil(l.V(this.bounds.getEast())*s),S=Math.ceil(l.U(this.bounds.getSouth())*s);return e.x>=h&&e.x<y&&e.y>=p&&e.y<S}}class Cn extends l.E{constructor(e,s,h,p){if(super(),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.Q(s,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ln(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new Nr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};h.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((y,S)=>{e.reloadPromise={resolve:y,reject:S}}))}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{const y=yield e.actor.sendAsync({type:p,data:h},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const h=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(h.resolve).catch(h.reject)}}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class jn extends l.E{constructor(e,s,h,p){super(),this.id=e,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},s),l.e(this,l.Q(s,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield ln(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(l.e(this,s),s.bounds&&(this.tileBounds=new Nr(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(s){this._tileJSONRequest=null,this.fire(new l.k(s))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const h=yield Le.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const p=this.map.painter.context,y=p.gl,S=h.data;e.texture=this.map.painter.getTileTexture(S.width),e.texture?e.texture.update(S,{useMipmap:!0}):(e.texture=new l.T(p,S,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}}))}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Xi extends jn{constructor(e,s,h,p){super(e,s,h,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const p=yield Le.getImage(h,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const S=l.b(y)&&l.W()?y:yield this.readImageNow(y),k={type:this.type,uid:e.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const M=yield e.actor.sendAsync({type:"LDT",data:k});e.dem=M,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}}))}readImageNow(e){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.X()){const s=e.width+2,h=e.height+2;try{return new l.R({width:s,height:h},yield l.Y(e,-1,-1,s,h))}catch{}}return te.getImageData(e,1)}))}_getNeighboringTiles(e){const s=e.canonical,h=Math.pow(2,s.z),p=(s.x-1+h)%h,y=s.x===0?e.wrap-1:e.wrap,S=(s.x+1+h)%h,k=s.x+1===h?e.wrap+1:e.wrap,M={};return M[new l.Z(e.overscaledZ,y,s.z,p,s.y).key]={backfilled:!1},M[new l.Z(e.overscaledZ,k,s.z,S,s.y).key]={backfilled:!1},s.y>0&&(M[new l.Z(e.overscaledZ,y,s.z,p,s.y-1).key]={backfilled:!1},M[new l.Z(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},M[new l.Z(e.overscaledZ,k,s.z,S,s.y-1).key]={backfilled:!1}),s.y+1<h&&(M[new l.Z(e.overscaledZ,y,s.z,p,s.y+1).key]={backfilled:!1},M[new l.Z(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},M[new l.Z(e.overscaledZ,k,s.z,S,s.y+1).key]={backfilled:!1}),M}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class zi extends l.E{constructor(e,s,h,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=h.getActor(),this.setEventedParent(p),this._data=s.data,this._options=l.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:l.$,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.$,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(l.$/this.tileSize)}_getClusterMaxZoom(e){const s=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${s}"`),s}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=l.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return l._(this,void 0,void 0,(function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((s=>s.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return l._(this,void 0,void 0,(function*(){const e=new Vr,s=yield this.getData();let h;switch(s.type){case"FeatureCollection":h=s.features.map((p=>this.getCoordinatesFromGeometry(p.geometry))).flat(1/0);break;case"Feature":h=this.getCoordinatesFromGeometry(s.geometry);break;default:h=this.getCoordinatesFromGeometry(s)}if(h.length==0)return e;for(let p=0;p<h.length-1;p+=2)e.extend([h[p],h[p+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:h}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:s}=this._pendingWorkerUpdate;if(!e&&!s)return void l.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const h=l.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(h.request=this.map._requestManager.transformRequest(te.resolveURL(e),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):s&&(h.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));this._data=p.data;let y=null;p.resourceTiming&&p.resourceTiming[this.id]&&(y=p.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(S,{resourceTiming:y}),this.fire(new l.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(p))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const h={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const p=yield this.actor.sendAsync({type:s,data:h},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,s==="RT")}))}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Zn extends l.E{constructor(e,s,h,p){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(e){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield Le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new l.k(s))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(l.a1.fromLngLat);var h;return this.tileID=(function(p){const y=l.a2.fromPoints(p),S=y.width(),k=y.height(),M=Math.max(S,k),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),D=Math.pow(2,R);return new l.a4(R,Math.floor((y.minX+y.maxX)/2*D),Math.floor((y.minY+y.maxY)/2*D))})(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.texture||(this.texture=new l.T(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:s,minY:h,maxX:p,maxY:y}=l.a2.fromPoints(e),S={};for(let k=0;k<=l.a3;k++){const M=Math.pow(2,k),R=Math.floor(s*M),D=Math.floor(h*M),N=Math.floor(p*M),j=Math.floor(y*M);S[k]={minTileX:R,minTileY:D,maxTileX:N,maxTileY:j}}return S}}class xe extends Zn{constructor(e,s,h,p){super(e,s,h,p),this.roundZoom=!0,this.type="video",this.options=s}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield l.a5(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new l.k(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new l.k(new l.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Be extends Zn{constructor(e,s,h,p){super(e,s,h,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((S=>typeof S!="number"))))||this.fire(new l.k(new l.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.a6(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.k(new l.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,h=s.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(s,this.canvas,h.RGBA,{premultiply:!0});let p=!1;for(const y in this.tiles){const S=this.tiles[y];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,p=!0)}p&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ke={},kt=g=>{switch(g){case"geojson":return zi;case"image":return Zn;case"raster":return jn;case"raster-dem":return Xi;case"vector":return Cn;case"video":return xe;case"canvas":return Be}return Ke[g]},vt="RTLPluginLoaded";class pt extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Lr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,(function*(s,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=te.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(vt))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Bt=null;function _r(){return Bt||(Bt=new pt),Bt}class Sr{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a7(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(p,y){const S={};if(!y)return S;for(const k of p){const M=k.layerIds.map((R=>y.getLayer(R))).filter(Boolean);if(M.length!==0){k.layers=M,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((R=>M.filter((D=>D.id===R))[0])));for(const R of M)S[R.id]=k}}return S})(e.buckets,s==null?void 0:s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof l.a9){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof l.a9&&y.hasRTLText){this.hasRTLText=!0,_r().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,h,p,y,S,k,M,R,D,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:S,tileSize:this.tileSize,pixelPosMatrix:D,transform:M,params:k,queryPadding:this.queryPadding*R,getElevation:N},e,s,h):{}}querySourceFeatures(e,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),y=s&&s.sourceLayer?s.sourceLayer:"",S=p._geojsonTileLayer||p[y];if(!S)return;const k=l.aa(s&&s.filter),{z:M,x:R,y:D}=this.tileID.canonical,N={z:M,x:R,y:D};for(let j=0;j<S.length;j++){const $=S.feature(j);if(k.needGeometry){const se=l.ab($,!0);if(!k.filter(new l.F(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!k.filter(new l.F(this.tileID.overscaledZ),$))continue;const W=h.getId($,y),re=new l.ac($,M,R,D,W);re.tile=N,e.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const h=l.ad(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const y=this.expirationTime-s;y?this.expirationTime=h+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const y=this.buckets[p],S=y.layers[0].sourceLayer||"_geojsonTileLayer",k=h[S],M=e[S];if(!k||!M||Object.keys(M).length===0)continue;y.update(M,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=s&&s.style&&s.style.getLayer(p);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<te.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=te.now()+e}setDependencies(e,s){const h={};for(const p of s)h[p]=!0;this.dependencies[e]=h}hasDependency(e,s){for(const h of e){const p=this.dependencies[h];if(p){for(const y of s)if(p[y])return!0}}return!1}}class Te{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,h){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:s,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout((()=>{this.remove(e,y)}),h)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const h=e.wrapped().key,p=s===void 0?0:this.data[h].indexOf(s),y=this.data[h][p];return this.data[h].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const h in this.data)for(const p of this.data[h])e(p.value)||s.push(p);for(const h of s)this.remove(h.value.tileID,h)}}class K{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,h){const p=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},l.e(this.stateChanges[e][p],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==p&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const y in this.state[e][p])h[y]||(this.deletedStates[e][p][y]=null)}else for(const y in h)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][y]===null&&delete this.deletedStates[e][p][y]}removeFeatureState(e,s,h){if(this.deletedStates[e]===null)return;const p=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&s!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][h]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(h in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][h]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,s){const h=String(s),p=l.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][s];if(y===null)return{};for(const S in y)delete p[S]}return p}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const S in this.stateChanges[p])this.state[p][S]||(this.state[p][S]={}),l.e(this.state[p][S],this.stateChanges[p][S]),y[S]=this.state[p][S];h[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const S in this.state[p])y[S]={},this.state[p][S]={};else for(const S in this.deletedStates[p]){if(this.deletedStates[p][S]===null)this.state[p][S]={};else for(const k of Object.keys(this.deletedStates[p][S]))delete this.state[p][S][k];y[S]=this.state[p][S]}h[p]=h[p]||{},l.e(h[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in e)e[p].setFeatureState(h,s)}}const X=89.25;function ne(g,e){const s=l.ah(e.lat,-l.ai,l.ai);return new l.P(l.V(e.lng)*g,l.U(s)*g)}function ue(g,e){return new l.a1(e.x/g,e.y/g).toLngLat()}function ve(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(l.ae(90-g.pitch)),Math.tan(l.ae(X-g.pitch)))}function Ae(g,e){const s=g.canonical,h=e/l.af(s.z),p=s.x+Math.pow(2,s.z)*g.wrap,y=l.ag(new Float64Array(16));return l.M(y,y,[p*h,s.y*h,0]),l.N(y,y,[h/l.$,h/l.$,1]),y}function Oe(g,e,s,h,p){const y=l.a1.fromLngLat(g,e),S=p*l.aj(1,g.lat),k=S*Math.cos(l.ae(s)),M=Math.sqrt(S*S-k*k),R=M*Math.sin(l.ae(-h)),D=M*Math.cos(l.ae(-h));return new l.a1(y.x+R,y.y+D,y.z+k)}function ze(g,e,s){const h=e.intersectsFrustum(g);if(!s||h===0)return h;const p=e.intersectsPlane(s);return p===0?0:h===2&&p===2?2:1}function qe(g,e,s){let h=0;const p=(s-e)/10;for(let y=0;y<10;y++)h+=p*Math.pow(Math.cos(e+(y+.5)/10*(s-e)),g);return h}function rt(g,e){return function(s,h,p,y,S){const k=2*((g-1)/l.ak(Math.cos(l.ae(X-S))/Math.cos(l.ae(X)))-1),M=Math.acos(p/y),R=2*qe(k-1,0,l.ae(S/2)),D=Math.min(l.ae(X),M+l.ae(S/2)),N=qe(k-1,Math.min(D,M-l.ae(S/2)),D),j=Math.atan(h/p),$=Math.hypot(h,p);let W=s;return W+=l.ak(y/$/Math.max(.5,Math.cos(l.ae(S/2)))),W+=k*l.ak(Math.cos(j))/2,W-=l.ak(Math.max(1,N/R/e))/2,W}}const Je=rt(9.314,3);function zt(g,e){const s=(e.roundZoom?Math.round:Math.floor)(g.zoom+l.ak(g.tileSize/e.tileSize));return Math.max(0,s)}function Pe(g,e){const s=g.getCameraFrustum(),h=g.getClippingPlane(),p=g.screenPointToMercatorCoordinate(g.getCameraPoint()),y=l.a1.fromLngLat(g.center,g.elevation);p.z=y.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const S=g.getCoveringTilesDetailsProvider(),k=S.allowVariableZoom(g,e),M=zt(g,e),R=e.minzoom||0,D=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,N=Math.min(Math.max(0,M),D),j=Math.pow(2,N),$=[j*p.x,j*p.y,0],W=[j*y.x,j*y.y,0],re=Math.hypot(y.x-p.x,y.y-p.y),se=Math.abs(y.z-p.z),oe=Math.hypot(re,se),ae=ge=>({zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),de=[],le=[];if(g.renderWorldCopies&&S.allowWorldCopies())for(let ge=1;ge<=3;ge++)de.push(ae(-ge)),de.push(ae(ge));for(de.push(ae(0));de.length>0;){const ge=de.pop(),we=ge.x,he=ge.y;let Ee=ge.fullyVisible;const $e={x:we,y:he,z:ge.zoom},je=S.getTileBoundingVolume($e,ge.wrap,g.elevation,e);if(!Ee){const ft=ze(s,je,h);if(ft===0)continue;Ee=ft===2}const Ne=S.distanceToTile2d(p.x,p.y,$e,je);let Ze=M;k&&(Ze=(e.calculateTileZoom||Je)(g.zoom+l.ak(g.tileSize/e.tileSize),Ne,se,oe,g.fov)),Ze=(e.roundZoom?Math.round:Math.floor)(Ze),Ze=Math.max(0,Ze);const ct=Math.min(Ze,D);if(ge.wrap=S.getWrap(y,$e,ge.wrap),ge.zoom>=ct){if(ge.zoom<R)continue;const ft=N-ge.zoom,tt=$[0]-.5-(we<<ft),Ft=$[1]-.5-(he<<ft),br=e.reparseOverscaled?Math.max(ge.zoom,Ze):ge.zoom;le.push({tileID:new l.Z(ge.zoom===D?br:ge.zoom,ge.wrap,ge.zoom,we,he),distanceSq:l.al([W[0]-.5-we,W[1]-.5-he]),tileDistanceToCamera:Math.sqrt(tt*tt+Ft*Ft)})}else for(let ft=0;ft<4;ft++)de.push({zoom:ge.zoom+1,x:(we<<1)+ft%2,y:(he<<1)+(ft>>1),wrap:ge.wrap,fullyVisible:Ee})}return le.sort(((ge,we)=>ge.distanceSq-we.distanceSq)).map((ge=>ge.tileID))}const $t=l.a2.fromPoints([new l.P(0,0),new l.P(l.$,l.$)]);class rr extends l.E{constructor(e,s,h){super(),this.id=e,this.dispatcher=h,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,y,S,k)=>{const M=new(kt(y.type))(p,y,S,k);if(M.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${M.id}`);return M})(e,s,h,this),this._tiles={},this._cache=new Te(0,(p=>this._unloadTile(p))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new K,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,h){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,h)}catch(p){e.state="errored",p.status!==404?this._source.fire(new l.k(p,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(e),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Dt).map((e=>e.key))}getRenderableIds(e){const s=[];for(const h in this._tiles)this._isIdRenderable(h,e)&&s.push(this._tiles[h]);return e?s.sort(((h,p)=>{const y=h.tileID,S=p.tileID,k=new l.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),M=new l.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-S.overscaledZ||M.y-k.y||M.x-k.x})).map((h=>h.tileID.key)):s.map((h=>h.tileID)).sort(Dt).map((h=>h.key))}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)e?this._reloadTile(s,"expired"):this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(e,s){return l._(this,void 0,void 0,(function*(){const h=this._tiles[e];h&&(h.state!=="loading"&&(h.state=s),yield this._loadTile(h,e,s))}))}_tileLoaded(e,s,h){e.timeAdded=te.now(),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const y=s[p];if(e.neighboringTiles&&e.neighboringTiles[y]){const S=this.getTileByID(y);h(e,S),h(S,e)}}function h(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let S=y.tileID.canonical.x-p.tileID.canonical.x;const k=y.tileID.canonical.y-p.tileID.canonical.y,M=Math.pow(2,p.tileID.canonical.z),R=y.tileID.key;S===0&&k===0||Math.abs(k)>1||(Math.abs(S)>1&&(Math.abs(S+M)===1?S+=M:Math.abs(S-M)===1&&(S-=M)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,S,k),p.neighboringTiles&&p.neighboringTiles[R]&&(p.neighboringTiles[R].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,h,p){for(const y in this._tiles){let S=this._tiles[y];if(p[y]||!S.hasData()||S.tileID.overscaledZ<=s||S.tileID.overscaledZ>h)continue;let k=S.tileID;for(;S&&S.tileID.overscaledZ>s+1;){const R=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[R.key],S&&S.hasData()&&(k=R)}let M=k;for(;M.overscaledZ>s;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]||e[M.canonical.key]){p[k.key]=k;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const h=this._loadedParentTiles[e.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=e.overscaledZ-1;h>=s;h--){const p=e.scaledTo(h),y=this._getLoadedTile(p);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(s*h*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const h={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),h[y.tileID.key]=y}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,s,h,p,y,S){const k={},M={},R=Object.keys(e),D=te.now();for(const N of R){const j=e[N],$=this._tiles[N];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=D)continue;const W=this.findLoadedParent(j,s),re=this.findLoadedSibling(j),se=W||re||null;se&&(this._addTile(se.tileID),k[se.tileID.key]=se.tileID),M[N]=j}this._retainLoadedChildren(M,p,h,e);for(const N in k)e[N]||(this._coveredTiles[N]=!0,e[N]=k[N]);if(S){const N={},j={};for(const $ of y)this._tiles[$.key].hasData()?N[$.key]=$:j[$.key]=$;for(const $ in j){const W=j[$].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(N[W[0].key]=e[W[0].key]=W[0],N[W[1].key]=e[W[1].key]=W[1],N[W[2].key]=e[W[2].key]=W[2],N[W[3].key]=e[W[3].key]=W[3],delete j[$])}for(const $ in j){const W=j[$],re=this.findLoadedParent(W,this._source.minzoom),se=this.findLoadedSibling(W),oe=re||se||null;if(oe){N[oe.tileID.key]=e[oe.tileID.key]=oe.tileID;for(const ae in N)N[ae].isChildOf(oe.tileID)&&delete N[ae]}}for(const $ in this._tiles)N[$]||(this._coveredTiles[$]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let h;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((D=>new l.Z(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y))):(h=Pe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter((D=>this._source.hasTile(D))))):h=[];const p=zt(e,this._source),y=Math.max(p-rr.maxOverzooming,this._source.minzoom),S=Math.max(p+rr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const N of h)if(N.canonical.z>this._source.minzoom){const j=N.scaledTo(N.canonical.z-1);D[j.key]=j;const $=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));D[$.key]=$}h=h.concat(Object.values(D))}const k=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(h,p);Xt(this._source.type)&&this._updateCoveredAndRetainedTiles(M,y,S,p,h,s);for(const D in M)this._tiles[D].clearFadeHold();const R=l.am(this._tiles,M);for(const D of R){const N=this._tiles[D];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var h;const p={},y={},S=Math.max(s-rr.maxOverzooming,this._source.minzoom),k=Math.max(s+rr.maxUnderzooming,this._source.minzoom),M={};for(const R of e){const D=this._addTile(R);p[R.key]=R,D.hasData()||s<this._source.maxzoom&&(M[R.key]=R)}this._retainLoadedChildren(M,s,k,p);for(const R of e){let D=this._tiles[R.key];if(D.hasData())continue;if(s+1>this._source.maxzoom){const j=R.children(this._source.maxzoom)[0],$=this.getTile(j);if($&&$.hasData()){p[j.key]=j;continue}}else{const j=R.children(this._source.maxzoom);if(p[j[0].key]&&p[j[1].key]&&p[j[2].key]&&p[j[3].key])continue}let N=D.wasRequested();for(let j=R.overscaledZ-1;j>=S;--j){const $=R.scaledTo(j);if(y[$.key])break;if(y[$.key]=!0,D=this.getTile($),!D&&N&&(D=this._addTile($)),D){const W=D.hasData();if((W||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||N)&&(p[$.key]=$),N=D.wasRequested(),W)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let h,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}s.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;p=y}for(const y of s)this._loadedParentTiles[y]=h}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,h=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=h}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const h=s;return s||(s=new Sr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,h||this._source.fire(new l.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const h=s.getExpiryTimeout();h&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),h))}refreshTiles(e){for(const s in this._tiles)(this._isIdRenderable(s)||this._tiles[s].state=="errored")&&e.some((h=>h.equals(this._tiles[s].tileID.canonical)))&&this._reloadTile(s,"expired")}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,h){const p=[],y=this.transform;if(!y)return p;const S=y.getCoveringTilesDetailsProvider().allowWorldCopies(),k=h?y.getCameraQueryGeometry(e):e,M=$=>y.screenPointToMercatorCoordinate($,this.terrain),R=this.transformBbox(e,M,!S),D=this.transformBbox(k,M,!S),N=this.getIds(),j=l.a2.fromPoints(D);for(let $=0;$<N.length;$++){const W=this._tiles[N[$]];if(W.holdingForFade())continue;const re=S?[W.tileID]:[W.tileID.unwrapTo(-1),W.tileID.unwrapTo(0)],se=Math.pow(2,y.zoom-W.tileID.overscaledZ),oe=s*W.queryPadding*l.$/W.tileSize/se;for(const ae of re){const de=j.map((le=>ae.getTilePoint(new l.a1(le.x,le.y))));if(de.expandBy(oe),de.intersects($t)){const le=R.map((we=>ae.getTilePoint(we))),ge=D.map((we=>ae.getTilePoint(we)));p.push({tile:W,tileID:S?ae:ae.unwrapTo(0),queryGeometry:le,cameraQueryGeometry:ge,scale:se})}}}return p}transformBbox(e,s,h){let p=e.map(s);if(h){const y=l.a2.fromPoints(e);y.shrinkBy(.001*Math.min(y.width(),y.height()));const S=y.map(s);l.a2.fromPoints(p).covers(S)||(p=p.map((k=>k.x>.5?new l.a1(k.x-1,k.y,k.z):k)))}return p}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map((h=>this._tiles[h].tileID));return this.transform&&this.transform.populateCache(s),s}hasTransition(){if(this._source.hasTransition())return!0;if(Xt(this._source.type)){const e=te.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,h){this._state.updateState(e=e||"_geojsonTileLayer",s,h)}removeFeatureState(e,s,h){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,h)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,h){const p=this._tiles[e];p&&p.setDependencies(s,h)}reloadTilesForDependencies(e,s){for(const h in this._tiles)this._tiles[h].hasDependency(e,s)&&this._reloadTile(h,"reloading");this._cache.filter((h=>!h.hasDependency(e,s)))}}function Dt(g,e){const s=Math.abs(2*g.wrap)-+(g.wrap<0),h=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||h-s||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function Xt(g){return g==="raster"||g==="image"||g==="video"}rr.maxOverzooming=10,rr.maxUnderzooming=3;class Cr{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ah(e,0,1);let s=1,h=this._distances[s];const p=e*this.paddedLength+this.padding;for(;h<p&&s<this._distances.length;)h=this._distances[++s];const y=s-1,S=this._distances[y],k=h-S,M=k>0?(p-S)/k:0;return this.points[y].mult(1-M).add(this.points[s].mult(M))}}function Kr(g,e){let s=!0;return g==="always"||g!=="never"&&e!=="never"||(s=!1),s}class dn{constructor(e,s,h){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(s/h);for(let S=0;S<this.xCellCount*this.yCellCount;S++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,h,p,y){this._forEachCell(s,h,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(e,s,h,p){this._forEachCell(s-p,h-p,s+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(h),this.circles.push(p)}_insertBoxCell(e,s,h,p,y,S){this.boxCells[y].push(S)}_insertCircleCell(e,s,h,p,y,S){this.circleCells[y].push(S)}_query(e,s,h,p,y,S,k){if(h<0||e>this.width||p<0||s>this.height)return[];const M=[];if(e<=0&&s<=0&&this.width<=h&&this.height<=p){if(y)return[{key:null,x1:e,y1:s,x2:h,y2:p}];for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const D=this.circles[3*R],N=this.circles[3*R+1],j=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:D-j,y1:N-j,x2:D+j,y2:N+j})}}else this._forEachCell(e,s,h,p,this._queryCell,M,{hitTest:y,overlapMode:S,seenUids:{box:{},circle:{}}},k);return M}query(e,s,h,p){return this._query(e,s,h,p,!1,null)}hitTest(e,s,h,p,y,S){return this._query(e,s,h,p,!0,y,S).length>0}hitTestCircle(e,s,h,p,y){const S=e-h,k=e+h,M=s-h,R=s+h;if(k<0||S>this.width||R<0||M>this.height)return!1;const D=[];return this._forEachCell(S,M,k,R,this._queryCellCircle,D,{hitTest:!0,overlapMode:p,circle:{x:e,y:s,radius:h},seenUids:{box:{},circle:{}}},y),D.length>0}_queryCell(e,s,h,p,y,S,k,M){const{seenUids:R,hitTest:D,overlapMode:N}=k,j=this.boxCells[y];if(j!==null){const W=this.bboxes;for(const re of j)if(!R.box[re]){R.box[re]=!0;const se=4*re,oe=this.boxKeys[re];if(e<=W[se+2]&&s<=W[se+3]&&h>=W[se+0]&&p>=W[se+1]&&(!M||M(oe))&&(!D||!Kr(N,oe.overlapMode))&&(S.push({key:oe,x1:W[se],y1:W[se+1],x2:W[se+2],y2:W[se+3]}),D))return!0}}const $=this.circleCells[y];if($!==null){const W=this.circles;for(const re of $)if(!R.circle[re]){R.circle[re]=!0;const se=3*re,oe=this.circleKeys[re];if(this._circleAndRectCollide(W[se],W[se+1],W[se+2],e,s,h,p)&&(!M||M(oe))&&(!D||!Kr(N,oe.overlapMode))){const ae=W[se],de=W[se+1],le=W[se+2];if(S.push({key:oe,x1:ae-le,y1:de-le,x2:ae+le,y2:de+le}),D)return!0}}}return!1}_queryCellCircle(e,s,h,p,y,S,k,M){const{circle:R,seenUids:D,overlapMode:N}=k,j=this.boxCells[y];if(j!==null){const W=this.bboxes;for(const re of j)if(!D.box[re]){D.box[re]=!0;const se=4*re,oe=this.boxKeys[re];if(this._circleAndRectCollide(R.x,R.y,R.radius,W[se+0],W[se+1],W[se+2],W[se+3])&&(!M||M(oe))&&!Kr(N,oe.overlapMode))return S.push(!0),!0}}const $=this.circleCells[y];if($!==null){const W=this.circles;for(const re of $)if(!D.circle[re]){D.circle[re]=!0;const se=3*re,oe=this.circleKeys[re];if(this._circlesCollide(W[se],W[se+1],W[se+2],R.x,R.y,R.radius)&&(!M||M(oe))&&!Kr(N,oe.overlapMode))return S.push(!0),!0}}}_forEachCell(e,s,h,p,y,S,k,M){const R=this._convertToXCellCoord(e),D=this._convertToYCellCoord(s),N=this._convertToXCellCoord(h),j=this._convertToYCellCoord(p);for(let $=R;$<=N;$++)for(let W=D;W<=j;W++)if(y.call(this,e,s,h,p,this.xCellCount*W+$,S,k,M))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,h,p,y,S){const k=p-e,M=y-s,R=h+S;return R*R>k*k+M*M}_circleAndRectCollide(e,s,h,p,y,S,k){const M=(S-p)/2,R=Math.abs(e-(p+M));if(R>M+h)return!1;const D=(k-y)/2,N=Math.abs(s-(y+D));if(N>D+h)return!1;if(R<=M||N<=D)return!0;const j=R-M,$=N-D;return j*j+$*$<=h*h}}function Tr(g,e,s){const h=l.L();if(!g){const{vecSouth:N,vecEast:j}=or(e),$=B();$[0]=j[0],$[1]=j[1],$[2]=N[0],$[3]=N[1],p=$,(D=(S=(y=$)[0])*(R=y[3])-(M=y[2])*(k=y[1]))&&(p[0]=R*(D=1/D),p[1]=-k*D,p[2]=-M*D,p[3]=S*D),h[0]=$[0],h[1]=$[1],h[4]=$[2],h[5]=$[3]}var p,y,S,k,M,R,D;return l.N(h,h,[1/s,1/s,1]),h}function cr(g,e,s,h){if(g){const p=l.L();if(!e){const{vecSouth:y,vecEast:S}=or(s);p[0]=S[0],p[1]=S[1],p[4]=y[0],p[5]=y[1]}return l.N(p,p,[h,h,1]),p}return s.pixelsToClipSpaceMatrix}function or(g){const e=Math.cos(g.rollInRadians),s=Math.sin(g.rollInRadians),h=Math.cos(g.pitchInRadians),p=Math.cos(g.bearingInRadians),y=Math.sin(g.bearingInRadians),S=l.ar();S[0]=-p*h*s-y*e,S[1]=-y*h*s+p*e;const k=l.as(S);k<1e-9?l.at(S):l.au(S,S,1/k);const M=l.ar();M[0]=p*h*e-y*s,M[1]=y*h*e+p*s;const R=l.as(M);return R<1e-9?l.at(M):l.au(M,M,1/R),{vecEast:M,vecSouth:S}}function en(g,e,s,h){let p;h?(p=[g,e,h(g,e),1],l.aw(p,p,s)):(p=[g,e,0,1],vl(p,p,s));const y=p[3];return{point:new l.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function st(g,e){return .5+g/e*.5}function _n(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function $r(g,e,s,h,p,y,S,k,M,R,D,N,j){const $=s?g.textSizeData:g.iconSizeData,W=l.an($,e.transform.zoom),re=[256/e.width*2+1,256/e.height*2+1],se=s?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;se.clear();const oe=g.lineVertexArray,ae=s?g.text.placedSymbolArray:g.icon.placedSymbolArray,de=e.transform.width/e.transform.height;let le=!1;for(let ge=0;ge<ae.length;ge++){const we=ae.get(ge);if(we.hidden||we.writingMode===l.ao.vertical&&!le){lo(we.numGlyphs,se);continue}le=!1;const he=new l.P(we.anchorX,we.anchorY),Ee={getElevation:j,pitchedLabelPlaneMatrix:h,lineVertexArray:oe,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:he,unwrappedTileID:M,width:R,height:D,translation:N},$e=la(we.anchorX,we.anchorY,Ee);if(!_n($e.point,re)){lo(we.numGlyphs,se);continue}const je=st(e.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),Ne=l.ap($,W,we),Ze=y?Ne*e.transform.getPitchedTextCorrection(we.anchorX,we.anchorY,M)/je:Ne*je,ct=Pt({projectionContext:Ee,pitchedLabelPlaneMatrixInverse:p,symbol:we,fontSize:Ze,flip:!1,keepUpright:S,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:se,aspectRatio:de,rotateToLine:k});le=ct.useVertical,(ct.notEnoughRoom||le||ct.needsFlipping&&Pt({projectionContext:Ee,pitchedLabelPlaneMatrixInverse:p,symbol:we,fontSize:Ze,flip:!0,keepUpright:S,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:se,aspectRatio:de,rotateToLine:k}).notEnoughRoom)&&lo(we.numGlyphs,se)}s?g.text.dynamicLayoutVertexBuffer.updateData(se):g.icon.dynamicLayoutVertexBuffer.updateData(se)}function vi(g,e,s,h,p,y,S,k){const M=y.glyphStartIndex+y.numGlyphs,R=y.lineStartIndex,D=y.lineStartIndex+y.lineLength,N=e.getoffsetX(y.glyphStartIndex),j=e.getoffsetX(M-1),$=Io(g*N,s,h,p,y.segment,R,D,k,S);if(!$)return null;const W=Io(g*j,s,h,p,y.segment,R,D,k,S);return W?k.projectionCache.anyProjectionOccluded?null:{first:$,last:W}:null}function ao(g,e,s,h){return g===l.ao.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*h?{useVertical:!0}:(g===l.ao.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function Pt(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:s,symbol:h,fontSize:p,flip:y,keepUpright:S,glyphOffsetArray:k,dynamicLayoutVertexArray:M,aspectRatio:R,rotateToLine:D}=g,N=p/24,j=h.lineOffsetX*N,$=h.lineOffsetY*N;let W;if(h.numGlyphs>1){const re=h.glyphStartIndex+h.numGlyphs,se=h.lineStartIndex,oe=h.lineStartIndex+h.lineLength,ae=vi(N,k,j,$,y,h,D,e);if(!ae)return{notEnoughRoom:!0};const de=aa(ae.first.point.x,ae.first.point.y,e,s),le=aa(ae.last.point.x,ae.last.point.y,e,s);if(S&&!y){const ge=ao(h.writingMode,de,le,R);if(ge)return ge}W=[ae.first];for(let ge=h.glyphStartIndex+1;ge<re-1;ge++){const we=Io(N*k.getoffsetX(ge),j,$,y,h.segment,se,oe,e,D);if(!we)return{notEnoughRoom:!0};W.push(we)}W.push(ae.last)}else{if(S&&!y){const se=ti(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,oe=h.lineStartIndex+h.segment+1,ae=new l.P(e.lineVertexArray.getx(oe),e.lineVertexArray.gety(oe)),de=ti(ae.x,ae.y,e),le=de.signedDistanceFromCamera>0?de.point:Dr(e.tileAnchorPoint,ae,se,1,e),ge=aa(se.x,se.y,e,s),we=aa(le.x,le.y,e,s),he=ao(h.writingMode,ge,we,R);if(he)return he}const re=Io(N*k.getoffsetX(h.glyphStartIndex),j,$,y,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,e,D);if(!re||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[re]}for(const re of W)l.av(M,re.point,re.angle);return{}}function Dr(g,e,s,h,p){const y=g.add(g.sub(e)._unit()),S=ti(y.x,y.y,p).point,k=s.sub(S);return s.add(k._mult(h/k.mag()))}function pr(g,e,s){const h=e.projectionCache;if(h.projections[g])return h.projections[g];const p=new l.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),y=ti(p.x,p.y,e);if(y.signedDistanceFromCamera>0)return h.projections[g]=y.point,h.anyProjectionOccluded=h.anyProjectionOccluded||y.isOccluded,y.point;const S=g-s.direction;return Dr(s.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(S),e.lineVertexArray.gety(S)),p,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function ti(g,e,s){const h=g+s.translation[0],p=e+s.translation[1];let y;return s.pitchWithMap?(y=en(h,p,s.pitchedLabelPlaneMatrix,s.getElevation),y.isOccluded=!1):(y=s.transform.projectTileCoordinates(h,p,s.unwrappedTileID,s.getElevation),y.point.x=(.5*y.point.x+.5)*s.width,y.point.y=(.5*-y.point.y+.5)*s.height),y}function aa(g,e,s,h){if(s.pitchWithMap){const p=[g,e,0,1];return l.aw(p,p,h),s.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],s.unwrappedTileID,s.getElevation).point}return{x:g/s.width*2-1,y:1-e/s.height*2}}function la(g,e,s){return s.transform.projectTileCoordinates(g,e,s.unwrappedTileID,s.getElevation)}function xr(g,e,s){return g._unit()._perp()._mult(e*s)}function uc(g,e,s,h,p,y,S,k,M){if(k.projectionCache.offsets[g])return k.projectionCache.offsets[g];const R=s.add(e);if(g+M.direction<h||g+M.direction>=p)return k.projectionCache.offsets[g]=R,R;const D=pr(g+M.direction,k,M),N=xr(D.sub(s),S,M.direction),j=s.add(N),$=D.add(N);return k.projectionCache.offsets[g]=l.ax(y,R,j,$)||R,k.projectionCache.offsets[g]}function Io(g,e,s,h,p,y,S,k,M){const R=h?g-e:g+e;let D=R>0?1:-1,N=0;h&&(D*=-1,N=Math.PI),D<0&&(N+=Math.PI);let j,$=D>0?y+p:y+p+1;k.projectionCache.cachedAnchorPoint?j=k.projectionCache.cachedAnchorPoint:(j=ti(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=j);let W,re,se=j,oe=j,ae=0,de=0;const le=Math.abs(R),ge=[];let we;for(;ae+de<=le;){if($+=D,$<y||$>=S)return null;ae+=de,oe=se,re=W;const $e={absOffsetX:le,direction:D,distanceFromAnchor:ae,previousVertex:oe};if(se=pr($,k,$e),s===0)ge.push(oe),we=se.sub(oe);else{let je;const Ne=se.sub(oe);je=Ne.mag()===0?xr(pr($+D,k,$e).sub(se),s,D):xr(Ne,s,D),re||(re=oe.add(je)),W=uc($,je,se,y,S,re,s,k,$e),ge.push(re),we=W.sub(re)}de=we.mag()}const he=we._mult((le-ae)/de)._add(re||oe),Ee=N+Math.atan2(se.y-oe.y,se.x-oe.x);return ge.push(he),{point:he,angle:M?Ee:0,path:ge}}const hc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lo(g,e){for(let s=0;s<g;s++){const h=e.length;e.resize(h+4),e.float32.set(hc,3*h)}}function vl(g,e,s){const h=e[0],p=e[1];return g[0]=s[0]*h+s[4]*p+s[12],g[1]=s[1]*h+s[5]*p+s[13],g[3]=s[3]*h+s[7]*p+s[15],g}const Er=100;class du{constructor(e,s=new dn(e.width+200,e.height+200,25),h=new dn(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=h,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Er,this.screenBottomBoundary=e.height+Er,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,h,p,y,S,k,M,R,D,N,j){const $=this.projectAndGetPerspectiveRatio(e.anchorPointX+M[0],e.anchorPointY+M[1],y,D,j),W=h*$.perspectiveRatio;let re;if(S||k)re=this._projectCollisionBox(e,W,p,y,S,k,M,$,D,N,j);else{const we=$.x+(N?N.x*W:0),he=$.y+(N?N.y*W:0);re={allPointsOccluded:!1,box:[we+e.x1*W,he+e.y1*W,we+e.x2*W,he+e.y2*W]}}const[se,oe,ae,de]=re.box,le=S?re.allPointsOccluded:$.isOccluded;let ge=le;return ge||(ge=$.perspectiveRatio<this.perspectiveRatioCutoff),ge||(ge=!this.isInsideGrid(se,oe,ae,de)),ge||s!=="always"&&this.grid.hitTest(se,oe,ae,de,s,R)?{box:[se,oe,ae,de],placeable:!1,offscreen:!1,occluded:le}:{box:[se,oe,ae,de],placeable:!0,offscreen:this.isOffscreen(se,oe,ae,de),occluded:le}}placeCollisionCircles(e,s,h,p,y,S,k,M,R,D,N,j,$,W){const re=[],se=new l.P(s.anchorX,s.anchorY),oe=this.getPerspectiveRatio(se.x,se.y,S,W),ae=(R?y*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,S)/oe:y*oe)/l.aB,de={getElevation:W,pitchedLabelPlaneMatrix:k,lineVertexArray:h,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:se,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:$},le=vi(ae,p,s.lineOffsetX*ae,s.lineOffsetY*ae,!1,s,!1,de);let ge=!1,we=!1,he=!0;if(le){const Ee=.5*N*oe+j,$e=new l.P(-100,-100),je=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ne=new Cr,Ze=le.first,ct=le.last;let ft=[];for(let br=Ze.path.length-1;br>=1;br--)ft.push(Ze.path[br]);for(let br=1;br<ct.path.length;br++)ft.push(ct.path[br]);const tt=2.5*Ee;if(R){const br=this.projectPathToScreenSpace(ft,de);ft=br.some((Zr=>Zr.signedDistanceFromCamera<=0))?[]:br.map((Zr=>Zr.point))}let Ft=[];if(ft.length>0){const br=ft[0].clone(),Zr=ft[0].clone();for(let nn=1;nn<ft.length;nn++)br.x=Math.min(br.x,ft[nn].x),br.y=Math.min(br.y,ft[nn].y),Zr.x=Math.max(Zr.x,ft[nn].x),Zr.y=Math.max(Zr.y,ft[nn].y);Ft=br.x>=$e.x&&Zr.x<=je.x&&br.y>=$e.y&&Zr.y<=je.y?[ft]:Zr.x<$e.x||br.x>je.x||Zr.y<$e.y||br.y>je.y?[]:l.ay([ft],$e.x,$e.y,je.x,je.y)}for(const br of Ft){Ne.reset(br,.25*Ee);let Zr=0;Zr=Ne.length<=.5*Ee?1:Math.ceil(Ne.paddedLength/tt)+1;for(let nn=0;nn<Zr;nn++){const Qr=nn/Math.max(Zr-1,1),un=Ne.lerp(Qr),xn=un.x+Er,mr=un.y+Er;re.push(xn,mr,Ee,0);const Xr=xn-Ee,Dn=mr-Ee,Ln=xn+Ee,Kn=mr+Ee;if(he=he&&this.isOffscreen(Xr,Dn,Ln,Kn),we=we||this.isInsideGrid(Xr,Dn,Ln,Kn),e!=="always"&&this.grid.hitTestCircle(xn,mr,Ee,e,D)&&(ge=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!M&&ge||!we||oe<this.perspectiveRatioCutoff?[]:re,offscreen:he,collisionDetected:ge}}projectPathToScreenSpace(e,s){const h=(function(p,y){const S=l.L();return l.aq(S,y.pitchedLabelPlaneMatrix),p.map((k=>{const M=en(k.x,k.y,S,y.getElevation),R=y.transform.projectTileCoordinates(M.point.x,M.point.y,y.unwrappedTileID,y.getElevation);return R.point.x=(.5*R.point.x+.5)*y.width,R.point.y=(.5*-R.point.y+.5)*y.height,R}))})(e,s);return(function(p){let y=0,S=0,k=0,M=0;for(let R=0;R<p.length;R++)p[R].isOccluded?(k=R+1,M=0):(M++,M>S&&(S=M,y=k));return p.slice(y,y+S)})(h)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],h=new l.a2;for(const N of e){const j=new l.P(N.x+Er,N.y+Er);h.extend(j),s.push(j)}const{minX:p,minY:y,maxX:S,maxY:k}=h,M=this.grid.query(p,y,S,k).concat(this.ignoredGrid.query(p,y,S,k)),R={},D={};for(const N of M){const j=N.key;if(R[j.bucketInstanceId]===void 0&&(R[j.bucketInstanceId]={}),R[j.bucketInstanceId][j.featureIndex])continue;const $=[new l.P(N.x1,N.y1),new l.P(N.x2,N.y1),new l.P(N.x2,N.y2),new l.P(N.x1,N.y2)];l.az(s,$)&&(R[j.bucketInstanceId][j.featureIndex]=!0,D[j.bucketInstanceId]===void 0&&(D[j.bucketInstanceId]=[]),D[j.bucketInstanceId].push(j.featureIndex))}return D}insertCollisionBox(e,s,h,p,y,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:S,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,h,p,y,S){const k=h?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:y,collisionGroupID:S,overlapMode:s};for(let R=0;R<e.length;R+=4)k.insertCircle(M,e[R],e[R+1],e[R+2])}projectAndGetPerspectiveRatio(e,s,h,p,y){if(y){let S;p?(S=[e,s,p(e,s),1],l.aw(S,S,y)):(S=[e,s,0,1],vl(S,S,y));const k=S[3];return{x:(S[0]/k+1)/2*this.transform.width+Er,y:(-S[1]/k+1)/2*this.transform.height+Er,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}{const S=this.transform.projectTileCoordinates(e,s,h,p);return{x:(S.point.x+1)/2*this.transform.width+Er,y:(1-S.point.y)/2*this.transform.height+Er,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5,isOccluded:S.isOccluded,signedDistanceFromCamera:S.signedDistanceFromCamera}}}getPerspectiveRatio(e,s,h,p){const y=this.transform.projectTileCoordinates(e,s,h,p);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,s,h,p){return h<Er||e>=this.screenRightBoundary||p<Er||s>this.screenBottomBoundary}isInsideGrid(e,s,h,p){return h>=0&&e<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=l.ag([]);return l.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,h,p,y,S,k,M,R,D,N){let j=1,$=0,W=0,re=1;const se=e.anchorPointX+k[0],oe=e.anchorPointY+k[1];if(S&&!y){const ft=this.projectAndGetPerspectiveRatio(se+1,oe,p,R,N),tt=ft.x-M.x,Ft=Math.atan((ft.y-M.y)/tt)+(tt<0?Math.PI:0),br=Math.sin(Ft),Zr=Math.cos(Ft);j=Zr,$=br,W=-br,re=Zr}else if(!S&&y){const ft=or(this.transform);j=ft.vecEast[0],$=ft.vecEast[1],W=ft.vecSouth[0],re=ft.vecSouth[1]}let ae=M.x,de=M.y,le=s;y&&(ae=se,de=oe,le=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),le*=this.transform.getPitchedTextCorrection(se,oe,p),D||(le*=l.ah(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(ae+=j*D.x*le+W*D.y*le,de+=$*D.x*le+re*D.y*le);const ge=e.x1*le,we=e.x2*le,he=(ge+we)/2,Ee=e.y1*le,$e=e.y2*le,je=(Ee+$e)/2,Ne=[{offsetX:ge,offsetY:Ee},{offsetX:he,offsetY:Ee},{offsetX:we,offsetY:Ee},{offsetX:we,offsetY:je},{offsetX:we,offsetY:$e},{offsetX:he,offsetY:$e},{offsetX:ge,offsetY:$e},{offsetX:ge,offsetY:je}];let Ze=[];for(const{offsetX:ft,offsetY:tt}of Ne)Ze.push(new l.P(ae+j*ft+W*tt,de+$*ft+re*tt));let ct=!1;if(y){const ft=Ze.map((tt=>this.projectAndGetPerspectiveRatio(tt.x,tt.y,p,R,N)));ct=ft.some((tt=>!tt.isOccluded)),Ze=ft.map((tt=>new l.P(tt.x,tt.y)))}else ct=!0;return{box:l.aA(Ze),allPointsOccluded:!ct}}}class xi{constructor(e,s,h,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class on{constructor(e,s,h,p,y){this.text=new xi(e?e.text:null,s,h,y),this.icon=new xi(e?e.icon:null,s,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class dc{constructor(e,s,h){this.text=e,this.icon=s,this.skipFade=h}}class fc{constructor(e,s,h,p,y){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=y}}class fu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[e]}}function Ns(g,e,s,h,p){const{horizontalAlign:y,verticalAlign:S}=l.aH(g);return new l.P(-(y-.5)*e+h[0]*p,-(S-.5)*s+h[1]*p)}class ui{constructor(e,s,h,p,y){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new du(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new fu(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(h,p)=>s.getElevation(e,h,p):null}getBucketParts(e,s,h,p){const y=h.getBucket(s),S=h.latestFeatureIndex;if(!y||!S||s.id!==y.layerIds[0])return;const k=h.collisionBoxArray,M=y.layers[0].layout,R=y.layers[0].paint,D=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),N=h.tileSize/l.$,j=h.tileID.toUnwrapped(),$=M.get("text-rotation-alignment")==="map",W=l.aC(h,1,this.transform.zoom),re=l.aD(this.collisionIndex.transform,h,R.get("text-translate"),R.get("text-translate-anchor")),se=l.aD(this.collisionIndex.transform,h,R.get("icon-translate"),R.get("icon-translate-anchor")),oe=Tr($,this.transform,W);this.retainedQueryData[y.bucketInstanceId]=new fc(y.bucketInstanceId,S,y.sourceLayerIndex,y.index,h.tileID);const ae={bucket:y,layout:M,translationText:re,translationIcon:se,unwrappedTileID:j,pitchedLabelPlaneMatrix:oe,scale:D,textPixelRatio:N,holdingForFade:h.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:l.an(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const de of y.sortKeyRanges){const{sortKey:le,symbolInstanceStart:ge,symbolInstanceEnd:we}=de;e.push({sortKey:le,symbolInstanceStart:ge,symbolInstanceEnd:we,parameters:ae})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(e,s,h,p,y,S,k,M,R,D,N,j,$,W,re,se,oe,ae,de,le){const ge=l.aE[e.textAnchor],we=[e.textOffset0,e.textOffset1],he=Ns(ge,h,p,we,y),Ee=this.collisionIndex.placeCollisionBox(s,j,M,R,D,k,S,se,N.predicate,de,he,le);if((!ae||this.collisionIndex.placeCollisionBox(ae,j,M,R,D,k,S,oe,N.predicate,de,he,le).placeable)&&Ee.placeable){let $e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&($e=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:we,width:h,height:p,anchor:ge,textBoxScale:y,prevAnchor:$e},this.markUsedJustification(W,ge,$,re),W.allowVerticalPlacement&&(this.markUsedOrientation(W,re,$),this.placedOrientations[$.crossTileID]=re),{shift:he,placedGlyphBoxes:Ee}}}placeLayerBucketPart(e,s,h){const{bucket:p,layout:y,translationText:S,translationIcon:k,unwrappedTileID:M,pitchedLabelPlaneMatrix:R,textPixelRatio:D,holdingForFade:N,collisionBoxArray:j,partiallyEvaluatedTextSize:$,collisionGroup:W}=e.parameters,re=y.get("text-optional"),se=y.get("icon-optional"),oe=l.aF(y,"text-overlap","text-allow-overlap"),ae=oe==="always",de=l.aF(y,"icon-overlap","icon-allow-overlap"),le=de==="always",ge=y.get("text-rotation-alignment")==="map",we=y.get("text-pitch-alignment")==="map",he=y.get("icon-text-fit")!=="none",Ee=y.get("symbol-z-order")==="viewport-y",$e=ae&&(le||!p.hasIconData()||se),je=le&&(ae||!p.hasTextData()||re);!p.collisionArrays&&j&&p.deserializeCollisionBoxes(j);const Ne=this.retainedQueryData[p.bucketInstanceId].tileID,Ze=this._getTerrainElevationFunc(Ne),ct=this.transform.getFastPathSimpleProjectionMatrix(Ne),ft=(tt,Ft,br)=>{var Zr,nn;if(s[tt.crossTileID])return;if(N)return void(this.placements[tt.crossTileID]=new dc(!1,!1,!1));let Qr=!1,un=!1,xn=!0,mr=null,Xr={box:null,placeable:!1,offscreen:null,occluded:!1},Dn={placeable:!1},Ln=null,Kn=null,Ti=null,Rs=0,Ho=0,wo=0;Ft.textFeatureIndex?Rs=Ft.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Rs=tt.featureIndex),Ft.verticalTextFeatureIndex&&(Ho=Ft.verticalTextFeatureIndex);const Ja=Ft.textBox;if(Ja){const ji=Fn=>{let Nn=l.ao.horizontal;if(p.allowVerticalPlacement&&!Fn&&this.prevPlacement){const Bi=this.prevPlacement.placedOrientations[tt.crossTileID];Bi&&(this.placedOrientations[tt.crossTileID]=Bi,Nn=Bi,this.markUsedOrientation(p,Nn,tt))}return Nn},Xs=(Fn,Nn)=>{if(p.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Ft.verticalTextBox){for(const Bi of p.writingModes)if(Bi===l.ao.vertical?(Xr=Nn(),Dn=Xr):Xr=Fn(),Xr&&Xr.placeable)break}else Xr=Fn()},Ni=tt.textAnchorOffsetStartIndex,Ko=tt.textAnchorOffsetEndIndex;if(Ko===Ni){const Fn=(Nn,Bi)=>{const Bn=this.collisionIndex.placeCollisionBox(Nn,oe,D,Ne,M,we,ge,S,W.predicate,Ze,void 0,ct);return Bn&&Bn.placeable&&(this.markUsedOrientation(p,Bi,tt),this.placedOrientations[tt.crossTileID]=Bi),Bn};Xs((()=>Fn(Ja,l.ao.horizontal)),(()=>{const Nn=Ft.verticalTextBox;return p.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Nn?Fn(Nn,l.ao.vertical):{box:null,offscreen:null}})),ji(Xr&&Xr.placeable)}else{let Fn=l.aE[(nn=(Zr=this.prevPlacement)===null||Zr===void 0?void 0:Zr.variableOffsets[tt.crossTileID])===null||nn===void 0?void 0:nn.anchor];const Nn=(Bn,$c,Kl)=>{const Xn=Bn.x2-Bn.x1,bs=Bn.y2-Bn.y1,Ys=tt.textBoxScale,Kh=he&&de==="never"?$c:null;let ns=null,Xh=oe==="never"?1:2,Uc="never";Fn&&Xh++;for(let Xo=0;Xo<Xh;Xo++){for(let Xl=Ni;Xl<Ko;Xl++){const So=p.textAnchorOffsets.get(Xl);if(Fn&&So.textAnchor!==Fn)continue;const Yo=this.attemptAnchorPlacement(So,Bn,Xn,bs,Ys,ge,we,D,Ne,M,W,Uc,tt,p,Kl,S,k,Kh,Ze);if(Yo&&(ns=Yo.placedGlyphBoxes,ns&&ns.placeable))return Qr=!0,mr=Yo.shift,ns}Fn?Fn=null:Uc=oe}return h&&!ns&&(ns={box:this.collisionIndex.placeCollisionBox(Ja,"always",D,Ne,M,we,ge,S,W.predicate,Ze,void 0,ct).box,offscreen:!1,placeable:!1,occluded:!1}),ns};Xs((()=>Nn(Ja,Ft.iconBox,l.ao.horizontal)),(()=>{const Bn=Ft.verticalTextBox;return p.allowVerticalPlacement&&(!Xr||!Xr.placeable)&&tt.numVerticalGlyphVertices>0&&Bn?Nn(Bn,Ft.verticalIconBox,l.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Xr&&(Qr=Xr.placeable,xn=Xr.offscreen);const Bi=ji(Xr&&Xr.placeable);if(!Qr&&this.prevPlacement){const Bn=this.prevPlacement.variableOffsets[tt.crossTileID];Bn&&(this.variableOffsets[tt.crossTileID]=Bn,this.markUsedJustification(p,Bn.anchor,tt,Bi))}}}if(Ln=Xr,Qr=Ln&&Ln.placeable,xn=Ln&&Ln.offscreen,tt.useRuntimeCollisionCircles){const ji=p.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Xs=l.ap(p.textSizeData,$,ji),Ni=y.get("text-padding");Kn=this.collisionIndex.placeCollisionCircles(oe,ji,p.lineVertexArray,p.glyphOffsetArray,Xs,M,R,h,we,W.predicate,tt.collisionCircleDiameter,Ni,S,Ze),Kn.circles.length&&Kn.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),Qr=ae||Kn.circles.length>0&&!Kn.collisionDetected,xn=xn&&Kn.offscreen}if(Ft.iconFeatureIndex&&(wo=Ft.iconFeatureIndex),Ft.iconBox){const ji=Xs=>this.collisionIndex.placeCollisionBox(Xs,de,D,Ne,M,we,ge,k,W.predicate,Ze,he&&mr?mr:void 0,ct);Dn&&Dn.placeable&&Ft.verticalIconBox?(Ti=ji(Ft.verticalIconBox),un=Ti.placeable):(Ti=ji(Ft.iconBox),un=Ti.placeable),xn=xn&&Ti.offscreen}const el=re||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,Ea=se||tt.numIconVertices===0;el||Ea?Ea?el||(un=un&&Qr):Qr=un&&Qr:un=Qr=un&&Qr;const tl=un&&Ti.placeable;if(Qr&&Ln.placeable&&this.collisionIndex.insertCollisionBox(Ln.box,oe,y.get("text-ignore-placement"),p.bucketInstanceId,Dn&&Dn.placeable&&Ho?Ho:Rs,W.ID),tl&&this.collisionIndex.insertCollisionBox(Ti.box,de,y.get("icon-ignore-placement"),p.bucketInstanceId,wo,W.ID),Kn&&Qr&&this.collisionIndex.insertCollisionCircles(Kn.circles,oe,y.get("text-ignore-placement"),p.bucketInstanceId,Rs,W.ID),h&&this.storeCollisionData(p.bucketInstanceId,br,Ft,Ln,Ti,Kn),tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new dc((Qr||$e)&&!(Ln!=null&&Ln.occluded),(un||je)&&!(Ti!=null&&Ti.occluded),xn||p.justReloaded),s[tt.crossTileID]=!0};if(Ee){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ft=tt.length-1;Ft>=0;--Ft){const br=tt[Ft];ft(p.symbolInstances.get(br),p.collisionArrays[br],br)}}else for(let tt=e.symbolInstanceStart;tt<e.symbolInstanceEnd;tt++)ft(p.symbolInstances.get(tt),p.collisionArrays[tt],tt);p.justReloaded=!1}storeCollisionData(e,s,h,p,y,S){if(h.textBox||h.iconBox){let k,M;this.collisionBoxArrays.has(e)?k=this.collisionBoxArrays.get(e):(k=new Map,this.collisionBoxArrays.set(e,k)),k.has(s)?M=k.get(s):(M={text:null,icon:null},k.set(s,M)),h.textBox&&(M.text=p.box),h.iconBox&&(M.icon=y.box)}if(S){let k=this.collisionCircleArrays[e];k===void 0&&(k=this.collisionCircleArrays[e]=[]);for(let M=0;M<S.circles.length;M+=4)k.push(S.circles[M+0]-Er),k.push(S.circles[M+1]-Er),k.push(S.circles[M+2]),k.push(S.collisionDetected?1:0)}}markUsedJustification(e,s,h,p){let y;y=p===l.ao.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.aG(s)];const S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const k of S)k>=0&&(e.text.placedSymbolArray.get(k).crossTileID=y>=0&&k!==y?0:h.crossTileID)}markUsedOrientation(e,s,h){const p=s===l.ao.horizontal||s===l.ao.horizontalOnly?s:0,y=s===l.ao.vertical?s:0,S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const k of S)e.text.placedSymbolArray.get(k).placedOrientation=p;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(e):1,y=s?s.opacities:{},S=s?s.variableOffsets:{},k=s?s.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],D=y[M];D?(this.opacities[M]=new on(D,p,R.text,R.icon),h=h||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[M]=new on(null,p,R.text,R.icon,R.skipFade),h=h||R.text||R.icon)}for(const M in y){const R=y[M];if(!this.opacities[M]){const D=new on(R,p,!1,!1);D.isHidden()||(this.opacities[M]=D,h=h||R.text.placed||R.icon.placed)}}for(const M in S)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=S[M]);for(const M in k)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=k[M]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const h={};for(const p of s){const y=p.getBucket(e);y&&p.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,h,p.collisionBoxArray)}}updateBucketOpacities(e,s,h,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const y=e.layers[0],S=y.layout,k=new on(null,0,!1,!1,!0),M=S.get("text-allow-overlap"),R=S.get("icon-allow-overlap"),D=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=S.get("text-rotation-alignment")==="map",j=S.get("text-pitch-alignment")==="map",$=S.get("icon-text-fit")!=="none",W=new on(null,0,M&&(R||!e.hasIconData()||S.get("icon-optional")),R&&(M||!e.hasTextData()||S.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const re=(oe,ae,de)=>{for(let le=0;le<ae/4;le++)oe.opacityVertexArray.emplaceBack(de);oe.hasVisibleVertices=oe.hasVisibleVertices||de!==wl},se=this.collisionBoxArrays.get(e.bucketInstanceId);for(let oe=0;oe<e.symbolInstances.length;oe++){const ae=e.symbolInstances.get(oe),{numHorizontalGlyphVertices:de,numVerticalGlyphVertices:le,crossTileID:ge}=ae;let we=this.opacities[ge];h[ge]?we=k:we||(we=W,this.opacities[ge]=we),h[ge]=!0;const he=ae.numIconVertices>0,Ee=this.placedOrientations[ae.crossTileID],$e=Ee===l.ao.vertical,je=Ee===l.ao.horizontal||Ee===l.ao.horizontalOnly;if(de>0||le>0){const Ze=bl(we.text);re(e.text,de,$e?wl:Ze),re(e.text,le,je?wl:Ze);const ct=we.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach((Ft=>{Ft>=0&&(e.text.placedSymbolArray.get(Ft).hidden=ct||$e?1:0)})),ae.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=ct||je?1:0);const ft=this.variableOffsets[ae.crossTileID];ft&&this.markUsedJustification(e,ft.anchor,ae,Ee);const tt=this.placedOrientations[ae.crossTileID];tt&&(this.markUsedJustification(e,"left",ae,tt),this.markUsedOrientation(e,tt,ae))}if(he){const Ze=bl(we.icon),ct=!($&&ae.verticalPlacedIconSymbolIndex&&$e);ae.placedIconSymbolIndex>=0&&(re(e.icon,ae.numIconVertices,ct?Ze:wl),e.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=we.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(re(e.icon,ae.numVerticalIconVertices,ct?wl:Ze),e.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const Ne=se&&se.has(oe)?se.get(oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ze=e.collisionArrays[oe];if(Ze){let ct=new l.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let ft=!0;if(D){const tt=this.variableOffsets[ge];tt?(ct=Ns(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),N&&ct._rotate(j?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ft=!1}if(Ze.textBox||Ze.verticalTextBox){let tt;Ze.textBox&&(tt=$e),Ze.verticalTextBox&&(tt=je),gh(e.textCollisionBox.collisionVertexArray,we.text.placed,!ft||tt,Ne.text,ct.x,ct.y)}}if(Ze.iconBox||Ze.verticalIconBox){const ft=!!(!je&&Ze.verticalIconBox);let tt;Ze.iconBox&&(tt=ft),Ze.verticalIconBox&&(tt=!ft),gh(e.iconCollisionBox.collisionVertexArray,we.icon.placed,tt,Ne.icon,$?ct.x:0,$?ct.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function gh(g,e,s,h,p,y){h&&h.length!==0||(h=[0,0,0,0]);const S=h[0]-Er,k=h[1]-Er,M=h[2]-Er,R=h[3]-Er;g.emplaceBack(e?1:0,s?1:0,p||0,y||0,S,k),g.emplaceBack(e?1:0,s?1:0,p||0,y||0,M,k),g.emplaceBack(e?1:0,s?1:0,p||0,y||0,M,R),g.emplaceBack(e?1:0,s?1:0,p||0,y||0,S,R)}const Es=Math.pow(2,25),Ud=Math.pow(2,24),xl=Math.pow(2,17),Vd=Math.pow(2,16),pu=Math.pow(2,9),mu=Math.pow(2,8),pc=Math.pow(2,1);function bl(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,s=Math.floor(127*g.opacity);return s*Es+e*Ud+s*xl+e*Vd+s*pu+e*mu+s*pc+e}const wl=0;class yh{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,h,p,y){const S=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(S,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(((k,M)=>k.sortKey-M.sortKey)));this._currentPartIndex<S.length;)if(s.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,y())return!0;return!1}}class mc{constructor(e,s,h,p,y,S,k,M){this.placement=new ui(e,s,S,k,M),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,s,h){const p=te.now(),y=()=>!this._forceFullPlacement&&te.now()-p>2;for(;this._currentPlacementIndex>=0;){const S=s[e[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=k)&&(!S.maxzoom||S.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new yh(S)),this._inProgressLayer.continuePlacement(h[S.source],this.placement,this._showCollisionBoxes,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Oa=512/l.$/2;class gc{constructor(e,s,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};const p=new Map;for(let y=0;y<s.length;y++){const S=s.get(y),k=S.key,M=p.get(k);M?M.push(S):p.set(k,[S])}for(const[y,S]of p){const k={positions:S.map((M=>({x:Math.floor(M.anchorX*Oa),y:Math.floor(M.anchorY*Oa)}))),crossTileIDs:S.map((M=>M.crossTileID))};if(k.positions.length>128){const M=new l.aI(k.positions.length,16,Uint16Array);for(const{x:R,y:D}of k.positions)M.add(R,D);M.finish(),delete k.positions,k.index=M}this._symbolsByKey[y]=k}}getScaledCoordinates(e,s){const{x:h,y:p,z:y}=this.tileID.canonical,{x:S,y:k,z:M}=s.canonical,R=Oa/Math.pow(2,M-y),D=(k*l.$+e.anchorY)*R,N=p*l.$*Oa;return{x:Math.floor((S*l.$+e.anchorX)*R-h*l.$*Oa),y:Math.floor(D-N)}}findMatches(e,s,h){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<e.length;y++){const S=e.get(y);if(S.crossTileID)continue;const k=this._symbolsByKey[S.key];if(!k)continue;const M=this.getScaledCoordinates(S,s);if(k.index){const R=k.index.range(M.x-p,M.y-p,M.x+p,M.y+p).sort();for(const D of R){const N=k.crossTileIDs[D];if(!h[N]){h[N]=!0,S.crossTileID=N;break}}}else if(k.positions)for(let R=0;R<k.positions.length;R++){const D=k.positions[R],N=k.crossTileIDs[R];if(Math.abs(D.x-M.x)<=p&&Math.abs(D.y-M.y)<=p&&!h[N]){h[N]=!0,S.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const h in this.indexes){const p=this.indexes[h],y={};for(const S in p){const k=p[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+s),y[k.tileID.key]=k}this.indexes[h]=y}this.lng=e}addBucket(e,s,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const S=this.indexes[y];if(Number(y)>e.overscaledZ)for(const k in S){const M=S[k];M.tileID.isChildOf(e)&&M.findMatches(s.symbolInstances,e,p)}else{const k=S[e.scaledTo(Number(y)).key];k&&k.findMatches(s.symbolInstances,e,p)}}for(let y=0;y<s.symbolInstances.length;y++){const S=s.symbolInstances.get(y);S.crossTileID||(S.crossTileID=h.generate(),p[S.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new gc(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const h of s.getCrossTileIDsLists())for(const p of h)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let s=!1;for(const h in this.indexes){const p=this.indexes[h];for(const y in p)e[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[y]),delete p[y],s=!0)}return s}}class ca{constructor(){this.layerIndexes={},this.crossTileIDs=new ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,h){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new Yf);let y=!1;const S={};p.handleWrapJump(h);for(const k of s){const M=k.getBucket(e);M&&e.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(k.tileID,M,this.crossTileIDs)&&(y=!0),S[M.bucketInstanceId]=!0)}return p.removeStaleBuckets(S)&&(y=!0),y}pruneUnusedLayers(e){const s={};e.forEach((h=>{s[h]=!0}));for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}var qr="void main() {fragColor=vec4(1.0);}";const ks={prelude:kr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:kr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:kr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:kr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:kr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:kr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:kr(qr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:kr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:kr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:kr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:kr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:kr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:kr(qr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:kr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:kr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:kr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:kr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:kr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:kr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:kr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:kr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:kr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:kr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:kr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:kr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:kr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:kr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:kr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:kr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:kr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:kr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:kr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:kr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:kr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function kr(g,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/in ([\w]+) ([\w]+)/g),p=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=y?y.concat(p):p,k={};return{fragmentSource:g=g.replace(s,((M,R,D,N,j)=>(k[j]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${D} ${N} ${j};
#else
uniform ${D} ${N} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${D} ${N} ${j} = u_${j};
#endif
`))),vertexSource:e=e.replace(s,((M,R,D,N,j)=>{const $=N==="float"?"vec2":"vec4",W=j.match(/color/)?"color":$;return k[j]?R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${D} ${$} a_${j};
out ${D} ${N} ${j};
#else
uniform ${D} ${N} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${D} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${D} ${N} ${j} = u_${j};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${D} ${$} a_${j};
#else
uniform ${D} ${N} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${D} ${N} ${j} = a_${j};
#else
    ${D} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${D} ${N} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${D} ${N} ${j} = u_${j};
#endif
`})),staticAttributes:h,staticUniforms:S}}class Ao{constructor(e,s,h){this.vertexBuffer=e,this.indexBuffer=s,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var zo=l.aJ([{name:"a_pos",type:"Int16",components:2}]);const co="#define PROJECTION_MERCATOR",ua="mercator";class Pr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ua}get shaderDefine(){return co}get shaderPreludeCode(){return ks.projectionMercator}get vertexShaderPreludeCode(){return ks.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,s,h,p,y){if(this._cachedMesh)return this._cachedMesh;const S=new l.aL;S.emplaceBack(0,0),S.emplaceBack(l.$,0),S.emplaceBack(0,l.$),S.emplaceBack(l.$,l.$);const k=e.createVertexBuffer(S,zo.members),M=l.aM.simpleSegment(0,0,4,2),R=new l.aN;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const D=e.createIndexBuffer(R);return this._cachedMesh=new Ao(k,D,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class uo{constructor(e=0,s=0,h=0,p=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=h,this.right=p}interpolate(e,s,h){return s.top!=null&&e.top!=null&&(this.top=l.C.number(e.top,s.top,h)),s.bottom!=null&&e.bottom!=null&&(this.bottom=l.C.number(e.bottom,s.bottom,h)),s.left!=null&&e.left!=null&&(this.left=l.C.number(e.left,s.left,h)),s.right!=null&&e.right!=null&&(this.right=l.C.number(e.right,s.right,h)),this}getCenter(e,s){const h=l.ah((this.left+e-this.right)/2,0,e),p=l.ah((this.top+s-this.bottom)/2,0,s);return new l.P(h,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new uo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bs(g,e){if(!g.renderWorldCopies||g.lngRange)return;const s=e.lng-g.center.lng;e.lng+=s>180?-360:s<-180?360:0}function $s(g){return Math.max(0,Math.floor(g))}class En{constructor(e,s,h,p,y,S){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=S===void 0||!!S,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=$s(this._zoom),this._scale=l.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new uo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,s,h){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=$s(this._zoom),this._scale=l.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new uo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!h&&e.autoCalculateNearFarZ,s&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const s=l.aO(e,-180,180)*Math.PI/180;var h,p,y,S,k,M,R,D,N;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=B(),h=this._rotationMatrix,y=-this._bearingInRadians,S=(p=this._rotationMatrix)[0],k=p[1],M=p[2],R=p[3],D=Math.sin(y),N=Math.cos(y),h[0]=S*N+M*D,h[1]=k*N+R*D,h[2]=S*-D+M*N,h[3]=k*-D+R*N)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const s=l.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const s=e/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aP(this._fovInRadians)}setFov(e){e=l.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=l.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const s=this.getConstrained(this._center,e).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=l.af(s),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,s){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,h){this._unmodified=!1,this._edgeInsets.interpolate(e,s,h),this._constrain(),this._calcMatrices()}resize(e,s,h=!0){this._width=e,this._height=s,h&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Vr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-l.ai,l.ai])}getConstrained(e,s){return this._callbacks.getConstrained(e,s)}getCameraQueryGeometry(e,s){if(s.length===1)return[s[0],e];{const{minX:h,minY:p,maxX:y,maxY:S}=l.a2.fromPoints(s).extend(e);return[new l.P(h,p),new l.P(y,p),new l.P(y,S),new l.P(h,S),new l.P(h,p)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:h}=this.getConstrained(this.center,this.zoom);this.setCenter(s),this.setZoom(h),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=l.ag(new Float64Array(16));l.N(e,e,[this._width/2,-this._height/2,1]),l.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=l.ag(new Float64Array(16)),l.N(e,e,[1,-1,1]),l.M(e,e,[-1,-1,0]),l.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,s,h,p){const y=h!==void 0?h:this.bearing,S=p=p!==void 0?p:this.pitch,k=l.a1.fromLngLat(e,s),M=-Math.cos(l.ae(S)),R=Math.sin(l.ae(S)),D=R*Math.sin(l.ae(y)),N=-R*Math.cos(l.ae(y));let j=this.elevation;const $=s-j;let W;M*$>=0||Math.abs(M)<.1?(W=1e4,j=s+W*M):W=-$/M;let re,se,oe=l.aQ(1,k.y),ae=0;do{if(ae+=1,ae>10)break;se=W/oe,re=new l.a1(k.x+D*se,k.y+N*se),oe=1/re.meterInMercatorCoordinateUnits()}while(Math.abs(W-se*oe)>1e-12);return{center:re.toLngLat(),elevation:j,zoom:l.ak(this.height/2/Math.tan(this.fovInRadians/2)/se/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const s=l.aj(1,this.center.lat)*this.worldSize,h=this.cameraToCenterDistance/s,p=l.a1.fromLngLat(this.center,this.elevation),y=Oe(this.center,this.elevation,this.pitch,this.bearing,h);this._elevation=e;const S=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),l.aQ(y.z,p.y),this.bearing,this.pitch);this._elevation=S.elevation,this._center=S.center,this.setZoom(S.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=l.aj(1,this.center.lat)*this.worldSize;return Oe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const s=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/s,e.canonical.y/s,1/s/l.$,1/s/l.$]}}class kn{constructor(e,s){this.min=e,this.max=s,this.center=l.aR([],l.aS([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],h=l.aT(this.min),p=l.aT(this.max);for(let y=0;y<s.length;y++)h[y]=s[y]?this.min[y]:this.center[y],p[y]=s[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new kn(h,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let s=!0;for(let h=0;h<e.planes.length;h++){const p=this.intersectsPlane(e.planes[h]);if(p===0)return 0;p===1&&(s=!1)}return s?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let s=e[3],h=e[3];for(let p=0;p<3;p++)e[p]>0?(s+=e[p]*this.min[p],h+=e[p]*this.max[p]):(h+=e[p]*this.min[p],s+=e[p]*this.max[p]);return s>=0?2:h<0?0:1}}class Gn{distanceToTile2d(e,s,h,p){const y=p.distanceX([e,s]),S=p.distanceY([e,s]);return Math.hypot(y,S)}getWrap(e,s,h){return h}getTileBoundingVolume(e,s,h,p){var y,S;let k=0,M=0;if(p!=null&&p.terrain){const D=new l.Z(e.z,s,e.z,e.x,e.y),N=p.terrain.getMinMaxElevation(D);k=(y=N.minElevation)!==null&&y!==void 0?y:Math.min(0,h),M=(S=N.maxElevation)!==null&&S!==void 0?S:Math.max(0,h)}const R=1<<e.z;return new kn([s+e.x/R,e.y/R,k],[s+(e.x+1)/R,(e.y+1)/R,M])}allowVariableZoom(e,s){const h=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,p=l.ah(78.5-h/2,0,60);return!!s.terrain||e.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class fn{constructor(e,s,h){this.points=e,this.planes=s,this.aabb=h}static fromInvProjectionMatrix(e,s=1,h=0,p,y){const S=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],k=Math.pow(2,h),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((j=>(function($,W,re,se){const oe=l.aw([],$,W),ae=1/oe[3]/re*se;return l.aY(oe,oe,[ae,ae,1/oe[3],ae])})(j,e,s,k)));p&&(function(j,$,W,re){const se=re?4:0,oe=re?0:4;let ae=0;const de=[],le=[];for(let he=0;he<4;he++){const Ee=l.aU([],j[he+oe],j[he+se]),$e=l.aZ(Ee);l.aR(Ee,Ee,1/$e),de.push($e),le.push(Ee)}for(let he=0;he<4;he++){const Ee=l.a_(j[he+se],le[he],W);ae=Ee!==null&&Ee>=0?Math.max(ae,Ee):Math.max(ae,de[he])}const ge=(function(he,Ee){const $e=l.aU([],he[Ee[0]],he[Ee[1]]),je=l.aU([],he[Ee[2]],he[Ee[1]]),Ne=[0,0,0,0];return l.aV(Ne,l.aW([],$e,je)),Ne[3]=-l.aX(Ne,he[Ee[0]]),Ne})(j,$),we=(function(he,Ee){const $e=l.a$(he),je=l.b0([],he,1/$e),Ne=l.aU([],Ee,l.aR([],je,l.aX(Ee,je))),Ze=l.a$(Ne);if(Ze>0){const ct=Math.sqrt(1-je[3]*je[3]),ft=l.aR([],je,-je[3]),tt=l.aS([],ft,l.aR([],Ne,ct/Ze));return l.b1(Ee,tt)}return null})(W,ge);if(we!==null){const he=we/l.aX(le[0],ge);ae=Math.min(ae,he)}for(let he=0;he<4;he++){const Ee=Math.min(ae,de[he]);j[he+oe]=[j[he+se][0]+le[he][0]*Ee,j[he+se][1]+le[he][1]*Ee,j[he+se][2]+le[he][2]*Ee,1]}})(M,S[0],p,y);const R=S.map((j=>{const $=l.aU([],M[j[0]],M[j[1]]),W=l.aU([],M[j[2]],M[j[1]]),re=l.aV([],l.aW([],$,W)),se=-l.aX(re,M[j[1]]);return re.concat(se)})),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],N=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const j of M)for(let $=0;$<3;$++)D[$]=Math.min(D[$],j[$]),N[$]=Math.max(N[$],j[$]);return new fn(M,R,new kn(D,N))}}class cn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,s,h){return this._helper.interpolatePadding(e,s,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,s,h=!0){this._helper.resize(e,s,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,s){this._helper.overrideNearFarZ(e,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,s){}constructor(e,s,h,p,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new En({calcMatrices:()=>{this._calcMatrices()},getConstrained:(S,k)=>this.getConstrained(S,k)},e,s,h,p,y),this._coveringTilesDetailsProvider=new Gn}clone(){const e=new cn;return e.apply(this),e}apply(e,s,h){this._helper.apply(e,s,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const s=[new l.b2(0,e)];if(this._helper._renderWorldCopies){const h=this.screenPointToMercatorCoordinate(new l.P(0,0)),p=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),S=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),k=Math.floor(Math.min(h.x,p.x,y.x,S.x)),M=Math.floor(Math.max(h.x,p.x,y.x,S.x)),R=1;for(let D=k-R;D<=M+R;D++)D!==0&&s.push(new l.b2(D,e))}return s}getCameraFrustum(){return fn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const s=this.screenPointToLocation(this.centerPoint,e),h=e?e.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(e,s){const h=l.aj(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(s,h),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),S=l.a1.fromLngLat(e),k=new l.a1(S.x-(p.x-y.x),S.y-(p.y-y.y));this.setCenter(k==null?void 0:k.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,s){return s?this.coordinatePoint(l.a1.fromLngLat(e),s.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.a1.fromLngLat(e))}screenPointToLocation(e,s){var h;return(h=this.screenPointToMercatorCoordinate(e,s))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(e,s){if(s){const h=s.pointCoordinate(e);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,s){const h=s||0,p=[e.x,e.y,0,1],y=[e.x,e.y,1,1];l.aw(p,p,this._pixelMatrixInverse),l.aw(y,y,this._pixelMatrixInverse);const S=p[3],k=y[3],M=p[1]/S,R=y[1]/k,D=p[2]/S,N=y[2]/k,j=D===N?0:(h-D)/(N-D);return new l.a1(l.C.number(p[0]/S,y[0]/k,j)/this.worldSize,l.C.number(M,R,j)/this.worldSize,h)}coordinatePoint(e,s=0,h=this._pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,s,1];return l.aw(p,p,h),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ve(this));return new Vr().extend(this.screenPointToLocation(new l.P(0,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(e,s){return s?s.pointCoordinate(e)!=null:e.y>this.height/2-ve(this)}calculatePosMatrix(e,s=!1,h){var p;const y=(p=e.key)!==null&&p!==void 0?p:l.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),S=s?this._alignedPosMatrixCache:this._posMatrixCache;if(S.has(y)){const R=S.get(y);return h?R.f32:R.f64}const k=Ae(e,this.worldSize);l.O(k,s?this._alignedProjMatrix:this._viewProjMatrix,k);const M={f64:k,f32:new Float32Array(k)};return S.set(y,M),h?M.f32:M.f64}calculateFogMatrix(e){const s=e.key,h=this._fogMatrixCacheF32;if(h.has(s))return h.get(s);const p=Ae(e,this.worldSize);return l.O(p,this._fogMatrix,p),h.set(s,new Float32Array(p)),h.get(s)}getConstrained(e,s){s=l.ah(+s,this.minZoom,this.maxZoom);const h={center:new l.S(e.lng,e.lat),zoom:s};let p=this._helper._lngRange;if(!this._helper._renderWorldCopies&&p===null){const de=179.9999999999;p=[-de,de]}const y=this.tileSize*l.af(h.zoom);let S=0,k=y,M=0,R=y,D=0,N=0;const{x:j,y:$}=this.size;if(this._helper._latRange){const de=this._helper._latRange;S=l.U(de[1])*y,k=l.U(de[0])*y,k-S<$&&(D=$/(k-S))}p&&(M=l.aO(l.V(p[0])*y,0,y),R=l.aO(l.V(p[1])*y,0,y),R<M&&(R+=y),R-M<j&&(N=j/(R-M)));const{x:W,y:re}=ne(y,e);let se,oe;const ae=Math.max(N||0,D||0);if(ae){const de=new l.P(N?(R+M)/2:W,D?(k+S)/2:re);return h.center=ue(y,de).wrap(),h.zoom+=l.ak(ae),h}if(this._helper._latRange){const de=$/2;re-de<S&&(oe=S+de),re+de>k&&(oe=k-de)}if(p){const de=(M+R)/2;let le=W;this._helper._renderWorldCopies&&(le=l.aO(W,de-y/2,de+y/2));const ge=j/2;le-ge<M&&(se=M+ge),le+ge>R&&(se=R-ge)}if(se!==void 0||oe!==void 0){const de=new l.P(se??W,oe??re);h.center=ue(y,de).wrap()}return h}calculateCenterFromCameraLngLatAlt(e,s,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,s,h,p)}_calculateNearFarZIfNeeded(e,s,h){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=e-p*this._helper._pixelPerMeter/Math.cos(s),S=p<0?y:e,k=Math.PI/2+this.pitchInRadians,M=l.ae(this.fov)*(Math.abs(Math.cos(l.ae(this.roll)))*this.height+Math.abs(Math.sin(l.ae(this.roll)))*this.width)/this.height*(.5+h.y/this.height),R=Math.sin(M)*S/Math.sin(l.ah(Math.PI-k-M,.01,Math.PI-.01)),D=ve(this),N=Math.atan(D/this._helper.cameraToCenterDistance),j=l.ae(.75),$=N>j?2*N*(.5+h.y/(2*D)):j,W=Math.sin($)*S/Math.sin(l.ah(Math.PI-k-$,.01,Math.PI-.01)),re=Math.min(R,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*re+S),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,s=ne(this.worldSize,this.center),h=s.x,p=s.y;this._helper._pixelPerMeter=l.aj(1,this.center.lat)*this.worldSize;const y=l.ae(Math.min(this.pitch,X)),S=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let k;this._calculateNearFarZIfNeeded(S,y,e),k=new Float64Array(16),l.b4(k,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aq(this._invProjMatrix,k),k[8]=2*-e.x/this._helper._width,k[9]=2*e.y/this._helper._height,this._projectionMatrix=l.b5(k),l.N(k,k,[1,-1,1]),l.M(k,k,[0,0,-this._helper.cameraToCenterDistance]),l.b6(k,k,-this.rollInRadians),l.b7(k,k,this.pitchInRadians),l.b6(k,k,-this.bearingInRadians),l.M(k,k,[-h,-p,0]),this._mercatorMatrix=l.N([],k,[this.worldSize,this.worldSize,this.worldSize]),l.N(k,k,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,k),l.M(k,k,[0,0,-this.elevation]),this._viewProjMatrix=k,this._invViewProjMatrix=l.aq([],k);const M=[0,0,-1,1];l.aw(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),l.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,S,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,l.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.M(this._fogMatrix,this._fogMatrix,[-h,-p,0]),l.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,k);const R=this._helper._width%2/2,D=this._helper._height%2/2,N=Math.cos(this.bearingInRadians),j=Math.sin(-this.bearingInRadians),$=h-Math.round(h)+N*R+j*D,W=p-Math.round(p)+N*D+j*R,re=new Float64Array(k);if(l.M(re,re,[$>.5?$-1:$,W>.5?W-1:W,0]),this._alignedProjMatrix=re,k=l.aq(new Float64Array(16),this._pixelMatrix),!k)throw new Error("failed to invert matrix");this._pixelMatrixInverse=k,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new l.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.aw(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=l.aj(1,this.center.lat)*this.worldSize;return Oe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,s){const h=l.a1.fromLngLat(e),p=[h.x*this.worldSize,h.y*this.worldSize,s,1];return l.aw(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(e){const{overscaledTileID:s,aligned:h,applyTerrainMatrix:p}=e,y=this._helper.getMercatorTileCoordinates(s),S=s?this.calculatePosMatrix(s,h,!0):null;let k;return k=s&&s.terrainRttPosMatrix32f&&p?s.terrainRttPosMatrix32f:S||l.b8(),{mainMatrix:k,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:k}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,s,h){return 1}transformLightDirection(e){return l.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,s,h,p){const y=this.calculatePosMatrix(h);let S;p?(S=[e,s,p(e,s),1],l.aw(S,S,y)):(S=[e,s,0,1],vl(S,S,y));const k=S[3];return{point:new l.P(S[0]/k,S[1]/k),signedDistanceFromCamera:k,isOccluded:!1}}populateCache(e){for(const s of e)this.calculatePosMatrix(s)}getMatrixForModel(e,s){const h=l.a1.fromLngLat(e,s),p=h.meterInMercatorCoordinateUnits(),y=l.b9();return l.M(y,y,[h.x,h.y,h.z]),l.b6(y,y,Math.PI),l.b7(y,y,Math.PI/2),l.N(y,y,[-p,p,p]),y}getProjectionDataForCustomLayer(e=!0){const s=new l.Z(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:e}),p=Ae(s,this.worldSize);l.O(p,this._viewProjMatrix,p),h.tileMercatorCoords=[0,0,1,1];const y=[l.$,l.$,this.worldSize/this._helper.pixelsPerMeter],S=l.ba();return l.N(S,p,y),h.fallbackMatrix=S,h.mainMatrix=S,h}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function _h(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function qn(g){if(g.useSlerp)if(g.k<1){const e=l.bb(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),s=l.bb(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),h=new Float64Array(4);l.bc(h,e,s,g.k);const p=l.bd(h);g.tr.setRoll(p.roll),g.tr.setPitch(p.pitch),g.tr.setBearing(p.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(l.C.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(l.C.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(l.C.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function ds(g,e,s,h,p){const y=p.padding,S=ne(p.worldSize,s.getNorthWest()),k=ne(p.worldSize,s.getNorthEast()),M=ne(p.worldSize,s.getSouthEast()),R=ne(p.worldSize,s.getSouthWest()),D=l.ae(-h),N=S.rotate(D),j=k.rotate(D),$=M.rotate(D),W=R.rotate(D),re=new l.P(Math.max(N.x,j.x,W.x,$.x),Math.max(N.y,j.y,W.y,$.y)),se=new l.P(Math.min(N.x,j.x,W.x,$.x),Math.min(N.y,j.y,W.y,$.y)),oe=re.sub(se),ae=(p.width-(y.left+y.right+e.left+e.right))/oe.x,de=(p.height-(y.top+y.bottom+e.top+e.bottom))/oe.y;if(de<0||ae<0)return void _h();const le=Math.min(l.ak(p.scale*Math.min(ae,de)),g.maxZoom),ge=l.P.convert(g.offset),we=new l.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(l.ae(h)),he=ge.add(we).mult(p.scale/l.af(le));return{center:ue(p.worldSize,S.add(M).div(2).sub(he)),zoom:le,bearing:h}}class hi{get useGlobeControls(){return!1}handlePanInertia(e,s){const h=e.mag(),p=Math.abs(ve(s));return{easingOffset:e.mult(Math.min(.75*p/h,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(e,s){e.bearingDelta&&s.setBearing(s.bearing+e.bearingDelta),e.pitchDelta&&s.setPitch(s.pitch+e.pitchDelta),e.rollDelta&&s.setRoll(s.roll+e.rollDelta),e.zoomDelta&&s.setZoom(s.zoom+e.zoomDelta)}handleMapControlsPan(e,s,h){e.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(h,e.around)}cameraForBoxAndBearing(e,s,h,p,y){return ds(e,s,h,p,y)}handleJumpToCenterZoom(e,s){e.zoom!==(s.zoom!==void 0?+s.zoom:e.zoom)&&e.setZoom(+s.zoom),s.center!==void 0&&e.setCenter(l.S.convert(s.center))}handleEaseTo(e,s){const h=e.zoom,p=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:s.roll===void 0?e.roll:s.roll,pitch:s.pitch===void 0?e.pitch:s.pitch,bearing:s.bearing===void 0?e.bearing:s.bearing},k=s.zoom!==void 0,M=!e.isPaddingEqual(s.padding);let R=!1;const D=k?+s.zoom:e.zoom;let N=e.centerPoint.add(s.offsetAsPoint);const j=e.screenPointToLocation(N),{center:$,zoom:W}=e.getConstrained(l.S.convert(s.center||j),D??h);Bs(e,$);const re=ne(e.worldSize,j),se=ne(e.worldSize,$).sub(re),oe=l.af(W-h);return R=W!==h,{easeFunc:ae=>{if(R&&e.setZoom(l.C.number(h,W,ae)),l.be(y,S)||qn({startEulerAngles:y,endEulerAngles:S,tr:e,k:ae,useSlerp:y.roll!=S.roll}),M&&(e.interpolatePadding(p,s.padding,ae),N=e.centerPoint.add(s.offsetAsPoint)),s.around)e.setLocationAtPoint(s.around,s.aroundPoint);else{const de=l.af(e.zoom-h),le=W>h?Math.min(2,oe):Math.max(.5,oe),ge=Math.pow(le,1-ae),we=ue(e.worldSize,re.add(se.mult(ae*ge)).mult(de));e.setLocationAtPoint(e.renderWorldCopies?we.wrap():we,N)}},isZooming:R,elevationCenter:$}}handleFlyTo(e,s){const h=s.zoom!==void 0,p=e.zoom,y=e.getConstrained(l.S.convert(s.center||s.locationAtOffset),h?+s.zoom:p),S=y.center,k=y.zoom;Bs(e,S);const M=ne(e.worldSize,s.locationAtOffset),R=ne(e.worldSize,S).sub(M),D=R.mag(),N=l.af(k-p);let j;if(s.minZoom!==void 0){const $=Math.min(+s.minZoom,p,k),W=e.getConstrained(S,$).zoom;j=l.af(W-p)}return{easeFunc:($,W,re,se)=>{e.setZoom($===1?k:p+l.ak(W));const oe=$===1?S:ue(e.worldSize,M.add(R.mult(re)).mult(W));e.setLocationAtPoint(e.renderWorldCopies?oe.wrap():oe,se)},scaleOfZoom:N,targetCenter:S,scaleOfMinZoom:j,pixelPathLength:D}}}class an{constructor(e,s,h){this.blendFunction=e,this.blendColor=s,this.mask=h}}an.Replace=[1,0],an.disabled=new an(an.Replace,l.bf.transparent,[!1,!1,!1,!1]),an.unblended=new an(an.Replace,l.bf.transparent,[!0,!0,!0,!0]),an.alphaBlended=new an([1,771],l.bf.transparent,[!0,!0,!0,!0]);const ha=2305;class nr{constructor(e,s,h){this.enable=e,this.mode=s,this.frontFace=h}}nr.disabled=new nr(!1,1029,ha),nr.backCCW=new nr(!0,1029,ha),nr.frontCCW=new nr(!0,1028,ha);class ur{constructor(e,s,h){this.func=e,this.mask=s,this.range=h}}ur.ReadOnly=!1,ur.ReadWrite=!0,ur.disabled=new ur(519,ur.ReadOnly,[0,1]);const fs=7680;class Mr{constructor(e,s,h,p,y,S){this.test=e,this.ref=s,this.mask=h,this.fail=p,this.depthFail=y,this.pass=S}}Mr.disabled=new Mr({func:519,mask:0},0,0,fs,fs,fs);const bi=new WeakMap;function ho(g){var e;if(bi.has(g))return bi.get(g);{const s=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return bi.set(g,s),s}}class fo{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const s=e.context,h=s.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;const p=new l.aL;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const y=new l.aN;y.emplaceBack(0,1,2),this._fullscreenTriangle=new Ao(s.createVertexBuffer(p,zo.members),s.createIndexBuffer(y),l.aM.simpleSegment(0,0,p.length,y.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(h.TEXTURE1);const S=h.createTexture();h.bindTexture(h.TEXTURE_2D,S),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(S),ho(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,s){const h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,s=e.gl;e.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,s){const h=this._cachedRenderContext.context,p=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:l.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,p.TRIANGLES,ur.disabled,Mr.disabled,an.unblended,nr.disabled,((y,S)=>({u_input:y,u_output_expected:S}))(e,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ho(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const y=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ho(e)){const s=e.clientWaitSync(this._readbackQueue.sync,0,0);if(s===e.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=fo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let s=0;return s+=e[0]/256,s+=e[1]/65536,s+=e[2]/16777216,e[3]<127&&(s=-s),s/128}}const Sl=l.$/128;function Tl(g,e){const s=g.granularity!==void 0?Math.max(g.granularity,1):1,h=s+(g.generateBorders?2:0),p=s+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),y=h+1,S=p+1,k=g.generateBorders?-1:0,M=g.generateBorders||g.extendToNorthPole?-1:0,R=s+(g.generateBorders?1:0),D=s+(g.generateBorders||g.extendToSouthPole?1:0),N=y*S,j=h*p*6,$=y*S>65536;if($&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=$||e==="32bit",re=new Int16Array(2*N);let se=0;for(let de=M;de<=D;de++)for(let le=k;le<=R;le++){let ge=le/s*l.$;le===-1&&(ge=-Sl),le===s+1&&(ge=l.$+Sl);let we=de/s*l.$;de===-1&&(we=g.extendToNorthPole?l.bh:-Sl),de===s+1&&(we=g.extendToSouthPole?l.bi:l.$+Sl),re[se++]=ge,re[se++]=we}const oe=W?new Uint32Array(j):new Uint16Array(j);let ae=0;for(let de=0;de<p;de++)for(let le=0;le<h;le++){const ge=le+1+de*y,we=le+(de+1)*y,he=le+1+(de+1)*y;oe[ae++]=le+de*y,oe[ae++]=we,oe[ae++]=ge,oe[ae++]=ge,oe[ae++]=we,oe[ae++]=he}return{vertices:re.buffer.slice(0),indices:oe.buffer.slice(0),uses32bitIndices:W}}const da=new l.aK({fill:new l.bj(128,2),line:new l.bj(512,0),tile:new l.bj(128,32),stencil:new l.bj(128,1),circle:3});class Pl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ks.projectionGlobe}get vertexShaderPreludeCode(){return ks.projectionMercator.vertexSource}get subdivisionGranularity(){return da}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new fo(e));const s=l.U(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(s,h),y=te.now();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=y);const S=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bl(S))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,s,h,p,y){const S=(y==="stencil"?da.stencil:da.tile).getGranularityForZoomLevel(s.z);return this._getMesh(e,{granularity:S,generateBorders:h,extendToNorthPole:s.y===0&&p,extendToSouthPole:s.y===(1<<s.z)-1&&p})}_getMesh(e,s){const h=this._getMeshKey(s);if(h in this._tileMeshCache)return this._tileMeshCache[h];const p=(function(y,S){const k=Tl(S,"16bit"),M=l.aL.deserialize({arrayBuffer:k.vertices,length:k.vertices.byteLength/2/2}),R=l.aN.deserialize({arrayBuffer:k.indices,length:k.indices.byteLength/2/3});return new Ao(y.createVertexBuffer(M,zo.members),y.createIndexBuffer(R),l.aM.simpleSegment(0,0,M.length,R.length))})(e,s);return this._tileMeshCache[h]=p,p}recalculate(e){}hasTransition(){const e=te.now();let s=!1;return s=s||(e-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Us=new l.r({type:new l.D(l.v.projection.type)});class Cl extends l.E{constructor(e){super(),this._transitionable=new l.t(Us),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0)),this._mercatorProjection=new Pr,this._verticalPerspectiveProjection=new Pl}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof l.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,s,h,p,y){return this.currentProjection.getMeshFromTileID(e,s,h,p,y)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Na(g){const e=Ro(g.worldSize,g.center.lat);return 2*Math.PI*e}function Ms(g,e,s,h,p){const y=1/(1<<p),S=e/l.$*y+h*y,k=l.bo((g/l.$*y+s*y)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI,R=Math.cos(M),D=new Float64Array(3);return D[0]=Math.sin(k)*R,D[1]=Math.sin(M),D[2]=Math.cos(k)*R,D}function zn(g){return(function(e,s){const h=Math.cos(s),p=new Float64Array(3);return p[0]=Math.sin(e)*h,p[1]=Math.sin(s),p[2]=Math.cos(e)*h,p})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function Ro(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function El(g){const e=Math.asin(g[1])/Math.PI*180,s=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(s>1e-6){const h=g[0]/s,p=Math.acos(g[2]/s),y=(h>0?p:-p)/Math.PI*180;return new l.S(l.aO(y,-180,180),e)}return new l.S(0,e)}function Wn(g){return Math.cos(g*Math.PI/180)}function pn(g,e){const s=Wn(g),h=Wn(e);return l.ak(h/s)}function gu(g,e){const s=g.rotate(e.bearingInRadians),h=e.zoom+pn(e.center.lat,0),p=l.bk(1/Wn(e.center.lat),1/Wn(Math.min(Math.abs(e.center.lat),60)),l.bn(h,7,3,0,1)),y=360/Na({worldSize:e.worldSize,center:{lat:e.center.lat}});return new l.S(e.center.lng-s.x*y*p,l.ah(e.center.lat+s.y*y,-l.ai,l.ai))}function Do(g){const e=.5*g,s=Math.sin(e),h=Math.cos(e);return Math.log(s+h)-Math.log(h-s)}function vh(g,e,s,h){const p=g.lat+s*h;if(Math.abs(s)>1){const y=(Math.sign(g.lat+s)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,S=Math.abs(g.lat+s)*Math.PI/180,k=Do(y+h*(S-y)),M=Do(y),R=Do(S);return new l.S(g.lng+e*((k-M)/(R-M)),p)}return new l.S(g.lng+e*h,p)}class xh{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,s,h,p){const y=`${e.z}_${e.x}_${e.y}_${p!=null&&p.terrain?"t":""}`,S=this._cache.get(y);if(S)return S;const k=this._cachePrevious.get(y);if(k)return this._cache.set(y,k),k;const M=this._boundingVolumeFactory(e,s,h,p);return this._cache.set(y,M),this._hadAnyChanges=!0,M}}class fa{constructor(e,s,h,p){this.min=h,this.max=p,this.points=e,this.planes=s}static fromAabb(e,s){const h=[];for(let p=0;p<8;p++)h.push([1&~p?e[0]:s[0],(p>>1&1)==1?s[1]:e[1],(p>>2&1)==1?s[2]:e[2]]);return new fa(h,[[-1,0,0,s[0]],[1,0,0,-e[0]],[0,-1,0,s[1]],[0,1,0,-e[1]],[0,0,-1,s[2]],[0,0,1,-e[2]]],e,s)}static fromCenterSizeAngles(e,s,h){const p=l.br([],h[0],h[1],h[2]),y=l.bs([],[s[0],0,0],p),S=l.bs([],[0,s[1],0],p),k=l.bs([],[0,0,s[2]],p),M=[...e],R=[...e];for(let N=0;N<8;N++)for(let j=0;j<3;j++){const $=e[j]+y[j]*(1&~N?-1:1)+S[j]*((N>>1&1)==1?1:-1)+k[j]*((N>>2&1)==1?1:-1);M[j]=Math.min(M[j],$),R[j]=Math.max(R[j],$)}const D=[];for(let N=0;N<8;N++){const j=[...e];l.aS(j,j,l.aR([],y,1&~N?-1:1)),l.aS(j,j,l.aR([],S,(N>>1&1)==1?1:-1)),l.aS(j,j,l.aR([],k,(N>>2&1)==1?1:-1)),D.push(j)}return new fa(D,[[...y,-l.aX(y,D[0])],[...S,-l.aX(S,D[0])],[...k,-l.aX(k,D[0])],[-y[0],-y[1],-y[2],-l.aX(y,D[7])],[-S[0],-S[1],-S[2],-l.aX(S,D[7])],[-k[0],-k[1],-k[2],-l.aX(k,D[7])]],M,R)}intersectsFrustum(e){let s=!0;const h=this.points.length,p=this.planes.length,y=e.planes.length,S=e.points.length;for(let k=0;k<y;k++){const M=e.planes[k];let R=0;for(let D=0;D<h;D++){const N=this.points[D];M[0]*N[0]+M[1]*N[1]+M[2]*N[2]+M[3]>=0&&R++}if(R===0)return 0;R<h&&(s=!1)}if(s)return 2;for(let k=0;k<p;k++){const M=this.planes[k];let R=0;for(let D=0;D<S;D++){const N=e.points[D];M[0]*N[0]+M[1]*N[1]+M[2]*N[2]+M[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(e){const s=this.points.length;let h=0;for(let p=0;p<s;p++){const y=this.points[p];e[0]*y[0]+e[1]*y[1]+e[2]*y[2]+e[3]>=0&&h++}return h===s?2:h===0?0:1}}function Rn(g,e,s){const h=g-e;return h<0?-h:Math.max(0,h-s)}function pa(g,e,s,h,p){const y=g-s;let S;return S=y<0?Math.min(-y,1+y-p):y>1?Math.min(Math.max(y-p,0),1-y):0,Math.max(S,Rn(e,h,p))}class Vs{constructor(){this._boundingVolumeCache=new xh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,s,h,p){const y=1<<h.z,S=1/y,k=h.x/y,M=h.y/y;let R=2;return R=Math.min(R,pa(e,s,k,M,S)),R=Math.min(R,pa(e,s,k+.5,-M-S,S)),R=Math.min(R,pa(e,s,k+.5,2-M-S,S)),R}getWrap(e,s,h){const p=1<<s.z,y=1/p,S=s.x/p,k=Rn(e.x,S,y),M=Rn(e.x,S-1,y),R=Rn(e.x,S+1,y),D=Math.min(k,M,R);return D===R?1:D===M?-1:0}allowVariableZoom(e,s){return zt(e,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,s,h,p){return this._boundingVolumeCache.getTileBoundingVolume(e,s,h,p)}_computeTileBoundingVolume(e,s,h,p){var y,S;let k=0,M=0;if(p!=null&&p.terrain){const R=new l.Z(e.z,s,e.z,e.x,e.y),D=p.terrain.getMinMaxElevation(R);k=(y=D.minElevation)!==null&&y!==void 0?y:Math.min(0,h),M=(S=D.maxElevation)!==null&&S!==void 0?S:Math.max(0,h)}if(k/=l.bu,M/=l.bu,k+=1,M+=1,e.z<=0)return fa.fromAabb([-M,-M,-M],[M,M,M]);if(e.z===1)return fa.fromAabb([e.x===0?-M:0,e.y===0?0:-M,-M],[e.x===0?0:M,e.y===0?M:0,M]);{const R=[Ms(0,0,e.x,e.y,e.z),Ms(l.$,0,e.x,e.y,e.z),Ms(l.$,l.$,e.x,e.y,e.z),Ms(0,l.$,e.x,e.y,e.z)],D=[];for(const Ne of R)D.push(l.aR([],Ne,M));if(M!==k)for(const Ne of R)D.push(l.aR([],Ne,k));e.y===0&&D.push([0,1,0]),e.y===(1<<e.z)-1&&D.push([0,-1,0]);const N=[1,1,1],j=[-1,-1,-1];for(const Ne of D)for(let Ze=0;Ze<3;Ze++)N[Ze]=Math.min(N[Ze],Ne[Ze]),j[Ze]=Math.max(j[Ze],Ne[Ze]);const $=Ms(l.$/2,l.$/2,e.x,e.y,e.z),W=l.aW([],[0,1,0],$);l.aV(W,W);const re=l.aW([],$,W);l.aV(re,re);const se=l.aW([],R[2],R[1]);l.aV(se,se);const oe=l.aW([],R[0],R[3]);l.aV(oe,oe),D.push(l.aR([],$,M)),e.y>=(1<<e.z)/2&&D.push(l.aR([],Ms(l.$/2,0,e.x,e.y,e.z),M)),e.y<(1<<e.z)/2&&D.push(l.aR([],Ms(l.$/2,l.$,e.x,e.y,e.z),M));const ae=yc($,D),de=yc(re,D),le=[-$[0],-$[1],-$[2],ae.max],ge=[$[0],$[1],$[2],-ae.min],we=[-re[0],-re[1],-re[2],de.max],he=[re[0],re[1],re[2],-de.min],Ee=[...se,0],$e=[...oe,0],je=[];return e.y===0?je.push(l.bt($e,Ee,le),l.bt($e,Ee,ge)):je.push(l.bt(we,Ee,le),l.bt(we,Ee,ge),l.bt(we,$e,le),l.bt(we,$e,ge)),e.y===(1<<e.z)-1?je.push(l.bt($e,Ee,le),l.bt($e,Ee,ge)):je.push(l.bt(he,Ee,le),l.bt(he,Ee,ge),l.bt(he,$e,le),l.bt(he,$e,ge)),new fa(je,[le,ge,we,he,Ee,$e],N,j)}}}function yc(g,e){let s=1/0,h=-1/0;for(const p of e){const y=l.aX(g,p);s=Math.min(s,y),h=Math.max(h,y)}return{min:s,max:h}}class _c{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,s,h){return this._helper.interpolatePadding(e,s,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,s){this._helper.resize(e,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,s){this._helper.overrideNearFarZ(e,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=l.bv(),this._projectionMatrix=l.b9(),this._globeViewProjMatrix32f=l.b8(),this._globeViewProjMatrixNoCorrection=l.b9(),this._globeViewProjMatrixNoCorrectionInverted=l.b9(),this._globeProjMatrixInverted=l.b9(),this._cameraPosition=l.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new En({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,s)=>this.getConstrained(e,s)}),this._coveringTilesDetailsProvider=new Vs}clone(){const e=new _c;return e.apply(this),e}apply(e,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=l.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:s,applyGlobeMatrix:h}=e,p=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const s=this.pitchInRadians,h=this.cameraToCenterDistance/e,p=Math.sin(s)*h,y=Math.cos(s)*h+1,S=1/Math.sqrt(p*p+y*y)*1;let k=-p,M=y;const R=Math.sqrt(k*k+M*M);k/=R,M/=R;const D=[0,k,M];l.bw(D,D,[0,0,0],-this.bearingInRadians),l.bx(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),l.by(D,D,[0,0,0],this.center.lng*Math.PI/180);const N=1/l.aZ(D);return l.aR(D,D,N),[...D,-S*N]}isLocationOccluded(e){return!this.isSurfacePointVisible(zn(e))}transformLightDirection(e){const s=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,p=Math.cos(h),y=[Math.sin(s)*p,Math.sin(h),Math.cos(s)*p],S=[y[2],0,-y[0]],k=[0,0,0];l.aW(k,S,y),l.aV(S,S),l.aV(k,k);const M=[0,0,0];return l.aV(M,[S[0]*e[0]+k[0]*e[1]+y[0]*e[2],S[1]*e[0]+k[1]*e[1]+y[1]*e[2],S[2]*e[0]+k[2]*e[1]+y[2]*e[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,s,h){const p=(function(k,M,R){const D=1/(1<<R.z);return new l.a1(k/l.$*D+R.x*D,M/l.$*D+R.y*D)})(e,s,h.canonical),y=(S=p.y,[l.bo(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI]);var S;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(e,s,h,p){const y=h.canonical,S=Ms(e,s,y.x,y.y,y.z),k=1+(p?p(e,s):0)/l.bu,M=[S[0]*k,S[1]*k,S[2]*k,1];l.aw(M,M,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,D=R[0]*S[0]+R[1]*S[1]+R[2]*S[2]+R[3]<0;return{point:new l.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Ro(this.worldSize,this.center.lat),s=l.ba(),h=l.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),l.b4(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;s[8]=2*-p.x/this._helper._width,s[9]=2*p.y/this._helper._height,this._projectionMatrix=l.b5(s),this._globeProjMatrixInverted=l.ba(),l.aq(this._globeProjMatrixInverted,s),l.M(s,s,[0,0,-this.cameraToCenterDistance]),l.b6(s,s,this.rollInRadians),l.b7(s,s,-this.pitchInRadians),l.b6(s,s,this.bearingInRadians),l.M(s,s,[0,0,-e]);const y=l.bp();y[0]=e,y[1]=e,y[2]=e,l.b7(h,s,this.center.lat*Math.PI/180),l.bz(h,h,-this.center.lng*Math.PI/180),l.N(h,h,y),this._globeViewProjMatrixNoCorrection=h,l.b7(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bz(s,s,-this.center.lng*Math.PI/180),l.N(s,s,y),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=l.ba(),l.aq(this._globeViewProjMatrixNoCorrectionInverted,h);const S=l.bp();this._cameraPosition=l.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,l.bw(this._cameraPosition,this._cameraPosition,S,-this.rollInRadians),l.bx(this._cameraPosition,this._cameraPosition,S,this.pitchInRadians),l.bw(this._cameraPosition,this._cameraPosition,S,-this.bearingInRadians),l.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bx(this._cameraPosition,this._cameraPosition,S,-this.center.lat*Math.PI/180),l.by(this._cameraPosition,this._cameraPosition,S,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const k=l.b5(this._globeViewProjMatrixNoCorrectionInverted);l.N(k,k,[1,1,-1]),this._cachedFrustum=fn.fromInvProjectionMatrix(k,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){l.w("calculateFogMatrix is not supported on globe projection.");const s=l.ba();return l.ag(s),s}getVisibleUnwrappedCoordinates(e){return[new l.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const h=zn(e);l.aR(h,h,1+s/l.bu);const p=l.bv();return l.aw(p,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(e){}getBounds(){const e=.5*this.width,s=.5*this.height,h=[new l.P(0,0),new l.P(e,0),new l.P(this.width,0),new l.P(this.width,s),new l.P(this.width,this.height),new l.P(e,this.height),new l.P(0,this.height),new l.P(0,s)],p=[];for(const N of h)p.push(this.unprojectScreenPoint(N));let y=0,S=0,k=0,M=0;const R=this.center;for(const N of p){const j=l.bA(R.lng,N.lng),$=l.bA(R.lat,N.lat);j<S&&(S=j),j>y&&(y=j),$<M&&(M=$),$>k&&(k=$)}const D=[R.lng+S,R.lat+M,R.lng+y,R.lat+k];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new Vr(D)}getConstrained(e,s){const h=l.ah(e.lat,-l.ai,l.ai),p=l.ah(+s,this.minZoom+pn(0,h),this.maxZoom);return{center:new l.S(e.lng,h),zoom:p}}calculateCenterFromCameraLngLatAlt(e,s,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,s,h,p)}setLocationAtPoint(e,s){const h=zn(this.unprojectScreenPoint(s)),p=zn(e),y=l.bp();l.bB(y);const S=l.bp();l.by(S,h,y,-this.center.lng*Math.PI/180),l.bx(S,S,y,this.center.lat*Math.PI/180);const k=p[0]*p[0]+p[2]*p[2],M=S[0]*S[0];if(k<M)return;const R=Math.sqrt(k-M),D=-R,N=l.bC(p[0],p[2],S[0],R),j=l.bC(p[0],p[2],S[0],D),$=l.bp();l.by($,p,y,-N);const W=l.bC($[1],$[2],S[1],S[2]),re=l.bp();l.by(re,p,y,-j);const se=l.bC(re[1],re[2],S[1],S[2]),oe=.5*Math.PI,ae=W>=-oe&&W<=oe,de=se>=-oe&&se<=oe;let le,ge;if(ae&&de){const $e=this.center.lng*Math.PI/180,je=this.center.lat*Math.PI/180;l.bD(N,$e)+l.bD(W,je)<l.bD(j,$e)+l.bD(se,je)?(le=N,ge=W):(le=j,ge=se)}else if(ae)le=N,ge=W;else{if(!de)return;le=j,ge=se}const we=le/Math.PI*180,he=ge/Math.PI*180,Ee=this.center.lat;this.setCenter(new l.S(we,l.ah(he,-90,90))),this.setZoom(this.zoom+pn(Ee,this.center.lat))}locationToScreenPoint(e,s){const h=zn(e);if(s){const p=s.getElevationForLngLatZoom(e,this._helper._tileZoom);l.aR(h,h,1+p/l.bu)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(e){const s=l.bv();return l.aw(s,[...e,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new l.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,s){if(s){const h=s.pointCoordinate(e);if(h)return h}return l.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,s){var h;return(h=this.screenPointToMercatorCoordinate(e,s))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(e,s){const h=this._cameraPosition,p=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(h,p)}getRayDirectionFromPixel(e){const s=l.bv();s[0]=e.x/this.width*2-1,s[1]=-1*(e.y/this.height*2-1),s[2]=1,s[3]=1,l.aw(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const h=l.bp();h[0]=s[0]-this._cameraPosition[0],h[1]=s[1]-this._cameraPosition[1],h[2]=s[2]-this._cameraPosition[2];const p=l.bp();return l.aV(p,h),p}isSurfacePointVisible(e){const s=this._cachedClippingPlane;return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const s=l.bv();return l.aw(s,[...e,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(e,s){const h=l.aX(e,s),p=l.bp(),y=l.bp();l.aR(y,s,h),l.aU(p,e,y);const S=1-l.aX(p,p);if(S<0)return null;const k=l.aX(e,e)-1,M=-h+(h<0?1:-1)*Math.sqrt(S),R=k/M,D=M;return{tMin:Math.min(R,D),tMax:Math.max(R,D)}}unprojectScreenPoint(e){const s=this._cameraPosition,h=this.getRayDirectionFromPixel(e),p=this.rayPlanetIntersection(s,h);if(p){const D=l.bp();l.aS(D,s,[h[0]*p.tMin,h[1]*p.tMin,h[2]*p.tMin]);const N=l.bp();return l.aV(N,D),El(N)}const y=this._cachedClippingPlane,S=y[0]*h[0]+y[1]*h[1]+y[2]*h[2],k=-l.b1(y,s)/S,M=l.bp();if(k>0)l.aS(M,s,[h[0]*k,h[1]*k,h[2]*k]);else{const D=l.bp();l.aS(D,s,[2*h[0],2*h[1],2*h[2]]);const N=l.b1(this._cachedClippingPlane,D);l.aU(M,D,[this._cachedClippingPlane[0]*N,this._cachedClippingPlane[1]*N,this._cachedClippingPlane[2]*N])}const R=(function(D){const N=l.bp();return N[0]=D[0]*-D[3],N[1]=D[1]*-D[3],N[2]=D[2]*-D[3],{center:N,radius:Math.sqrt(1-D[3]*D[3])}})(y);return El((function(D,N,j){const $=l.bp();l.aU($,j,D);const W=l.bp();return l.bq(W,D,$,N/l.a$($)),W})(R.center,R.radius,M))}getMatrixForModel(e,s){const h=l.S.convert(e),p=1/l.bu,y=l.b9();return l.bz(y,y,h.lng/180*Math.PI),l.b7(y,y,-h.lat/180*Math.PI),l.M(y,y,[0,0,1+s/l.bu]),l.b7(y,y,.5*Math.PI),l.N(y,y,[p,p,p]),y}getProjectionDataForCustomLayer(e=!0){const s=this.getProjectionData({overscaledTileID:new l.Z(0,0,0,0,0),applyGlobeMatrix:e});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(e){}}class vc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,s,h){return this._helper.interpolatePadding(e,s,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,s,h=!0){this._helper.resize(e,s,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,s){this._helper.overrideNearFarZ(e,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,s){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new En({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,s)=>this.getConstrained(e,s)}),this._globeness=1,this._mercatorTransform=new cn,this._verticalPerspectiveTransform=new _c}clone(){const e=new vc;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const s=this._mercatorTransform.getProjectionData(e),h=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:s.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return l.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,s,h){const p=this._mercatorTransform.getPitchedTextCorrection(e,s,h),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,s,h);return l.bk(p,y,this._globeness)}projectTileCoordinates(e,s,h,p){return this.currentTransform.projectTileCoordinates(e,s,h,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,s){return this.currentTransform.lngLatToCameraDepth(e,s)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,s){return this.currentTransform.getConstrained(e,s)}calculateCenterFromCameraLngLatAlt(e,s,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,s,h,p)}setLocationAtPoint(e,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,s){return this.currentTransform.locationToScreenPoint(e,s)}screenPointToMercatorCoordinate(e,s){return this.currentTransform.screenPointToMercatorCoordinate(e,s)}screenPointToLocation(e,s){return this.currentTransform.screenPointToLocation(e,s)}isPointOnMapSurface(e,s){return this.currentTransform.isPointOnMapSurface(e,s)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,s){return this.currentTransform.getMatrixForModel(e,s)}getProjectionDataForCustomLayer(e=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return s;const h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return h.fallbackMatrix=s.mainMatrix,h}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class ri{get useGlobeControls(){return!0}handlePanInertia(e,s){const h=gu(e,s);return Math.abs(h.lng-s.center.lng)>180&&(h.lng=s.center.lng+179.5*Math.sign(h.lng-s.center.lng)),{easingCenter:h,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,s){const h=e.around,p=s.screenPointToLocation(h);e.bearingDelta&&s.setBearing(s.bearing+e.bearingDelta),e.pitchDelta&&s.setPitch(s.pitch+e.pitchDelta),e.rollDelta&&s.setRoll(s.roll+e.rollDelta);const y=s.zoom;e.zoomDelta&&s.setZoom(s.zoom+e.zoomDelta);const S=s.zoom-y;if(S===0)return;const k=l.bA(s.center.lng,p.lng),M=k/(Math.abs(k/180)+1),R=l.bA(s.center.lat,p.lat),D=s.getRayDirectionFromPixel(h),N=s.cameraPosition,j=-1*l.aX(N,D),$=l.bp();l.aS($,N,[D[0]*j,D[1]*j,D[2]*j]);const W=l.aZ($)-1,re=Math.exp(.5*-Math.max(W-.3,0)),se=Ro(s.worldSize,s.center.lat)/Math.min(s.width,s.height),oe=l.bn(se,.9,.5,1,.25),ae=(1-l.af(-S))*Math.min(re,oe),de=s.center.lat,le=s.zoom,ge=new l.S(s.center.lng+M*ae,l.ah(s.center.lat+R*ae,-l.ai,l.ai));s.setLocationAtPoint(p,h);const we=s.center,he=l.bn(Math.abs(k),45,85,0,1),Ee=l.bn(se,.75,.35,0,1),$e=Math.pow(Math.max(he,Ee),.25),je=l.bA(we.lng,ge.lng),Ne=l.bA(we.lat,ge.lat);s.setCenter(new l.S(we.lng+je*$e,we.lat+Ne*$e).wrap()),s.setZoom(le+pn(de,s.center.lat))}handleMapControlsPan(e,s,h){if(!e.panDelta)return;const p=s.center.lat,y=s.zoom;s.setCenter(gu(e.panDelta,s).wrap()),s.setZoom(y+pn(p,s.center.lat))}cameraForBoxAndBearing(e,s,h,p,y){const S=ds(e,s,h,p,y),k=s.left/y.width*2-1,M=(y.width-s.right)/y.width*2-1,R=s.top/y.height*-2+1,D=(y.height-s.bottom)/y.height*-2+1,N=l.bA(h.getWest(),h.getEast())<0,j=N?h.getEast():h.getWest(),$=N?h.getWest():h.getEast(),W=Math.max(h.getNorth(),h.getSouth()),re=Math.min(h.getNorth(),h.getSouth()),se=j+.5*l.bA(j,$),oe=W+.5*l.bA(W,re),ae=y.clone();ae.setCenter(S.center),ae.setBearing(S.bearing),ae.setPitch(0),ae.setRoll(0),ae.setZoom(S.zoom);const de=ae.modelViewProjectionMatrix,le=[zn(h.getNorthWest()),zn(h.getNorthEast()),zn(h.getSouthWest()),zn(h.getSouthEast()),zn(new l.S($,oe)),zn(new l.S(j,oe)),zn(new l.S(se,W)),zn(new l.S(se,re))],ge=zn(S.center);let we=Number.POSITIVE_INFINITY;for(const he of le)k<0&&(we=ri.getLesserNonNegativeNonNull(we,ri.solveVectorScale(he,ge,de,"x",k))),M>0&&(we=ri.getLesserNonNegativeNonNull(we,ri.solveVectorScale(he,ge,de,"x",M))),R>0&&(we=ri.getLesserNonNegativeNonNull(we,ri.solveVectorScale(he,ge,de,"y",R))),D<0&&(we=ri.getLesserNonNegativeNonNull(we,ri.solveVectorScale(he,ge,de,"y",D)));if(Number.isFinite(we)&&we!==0)return S.zoom=ae.zoom+l.ak(we),S;_h()}handleJumpToCenterZoom(e,s){const h=e.center.lat,p=e.getConstrained(s.center?l.S.convert(s.center):e.center,e.zoom).center;e.setCenter(p.wrap());const y=s.zoom!==void 0?+s.zoom:e.zoom+pn(h,p.lat);e.zoom!==y&&e.setZoom(y)}handleEaseTo(e,s){const h=e.zoom,p=e.center,y=e.padding,S={roll:e.roll,pitch:e.pitch,bearing:e.bearing},k={roll:s.roll===void 0?e.roll:s.roll,pitch:s.pitch===void 0?e.pitch:s.pitch,bearing:s.bearing===void 0?e.bearing:s.bearing},M=s.zoom!==void 0,R=!e.isPaddingEqual(s.padding);let D=!1;const N=s.center?l.S.convert(s.center):p,j=e.getConstrained(N,h).center;Bs(e,j);const $=e.clone();$.setCenter(j),$.setZoom(M?+s.zoom:h+pn(p.lat,N.lat)),$.setBearing(s.bearing);const W=new l.P(l.ah(e.centerPoint.x+s.offsetAsPoint.x,0,e.width),l.ah(e.centerPoint.y+s.offsetAsPoint.y,0,e.height));$.setLocationAtPoint(j,W);const re=(s.offset&&s.offsetAsPoint.mag())>0?$.center:j,se=M?+s.zoom:h+pn(p.lat,re.lat),oe=h+pn(p.lat,0),ae=se+pn(re.lat,0),de=l.bA(p.lng,re.lng),le=l.bA(p.lat,re.lat),ge=l.af(ae-oe);return D=se!==h,{easeFunc:we=>{if(l.be(S,k)||qn({startEulerAngles:S,endEulerAngles:k,tr:e,k:we,useSlerp:S.roll!=k.roll}),R&&e.interpolatePadding(y,s.padding,we),s.around)l.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(s.around,s.aroundPoint);else{const he=ae>oe?Math.min(2,ge):Math.max(.5,ge),Ee=Math.pow(he,1-we),$e=vh(p,de,le,we*Ee);e.setCenter($e.wrap())}if(D){const he=l.C.number(oe,ae,we)+pn(0,e.center.lat);e.setZoom(he)}},isZooming:D,elevationCenter:re}}handleFlyTo(e,s){const h=s.zoom!==void 0,p=e.center,y=e.zoom,S=e.padding,k=!e.isPaddingEqual(s.padding),M=e.getConstrained(l.S.convert(s.center||s.locationAtOffset),y).center,R=h?+s.zoom:e.zoom+pn(e.center.lat,M.lat),D=e.clone();D.setCenter(M),D.setZoom(R),D.setBearing(s.bearing);const N=new l.P(l.ah(e.centerPoint.x+s.offsetAsPoint.x,0,e.width),l.ah(e.centerPoint.y+s.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(M,N);const j=D.center;Bs(e,j);const $=(function(le,ge,we){const he=zn(ge),Ee=zn(we),$e=l.aX(he,Ee),je=Math.acos($e),Ne=Na(le);return je/(2*Math.PI)*Ne})(e,p,j),W=y+pn(p.lat,0),re=R+pn(j.lat,0),se=l.af(re-W);let oe;if(typeof s.minZoom=="number"){const le=+s.minZoom+pn(j.lat,0),ge=Math.min(le,W,re)+pn(0,j.lat),we=e.getConstrained(j,ge).zoom+pn(j.lat,0);oe=l.af(we-W)}const ae=l.bA(p.lng,j.lng),de=l.bA(p.lat,j.lat);return{easeFunc:(le,ge,we,he)=>{const Ee=vh(p,ae,de,we);k&&e.interpolatePadding(S,s.padding,le);const $e=le===1?j:Ee;e.setCenter($e.wrap());const je=W+l.ak(ge);e.setZoom(le===1?R:je+pn(0,$e.lat))},scaleOfZoom:se,targetCenter:j,scaleOfMinZoom:oe,pixelPathLength:$}}static solveVectorScale(e,s,h,p,y){const S=p==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],k=[h[3],h[7],h[11],h[15]],M=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],R=e[0]*k[0]+e[1]*k[1]+e[2]*k[2],D=s[0]*S[0]+s[1]*S[1]+s[2]*S[2],N=s[0]*k[0]+s[1]*k[1]+s[2]*k[2];return D+y*R===M+y*N||k[3]*(M-D)+S[3]*(N-R)+M*N==D*R?null:(D+S[3]-y*N-y*k[3])/(D-M-y*N+y*R)}static getLesserNonNegativeNonNull(e,s){return s!==null&&s>=0&&s<e?s:e}}class Zd{constructor(e){this._globe=e,this._mercatorCameraHelper=new hi,this._verticalPerspectiveCameraHelper=new ri}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,s){return this.currentHelper.handlePanInertia(e,s)}handleMapControlsRollPitchBearingZoom(e,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,s)}handleMapControlsPan(e,s,h){this.currentHelper.handleMapControlsPan(e,s,h)}cameraForBoxAndBearing(e,s,h,p,y){return this.currentHelper.cameraForBoxAndBearing(e,s,h,p,y)}handleJumpToCenterZoom(e,s){this.currentHelper.handleJumpToCenterZoom(e,s)}handleEaseTo(e,s){return this.currentHelper.handleEaseTo(e,s)}handleFlyTo(e,s){return this.currentHelper.handleFlyTo(e,s)}}const yu=(g,e)=>l.y(g,e&&e.filter((s=>s.identifier!=="source.canvas"))),Qf=l.bE();class bh extends l.E{constructor(e,s={}){var h,p;super(),this._rtlPluginLoaded=()=>{for(const S in this.sourceCaches){const k=this.sourceCaches[S].getSource().type;k!=="vector"&&k!=="geojson"||this.sourceCaches[S].reload()}},this.map=e,this.dispatcher=new Kt(fr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((S,k)=>this.getGlyphs(S,k))),this.dispatcher.registerMessageHandler("GI",((S,k)=>this.getImages(S,k))),this.imageManager=new it,this.imageManager.setEventedParent(this);const y=((h=e._container)===null||h===void 0?void 0:h.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new At(e._requestManager,s.localIdeographFontFamily,y),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new ca,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",l.bG()),_r().on(vt,this._rtlPluginLoaded),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const k=this.sourceCaches[S.sourceId];if(!k)return;const M=k.getSource();if(M&&M.vectorLayerIds)for(const R in this._layers){const D=this._layers[R];D.source===M.id&&this._validateLayer(D)}}))}setGlobalStateProperty(e,s){var h,p,y;this._checkLoaded();const S=s===null?(y=(p=(h=this.stylesheet.state)===null||h===void 0?void 0:h[e])===null||p===void 0?void 0:p.default)!==null&&y!==void 0?y:null:s;if(l.bH(S,this._globalState[e]))return this;this._globalState[e]=S,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const s=[];for(const h in e)!l.bH(this._globalState[h],e[h].default)&&(s.push(h),this._globalState[h]=e[h].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(e){if(e.length===0)return;const s=new Set;for(const h in this._layers){const p=this._layers[h],y=p.getLayoutAffectingGlobalStateRefs(),S=p.getPaintAffectingGlobalStateRefs();for(const k of e)if(y.has(k)&&s.add(p.source),S.has(k))for(const{name:M,value:R}of S.get(k))this._updatePaintProperty(p,M,R)}for(const h in this.sourceCaches)s.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(e,s={},h){this.fire(new l.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;l.j(p,this._loadStyleRequest).then((S=>{this._loadStyleRequest=null,this._load(S.data,s,h)})).catch((S=>{this._loadStyleRequest=null,S&&!y.signal.aborted&&this.fire(new l.k(S))}))}loadJSON(e,s={},h){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,te.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,h)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(Qf,{validate:!1})}_load(e,s,h){var p,y;let S=s.transformStyle?s.transformStyle(h,e):e;if(!s.validate||!yu(this,l.z(S))){S=Object.assign({},S),this._loaded=!0,this.stylesheet=S;for(const k in S.sources)this.addSource(k,S.sources[k],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new ar(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new _t(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var e;const s=l.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map((h=>h.id)),this._layers={},this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this._serializedLayers=null;for(const h of s){const p=l.bJ(h);p.setEventedParent(this,{layer:{id:h.id}}),p.setGlobalState(this._globalState),this._layers[h.id]=p}}_loadSprite(e,s=!1,h=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(y,S,k,M){return l._(this,void 0,void 0,(function*(){const R=mt(y),D=k>1?"@2x":"",N={},j={};for(const{id:$,url:W}of R){const re=S.transformRequest(yt(W,D,".json"),"SpriteJSON");N[$]=l.j(re,M);const se=S.transformRequest(yt(W,D,".png"),"SpriteImage");j[$]=Le.getImage(se,M)}return yield Promise.all([...Object.values(N),...Object.values(j)]),(function($,W){return l._(this,void 0,void 0,(function*(){const re={};for(const se in $){re[se]={};const oe=te.getImageCanvasContext((yield W[se]).data),ae=(yield $[se]).data;for(const de in ae){const{width:le,height:ge,x:we,y:he,sdf:Ee,pixelRatio:$e,stretchX:je,stretchY:Ne,content:Ze,textFitWidth:ct,textFitHeight:ft}=ae[de];re[se][de]={data:null,pixelRatio:$e,sdf:Ee,stretchX:je,stretchY:Ne,content:Ze,textFitWidth:ct,textFitHeight:ft,spriteData:{width:le,height:ge,x:we,y:he,context:oe}}}}return re}))})(N,j)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((y=>{if(this._spriteRequest=null,y)for(const S in y){this._spritesImagesIds[S]=[];const k=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter((M=>!(M in y))):[];for(const M of k)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in y[S]){const R=S==="default"?M:`${S}:${M}`;this._spritesImagesIds[S].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,y[S][M],!1):this.imageManager.addImage(R,y[S][M]),s&&(this._changedImages[R]=!0)}}})).catch((y=>{this._spriteRequest=null,p=y,this.fire(new l.k(p))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),h&&h(p)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const h=e.sourceLayer;if(!h)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.k(new Error(`Source layer "${h}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const h=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?l.bK(h):h);const p=[];for(const y of e)if(h[y]){const S=s?l.bK(h[y]):h[y];p.push(S)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const h of s){const p=this._layers[h];p.type!=="custom"&&(e[h]=p.serialize())}return e}hasTransitions(){var e,s,h;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(const p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const S in this._updatedSources){const k=this._updatedSources[S];if(k==="reload")this._reloadSource(S);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const h={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];h[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in h){const y=this.sourceCaches[p];!!h[p]!=!!y.used&&y.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,s&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var h;this._checkLoaded();const p=this.serialize();if(e=s.transformStyle?s.transformStyle(p,e):e,((h=s.validate)===null||h===void 0||h)&&yu(this,l.z(e)))return!1;(e=l.bK(e)).layers=l.bI(e.layers);const y=l.bL(p,e),S=this._getOperationsToPerform(y);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const k of S.operations)k();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],h=[];for(const p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":s.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":s.push((()=>{}));break;default:h.push(p.command)}return{operations:s,unimplemented:h}}addImage(e,s){if(this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,h={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.z.source,`sources.${e}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[e]=new rr(e,s,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e}))),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===e)return this.fire(new l.k(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const h=this.sourceCaches[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,h={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new l.k(new Error(`Layer "${p}" already exists on this map.`)));let y;if(e.type==="custom"){if(yu(this,l.bM(e)))return;y=l.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=l.bK(e),e=l.e(e,{source:p})),this._validate(l.z.layer,`layers.${p}`,e,{arrayIndex:-1},h))return;y=l.bJ(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const S=s?this._order.indexOf(s):this._order.length;if(s&&S===-1)this.fire(new l.k(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(S,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const k=this._removedLayers[p];delete this._removedLayers[p],k.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const h=this._order.indexOf(e);this._order.splice(h,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new l.k(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,h){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===s&&p.maxzoom===h||(s!=null&&(p.minzoom=s),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,h={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!l.bH(p.filter,s))return s==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(l.z.filter,`layers.${p.id}.filter`,s,null,h)||(p.setFilter(l.bK(s)),this._updateLayer(p)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.bK(this.getLayer(e).filter)}setLayoutProperty(e,s,h,p={}){this._checkLoaded();const y=this.getLayer(e);y?l.bH(y.getLayoutProperty(s),h)||(y.setLayoutProperty(s,h,p),this._updateLayer(y)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const h=this.getLayer(e);if(h)return h.getLayoutProperty(s);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,h,p={}){this._checkLoaded();const y=this.getLayer(e);y?l.bH(y.getPaintProperty(s),h)||this._updatePaintProperty(y,s,h,p):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,s,h,p={}){e.setPaintProperty(s,h,p)&&this._updateLayer(e),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const h=e.source,p=e.sourceLayer,y=this.sourceCaches[h];if(y===void 0)return void this.fire(new l.k(new Error(`The source '${h}' does not exist in the map's style.`)));const S=y.getSource().type;S==="geojson"&&p?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||p?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,e.id,s)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const h=e.source,p=this.sourceCaches[h];if(p===void 0)return void this.fire(new l.k(new Error(`The source '${h}' does not exist in the map's style.`)));const y=p.getSource().type,S=y==="vector"?e.sourceLayer:void 0;y!=="vector"||S?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(S,e.id,s):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,h=e.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(h,e.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.bN(this.sourceCaches,(y=>y.serialize())),s=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,p=this.stylesheet;return l.bO({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:e,layers:s,terrain:h},(y=>y!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=S=>this._layers[S].type==="fill-extrusion",h={},p=[];for(let S=this._order.length-1;S>=0;S--){const k=this._order[S];if(s(k)){h[k]=S;for(const M of e){const R=M[k];if(R)for(const D of R)p.push(D)}}}p.sort(((S,k)=>k.intersectionZ-S.intersectionZ));const y=[];for(let S=this._order.length-1;S>=0;S--){const k=this._order[S];if(s(k))for(let M=p.length-1;M>=0;M--){const R=p[M].feature;if(h[R.layer.id]<S)break;y.push(R),p.pop()}else for(const M of e){const R=M[k];if(R)for(const D of R)y.push(D.feature)}}return y}queryRenderedFeatures(e,s,h){s&&s.filter&&this._validate(l.z.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of s.layers){const D=this._layers[R];if(!D)return this.fire(new l.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];p[D.source]=!0}}const y=[];s.availableImages=this._availableImages;const S=this._serializedAllLayers(),k=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,M=Object.assign(Object.assign({},s),{layers:k});for(const R in this.sourceCaches)s.layers&&!p[R]||y.push(yr(this.sourceCaches[R],this._layers,S,e,M,h,this.map.terrain?(D,N,j)=>this.map.terrain.getElevation(D,N,j):void 0));return this.placement&&y.push((function(R,D,N,j,$,W,re){const se={},oe=W.queryRenderedSymbols(j),ae=[];for(const de of Object.keys(oe).map(Number))ae.push(re[de]);ae.sort(lr);for(const de of ae){const le=de.featureIndex.lookupSymbolFeatures(oe[de.bucketInstanceId],D,de.bucketIndex,de.sourceLayerIndex,$.filter,$.layers,$.availableImages,R);for(const ge in le){const we=se[ge]=se[ge]||[],he=le[ge];he.sort(((Ee,$e)=>{const je=de.featureSortOrder;if(je){const Ne=je.indexOf(Ee.featureIndex);return je.indexOf($e.featureIndex)-Ne}return $e.featureIndex-Ee.featureIndex}));for(const Ee of he)we.push(Ee)}}return(function(de,le,ge){for(const we in de)for(const he of de[we])ci(he,ge[le[we].source]);return de})(se,R,N)})(this._layers,S,this.sourceCaches,e,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,s){s&&s.filter&&this._validate(l.z.filter,"querySourceFeatures.filter",s.filter,null,s);const h=this.sourceCaches[e];return h?(function(p,y){const S=p.getRenderableIds().map((R=>p.getTileByID(R))),k=[],M={};for(let R=0;R<S.length;R++){const D=S[R],N=D.tileID.canonical.key;M[N]||(M[N]=!0,D.querySourceFeatures(k,y))}return k})(h,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const S in e)if(!l.bH(e[S],h[S])){p=!0;break}if(!p)return;const y={now:te.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(y)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){this._checkLoaded();const h=this.getSky();let p=!1;if(!e&&!h)return;if(e&&!h)p=!0;else if(!e&&h)p=!0;else for(const S in e)if(!l.bH(e[S],h[S])){p=!0;break}if(!p)return;const y={now:te.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(y)}_setProjectionInternal(e){const s=(function(h){if(Array.isArray(h)){const p=new Cl({type:h});return{projection:p,transform:new vc,cameraHelper:new Zd(p)}}switch(h){case"mercator":return{projection:new Pr,transform:new cn,cameraHelper:new hi};case"globe":{const p=new Cl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:p,transform:new vc,cameraHelper:new Zd(p)}}case"vertical-perspective":return{projection:new Pl,transform:new _c,cameraHelper:new ri};default:return l.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new Pr,transform:new cn,cameraHelper:new hi}}})(e);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const h in this.sourceCaches)this.sourceCaches[h].reload()}_validate(e,s,h,p,y={}){return(!y||y.validate!==!1)&&yu(this,e.call(l.z,l.e({key:s,style:this.serialize(),value:h,styleSpec:l.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),_r().off(vt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const h=this.sourceCaches[s];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,h,p,y=!1){let S=!1,k=!1;const M={};for(const R of this._order){const D=this._layers[R];if(D.type!=="symbol")continue;if(!M[D.source]){const j=this.sourceCaches[D.source];M[D.source]=j.getRenderableIds(!0).map(($=>j.getTileByID($))).sort((($,W)=>W.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(W.tileID)?-1:1)))}const N=this.crossTileSymbolIndex.addLayer(D,M[D.source],e.center.lng);S=S||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(te.now(),e.zoom))&&(this.pauseablePlacement=new mc(e,this.map.terrain,this._order,y,s,h,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(te.now()),k=!0),S&&this.pauseablePlacement.placement.setStale()),k||S)for(const R of this._order){const D=this._layers[R];D.type==="symbol"&&this.placement.updateLayerOpacities(D,M[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(te.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return l._(this,void 0,void 0,(function*(){const h=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];return p&&p.setDependencies(s.tileID.key,s.type,s.icons),h}))}getGlyphs(e,s){return l._(this,void 0,void 0,(function*(){const h=yield this.glyphManager.getGlyphs(s.stacks),p=this.sourceCaches[s.source];return p&&p.setDependencies(s.tileID.key,s.type,[""]),h}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(l.z.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,h={},p){this._checkLoaded();const y=[{id:e,url:s}],S=[...mt(this.stylesheet.sprite),...y];this._validate(l.z.sprite,"sprite",S,null,h)||(this.stylesheet.sprite=S,this._loadSprite(y,!0,p))}removeSprite(e){this._checkLoaded();const s=mt(this.stylesheet.sprite);if(s.find((h=>h.id===e))){if(this._spritesImagesIds[e])for(const h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;s.splice(s.findIndex((h=>h.id===e)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return mt(this.stylesheet.sprite)}setSprite(e,s={},h){this._checkLoaded(),e&&this._validate(l.z.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}}var Jf=l.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,h,p,y,S,k,M,R){this.context=e;let D=this.boundPaintVertexBuffers.length!==p.length;for(let N=0;!D&&N<p.length;N++)this.boundPaintVertexBuffers[N]!==p[N]&&(D=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==R?this.freshBind(s,h,p,y,S,k,M,R):(e.bindVertexArray.set(this.vao),k&&k.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind(),R&&R.bind())}freshBind(e,s,h,p,y,S,k,M){const R=e.numAttributes,D=this.context,N=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=M,s.enableAttributes(N,e);for(const j of h)j.enableAttributes(N,e);S&&S.enableAttributes(N,e),k&&k.enableAttributes(N,e),M&&M.enableAttributes(N,e),s.bind(),s.setVertexAttribPointers(N,e,y);for(const j of h)j.bind(),j.setVertexAttribPointers(N,e,y);S&&(S.bind(),S.setVertexAttribPointers(N,e,y)),p&&p.bind(),k&&(k.bind(),k.setVertexAttribPointers(N,e,y)),M&&(M.bind(),M.setVertexAttribPointers(N,e,y)),D.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const _u=(g,e,s,h,p)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:s?s.properties.get("fog-color"):l.bf.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:s?s.calculateFogBlendOpacity(h):0,u_horizon_color:s?s.properties.get("horizon-color"):l.bf.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),wh={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ba(g){const e=[];for(let s=0;s<g.length;s++){if(g[s]===null)continue;const h=g[s].split(" ");e.push(h.pop())}return e}class Sh{constructor(e,s,h,p,y,S,k,M,R=[]){const D=e.gl;this.program=D.createProgram();const N=Ba(s.staticAttributes),j=h?h.getBinderAttributes():[],$=N.concat(j),W=ks.prelude.staticUniforms?Ba(ks.prelude.staticUniforms):[],re=k.staticUniforms?Ba(k.staticUniforms):[],se=s.staticUniforms?Ba(s.staticUniforms):[],oe=h?h.getBinderUniforms():[],ae=W.concat(re).concat(se).concat(oe),de=[];for(const je of ae)de.indexOf(je)<0&&de.push(je);const le=h?h.defines():[];ho(D)&&le.unshift("#version 300 es"),y&&le.push("#define OVERDRAW_INSPECTOR;"),S&&le.push("#define TERRAIN3D;"),M&&le.push(M),R&&le.push(...R);let ge=le.concat(ks.prelude.fragmentSource,k.fragmentSource,s.fragmentSource).join(`
`),we=le.concat(ks.prelude.vertexSource,k.vertexSource,s.vertexSource).join(`
`);ho(D)||(ge=(function(je){return je.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ge),we=(function(je){return je.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(we));const he=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(he,ge),D.compileShader(he),!D.getShaderParameter(he,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(he)}`);D.attachShader(this.program,he);const Ee=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ee,we),D.compileShader(Ee),!D.getShaderParameter(Ee,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ee)}`);D.attachShader(this.program,Ee),this.attributes={};const $e={};this.numAttributes=$.length;for(let je=0;je<this.numAttributes;je++)$[je]&&(D.bindAttribLocation(this.program,je,$[je]),this.attributes[$[je]]=je);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ee),D.deleteShader(he);for(let je=0;je<de.length;je++){const Ne=de[je];if(Ne&&!$e[Ne]){const Ze=D.getUniformLocation(this.program,Ne);Ze&&($e[Ne]=Ze)}}this.fixedUniforms=p(e,$e),this.terrainUniforms=((je,Ne)=>({u_depth:new l.bP(je,Ne.u_depth),u_terrain:new l.bP(je,Ne.u_terrain),u_terrain_dim:new l.bg(je,Ne.u_terrain_dim),u_terrain_matrix:new l.bR(je,Ne.u_terrain_matrix),u_terrain_unpack:new l.bS(je,Ne.u_terrain_unpack),u_terrain_exaggeration:new l.bg(je,Ne.u_terrain_exaggeration)}))(e,$e),this.projectionUniforms=((je,Ne)=>({u_projection_matrix:new l.bR(je,Ne.u_projection_matrix),u_projection_tile_mercator_coords:new l.bS(je,Ne.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bS(je,Ne.u_projection_clipping_plane),u_projection_transition:new l.bg(je,Ne.u_projection_transition),u_projection_fallback_matrix:new l.bR(je,Ne.u_projection_fallback_matrix)}))(e,$e),this.binderUniforms=h?h.getUniforms(e,$e):[]}draw(e,s,h,p,y,S,k,M,R,D,N,j,$,W,re,se,oe,ae,de){const le=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(p),e.setColorMode(y),e.setCullFace(S),M){e.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,M.depthTexture),e.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,M.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(M[we])}if(R)for(const we in R)this.projectionUniforms[wh[we]].set(R[we]);if(k)for(const we in this.fixedUniforms)this.fixedUniforms[we].set(k[we]);se&&se.setUniforms(e,this.binderUniforms,W,{zoom:re});let ge=0;switch(s){case le.LINES:ge=2;break;case le.TRIANGLES:ge=3;break;case le.LINE_STRIP:ge=1}for(const we of $.get()){const he=we.vaos||(we.vaos={});(he[D]||(he[D]=new Gd)).bind(e,this,N,se?se.getPaintVertexBuffers():[],j,we.vertexOffset,oe,ae,de),le.drawElements(s,we.primitiveLength*ge,le.UNSIGNED_SHORT,we.primitiveOffset*ge*2)}}}function kl(g,e,s){const h=1/l.aC(s,1,e.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,e.transform.tileZoom)/p,S=y*(s.tileID.canonical.x+s.tileID.wrap*p),k=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[S>>16,k>>16],u_pixel_coord_lower:[65535&S,65535&k]}}const Zs=(g,e,s,h)=>{const p=g.style.light,y=p.properties.get("position"),S=[y.x,y.y,y.z],k=l.bV();p.properties.get("anchor")==="viewport"&&l.bW(k,g.transform.bearingInRadians),l.bX(S,S,k);const M=g.transform.transformLightDirection(S),R=p.properties.get("color");return{u_lightpos:S,u_lightpos_globe:M,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+e,u_opacity:s,u_fill_translate:h}},ep=(g,e,s,h,p,y,S)=>l.e(Zs(g,e,s,h),kl(y,g,S),{u_height_factor:-Math.pow(2,p.overscaledZ)/S.tileSize/8}),vu=(g,e,s,h)=>l.e(kl(e,g,s),{u_fill_translate:h}),Ml=(g,e)=>({u_world:g,u_fill_translate:e}),xc=(g,e,s,h,p)=>l.e(vu(g,e,s,p),{u_world:h}),tp=(g,e,s,h,p)=>{const y=g.transform;let S,k,M=0;if(s.paint.get("circle-pitch-alignment")==="map"){const R=l.aC(e,1,y.zoom);S=!0,k=[R,R],M=R/(l.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*p}else S=!1,k=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+S,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:k,u_globe_extrude_scale:M,u_translate:h}},xu=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),rp=g=>({u_viewport_size:[g.width,g.height]}),$a=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),qd=(g,e,s,h)=>{const p=l.aC(g,1,e)/(l.$*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:l.aC(g,1,e),u_intensity:s,u_globe_extrude_scale:p}},Th=(g,e,s,h)=>{const p=l.L();l.bY(p,0,g.width,g.height,0,0,1);const y=g.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:s,u_color_ramp:h,u_opacity:e.paint.get("heatmap-opacity")}},Ph=(g,e,s)=>{const h=s.paint.get("hillshade-accent-color");let p;switch(s.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const y=s.getIlluminationProperties();for(let S=0;S<y.directionRadians.length;S++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[S]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:Ch(0,e.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:h,u_method:p,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},Il=(g,e)=>{const s=e.stride,h=l.L();return l.bY(h,0,l.$,-l.$,0,0,1),l.M(h,h,[0,-l.$,0]),{u_matrix:h,u_image:1,u_dimension:[s,s],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function Ch(g,e){const s=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new l.a1(0,h/s).toLngLat().lat,new l.a1(0,(h+1)/s).toLngLat().lat]}const Eh=(g,e,s=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:g.paint.get("color-relief-opacity")}),bc=(g,e,s,h)=>{const p=g.transform;return{u_translation:Ih(g,e,s),u_ratio:h/l.aC(e,1,p.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},kh=(g,e,s,h,p)=>l.e(bc(g,e,s,h),{u_image:0,u_image_height:p}),Mh=(g,e,s,h,p)=>{const y=g.transform,S=ga(e,y);return{u_translation:Ih(g,e,s),u_texsize:e.imageAtlasTexture.size,u_ratio:h/l.aC(e,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[S,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ma=(g,e,s,h,p,y)=>{const S=g.lineAtlas,k=ga(e,g.transform),M=s.layout.get("line-cap")==="round",R=S.getDash(p.from,M),D=S.getDash(p.to,M),N=R.width*y.fromScale,j=D.width*y.toScale;return l.e(bc(g,e,s,h),{u_patternscale_a:[k/N,-R.height/2],u_patternscale_b:[k/j,-D.height/2],u_sdfgamma:S.width/(256*Math.min(N,j)*g.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:D.y,u_mix:y.t})};function ga(g,e){return 1/l.aC(g,1,e.tileZoom)}function Ih(g,e,s){return l.aD(g.transform,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const wc=(g,e,s,h,p)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(S=h.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(y=h.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:np(h.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var y,S};function np(g){g*=Math.PI/180;const e=Math.sin(g),s=Math.cos(g);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Al=(g,e,s,h,p,y,S,k,M,R,D,N,j)=>{const $=S.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:$.width/$.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_label_plane_matrix:k,u_coord_matrix:M,u_is_text:+D,u_pitch_with_map:+h,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:N,u_texture:0,u_translation:R,u_pitched_scale:j}},Ah=(g,e,s,h,p,y,S,k,M,R,D,N,j,$)=>{const W=S.transform;return l.e(Al(g,e,s,h,p,y,S,k,M,R,D,N,$),{u_gamma_scale:h?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},Sc=(g,e,s,h,p,y,S,k,M,R,D,N,j)=>l.e(Ah(g,e,s,h,p,y,S,k,M,R,!0,D,0,j),{u_texsize_icon:N,u_texture_icon:1}),zl=(g,e)=>({u_opacity:g,u_color:e}),Wd=(g,e,s,h,p)=>l.e((function(y,S,k,M){const R=k.imageManager.getPattern(y.from.toString()),D=k.imageManager.getPattern(y.to.toString()),{width:N,height:j}=k.imageManager.getPixelSize(),$=Math.pow(2,M.tileID.overscaledZ),W=M.tileSize*Math.pow(2,k.transform.tileZoom)/$,re=W*(M.tileID.canonical.x+M.tileID.wrap*$),se=W*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[N,j],u_mix:S.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/l.aC(M,1,k.transform.tileZoom),u_pixel_coord_upper:[re>>16,se>>16],u_pixel_coord_lower:[65535&re,65535&se]}})(s,p,e,h),{u_opacity:g}),Rl=(g,e)=>{},zh={fillExtrusion:(g,e)=>({u_lightpos:new l.bT(g,e.u_lightpos),u_lightpos_globe:new l.bT(g,e.u_lightpos_globe),u_lightintensity:new l.bg(g,e.u_lightintensity),u_lightcolor:new l.bT(g,e.u_lightcolor),u_vertical_gradient:new l.bg(g,e.u_vertical_gradient),u_opacity:new l.bg(g,e.u_opacity),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new l.bT(g,e.u_lightpos),u_lightpos_globe:new l.bT(g,e.u_lightpos_globe),u_lightintensity:new l.bg(g,e.u_lightintensity),u_lightcolor:new l.bT(g,e.u_lightcolor),u_vertical_gradient:new l.bg(g,e.u_vertical_gradient),u_height_factor:new l.bg(g,e.u_height_factor),u_opacity:new l.bg(g,e.u_opacity),u_fill_translate:new l.bU(g,e.u_fill_translate),u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new l.bU(g,e.u_world),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new l.bU(g,e.u_world),u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade),u_fill_translate:new l.bU(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_scale_with_map:new l.bP(g,e.u_scale_with_map),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_extrude_scale:new l.bU(g,e.u_extrude_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new l.bg(g,e.u_globe_extrude_scale),u_translate:new l.bU(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new l.bU(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new l.bU(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new l.bQ(g,e.u_color),u_overlay:new l.bP(g,e.u_overlay),u_overlay_scale:new l.bg(g,e.u_overlay_scale)}),depth:Rl,clippingMask:Rl,heatmap:(g,e)=>({u_extrude_scale:new l.bg(g,e.u_extrude_scale),u_intensity:new l.bg(g,e.u_intensity),u_globe_extrude_scale:new l.bg(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new l.bR(g,e.u_matrix),u_world:new l.bU(g,e.u_world),u_image:new l.bP(g,e.u_image),u_color_ramp:new l.bP(g,e.u_color_ramp),u_opacity:new l.bg(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new l.bP(g,e.u_image),u_latrange:new l.bU(g,e.u_latrange),u_exaggeration:new l.bg(g,e.u_exaggeration),u_altitudes:new l.b_(g,e.u_altitudes),u_azimuths:new l.b_(g,e.u_azimuths),u_accent:new l.bQ(g,e.u_accent),u_method:new l.bP(g,e.u_method),u_shadows:new l.bZ(g,e.u_shadows),u_highlights:new l.bZ(g,e.u_highlights)}),hillshadePrepare:(g,e)=>({u_matrix:new l.bR(g,e.u_matrix),u_image:new l.bP(g,e.u_image),u_dimension:new l.bU(g,e.u_dimension),u_zoom:new l.bg(g,e.u_zoom),u_unpack:new l.bS(g,e.u_unpack)}),colorRelief:(g,e)=>({u_image:new l.bP(g,e.u_image),u_unpack:new l.bS(g,e.u_unpack),u_dimension:new l.bU(g,e.u_dimension),u_elevation_stops:new l.bP(g,e.u_elevation_stops),u_color_stops:new l.bP(g,e.u_color_stops),u_color_ramp_size:new l.bP(g,e.u_color_ramp_size),u_opacity:new l.bg(g,e.u_opacity)}),line:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_image:new l.bP(g,e.u_image),u_image_height:new l.bg(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_texsize:new l.bU(g,e.u_texsize),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_image:new l.bP(g,e.u_image),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_patternscale_a:new l.bU(g,e.u_patternscale_a),u_patternscale_b:new l.bU(g,e.u_patternscale_b),u_sdfgamma:new l.bg(g,e.u_sdfgamma),u_image:new l.bP(g,e.u_image),u_tex_y_a:new l.bg(g,e.u_tex_y_a),u_tex_y_b:new l.bg(g,e.u_tex_y_b),u_mix:new l.bg(g,e.u_mix)}),raster:(g,e)=>({u_tl_parent:new l.bU(g,e.u_tl_parent),u_scale_parent:new l.bg(g,e.u_scale_parent),u_buffer_scale:new l.bg(g,e.u_buffer_scale),u_fade_t:new l.bg(g,e.u_fade_t),u_opacity:new l.bg(g,e.u_opacity),u_image0:new l.bP(g,e.u_image0),u_image1:new l.bP(g,e.u_image1),u_brightness_low:new l.bg(g,e.u_brightness_low),u_brightness_high:new l.bg(g,e.u_brightness_high),u_saturation_factor:new l.bg(g,e.u_saturation_factor),u_contrast_factor:new l.bg(g,e.u_contrast_factor),u_spin_weights:new l.bT(g,e.u_spin_weights),u_coords_top:new l.bS(g,e.u_coords_top),u_coords_bottom:new l.bS(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texture:new l.bP(g,e.u_texture),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texture:new l.bP(g,e.u_texture),u_gamma_scale:new l.bg(g,e.u_gamma_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_is_halo:new l.bP(g,e.u_is_halo),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texsize_icon:new l.bU(g,e.u_texsize_icon),u_texture:new l.bP(g,e.u_texture),u_texture_icon:new l.bP(g,e.u_texture_icon),u_gamma_scale:new l.bg(g,e.u_gamma_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_is_halo:new l.bP(g,e.u_is_halo),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new l.bg(g,e.u_opacity),u_color:new l.bQ(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new l.bg(g,e.u_opacity),u_image:new l.bP(g,e.u_image),u_pattern_tl_a:new l.bU(g,e.u_pattern_tl_a),u_pattern_br_a:new l.bU(g,e.u_pattern_br_a),u_pattern_tl_b:new l.bU(g,e.u_pattern_tl_b),u_pattern_br_b:new l.bU(g,e.u_pattern_br_b),u_texsize:new l.bU(g,e.u_texsize),u_mix:new l.bg(g,e.u_mix),u_pattern_size_a:new l.bU(g,e.u_pattern_size_a),u_pattern_size_b:new l.bU(g,e.u_pattern_size_b),u_scale_a:new l.bg(g,e.u_scale_a),u_scale_b:new l.bg(g,e.u_scale_b),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bg(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new l.bP(g,e.u_texture),u_ele_delta:new l.bg(g,e.u_ele_delta),u_fog_matrix:new l.bR(g,e.u_fog_matrix),u_fog_color:new l.bQ(g,e.u_fog_color),u_fog_ground_blend:new l.bg(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bg(g,e.u_fog_ground_blend_opacity),u_horizon_color:new l.bQ(g,e.u_horizon_color),u_horizon_fog_blend:new l.bg(g,e.u_horizon_fog_blend),u_is_globe_mode:new l.bg(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new l.bg(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new l.bP(g,e.u_texture),u_terrain_coords_id:new l.bg(g,e.u_terrain_coords_id),u_ele_delta:new l.bg(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new l.bg(g,e.u_input),u_output_expected:new l.bg(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new l.bT(g,e.u_sun_pos),u_atmosphere_blend:new l.bg(g,e.u_atmosphere_blend),u_globe_position:new l.bT(g,e.u_globe_position),u_globe_radius:new l.bg(g,e.u_globe_radius),u_inv_proj_matrix:new l.bR(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new l.bQ(g,e.u_sky_color),u_horizon_color:new l.bQ(g,e.u_horizon_color),u_horizon:new l.bU(g,e.u_horizon),u_horizon_normal:new l.bU(g,e.u_horizon_normal),u_sky_horizon_blend:new l.bg(g,e.u_sky_horizon_blend),u_sky_blend:new l.bg(g,e.u_sky_blend)})};class Rh{constructor(e,s,h){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Dl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gs{constructor(e,s,h,p){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let h=0;h<this.attributes.length;h++){const p=s.attributes[this.attributes[h].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,s,h){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],S=s.attributes[y.name];S!==void 0&&e.vertexAttribPointer(S,y.components,e[Dl[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ur{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bu extends Ur{getDefault(){return l.bf.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class wu extends Ur{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Hd extends Ur{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Dh extends Ur{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ua extends Ur{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Lh extends Ur{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ip extends Ur{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class qs extends Ur{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Tc extends Ur{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Kd extends Ur{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Fh extends Ur{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Xd extends Ur{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Oh extends Ur{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Ll extends Ur{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Su extends Ur{getDefault(){return l.bf.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Tu extends Ur{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ya extends Ur{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Lo extends Ur{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Fo extends Ur{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class _a extends Ur{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ps extends Ur{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Pc extends Ur{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Va extends Ur{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Cc extends Ur{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class va extends Ur{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Za extends Ur{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ec extends Ur{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Fl extends Ur{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const h=this.gl;ho(h)?h.bindVertexArray(e):(s=h.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class kc extends Ur{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class jh extends Ur{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ga extends Ur{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Oo extends Ur{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class jo extends Oo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Mc extends Oo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ir extends Oo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ic="Framebuffer is not complete";class sp{constructor(e,s,h,p,y){this.context=e,this.width=s,this.height=h;const S=e.gl,k=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new jo(e,k),p)this.depthAttachment=y?new Ir(e,k):new Mc(e,k);else if(y)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error(Ic)}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class Ol{constructor(e){var s,h;if(this.gl=e,this.clearColor=new bu(this),this.clearDepth=new wu(this),this.clearStencil=new Hd(this),this.colorMask=new Dh(this),this.depthMask=new Ua(this),this.stencilMask=new Lh(this),this.stencilFunc=new ip(this),this.stencilOp=new qs(this),this.stencilTest=new Tc(this),this.depthRange=new Kd(this),this.depthTest=new Fh(this),this.depthFunc=new Xd(this),this.blend=new Oh(this),this.blendFunc=new Ll(this),this.blendColor=new Su(this),this.blendEquation=new Tu(this),this.cullFace=new ya(this),this.cullFaceSide=new Lo(this),this.frontFace=new Fo(this),this.program=new _a(this),this.activeTexture=new ps(this),this.viewport=new Pc(this),this.bindFramebuffer=new Va(this),this.bindRenderbuffer=new Cc(this),this.bindTexture=new va(this),this.bindVertexBuffer=new Za(this),this.bindElementBuffer=new Ec(this),this.bindVertexArray=new Fl(this),this.pixelStoreUnpack=new kc(this),this.pixelStoreUnpackPremultiplyAlpha=new jh(this),this.pixelStoreUnpackFlipY=new Ga(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ho(e)){this.HALF_FLOAT=e.HALF_FLOAT;const p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:p==null?void 0:p.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Rh(this,e,s)}createVertexBuffer(e,s,h){return new Gs(this,e,s,h)}createRenderbuffer(e,s,h){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,e,s,h),this.bindRenderbuffer.set(null),y}createFramebuffer(e,s,h,p){return new sp(this,e,s,h,p)}clear({color:e,depth:s,stencil:h}){const p=this.gl;let y=0;e&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.bH(e.blendFunction,an.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ho(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return ho(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let xa;function Nh(g,e,s,h,p){const y=g.context,S=g.transform,k=y.gl,M=g.useProgram("collisionBox"),R=[];let D=0,N=0;for(let oe=0;oe<h.length;oe++){const ae=h[oe],de=e.getTile(ae).getBucket(s);if(!de)continue;const le=p?de.textCollisionBox:de.iconCollisionBox,ge=de.collisionCircleArray;ge.length>0&&(R.push({circleArray:ge,circleOffset:N,coord:ae}),D+=ge.length/4,N=D),le&&M.draw(y,k.LINES,ur.disabled,Mr.disabled,g.colorModeForRenderPass(),nr.disabled,xu(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(ae),S.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,g.transform.zoom,null,null,le.collisionVertexBuffer)}if(!p||!R.length)return;const j=g.useProgram("collisionCircle"),$=new l.b$;$.resize(4*D),$._trim();let W=0;for(const oe of R)for(let ae=0;ae<oe.circleArray.length/4;ae++){const de=4*ae,le=oe.circleArray[de+0],ge=oe.circleArray[de+1],we=oe.circleArray[de+2],he=oe.circleArray[de+3];$.emplace(W++,le,ge,we,he,0),$.emplace(W++,le,ge,we,he,1),$.emplace(W++,le,ge,we,he,2),$.emplace(W++,le,ge,we,he,3)}(!xa||xa.length<2*D)&&(xa=(function(oe){const ae=2*oe,de=new l.c1;de.resize(ae),de._trim();for(let le=0;le<ae;le++){const ge=6*le;de.uint16[ge+0]=4*le+0,de.uint16[ge+1]=4*le+1,de.uint16[ge+2]=4*le+2,de.uint16[ge+3]=4*le+2,de.uint16[ge+4]=4*le+3,de.uint16[ge+5]=4*le+0}return de})(D));const re=y.createIndexBuffer(xa,!0),se=y.createVertexBuffer($,l.c0.members,!0);for(const oe of R){const ae=rp(g.transform);j.draw(y,k.TRIANGLES,ur.disabled,Mr.disabled,g.colorModeForRenderPass(),nr.disabled,ae,g.style.map.terrain&&g.style.map.terrain.getTerrainData(oe.coord),null,s.id,se,re,l.aM.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,g.transform.zoom,null,null,null)}se.destroy(),re.destroy()}const Yd=l.ag(new Float32Array(16));function gn(g,e,s,h,p,y){const{horizontalAlign:S,verticalAlign:k}=l.aH(g);return new l.P((-(S-.5)*e/p+h[0])*y,(-(k-.5)*s/p+h[1])*y)}function Bh(g,e,s,h,p,y){const S=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let k=h.mult(y);s||(k=k.rotate(-p));const M=S.add(k);return en(M.x,M.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(s){const k=ti(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),M=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return g.add(h.rotate(M))}return g.add(h)}function jl(g,e,s,h,p,y,S,k,M,R,D,N){const j=g.text.placedSymbolArray,$=g.text.dynamicLayoutVertexArray,W=g.icon.dynamicLayoutVertexArray,re={};$.clear();for(let se=0;se<j.length;se++){const oe=j.get(se),ae=oe.hidden||!oe.crossTileID||g.allowVerticalPlacement&&!oe.placedOrientation?null:h[oe.crossTileID];if(ae){const de=new l.P(oe.anchorX,oe.anchorY),le={getElevation:N,width:p.width,height:p.height,pitchedLabelPlaneMatrix:y,pitchWithMap:s,transform:p,tileAnchorPoint:de,translation:R,unwrappedTileID:D},ge=s?la(de.x,de.y,le):ti(de.x,de.y,le),we=st(p.cameraToCenterDistance,ge.signedDistanceFromCamera);let he=l.ap(g.textSizeData,k,oe)*we/l.aB;s&&(he*=g.tilePixelRatio/S);const{width:Ee,height:$e,anchor:je,textOffset:Ne,textBoxScale:Ze}=ae,ct=gn(je,Ee,$e,Ne,Ze,he),ft=p.getPitchedTextCorrection(de.x+R[0],de.y+R[1],D),tt=Bh(ge.point,le,e,ct,-p.bearingInRadians,ft),Ft=g.allowVerticalPlacement&&oe.placedOrientation===l.ao.vertical?Math.PI/2:0;for(let br=0;br<oe.numGlyphs;br++)l.av($,tt,Ft);M&&oe.associatedIconIndex>=0&&(re[oe.associatedIconIndex]={shiftedAnchor:tt,angle:Ft})}else lo(oe.numGlyphs,$)}if(M){W.clear();const se=g.icon.placedSymbolArray;for(let oe=0;oe<se.length;oe++){const ae=se.get(oe);if(ae.hidden)lo(ae.numGlyphs,W);else{const de=re[oe];if(de)for(let le=0;le<ae.numGlyphs;le++)l.av(W,de.shiftedAnchor,de.angle);else lo(ae.numGlyphs,W)}}g.icon.dynamicLayoutVertexBuffer.updateData(W)}g.text.dynamicLayoutVertexBuffer.updateData($)}function ba(g,e,s){return s.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Nl(g,e,s,h,p,y,S,k,M,R,D,N,j){const $=g.context,W=$.gl,re=g.transform,se=k==="map",oe=M==="map",ae=k!=="viewport"&&s.layout.get("symbol-placement")!=="point",de=se&&!oe&&!ae,le=!s.layout.get("symbol-sort-key").isConstant();let ge=!1;const we=g.getDepthModeForSublayer(0,ur.ReadOnly),he=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ee=[],$e=re.getCircleRadiusCorrection();for(const je of h){const Ne=e.getTile(je),Ze=Ne.getBucket(s);if(!Ze)continue;const ct=p?Ze.text:Ze.icon;if(!ct||!ct.segments.get().length||!ct.hasVisibleVertices)continue;const ft=ct.programConfigurations.get(s.id),tt=p||Ze.sdfIcons,Ft=p?Ze.textSizeData:Ze.iconSizeData,br=oe||re.pitch!==0,Zr=g.useProgram(ba(tt,p,Ze),ft),nn=l.an(Ft,re.zoom),Qr=g.style.map.terrain&&g.style.map.terrain.getTerrainData(je);let un,xn,mr,Xr,Dn=[0,0],Ln=null;if(p)xn=Ne.glyphAtlasTexture,mr=W.LINEAR,un=Ne.glyphAtlasTexture.size,Ze.iconsInText&&(Dn=Ne.imageAtlasTexture.size,Ln=Ne.imageAtlasTexture,Xr=br||g.options.rotating||g.options.zooming||Ft.kind==="composite"||Ft.kind==="camera"?W.LINEAR:W.NEAREST);else{const Fn=s.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;xn=Ne.imageAtlasTexture,mr=tt||g.options.rotating||g.options.zooming||Fn||br?W.LINEAR:W.NEAREST,un=Ne.imageAtlasTexture.size}const Kn=l.aC(Ne,1,g.transform.zoom),Ti=Tr(se,g.transform,Kn),Rs=l.L();l.aq(Rs,Ti);const Ho=cr(oe,se,g.transform,Kn),wo=l.aD(re,Ne,y,S),Ja=re.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),el=he&&Ze.hasTextData(),Ea=s.layout.get("icon-text-fit")!=="none"&&el&&Ze.hasIconData();if(ae){const Fn=g.style.map.terrain?(Bi,Bn)=>g.style.map.terrain.getElevation(je,Bi,Bn):null,Nn=s.layout.get("text-rotation-alignment")==="map";$r(Ze,g,p,Ti,Rs,oe,R,Nn,je.toUnwrapped(),re.width,re.height,wo,Fn)}const tl=p&&he||Ea,ji=ae||tl?Yd:oe?Ti:g.transform.clipSpaceToPixelsMatrix,Xs=tt&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ni;Ni=tt?Ze.iconsInText?Sc(Ft.kind,nn,de,oe,ae,tl,g,ji,Ho,wo,un,Dn,$e):Ah(Ft.kind,nn,de,oe,ae,tl,g,ji,Ho,wo,p,un,0,$e):Al(Ft.kind,nn,de,oe,ae,tl,g,ji,Ho,wo,p,un,$e);const Ko={program:Zr,buffers:ct,uniformValues:Ni,projectionData:Ja,atlasTexture:xn,atlasTextureIcon:Ln,atlasInterpolation:mr,atlasInterpolationIcon:Xr,isSDF:tt,hasHalo:Xs};if(le&&Ze.canOverlap){ge=!0;const Fn=ct.segments.get();for(const Nn of Fn)Ee.push({segments:new l.aM([Nn]),sortKey:Nn.sortKey,state:Ko,terrainData:Qr})}else Ee.push({segments:ct.segments,sortKey:0,state:Ko,terrainData:Qr})}ge&&Ee.sort(((je,Ne)=>je.sortKey-Ne.sortKey));for(const je of Ee){const Ne=je.state;if($.activeTexture.set(W.TEXTURE0),Ne.atlasTexture.bind(Ne.atlasInterpolation,W.CLAMP_TO_EDGE),Ne.atlasTextureIcon&&($.activeTexture.set(W.TEXTURE1),Ne.atlasTextureIcon&&Ne.atlasTextureIcon.bind(Ne.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ne.isSDF){const Ze=Ne.uniformValues;Ne.hasHalo&&(Ze.u_is_halo=1,qa(Ne.buffers,je.segments,s,g,Ne.program,we,D,N,Ze,Ne.projectionData,je.terrainData)),Ze.u_is_halo=0}qa(Ne.buffers,je.segments,s,g,Ne.program,we,D,N,Ne.uniformValues,Ne.projectionData,je.terrainData)}}function qa(g,e,s,h,p,y,S,k,M,R,D){const N=h.context;p.draw(N,N.gl.TRIANGLES,y,S,k,nr.backCCW,M,D,R,s.id,g.layoutVertexBuffer,g.indexBuffer,e,s.paint,h.transform.zoom,g.programConfigurations.get(s.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Wa(g,e,s,h,p){const y=g.context,S=y.gl,k=Mr.disabled,M=new an([S.ONE,S.ONE],l.bf.transparent,[!0,!0,!0,!0]),R=e.getBucket(s);if(!R)return;const D=h.key;let N=s.heatmapFbos.get(D);N||(N=po(y,e.tileSize,e.tileSize),s.heatmapFbos.set(D,N)),y.bindFramebuffer.set(N.framebuffer),y.viewport.set([0,0,e.tileSize,e.tileSize]),y.clear({color:l.bf.transparent});const j=R.programConfigurations.get(s.id),$=g.useProgram("heatmap",j,!p),W=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),re=g.style.map.terrain.getTerrainData(h);$.draw(y,S.TRIANGLES,ur.disabled,k,M,nr.disabled,qd(e,g.transform.zoom,s.paint.get("heatmap-intensity"),1),re,W,s.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,s.paint,g.transform.zoom,j)}function Ac(g,e,s,h,p){const y=g.context,S=y.gl,k=g.transform;y.setColorMode(g.colorModeForRenderPass());const M=Bl(y,e),R=s.key,D=e.heatmapFbos.get(R);if(!D)return;y.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,D.colorAttachment.get()),y.activeTexture.set(S.TEXTURE1),M.bind(S.LINEAR,S.CLAMP_TO_EDGE);const N=k.getProjectionData({overscaledTileID:s,applyTerrainMatrix:p,applyGlobeMatrix:!h});g.useProgram("heatmapTexture").draw(y,S.TRIANGLES,ur.disabled,Mr.disabled,g.colorModeForRenderPass(),nr.disabled,Th(g,e,0,1),null,N,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,k.zoom),D.destroy(),e.heatmapFbos.delete(R)}function po(g,e,s){var h,p;const y=g.gl,S=y.createTexture();y.bindTexture(y.TEXTURE_2D,S),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const k=(h=g.HALF_FLOAT)!==null&&h!==void 0?h:y.UNSIGNED_BYTE,M=(p=g.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,M,e,s,0,y.RGBA,k,null);const R=g.createFramebuffer(e,s,!1,!1);return R.colorAttachment.set(S),R}function Bl(g,e){return e.colorRampTexture||(e.colorRampTexture=new l.T(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function zc(g,e,s,h,p){if(!s||!h||!h.imageAtlas)return;const y=h.imageAtlas.patternPositions;let S=y[s.to.toString()],k=y[s.from.toString()];if(!S&&k&&(S=k),!k&&S&&(k=S),!S||!k){const M=p.getPaintProperty(e);S=y[M],k=y[M]}S&&k&&g.setConstantPatternPositions(S,k)}function Pu(g,e,s,h,p,y,S,k){const M=g.context.gl,R="fill-pattern",D=s.paint.get(R),N=D&&D.constantOr(1),j=s.getCrossfadeParameters();let $,W,re,se,oe;const ae=g.transform,de=s.paint.get("fill-translate"),le=s.paint.get("fill-translate-anchor");S?(W=N&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=M.LINES):(W=N?"fillPattern":"fill",$=M.TRIANGLES);const ge=D.constantOr(null);for(const we of h){const he=e.getTile(we);if(N&&!he.patternsLoaded())continue;const Ee=he.getBucket(s);if(!Ee)continue;const $e=Ee.programConfigurations.get(s.id),je=g.useProgram(W,$e),Ne=g.style.map.terrain&&g.style.map.terrain.getTerrainData(we);N&&(g.context.activeTexture.set(M.TEXTURE0),he.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),$e.updatePaintBuffers(j)),zc($e,R,ge,he,s);const Ze=ae.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),ct=l.aD(ae,he,de,le);if(S){se=Ee.indexBuffer2,oe=Ee.segments2;const tt=[M.drawingBufferWidth,M.drawingBufferHeight];re=W==="fillOutlinePattern"&&N?xc(g,j,he,tt,ct):Ml(tt,ct)}else se=Ee.indexBuffer,oe=Ee.segments,re=N?vu(g,j,he,ct):{u_fill_translate:ct};const ft=g.stencilModeForClipping(we);je.draw(g.context,$,p,ft,y,nr.backCCW,re,Ne,Ze,s.id,Ee.layoutVertexBuffer,se,oe,s.paint,g.transform.zoom,$e)}}function Cu(g,e,s,h,p,y,S,k){const M=g.context,R=M.gl,D="fill-extrusion-pattern",N=s.paint.get(D),j=N.constantOr(1),$=s.getCrossfadeParameters(),W=s.paint.get("fill-extrusion-opacity"),re=N.constantOr(null),se=g.transform;for(const oe of h){const ae=e.getTile(oe),de=ae.getBucket(s);if(!de)continue;const le=g.style.map.terrain&&g.style.map.terrain.getTerrainData(oe),ge=de.programConfigurations.get(s.id),we=g.useProgram(j?"fillExtrusionPattern":"fillExtrusion",ge);j&&(g.context.activeTexture.set(R.TEXTURE0),ae.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ge.updatePaintBuffers($));const he=se.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!k,applyTerrainMatrix:!0});zc(ge,D,re,ae,s);const Ee=l.aD(se,ae,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),$e=s.paint.get("fill-extrusion-vertical-gradient"),je=j?ep(g,$e,W,Ee,oe,$,ae):Zs(g,$e,W,Ee);we.draw(M,M.gl.TRIANGLES,p,y,S,nr.backCCW,je,le,he,s.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,s.paint,g.transform.zoom,ge,g.style.map.terrain&&de.centroidVertexBuffer)}}function mo(g,e,s,h,p,y,S,k,M){var R;const D=g.style.projection,N=g.context,j=g.transform,$=N.gl,W=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],re=g.useProgram("hillshade",null,!1,W),se=!g.options.moving;for(const oe of h){const ae=e.getTile(oe),de=ae.fbo;if(!de)continue;const le=D.getMeshFromTileID(N,oe.canonical,k,!0,"raster"),ge=(R=g.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(oe);N.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,de.colorAttachment.get());const we=j.getProjectionData({overscaledTileID:oe,aligned:se,applyGlobeMatrix:!M,applyTerrainMatrix:!0});re.draw(N,$.TRIANGLES,y,p[oe.overscaledZ],S,nr.backCCW,Ph(g,ae,s),ge,we,s.id,le.vertexBuffer,le.indexBuffer,le.segments)}}function $l(g,e,s,h,p,y,S,k,M){var R;const D=g.style.projection,N=g.context,j=g.transform,$=N.gl,W=g.useProgram("colorRelief"),re=!g.options.moving;let se=!0,oe=0;for(const ae of h){const de=e.getTile(ae),le=de.dem;if(se){const je=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:Ne,colorTexture:Ze}=s.getColorRampTextures(N,je,le.getUnpackVector());N.activeTexture.set($.TEXTURE1),Ne.bind($.NEAREST,$.CLAMP_TO_EDGE),N.activeTexture.set($.TEXTURE4),Ze.bind($.LINEAR,$.CLAMP_TO_EDGE),se=!1,oe=Ne.size[0]}if(!le||!le.data)continue;const ge=le.stride,we=le.getPixels();if(N.activeTexture.set($.TEXTURE0),N.pixelStoreUnpackPremultiplyAlpha.set(!1),de.demTexture=de.demTexture||g.getTileTexture(ge),de.demTexture){const je=de.demTexture;je.update(we,{premultiply:!1}),je.bind($.LINEAR,$.CLAMP_TO_EDGE)}else de.demTexture=new l.T(N,we,$.RGBA,{premultiply:!1}),de.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const he=D.getMeshFromTileID(N,ae.canonical,k,!0,"raster"),Ee=(R=g.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ae),$e=j.getProjectionData({overscaledTileID:ae,aligned:re,applyGlobeMatrix:!M,applyTerrainMatrix:!0});W.draw(N,$.TRIANGLES,y,p[ae.overscaledZ],S,nr.backCCW,Eh(s,de.dem,oe),Ee,$e,s.id,he.vertexBuffer,he.indexBuffer,he.segments)}}const Ul=[new l.P(0,0),new l.P(l.$,0),new l.P(l.$,l.$),new l.P(0,l.$)];function No(g,e,s,h,p,y,S,k,M=!1,R=!1){const D=h[h.length-1].overscaledZ,N=g.context,j=N.gl,$=g.useProgram("raster"),W=g.transform,re=g.style.projection,se=g.colorModeForRenderPass(),oe=!g.options.moving;for(const ae of h){const de=g.getDepthModeForSublayer(ae.overscaledZ-D,s.paint.get("raster-opacity")===1?ur.ReadWrite:ur.ReadOnly,j.LESS),le=e.getTile(ae);le.registerFadeDuration(s.paint.get("raster-fade-duration"));const ge=e.findLoadedParent(ae,0),we=e.findLoadedSibling(ae),he=Rc(le,ge||we||null,e,s,g.transform,g.style.map.terrain);let Ee,$e;const je=s.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;N.activeTexture.set(j.TEXTURE0),le.texture.bind(je,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(j.TEXTURE1),ge?(ge.texture.bind(je,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),Ee=Math.pow(2,ge.tileID.overscaledZ-le.tileID.overscaledZ),$e=[le.tileID.canonical.x*Ee%1,le.tileID.canonical.y*Ee%1]):le.texture.bind(je,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),le.texture.useMipmap&&N.extTextureFilterAnisotropic&&g.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Ne=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ae),Ze=W.getProjectionData({overscaledTileID:ae,aligned:oe,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),ct=wc($e||[0,0],Ee||1,he,s,k),ft=re.getMeshFromTileID(N,ae.canonical,y,S,"raster");$.draw(N,j.TRIANGLES,de,p?p[ae.overscaledZ]:Mr.disabled,se,M?nr.frontCCW:nr.backCCW,ct,Ne,Ze,s.id,ft.vertexBuffer,ft.indexBuffer,ft.segments)}}function Rc(g,e,s,h,p,y){const S=h.paint.get("raster-fade-duration");if(!y&&S>0){const k=te.now(),M=(k-g.timeAdded)/S,R=e?(k-e.timeAdded)/S:-1,D=s.getSource(),N=zt(p,{tileSize:D.tileSize,roundZoom:D.roundZoom}),j=!e||Math.abs(e.tileID.overscaledZ-N)>Math.abs(g.tileID.overscaledZ-N),$=j&&g.refreshedUponExpiration?1:l.ah(j?M:1-R,0,1);return g.refreshedUponExpiration&&M>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const Eu=new l.bf(1,0,0,1),Qd=new l.bf(0,1,0,1),Dc=new l.bf(0,0,1,1),$h=new l.bf(1,0,1,1),op=new l.bf(0,1,1,1);function Lc(g,e,s,h){Ws(g,0,e+s/2,g.transform.width,s,h)}function tn(g,e,s,h){Ws(g,e-s/2,0,s,g.transform.height,h)}function Ws(g,e,s,h,p,y){const S=g.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(e*g.pixelRatio,s*g.pixelRatio,h*g.pixelRatio,p*g.pixelRatio),S.clear({color:y}),k.disable(k.SCISSOR_TEST)}function di(g,e,s){const h=g.context,p=h.gl,y=g.useProgram("debug"),S=ur.disabled,k=Mr.disabled,M=g.colorModeForRenderPass(),R="$debug",D=g.style.map.terrain&&g.style.map.terrain.getTerrainData(s);h.activeTexture.set(p.TEXTURE0);const N=e.getTileByID(s.key).latestRawTileData,j=Math.floor((N&&N.byteLength||0)/1024),$=e.getTile(s).tileSize,W=512/Math.min($,512)*(s.overscaledZ/g.transform.zoom)*.5;let re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(re+=` => ${s.overscaledZ}`),(function(oe,ae){oe.initDebugOverlayCanvas();const de=oe.debugOverlayCanvas,le=oe.context.gl,ge=oe.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,de.width,de.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ae,5,5),ge.strokeText(ae,5,5),oe.debugOverlayTexture.update(de),oe.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)})(g,`${re} ${j}kB`);const se=g.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(h,p.TRIANGLES,S,k,an.alphaBlended,nr.disabled,$a(l.bf.transparent,W),null,se,R,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),y.draw(h,p.LINE_STRIP,S,k,M,nr.disabled,$a(l.bf.red),D,se,R,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function ms(g,e,s,h){const{isRenderingGlobe:p}=h,y=g.context,S=y.gl,k=g.transform,M=g.colorModeForRenderPass(),R=g.getDepthModeFor3D(),D=g.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]);for(const N of s){const j=e.getTerrainMesh(N.tileID),$=g.renderToTexture.getTexture(N),W=e.getTerrainData(N.tileID);y.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,$.texture);const re=e.getMeshFrameDelta(k.zoom),se=k.calculateFogMatrix(N.tileID.toUnwrapped()),oe=_u(re,se,g.style.sky,k.pitch,p),ae=k.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(y,S.TRIANGLES,R,Mr.disabled,M,nr.backCCW,oe,W,ae,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}}function Bo(g,e){if(!e.mesh){const s=new l.aL;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const h=new l.aN;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),e.mesh=new Ao(g.createVertexBuffer(s,zo.members),g.createIndexBuffer(h),l.aM.simpleSegment(0,0,s.length,h.length))}return e.mesh}class go{constructor(e,s){this.context=new Ol(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=rr.maxUnderzooming+rr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ca}resize(e,s,h){if(this.width=Math.floor(e*h),this.height=Math.floor(s*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,s=new l.aL;s.emplaceBack(0,0),s.emplaceBack(l.$,0),s.emplaceBack(0,l.$),s.emplaceBack(l.$,l.$),this.tileExtentBuffer=e.createVertexBuffer(s,zo.members),this.tileExtentSegments=l.aM.simpleSegment(0,0,4,2);const h=new l.aL;h.emplaceBack(0,0),h.emplaceBack(l.$,0),h.emplaceBack(0,l.$),h.emplaceBack(l.$,l.$),this.debugBuffer=e.createVertexBuffer(h,zo.members),this.debugSegments=l.aM.simpleSegment(0,0,4,5);const p=new l.c6;p.emplaceBack(0,0,0,0),p.emplaceBack(l.$,0,l.$,0),p.emplaceBack(0,l.$,0,l.$),p.emplaceBack(l.$,l.$,l.$,l.$),this.rasterBoundsBuffer=e.createVertexBuffer(p,Jf.members),this.rasterBoundsSegments=l.aM.simpleSegment(0,0,4,2);const y=new l.aL;y.emplaceBack(0,0),y.emplaceBack(l.$,0),y.emplaceBack(0,l.$),y.emplaceBack(l.$,l.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(y,zo.members),this.rasterBoundsSegmentsPosOnly=l.aM.simpleSegment(0,0,4,5);const S=new l.aL;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(S,zo.members),this.viewportSegments=l.aM.simpleSegment(0,0,4,2);const k=new l.c7;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(k);const M=new l.aN;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(M);const R=this.context.gl;this.stencilClearMode=new Mr({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Ao(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.L();l.bY(h,0,this.width,this.height,0,0,1),l.N(h,h,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const p={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(e,s.TRIANGLES,ur.disabled,this.stencilClearMode,an.disabled,nr.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s,h){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source,this.nextStencilID+s.length>256&&this.clearStencil();const p=this.context;p.setColorMode(an.disabled),p.setDepthMode(ur.disabled);const y={};for(const S of s)y[S.key]=this.nextStencilID++;this._renderTileMasks(y,s,h,!0),this._renderTileMasks(y,s,h,!1),this._tileClippingMaskIDs=y}_renderTileMasks(e,s,h,p){const y=this.context,S=y.gl,k=this.style.projection,M=this.transform,R=this.useProgram("clippingMask");for(const D of s){const N=e[D.key],j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),$=k.getMeshFromTileID(this.context,D.canonical,p,!0,"stencil"),W=M.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!h,applyTerrainMatrix:!0});R.draw(y,S.TRIANGLES,ur.disabled,new Mr({func:S.ALWAYS,mask:0},N,255,S.KEEP,S.KEEP,S.REPLACE),an.disabled,h?nr.disabled:nr.backCCW,null,j,W,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){const e=this.context,s=e.gl,h=this.style.projection,p=this.transform,y=this.useProgram("depth"),S=this.getDepthModeFor3D(),k=Pe(p,{tileSize:p.tileSize});for(const M of k){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),D=h.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),N=p.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(e,s.TRIANGLES,S,Mr.disabled,an.disabled,nr.backCCW,null,R,N,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Mr({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Mr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const s=this.context.gl,h=e.sort(((S,k)=>k.overscaledZ-S.overscaledZ)),p=h[h.length-1].overscaledZ,y=h[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const S={};for(let k=0;k<y;k++)S[k+p]=new Mr({func:s.GEQUAL,mask:255},k+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[S,h]}return[{[p]:Mr.disabled},h]}stencilConfigForOverlapTwoPass(e){const s=this.context.gl,h=e.sort(((S,k)=>k.overscaledZ-S.overscaledZ)),p=h[h.length-1].overscaledZ,y=h[0].overscaledZ-p+1;if(this.clearStencil(),y>1){const S={},k={};for(let M=0;M<y;M++)S[M+p]=new Mr({func:s.GREATER,mask:255},y+1+M,255,s.KEEP,s.KEEP,s.REPLACE),k[M+p]=new Mr({func:s.GREATER,mask:255},1+M,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*y+1,[S,k,h]}return this.nextStencilID=3,[{[p]:new Mr({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[p]:new Mr({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},h]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new an([e.CONSTANT_COLOR,e.ONE],new l.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?an.unblended:an.alphaBlended}getDepthModeForSublayer(e,s,h){if(!this.opaquePassEnabledForLayer())return ur.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ur(h||this.context.gl.LEQUAL,s,[p,p])}getDepthModeFor3D(){return new ur(this.context.gl.LEQUAL,ur.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){var h,p;this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(te.now()),this.imageManager.beginFrame();const y=this.style._order,S=this.style.sourceCaches,k={},M={},R={},D={isRenderingToTexture:!1,isRenderingGlobe:((h=e.projection)===null||h===void 0?void 0:h.transitionState)>0};for(const j in S){const $=S[j];$.used&&$.prepare(this.context),k[j]=$.getVisibleCoordinates(!1),M[j]=k[j].slice().reverse(),R[j]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<y.length;j++)if(this.style._layers[y[j]].is3D()){this.opaquePassCutoff=j;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const j of y){const $=this.style._layers[j];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const W=M[$.source];($.type==="custom"||W.length)&&this.renderLayer(this,S[$.source],$,W,D)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:j=>this.useProgram(j)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.bf.black:l.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(j,$){const W=j.context,re=W.gl,se=((we,he,Ee)=>{const $e=Math.cos(he.rollInRadians),je=Math.sin(he.rollInRadians),Ne=ve(he),Ze=he.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:we.properties.get("sky-color"),u_horizon_color:we.properties.get("horizon-color"),u_horizon:[(he.width/2-Ne*je)*Ee,(he.height/2+Ne*$e)*Ee],u_horizon_normal:[-je,$e],u_sky_horizon_blend:we.properties.get("sky-horizon-blend")*he.height/2*Ee,u_sky_blend:Ze}})($,j.style.map.transform,j.pixelRatio),oe=new ur(re.LEQUAL,ur.ReadWrite,[0,1]),ae=Mr.disabled,de=j.colorModeForRenderPass(),le=j.useProgram("sky"),ge=Bo(W,$);le.draw(W,re.TRIANGLES,oe,ae,de,nr.disabled,se,null,void 0,"sky",ge.vertexBuffer,ge.indexBuffer,ge.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[y[this.currentLayer]],$=S[j.source],W=k[j.source];this._renderTileClippingMasks(j,W,!1),this.renderLayer(this,$,j,W,D)}this.renderPass="translucent";let N=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const j=this.style._layers[y[this.currentLayer]],$=S[j.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(j,D))continue;this.opaquePassEnabledForLayer()||N||(N=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(j.type==="symbol"?R:M)[j.source];this._renderTileClippingMasks(j,k[j.source],!!this.renderToTexture),this.renderLayer(this,$,j,W,D)}if(D.isRenderingGlobe&&(function(j,$,W){const re=j.context,se=re.gl,oe=j.useProgram("atmosphere"),ae=new ur(se.LEQUAL,ur.ReadOnly,[0,1]),de=j.transform,le=(function(Ze,ct){const ft=Ze.properties.get("position"),tt=[-ft.x,-ft.y,-ft.z],Ft=l.ag(new Float64Array(16));return Ze.properties.get("anchor")==="map"&&(l.b6(Ft,Ft,ct.rollInRadians),l.b7(Ft,Ft,-ct.pitchInRadians),l.b6(Ft,Ft,ct.bearingInRadians),l.b7(Ft,Ft,ct.center.lat*Math.PI/180),l.bz(Ft,Ft,-ct.center.lng*Math.PI/180)),l.c5(tt,tt,Ft),tt})(W,j.transform),ge=de.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),we=$.properties.get("atmosphere-blend")*ge.projectionTransition;if(we===0)return;const he=Ro(de.worldSize,de.center.lat),Ee=de.inverseProjectionMatrix,$e=new Float64Array(4);$e[3]=1,l.aw($e,$e,de.modelViewProjectionMatrix),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1,l.aw($e,$e,Ee),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1;const je=((Ze,ct,ft,tt,Ft)=>({u_sun_pos:Ze,u_atmosphere_blend:ct,u_globe_position:ft,u_globe_radius:tt,u_inv_proj_matrix:Ft}))(le,we,[$e[0],$e[1],$e[2]],he,Ee),Ne=Bo(re,$);oe.draw(re,se.TRIANGLES,ae,Mr.disabled,an.alphaBlended,nr.disabled,je,null,null,"atmosphere",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const j=(function($,W){let re=null;const se=Object.values($._layers).flatMap((le=>le.source&&!le.isHidden(W)?[$.sourceCaches[le.source]]:[])),oe=se.filter((le=>le.getSource().type==="vector")),ae=se.filter((le=>le.getSource().type!=="vector")),de=le=>{(!re||re.getSource().maxzoom<le.getSource().maxzoom)&&(re=le)};return oe.forEach((le=>de(le))),re||ae.forEach((le=>de(le))),re})(this.style,this.transform.zoom);j&&(function($,W,re){for(let se=0;se<re.length;se++)di($,W,re[se])})(this,j,j.getVisibleCoordinates())}this.options.showPadding&&(function(j){const $=j.transform.padding;Lc(j,j.transform.height-($.top||0),3,Eu),Lc(j,$.bottom||0,3,Qd),tn(j,$.left||0,3,Dc),tn(j,j.transform.width-($.right||0),3,$h);const W=j.transform.centerPoint;(function(re,se,oe,ae){Ws(re,se-1,oe-10,2,20,ae),Ws(re,se-10,oe-1,20,2,ae)})(j,W.x,j.transform.height-W.y,op)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!l.c8(s,h):!l.c9(s,h)),p||(p=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(l.ca(s,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,S){const k=y.context,M=k.gl,R=y.transform,D=an.unblended,N=new ur(M.LEQUAL,ur.ReadWrite,[0,1]),j=S.sourceCache.getRenderableTiles(),$=y.useProgram("terrainDepth");k.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),k.clear({color:l.bf.transparent,depth:1});for(const W of j){const re=S.getTerrainMesh(W.tileID),se=S.getTerrainData(W.tileID),oe=R.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ae={u_ele_delta:S.getMeshFrameDelta(R.zoom)};$.draw(k,M.TRIANGLES,N,Mr.disabled,D,nr.backCCW,ae,se,oe,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,S){const k=y.context,M=k.gl,R=y.transform,D=an.unblended,N=new ur(M.LEQUAL,ur.ReadWrite,[0,1]),j=S.getCoordsTexture(),$=S.sourceCache.getRenderableTiles(),W=y.useProgram("terrainCoords");k.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),k.clear({color:l.bf.transparent,depth:1}),S.coordsIndex=[];for(const re of $){const se=S.getTerrainMesh(re.tileID),oe=S.getTerrainData(re.tileID);k.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,j.texture);const ae={u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(R.zoom)},de=R.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(k,M.TRIANGLES,N,Mr.disabled,D,nr.backCCW,ae,oe,de,"terrain",se.vertexBuffer,se.indexBuffer,se.segments),S.coordsIndex.push(re.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(e,s,h,p,y){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(p||[]).length)&&(this.id=h.id,l.cb(h)?(function(S,k,M,R,D,N){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:j}=N,$=Mr.disabled,W=S.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(re,se,oe,ae,de,le,ge,we,he){const Ee=se.transform,$e=se.style.map.terrain,je=de==="map",Ne=le==="map";for(const Ze of re){const ct=ae.getTile(Ze),ft=ct.getBucket(oe);if(!ft||!ft.text||!ft.text.segments.get().length)continue;const tt=l.an(ft.textSizeData,Ee.zoom),Ft=l.aC(ct,1,se.transform.zoom),br=Tr(je,se.transform,Ft),Zr=oe.layout.get("icon-text-fit")!=="none"&&ft.hasIconData();if(tt){const nn=Math.pow(2,Ee.zoom-ct.tileID.overscaledZ),Qr=$e?(un,xn)=>$e.getElevation(Ze,un,xn):null;jl(ft,je,Ne,he,Ee,br,nn,tt,Zr,l.aD(Ee,ct,ge,we),Ze.toUnwrapped(),Qr)}}})(R,S,M,k,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),D),M.paint.get("icon-opacity").constantOr(1)!==0&&Nl(S,k,M,R,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),$,W,j),M.paint.get("text-opacity").constantOr(1)!==0&&Nl(S,k,M,R,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),$,W,j),k.map.showCollisionBoxes&&(Nh(S,k,M,R,!0),Nh(S,k,M,R,!1))})(e,s,h,p,this.style.placement.variableOffsets,y):l.cc(h)?(function(S,k,M,R,D){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:N}=D,j=M.paint.get("circle-opacity"),$=M.paint.get("circle-stroke-width"),W=M.paint.get("circle-stroke-opacity"),re=!M.layout.get("circle-sort-key").isConstant();if(j.constantOr(1)===0&&($.constantOr(1)===0||W.constantOr(1)===0))return;const se=S.context,oe=se.gl,ae=S.transform,de=S.getDepthModeForSublayer(0,ur.ReadOnly),le=Mr.disabled,ge=S.colorModeForRenderPass(),we=[],he=ae.getCircleRadiusCorrection();for(let Ee=0;Ee<R.length;Ee++){const $e=R[Ee],je=k.getTile($e),Ne=je.getBucket(M);if(!Ne)continue;const Ze=M.paint.get("circle-translate"),ct=M.paint.get("circle-translate-anchor"),ft=l.aD(ae,je,Ze,ct),tt=Ne.programConfigurations.get(M.id),Ft=S.useProgram("circle",tt),br=Ne.layoutVertexBuffer,Zr=Ne.indexBuffer,nn=S.style.map.terrain&&S.style.map.terrain.getTerrainData($e),Qr={programConfiguration:tt,program:Ft,layoutVertexBuffer:br,indexBuffer:Zr,uniformValues:tp(S,je,M,ft,he),terrainData:nn,projectionData:ae.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!N,applyTerrainMatrix:!0})};if(re){const un=Ne.segments.get();for(const xn of un)we.push({segments:new l.aM([xn]),sortKey:xn.sortKey,state:Qr})}else we.push({segments:Ne.segments,sortKey:0,state:Qr})}re&&we.sort(((Ee,$e)=>Ee.sortKey-$e.sortKey));for(const Ee of we){const{programConfiguration:$e,program:je,layoutVertexBuffer:Ne,indexBuffer:Ze,uniformValues:ct,terrainData:ft,projectionData:tt}=Ee.state;je.draw(se,oe.TRIANGLES,de,le,ge,nr.backCCW,ct,ft,tt,M.id,Ne,Ze,Ee.segments,M.paint,S.transform.zoom,$e)}})(e,s,h,p,y):l.cd(h)?(function(S,k,M,R,D){if(M.paint.get("heatmap-opacity")===0)return;const N=S.context,{isRenderingToTexture:j,isRenderingGlobe:$}=D;if(S.style.map.terrain){for(const W of R){const re=k.getTile(W);k.hasRenderableParent(W)||(S.renderPass==="offscreen"?Wa(S,re,M,W,$):S.renderPass==="translucent"&&Ac(S,M,W,j,$))}N.viewport.set([0,0,S.width,S.height])}else S.renderPass==="offscreen"?(function(W,re,se,oe){const ae=W.context,de=ae.gl,le=W.transform,ge=Mr.disabled,we=new an([de.ONE,de.ONE],l.bf.transparent,[!0,!0,!0,!0]);(function(he,Ee,$e){const je=he.gl;he.activeTexture.set(je.TEXTURE1),he.viewport.set([0,0,Ee.width/4,Ee.height/4]);let Ne=$e.heatmapFbos.get(l.c2);Ne?(je.bindTexture(je.TEXTURE_2D,Ne.colorAttachment.get()),he.bindFramebuffer.set(Ne.framebuffer)):(Ne=po(he,Ee.width/4,Ee.height/4),$e.heatmapFbos.set(l.c2,Ne))})(ae,W,se),ae.clear({color:l.bf.transparent});for(let he=0;he<oe.length;he++){const Ee=oe[he];if(re.hasRenderableParent(Ee))continue;const $e=re.getTile(Ee),je=$e.getBucket(se);if(!je)continue;const Ne=je.programConfigurations.get(se.id),Ze=W.useProgram("heatmap",Ne),ct=le.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ft=le.getCircleRadiusCorrection();Ze.draw(ae,de.TRIANGLES,ur.disabled,ge,we,nr.backCCW,qd($e,le.zoom,se.paint.get("heatmap-intensity"),ft),null,ct,se.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,se.paint,le.zoom,Ne)}ae.viewport.set([0,0,W.width,W.height])})(S,k,M,R):S.renderPass==="translucent"&&(function(W,re){const se=W.context,oe=se.gl;se.setColorMode(W.colorModeForRenderPass());const ae=re.heatmapFbos.get(l.c2);ae&&(se.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,ae.colorAttachment.get()),se.activeTexture.set(oe.TEXTURE1),Bl(se,re).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(se,oe.TRIANGLES,ur.disabled,Mr.disabled,W.colorModeForRenderPass(),nr.disabled,Th(W,re,0,1),null,null,re.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,re.paint,W.transform.zoom))})(S,M)})(e,s,h,p,y):l.ce(h)?(function(S,k,M,R,D){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:N}=D,j=M.paint.get("line-opacity"),$=M.paint.get("line-width");if(j.constantOr(1)===0||$.constantOr(1)===0)return;const W=S.getDepthModeForSublayer(0,ur.ReadOnly),re=S.colorModeForRenderPass(),se=M.paint.get("line-dasharray"),oe=M.paint.get("line-pattern"),ae=oe.constantOr(1),de=M.paint.get("line-gradient"),le=M.getCrossfadeParameters(),ge=ae?"linePattern":se?"lineSDF":de?"lineGradient":"line",we=S.context,he=we.gl,Ee=S.transform;let $e=!0;for(const je of R){const Ne=k.getTile(je);if(ae&&!Ne.patternsLoaded())continue;const Ze=Ne.getBucket(M);if(!Ze)continue;const ct=Ze.programConfigurations.get(M.id),ft=S.context.program.get(),tt=S.useProgram(ge,ct),Ft=$e||tt.program!==ft,br=S.style.map.terrain&&S.style.map.terrain.getTerrainData(je),Zr=oe.constantOr(null);if(Zr&&Ne.imageAtlas){const mr=Ne.imageAtlas,Xr=mr.patternPositions[Zr.to.toString()],Dn=mr.patternPositions[Zr.from.toString()];Xr&&Dn&&ct.setConstantPatternPositions(Xr,Dn)}const nn=Ee.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Qr=Ee.getPixelScale(),un=ae?Mh(S,Ne,M,Qr,le):se?ma(S,Ne,M,Qr,se,le):de?kh(S,Ne,M,Qr,Ze.lineClipsArray.length):bc(S,Ne,M,Qr);if(ae)we.activeTexture.set(he.TEXTURE0),Ne.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),ct.updatePaintBuffers(le);else if(se&&(Ft||S.lineAtlas.dirty))we.activeTexture.set(he.TEXTURE0),S.lineAtlas.bind(we);else if(de){const mr=Ze.gradients[M.id];let Xr=mr.texture;if(M.gradientVersion!==mr.version){let Dn=256;if(M.stepInterpolant){const Ln=k.getSource().maxzoom,Kn=je.canonical.z===Ln?Math.ceil(1<<S.transform.maxZoom-je.canonical.z):1;Dn=l.ah(l.c3(Ze.maxLineLength/l.$*1024*Kn),256,we.maxTextureSize)}mr.gradient=l.c4({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Dn,image:mr.gradient||void 0,clips:Ze.lineClipsArray}),mr.texture?mr.texture.update(mr.gradient):mr.texture=new l.T(we,mr.gradient,he.RGBA),mr.version=M.gradientVersion,Xr=mr.texture}we.activeTexture.set(he.TEXTURE0),Xr.bind(M.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}const xn=S.stencilModeForClipping(je);tt.draw(we,he.TRIANGLES,W,xn,re,nr.disabled,un,br,nn,M.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,M.paint,S.transform.zoom,ct,Ze.layoutVertexBuffer2),$e=!1}})(e,s,h,p,y):l.cf(h)?(function(S,k,M,R,D){const N=M.paint.get("fill-color"),j=M.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const{isRenderingToTexture:$}=D,W=S.colorModeForRenderPass(),re=M.paint.get("fill-pattern"),se=S.opaquePassEnabledForLayer()&&!re.constantOr(1)&&N.constantOr(l.bf.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===se){const oe=S.getDepthModeForSublayer(1,S.renderPass==="opaque"?ur.ReadWrite:ur.ReadOnly);Pu(S,k,M,R,oe,W,!1,$)}if(S.renderPass==="translucent"&&M.paint.get("fill-antialias")){const oe=S.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,ur.ReadOnly);Pu(S,k,M,R,oe,W,!0,$)}})(e,s,h,p,y):l.cg(h)?(function(S,k,M,R,D){const N=M.paint.get("fill-extrusion-opacity");if(N===0)return;const{isRenderingToTexture:j}=D;if(S.renderPass==="translucent"){const $=new ur(S.context.gl.LEQUAL,ur.ReadWrite,S.depthRangeFor3D);if(N!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Cu(S,k,M,R,$,Mr.disabled,an.disabled,j),Cu(S,k,M,R,$,S.stencilModeFor3D(),S.colorModeForRenderPass(),j);else{const W=S.colorModeForRenderPass();Cu(S,k,M,R,$,Mr.disabled,W,j)}}})(e,s,h,p,y):l.ch(h)?(function(S,k,M,R,D){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const{isRenderingToTexture:N}=D,j=S.context,$=S.style.projection.useSubdivision,W=S.getDepthModeForSublayer(0,ur.ReadOnly),re=S.colorModeForRenderPass();if(S.renderPass==="offscreen")(function(se,oe,ae,de,le,ge,we){const he=se.context,Ee=he.gl;for(const $e of ae){const je=oe.getTile($e),Ne=je.dem;if(!Ne||!Ne.data||!je.needsHillshadePrepare)continue;const Ze=Ne.dim,ct=Ne.stride,ft=Ne.getPixels();if(he.activeTexture.set(Ee.TEXTURE1),he.pixelStoreUnpackPremultiplyAlpha.set(!1),je.demTexture=je.demTexture||se.getTileTexture(ct),je.demTexture){const Ft=je.demTexture;Ft.update(ft,{premultiply:!1}),Ft.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE)}else je.demTexture=new l.T(he,ft,Ee.RGBA,{premultiply:!1}),je.demTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);he.activeTexture.set(Ee.TEXTURE0);let tt=je.fbo;if(!tt){const Ft=new l.T(he,{width:Ze,height:Ze,data:null},Ee.RGBA);Ft.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),tt=je.fbo=he.createFramebuffer(Ze,Ze,!0,!1),tt.colorAttachment.set(Ft.texture)}he.bindFramebuffer.set(tt.framebuffer),he.viewport.set([0,0,Ze,Ze]),se.useProgram("hillshadePrepare").draw(he,Ee.TRIANGLES,le,ge,we,nr.disabled,Il(je.tileID,Ne),null,null,de.id,se.rasterBoundsBuffer,se.quadTriangleIndexBuffer,se.rasterBoundsSegments),je.needsHillshadePrepare=!1}})(S,k,R,M,W,Mr.disabled,re),j.viewport.set([0,0,S.width,S.height]);else if(S.renderPass==="translucent")if($){const[se,oe,ae]=S.stencilConfigForOverlapTwoPass(R);mo(S,k,M,ae,se,W,re,!1,N),mo(S,k,M,ae,oe,W,re,!0,N)}else{const[se,oe]=S.getStencilConfigForOverlapAndUpdateStencilID(R);mo(S,k,M,oe,se,W,re,!1,N)}})(e,s,h,p,y):l.ci(h)?(function(S,k,M,R,D){if(S.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:N}=D,j=S.style.projection.useSubdivision,$=S.getDepthModeForSublayer(0,ur.ReadOnly),W=S.colorModeForRenderPass();if(j){const[re,se,oe]=S.stencilConfigForOverlapTwoPass(R);$l(S,k,M,oe,re,$,W,!1,N),$l(S,k,M,oe,se,$,W,!0,N)}else{const[re,se]=S.getStencilConfigForOverlapAndUpdateStencilID(R);$l(S,k,M,se,re,$,W,!1,N)}})(e,s,h,p,y):l.cj(h)?(function(S,k,M,R,D){if(S.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:N}=D,j=k.getSource(),$=S.style.projection.useSubdivision;if(j instanceof Zn)No(S,k,M,R,null,!1,!1,j.tileCoords,j.flippedWindingOrder,N);else if($){const[W,re,se]=S.stencilConfigForOverlapTwoPass(R);No(S,k,M,se,W,!1,!0,Ul,!1,N),No(S,k,M,se,re,!0,!0,Ul,!1,N)}else{const[W,re]=S.getStencilConfigForOverlapAndUpdateStencilID(R);No(S,k,M,re,W,!1,!0,Ul,!1,N)}})(e,s,h,p,y):l.ck(h)?(function(S,k,M,R,D){const N=M.paint.get("background-color"),j=M.paint.get("background-opacity");if(j===0)return;const{isRenderingToTexture:$}=D,W=S.context,re=W.gl,se=S.style.projection,oe=S.transform,ae=oe.tileSize,de=M.paint.get("background-pattern");if(S.isPatternMissing(de))return;const le=!de&&N.a===1&&j===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==le)return;const ge=Mr.disabled,we=S.getDepthModeForSublayer(0,le==="opaque"?ur.ReadWrite:ur.ReadOnly),he=S.colorModeForRenderPass(),Ee=S.useProgram(de?"backgroundPattern":"background"),$e=R||Pe(oe,{tileSize:ae,terrain:S.style.map.terrain});de&&(W.activeTexture.set(re.TEXTURE0),S.imageManager.bind(S.context));const je=M.getCrossfadeParameters();for(const Ne of $e){const Ze=oe.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),ct=de?Wd(j,S,de,{tileID:Ne,tileSize:ae},je):zl(j,N),ft=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ne),tt=se.getMeshFromTileID(W,Ne.canonical,!1,!0,"raster");Ee.draw(W,re.TRIANGLES,we,ge,he,nr.backCCW,ct,ft,Ze,M.id,tt.vertexBuffer,tt.indexBuffer,tt.segments)}})(e,0,h,p,y):l.cl(h)&&(function(S,k,M,R){const{isRenderingGlobe:D}=R,N=S.context,j=M.implementation,$=S.style.projection,W=S.transform,re=W.getProjectionDataForCustomLayer(D),se={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:re},oe=j.renderingMode?j.renderingMode:"2d";if(S.renderPass==="offscreen"){const ae=j.prerender;ae&&(S.setCustomLayerDefaults(),N.setColorMode(S.colorModeForRenderPass()),ae.call(j,N.gl,se),N.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),N.setColorMode(S.colorModeForRenderPass()),N.setStencilMode(Mr.disabled);const ae=oe==="3d"?S.getDepthModeFor3D():S.getDepthModeForSublayer(0,ur.ReadOnly);N.setDepthMode(ae),j.render(N.gl,se),N.setDirty(),S.setBaseState(),N.bindFramebuffer.set(null)}})(e,0,h,y))}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!s||!h}useProgram(e,s,h=!1,p=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,S=this.style.projection,k=h?ks.projectionMercator:S.shaderPreludeCode,M=h?co:S.shaderDefine,R=e+(s?s.cacheKey:"")+`/${h?ua:S.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Sh(this.context,ks[e],s,zh[e],this._showOverdrawInspector,y,k,M,p)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}function $o(g,e){let s,h=!1,p=null,y=null;const S=()=>{p=null,h&&(g.apply(y,s),p=setTimeout(S,e),h=!1)};return(...k)=>(h=!0,y=this,s=k,p||S(),p)}class ku{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(h=p)})),(h&&h[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const h=s.join("/");let p=h;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${h}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let S=window.location.href.replace(/(#.+)?$/,y);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=$o(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),S=Math.round(s.lng*y)/y,k=Math.round(s.lat*y)/y,M=this._map.getBearing(),R=this._map.getPitch();let D="";if(D+=e?`/${S}/${k}/${h}`:`${h}/${k}/${S}`,(M||R)&&(D+="/"+Math.round(10*M)/10),R&&(D+=`/${Math.round(R)}`),this._hashName){const N=this._hashName;let j=!1;const $=window.location.hash.slice(1).split("&").map((W=>{const re=W.split("=")[0];return re===N?(j=!0,`${re}=${D}`):W})).filter((W=>W));return j||$.push(`${N}=${D}`),`#${$.join("&")}`}return`#${D}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new l.S(+e[2],+e[1])}catch{return!1}const s=+e[0],h=+(e[3]||0),p=+(e[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&h>=-180&&h<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Uo={linearity:.3,easing:l.cm(0,0,.3,1)},Vo=l.e({deceleration:2500,maxSpeed:1400},Uo),Vl=l.e({deceleration:20,maxSpeed:1400},Uo),Ha=l.e({deceleration:1e3,maxSpeed:360},Uo),Fc=l.e({deceleration:1e3,maxSpeed:90},Uo),Mu=l.e({deceleration:1e3,maxSpeed:360},Uo);class Ka{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:te.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=te.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,s.roll+=y.rollDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const y=rn(s.pan.mag(),h,l.e({},Vo,e||{})),S=s.pan.mult(y.amount/s.pan.mag()),k=this._map.cameraHelper.handlePanInertia(S,this._map.transform);p.center=k.easingCenter,p.offset=k.easingOffset,ni(p,y)}if(s.zoom){const y=rn(s.zoom,h,Vl);p.zoom=this._map.transform.zoom+y.amount,ni(p,y)}if(s.bearing){const y=rn(s.bearing,h,Ha);p.bearing=this._map.transform.bearing+l.ah(y.amount,-179,179),ni(p,y)}if(s.pitch){const y=rn(s.pitch,h,Fc);p.pitch=this._map.transform.pitch+y.amount,ni(p,y)}if(s.roll){const y=rn(s.roll,h,Mu);p.roll=this._map.transform.roll+l.ah(y.amount,-179,179),ni(p,y)}if(p.zoom||p.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function ni(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function rn(g,e,s){const{maxSpeed:h,linearity:p,deceleration:y}=s,S=l.ah(g*p/(e/1e3),-h,h),k=Math.abs(S)/(y*p);return{easing:s.easing,duration:1e3*k,amount:S*(k/2)}}class Or extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,h,p={}){h=h instanceof MouseEvent?h:new MouseEvent(e,h);const y=q.mousePos(s.getCanvas(),h),S=s.unproject(y);super(e,l.e({point:y,lngLat:S,originalEvent:h},p)),this._defaultPrevented=!1,this.target=s}}class gs extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,h){const p=e==="touchend"?h.changedTouches:h.touches,y=q.touchPos(s.getCanvasContainer(),p),S=y.map((M=>s.unproject(M))),k=y.reduce(((M,R,D,N)=>M.add(R.div(N.length))),new l.P(0,0));super(e,{points:y,point:k,lngLats:S,lngLat:s.unproject(k),originalEvent:h}),this._defaultPrevented=!1}}class ii extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class Ri{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ii(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Or(e.type,this._map,e))}mouseup(e){this._map.fire(new Or(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Or(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Or(e.type,this._map,e))}mouseover(e){this._map.fire(new Or(e.type,this._map,e))}mouseout(e){this._map.fire(new Or(e.type,this._map,e))}touchstart(e){return this._firePreventable(new gs(e.type,this._map,e))}touchmove(e){this._map.fire(new gs(e.type,this._map,e))}touchend(e){this._map.fire(new gs(e.type,this._map,e))}touchcancel(e){this._map.fire(new gs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wa{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Or(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Or(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hs{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(l.P.convert(e),this._map.terrain)}}class wi{constructor(e,s){this._map=e,this._tr=new Hs(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=h,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(p.x,h.x),S=Math.max(p.x,h.x),k=Math.min(p.y,h.y),M=Math.max(p.y,h.y);q.setTransform(this._box,`translate(${y}px,${k}px)`),this._box.style.width=S-y+"px",this._box.style.height=M-k+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const h=this._startPos,p=s;if(this.reset(),q.suppressClick(),h.x!==p.x||h.y!==p.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(h,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new l.l(e,{originalEvent:s}))}}function Zo(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const s={};for(let h=0;h<g.length;h++)s[g[h].identifier]=e[h];return s}class Uh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=(function(p){const y=new l.P(0,0);for(const S of p)y._add(S);return y.div(p.length)})(s),this.touches=Zo(h,s)))}touchmove(e,s,h){if(this.aborted||!this.centroid)return;const p=Zo(h,s);for(const y in this.touches){const S=p[y];(!S||S.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,s,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Di{constructor(e){this.singleTap=new Uh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,h){this.singleTap.touchstart(e,s,h)}touchmove(e,s,h){this.singleTap.touchmove(e,s,h)}touchend(e,s,h){const p=this.singleTap.touchend(e,s,h);if(p){const y=e.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(p)<30;if(y&&S||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Yi{constructor(e){this._tr=new Hs(e),this._zoomIn=new Di({numTouches:1,numTaps:2}),this._zoomOut=new Di({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,h){this._zoomIn.touchstart(e,s,h),this._zoomOut.touchstart(e,s,h)}touchmove(e,s,h){this._zoomIn.touchmove(e,s,h),this._zoomOut.touchmove(e,s,h)}touchend(e,s,h){const p=this._zoomIn.touchend(e,s,h),y=this._zoomOut.touchend(e,s,h),S=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(p)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xa{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const p=Array.isArray(s)?s[0]:s;return!this._moved&&p.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(h,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Hn=0,Go=2,Vh={[Hn]:1,[Go]:2};class Zl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=q.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(s,h){const p=Vh[h];return s.buttons===void 0||(s.buttons&p)!==p})(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class ap{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Sa{constructor(e=new Zl({checkCorrectEvent:()=>!0}),s=new ap){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(e,s,h){return e instanceof MouseEvent?s(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?h(e):void 0}startMove(e){this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.startMove(s)),(s=>this.oneFingerTouchMoveStateManager.startMove(s)))}endMove(e){this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.endMove(s)),(s=>this.oneFingerTouchMoveStateManager.endMove(s)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.isValidStartEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.isValidMoveEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.isValidEndEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s)))}}const yo=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class _o{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,h){return this._calculateTransform(e,s,h)}touchmove(e,s,h){if(this._active){if(!this._shouldBePrevented(h.length))return e.preventDefault(),this._calculateTransform(e,s,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,h){this._calculateTransform(e,s,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,h){h.length>0&&(this._active=!0);const p=Zo(h,s),y=new l.P(0,0),S=new l.P(0,0);let k=0;for(const R in p){const D=p[R],N=this._touches[R];N&&(y._add(D),S._add(D.sub(N)),k++,p[R]=D)}if(this._touches=p,this._shouldBePrevented(k)||!S.mag())return;const M=S.div(k);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(k),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,h){if(!this._firstTwoTouches)return;e.preventDefault();const[p,y]=this._firstTwoTouches,S=Et(h,s,p),k=Et(h,s,y);if(!S||!k)return;const M=this._aroundCenter?null:S.add(k).div(2);return this._move([S,k],M,e)}touchend(e,s,h){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,S=Et(h,s,p),k=Et(h,s,y);S&&k||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Et(g,e,s){for(let h=0;h<g.length;h++)if(g[h].identifier===s)return e[h]}function Ji(g,e){return Math.log(g/e)/Math.LN2}class Li extends Qi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ji(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ji(this._distance,h),pinchAround:s}}}function qo(g,e){return 180*g.angleWith(e)/Math.PI}class es extends Qi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,h){const p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qo(this._vector,p),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,h=qo(e,this._startVector);return Math.abs(h)<s}}function Fi(g){return Math.abs(g.y)>Math.abs(g.x)}class vo extends Qi{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,h){super.touchstart(e,s,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,Fi(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,h){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,y=s.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const S=e.y>0==s.y>0;return Fi(e)&&Fi(s)&&S}}const Fr={panStep:100,bearingStep:15,pitchStep:10};class Gl{constructor(e){this._tr=new Hs(e);const s=Fr;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,h=0,p=0,y=0,S=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),S=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:k=>{const M=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:Zh,zoom:s?Math.round(M.zoom)+s*(e.shiftKey?2:1):M.zoom,bearing:M.bearing+h*this._bearingStep,pitch:M.pitch+p*this._pitchStep,offset:[-y*this._panStep,-S*this._panStep],center:M.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zh(g){return g*(2-g)}const Si=4.000244140625,ys=1/450;class vn{constructor(e,s){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new Hs(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ys}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const h=te.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Si==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=q.mousePos(this._map.getCanvas(),e),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(l.S.convert(h.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const k=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=k),typeof this._targetZoom=="number"&&(this._targetZoom+=k)}if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Si?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&M!==0&&(M=1/M);const R=typeof this._targetZoom!="number"?e.scale:l.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),l.ak(R*M)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,h=this._startZoom,p=this._easing;let y,S=!1;if(this._type==="wheel"&&h&&p){const k=te.now()-this._lastWheelEventTime,M=Math.min((k+5)/200,1),R=p(M);y=l.C.number(h,s,R),M<1?this._frameId||(this._frameId=!0):S=!0}else y=s,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!S,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=l.co;if(this._prevEase){const h=this._prevEase,p=(te.now()-h.start)/h.duration,y=h.easing(p+.01)-h.easing(p),S=.27/Math.sqrt(y*y+1e-4)*.01,k=Math.sqrt(.0729-S*S);s=l.cm(S,k,.25,1)}return this._prevEase={start:te.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class _s{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Iu{constructor(e){this._tr=new Hs(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gh{constructor(){this._tap=new Di({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,h){if(!this._swipePoint)if(this._tapTime){const p=s[0],y=e.timeStamp-this._tapTime<500,S=this._tapPoint.dist(p)<30;y&&S?h.length>0&&(this._swipePoint=p,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,s,h)}touchmove(e,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=s[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,s,h)}touchend(e,s,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const p=this._tap.touchend(e,s,h);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Au{constructor(e,s,h){this._el=e,this._mousePan=s,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oc{constructor(e,s,h,p){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=s,this._mousePitch=h,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class qh{constructor(e,s,h,p){this._el=e,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class jc{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=s,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=h,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Is=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Wr extends l.l{}function Ta(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class Wh{constructor(e,s){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=p.type==="renderFrame"?void 0:p,k={needsRenderFrame:!1},M={},R={};for(const{handlerName:j,handler:$,allowed:W}of this._handlers){if(!$.isEnabled())continue;let re;if(this._blockedByActive(R,W,j))$.reset();else if($[y||p.type]){if(l.cp(p,y||p.type)){const se=q.mousePos(this._map.getCanvas(),p);re=$[y||p.type](p,se)}else if(l.cq(p,y||p.type)){const se=this._getMapTouches(p.touches),oe=q.touchPos(this._map.getCanvas(),se);re=$[y||p.type](p,oe,se)}else l.cr(y||p.type)||(re=$[y||p.type](p));this.mergeHandlerResult(k,M,re,j,S),re&&re.needsRenderFrame&&this._triggerRenderFrame()}(re||$.isActive())&&(R[j]=$)}const D={};for(const j in this._previousActiveHandlers)R[j]||(D[j]=S);this._previousActiveHandlers=R,(Object.keys(D).length||Ta(k))&&(this._changes.push([k,M,D]),this._triggerRenderFrame()),(Object.keys(R).length||Ta(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=k;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ka(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,S]of this._listeners)q.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[e,s,h]of this._listeners)q.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Ri(s,e));const p=s.boxZoom=new wi(s,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const y=s.cooperativeGestures=new jc(s,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();const S=new Yi(s),k=new Iu(s);s.doubleClickZoom=new _s(k,S),this._add("tapZoom",S),this._add("clickZoom",k),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const M=new Gh;this._add("tapDragZoom",M);const R=s.touchPitch=new vo(s);this._add("touchPitch",R),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const D=()=>s.project(s.getCenter()),N=(function({enable:le,clickTolerance:ge,aroundCenter:we=!0,minPixelCenterThreshold:he=100,rotateDegreesPerPixelMoved:Ee=.8},$e){const je=new Zl({checkCorrectEvent:Ne=>q.mouseButton(Ne)===0&&Ne.ctrlKey||q.mouseButton(Ne)===2&&!Ne.ctrlKey});return new Xa({clickTolerance:ge,move:(Ne,Ze)=>{const ct=$e();if(we&&Math.abs(ct.y-Ne.y)>he)return{bearingDelta:l.cn(new l.P(Ne.x,Ze.y),Ze,ct)};let ft=(Ze.x-Ne.x)*Ee;return we&&Ze.y<ct.y&&(ft=-ft),{bearingDelta:ft}},moveStateManager:je,enable:le,assignEvents:yo})})(e,D),j=(function({enable:le,clickTolerance:ge,pitchDegreesPerPixelMoved:we=-.5}){const he=new Zl({checkCorrectEvent:Ee=>q.mouseButton(Ee)===0&&Ee.ctrlKey||q.mouseButton(Ee)===2});return new Xa({clickTolerance:ge,move:(Ee,$e)=>({pitchDelta:($e.y-Ee.y)*we}),moveStateManager:he,enable:le,assignEvents:yo})})(e),$=(function({enable:le,clickTolerance:ge,rollDegreesPerPixelMoved:we=.3},he){const Ee=new Zl({checkCorrectEvent:$e=>q.mouseButton($e)===2&&$e.ctrlKey});return new Xa({clickTolerance:ge,move:($e,je)=>{const Ne=he();let Ze=(je.x-$e.x)*we;return je.y<Ne.y&&(Ze=-Ze),{rollDelta:Ze}},moveStateManager:Ee,enable:le,assignEvents:yo})})(e,D);s.dragRotate=new Oc(e,N,j,$),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",j,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const W=(function({enable:le,clickTolerance:ge}){const we=new Zl({checkCorrectEvent:he=>q.mouseButton(he)===0&&!he.ctrlKey});return new Xa({clickTolerance:ge,move:(he,Ee)=>({around:Ee,panDelta:Ee.sub(he)}),activateOnStart:!0,moveStateManager:we,enable:le,assignEvents:yo})})(e),re=new _o(e,s);s.dragPan=new Au(h,W,re),this._add("mousePan",W),this._add("touchPan",re,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const se=new es,oe=new Li;s.touchZoomRotate=new qh(h,oe,se,M),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const ae=s.scrollZoom=new vn(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ae,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const de=s.keyboard=new Gl(s);this._add("keyboard",de),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new wa(s))}_add(e,s,h){this._handlers.push({handlerName:e,handler:s,allowed:h}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Is(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,h){for(const p in e)if(p!==h&&(!s||s.indexOf(p)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const h of e)this._el.contains(h.target)&&s.push(h);return s}mergeHandlerResult(e,s,h,p,y){if(!h)return;l.e(e,h);const S={handlerName:p,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(s.zoom=S),h.panDelta!==void 0&&(s.drag=S),h.rollDelta!==void 0&&(s.roll=S),h.pitchDelta!==void 0&&(s.pitch=S),h.bearingDelta!==void 0&&(s.rotate=S)}_applyChanges(){const e={},s={},h={};for(const[p,y,S]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(e.rollDelta=(e.rollDelta||0)+p.rollDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),l.e(s,y),l.e(h,S);this._updateMapTransform(e,s,h),this._changes=[]}_updateMapTransform(e,s,h){const p=this._map,y=p._getTransformForUpdate(),S=p.terrain;if(!(Ta(e)||S&&this._terrainMovement))return this._fireEvents(s,h,!0);p._stop(!0);let{panDelta:k,zoomDelta:M,bearingDelta:R,pitchDelta:D,rollDelta:N,around:j,pinchAround:$}=e;$!==void 0&&(j=$),j=j||p.transform.centerPoint,S&&!y.isPointOnMapSurface(j)&&(j=y.centerPoint);const W={panDelta:k,zoomDelta:M,rollDelta:N,pitchDelta:D,bearingDelta:R,around:j};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(j)&&(j=y.centerPoint);const re=j.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(k?j.sub(k):j);S?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,y),this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(k))):this._map.cameraHelper.handleMapControlsPan(W,y,re):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(W,y,re))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,y),this._map.cameraHelper.handleMapControlsPan(W,y,re)),p._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,h,!0)}_fireEvents(e,s,h){const p=Is(this._eventsInProgress),y=Is(e),S={};for(const N in e){const{originalEvent:j}=e[N];this._eventsInProgress[N]||(S[`${N}start`]=j),this._eventsInProgress[N]=e[N]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const N in S)this._fireEvent(N,S[N]);y&&this._fireEvent("move",y.originalEvent);for(const N in e){const{originalEvent:j}=e[N];this._fireEvent(N,j)}const k={};let M;for(const N in this._eventsInProgress){const{handlerName:j,originalEvent:$}=this._eventsInProgress[N];this._handlersById[j].isActive()||(delete this._eventsInProgress[N],M=s[j]||$,k[`${N}end`]=M)}for(const N in k)this._fireEvent(N,k[N]);const R=Is(this._eventsInProgress),D=(p||y)&&!R;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&N.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(N)}if(h&&D){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!N||!N.essential&&te.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:M})),j(this._map.getBearing())&&this._map.resetNorth()):(j(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new l.l(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Wr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ql extends l.E{constructor(e,s,h){super(),this._renderFrameCallback=()=>{const p=Math.min((te.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=h.bearingSnap,this.cameraHelper=s,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,s){e.apply(this.transform),this.transform=e,this.cameraHelper=s}getCenter(){return new l.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,s){return this.jumpTo({elevation:e},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,s,h){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},s),h)}panTo(e,s,h){return this.easeTo(l.e({center:e},s),h)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,h){return this.easeTo(l.e({zoom:e},s),h)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,s){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new l.l("movestart",s)).fire(new l.l("move",s)).fire(new l.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,h){return this.easeTo(l.e({bearing:e},s),h)}resetNorth(e,s){return this.rotateTo(0,l.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}getRoll(){return this.transform.roll}setRoll(e,s){return this.jumpTo({roll:e},s),this}cameraForBounds(e,s){e=Vr.convert(e).adjustAntiMeridian();const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,s)}_cameraForBoxAndBearing(e,s,h,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const R=p.padding;p.padding={top:R,bottom:R,right:R,left:R}}const S=l.e(y,p.padding);p.padding=S;const k=this.transform,M=new Vr(e,s);return this.cameraHelper.cameraForBoxAndBearing(p,S,M,h,k)}fitBounds(e,s,h){return this._fitInternal(this.cameraForBounds(e,s),s,h)}fitScreenCoordinates(e,s,h,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(e)),this.transform.screenPointToLocation(l.P.convert(s)),h,p),p,y)}_fitInternal(e,s,h){return e?(delete(s=l.e(e,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(e,s){this.stop();const h=this._getTransformForUpdate();let p=!1,y=!1,S=!1;const k=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,e);const M=h.zoom!==k;return"elevation"in e&&h.elevation!==+e.elevation&&h.setElevation(+e.elevation),"bearing"in e&&h.bearing!==+e.bearing&&(p=!0,h.setBearing(+e.bearing)),"pitch"in e&&h.pitch!==+e.pitch&&(y=!0,h.setPitch(+e.pitch)),"roll"in e&&h.roll!==+e.roll&&(S=!0,h.setRoll(+e.roll)),e.padding==null||h.isPaddingEqual(e.padding)||h.setPadding(e.padding),this._applyUpdatedTransform(h),this.fire(new l.l("movestart",s)).fire(new l.l("move",s)),M&&this.fire(new l.l("zoomstart",s)).fire(new l.l("zoom",s)).fire(new l.l("zoomend",s)),p&&this.fire(new l.l("rotatestart",s)).fire(new l.l("rotate",s)).fire(new l.l("rotateend",s)),y&&this.fire(new l.l("pitchstart",s)).fire(new l.l("pitch",s)).fire(new l.l("pitchend",s)),S&&this.fire(new l.l("rollstart",s)).fire(new l.l("roll",s)).fire(new l.l("rollend",s)),this.fire(new l.l("moveend",s))}calculateCameraOptionsFromTo(e,s,h,p=0){const y=l.a1.fromLngLat(e,s),S=l.a1.fromLngLat(h,p),k=S.x-y.x,M=S.y-y.y,R=S.z-y.z,D=Math.hypot(k,M,R);if(D===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(k,M),j=l.ak(this.transform.cameraToCenterDistance/D/this.transform.tileSize),$=180*Math.atan2(k,-M)/Math.PI;let W=180*Math.acos(N/D)/Math.PI;return W=R<0?90-W:90+W,{center:S.toLngLat(),elevation:p,zoom:j,pitch:W,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(e,s,h,p,y){const S=this.transform.calculateCenterFromCameraLngLatAlt(e,s,h,p);return{center:S.center,elevation:S.elevation,zoom:S.zoom,bearing:h,pitch:p,roll:y}}easeTo(e,s){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.co},e)).animate===!1||!e.essential&&te.prefersReducedMotion)&&(e.duration=0);const h=this._getTransformForUpdate(),p=this.getBearing(),y=h.pitch,S=h.roll,k="bearing"in e?this._normalizeBearing(e.bearing,p):p,M="pitch"in e?+e.pitch:y,R="roll"in e?this._normalizeBearing(e.roll,S):S,D="padding"in e?e.padding:h.padding,N=l.P.convert(e.offset);let j,$;e.around&&(j=l.S.convert(e.around),$=h.locationToScreenPoint(j));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},re=this.cameraHelper.handleEaseTo(h,{bearing:k,pitch:M,roll:R,padding:D,around:j,aroundPoint:$,offsetAsPoint:N,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||p!==k,this._pitching=this._pitching||M!==y,this._rolling=this._rolling||R!==S,this._padding=!h.isPaddingEqual(D),this._zooming=this._zooming||re.isZooming,this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,W),this.terrain&&this._prepareElevation(re.elevationCenter),this._ease((se=>{re.easeFunc(se),this.terrain&&!e.freezeElevation&&this._updateElevation(se),this._applyUpdatedTransform(h),this._fireMoveEvents(s)}),(se=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,se)}),e),this}_prepareEase(e,s,h={}){this._moving=!0,s||h.moving||this.fire(new l.l("movestart",e)),this._zooming&&!h.zooming&&this.fire(new l.l("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new l.l("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new l.l("pitchstart",e)),this._rolling&&!h.rolling&&this.fire(new l.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(s-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.setElevation(l.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const s=e.getCameraLngLat(),h=e.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(s,e.zoom):0;if(h<p){const y=this.calculateCameraOptionsFromTo(s,p,e.center,e.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(s.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&s.push((p=>this.transformCameraUpdate(p))),!s.length)return;const h=e.clone();for(const p of s){const y=h.clone(),{center:S,zoom:k,roll:M,pitch:R,bearing:D,elevation:N}=p(y);S&&y.setCenter(S),N!==void 0&&y.setElevation(N),k!==void 0&&y.setZoom(k),M!==void 0&&y.setRoll(M),R!==void 0&&y.setPitch(R),D!==void 0&&y.setBearing(D),h.apply(y)}this.transform.apply(h)}_fireMoveEvents(e){this.fire(new l.l("move",e)),this._zooming&&this.fire(new l.l("zoom",e)),this._rotating&&this.fire(new l.l("rotate",e)),this._pitching&&this.fire(new l.l("pitch",e)),this._rolling&&this.fire(new l.l("roll",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const h=this._zooming,p=this._rotating,y=this._pitching,S=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new l.l("zoomend",e)),p&&this.fire(new l.l("rotateend",e)),y&&this.fire(new l.l("pitchend",e)),S&&this.fire(new l.l("rollend",e)),this.fire(new l.l("moveend",e))}flyTo(e,s){if(!e.essential&&te.prefersReducedMotion){const Ze=l.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ze,s)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.co},e);const h=this._getTransformForUpdate(),p=h.bearing,y=h.pitch,S=h.roll,k=h.padding,M="bearing"in e?this._normalizeBearing(e.bearing,p):p,R="pitch"in e?+e.pitch:y,D="roll"in e?this._normalizeBearing(e.roll,S):S,N="padding"in e?e.padding:h.padding,j=l.P.convert(e.offset);let $=h.centerPoint.add(j);const W=h.screenPointToLocation($),re=this.cameraHelper.handleFlyTo(h,{bearing:M,pitch:R,roll:D,padding:N,locationAtOffset:W,offsetAsPoint:j,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let se=e.curve;const oe=Math.max(h.width,h.height),ae=oe/re.scaleOfZoom,de=re.pixelPathLength;typeof re.scaleOfMinZoom=="number"&&(se=Math.sqrt(oe/re.scaleOfMinZoom/de*2));const le=se*se;function ge(Ze){const ct=(ae*ae-oe*oe+(Ze?-1:1)*le*le*de*de)/(2*(Ze?ae:oe)*le*de);return Math.log(Math.sqrt(ct*ct+1)-ct)}function we(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function he(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Ee=ge(!1);let $e=function(Ze){return he(Ee)/he(Ee+se*Ze)},je=function(Ze){return oe*((he(Ee)*(we(ct=Ee+se*Ze)/he(ct))-we(Ee))/le)/de;var ct},Ne=(ge(!0)-Ee)/se;if(Math.abs(de)<2e-6||!isFinite(Ne)){if(Math.abs(oe-ae)<1e-6)return this.easeTo(e,s);const Ze=ae<oe?-1:1;Ne=Math.abs(Math.log(ae/oe))/se,je=()=>0,$e=ct=>Math.exp(Ze*se*ct)}return e.duration="duration"in e?+e.duration:1e3*Ne/("screenSpeed"in e?+e.screenSpeed/se:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=p!==M,this._pitching=R!==y,this._rolling=D!==S,this._padding=!h.isPaddingEqual(N),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(re.targetCenter),this._ease((Ze=>{const ct=Ze*Ne,ft=1/$e(ct),tt=je(ct);this._rotating&&h.setBearing(l.C.number(p,M,Ze)),this._pitching&&h.setPitch(l.C.number(y,R,Ze)),this._rolling&&h.setRoll(l.C.number(S,D,Ze)),this._padding&&(h.interpolatePadding(k,N,Ze),$=h.centerPoint.add(j)),re.easeFunc(Ze,ft,tt,$),this.terrain&&!e.freezeElevation&&this._updateElevation(Ze),this._applyUpdatedTransform(h),this._fireMoveEvents(s)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}return e||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(e,s,h){h.animate===!1||h.duration===0?(e(1),s()):(this._easeStart=te.now(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=l.aO(e,-180,180);const h=Math.abs(e-s);return Math.abs(e-360-s)<h&&(e-=360),Math.abs(e+360-s)<h&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.S.convert(e),this.transform.tileZoom):null}}const Wl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zu{constructor(e=Wl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const h=this._map._getUIString(`AttributionControl.${s}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const y=s[p];if(y.used||y.usedForTerrain){const S=y.getSource();S.attribution&&e.indexOf(S.attribution)<0&&e.push(S.attribution)}}e=e.filter((p=>String(p).trim())),e.sort(((p,y)=>p.length-y.length)),e=e.filter(((p,y)=>{for(let S=y+1;S<e.length;S++)if(e[S].indexOf(p)>=0)return!1;return!0}));const h=e.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,e.length?(this._innerContainer.innerHTML=q.sanitize(h),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Hh{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const s=q.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Oi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const p of h)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nc=l.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Lt extends l.E{constructor(e){super(),this._lastTilesetChange=te.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const h={};for(const p of Pe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))h[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),l.bY(p.terrainRttPosMatrix32f,0,l.$,l.$,0,0,1),this._tiles[p.key]=new Sr(p,this.tileSize),this._lastTilesetChange=te.now());for(const p in this._tiles)h[p]||delete this._tiles[p]}freeRtt(e){for(const s in this._tiles){const h=this._tiles[s];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,s){return s?this._getTerrainCoordsForTileRanges(e,s):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const s={};for(const h of this._renderableTilesKeys){const p=this._tiles[h].tileID,y=e.clone(),S=l.ba();if(p.canonical.equals(e.canonical))l.bY(S,0,l.$,l.$,0,0,1);else if(p.canonical.isChildOf(e.canonical)){const k=p.canonical.z-e.canonical.z,M=p.canonical.x-(p.canonical.x>>k<<k),R=p.canonical.y-(p.canonical.y>>k<<k),D=l.$>>k;l.bY(S,0,D,D,0,0,1),l.M(S,S,[-M*D,-R*D,0])}else{if(!e.canonical.isChildOf(p.canonical))continue;{const k=e.canonical.z-p.canonical.z,M=e.canonical.x-(e.canonical.x>>k<<k),R=e.canonical.y-(e.canonical.y>>k<<k),D=l.$>>k;l.bY(S,0,l.$,l.$,0,0,1),l.M(S,S,[M*D,R*D,0]),l.N(S,S,[1/2**k,1/2**k,0])}}y.terrainRttPosMatrix32f=new Float32Array(S),s[h]=y}return s}_getTerrainCoordsForTileRanges(e,s){const h={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(!this._isWithinTileRanges(y,s))continue;const S=e.clone(),k=l.ba();if(y.canonical.z===e.canonical.z){const M=e.canonical.x-y.canonical.x,R=e.canonical.y-y.canonical.y;l.bY(k,0,l.$,l.$,0,0,1),l.M(k,k,[M*l.$,R*l.$,0])}else if(y.canonical.z>e.canonical.z){const M=y.canonical.z-e.canonical.z,R=y.canonical.x-(y.canonical.x>>M<<M),D=y.canonical.y-(y.canonical.y>>M<<M),N=e.canonical.x-(y.canonical.x>>M),j=e.canonical.y-(y.canonical.y>>M),$=l.$>>M;l.bY(k,0,$,$,0,0,1),l.M(k,k,[-R*$+N*l.$,-D*$+j*l.$,0])}else{const M=e.canonical.z-y.canonical.z,R=e.canonical.x-(e.canonical.x>>M<<M),D=e.canonical.y-(e.canonical.y>>M<<M),N=(e.canonical.x>>M)-y.canonical.x,j=(e.canonical.y>>M)-y.canonical.y,$=l.$<<M;l.bY(k,0,$,$,0,0,1),l.M(k,k,[R*l.$+N*$,D*l.$+j*$,0])}S.terrainRttPosMatrix32f=new Float32Array(k),h[p]=S}return h}getSourceTile(e,s){const h=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>h.maxzoom&&(p=h.maxzoom),p<h.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&s)for(;p>=h.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(p--).key);return y}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,s){return s[e.canonical.z]&&e.canonical.x>=s[e.canonical.z].minTileX&&e.canonical.x<=s[e.canonical.z].maxTileX&&e.canonical.y>=s[e.canonical.z].minTileY&&e.canonical.y<=s[e.canonical.z].maxTileY}}class Yt{constructor(e,s,h){this._meshCache={},this.painter=e,this.sourceCache=new Lt(s),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,h,p=l.$){var y;if(!(s>=0&&s<p&&h>=0&&h<p))return 0;const S=this.getTerrainData(e),k=(y=S.tile)===null||y===void 0?void 0:y.dem;if(!k)return 0;const M=l.cs([],[s/p*l.$,h/p*l.$],S.u_terrain_matrix),R=[M[0]*k.dim,M[1]*k.dim],D=Math.floor(R[0]),N=Math.floor(R[1]),j=R[0]-D,$=R[1]-N;return k.get(D,N)*(1-j)*(1-$)+k.get(D+1,N)*j*(1-$)+k.get(D,N+1)*(1-j)*$+k.get(D+1,N+1)*j*$}getElevationForLngLatZoom(e,s){if(!l.ct(s,e.wrap()))return 0;const{tileID:h,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(h,p%l.$,y%l.$,l.$)}getElevation(e,s,h,p=l.$){return this.getDEMElevation(e,s,h,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ag([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new l.T(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const h=s&&s+s.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?y=e.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=e.canonical.x-(e.canonical.x>>y<<y),k=e.canonical.y-(e.canonical.y>>y<<y),M=l.cu(new Float64Array(16),[1/(l.$<<y),1/(l.$<<y),0]);l.M(M,M,[S*l.$,k*l.$,0]),this._demMatrixCache[e.key]={matrix:M,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,h=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(s.context,{width:h,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(s.context,{width:h,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(h,p,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,h,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,S=0;y<this._coordsTextureSize;y++)for(let k=0;k<this._coordsTextureSize;k++,S+=4)s[S+0]=255&k,s[S+1]=255&y,s[S+2]=k>>8<<4|y>>8,s[S+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new l.T(e,h,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),h=this.painter.context,p=h.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,k-S-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),h.bindFramebuffer.set(null);const M=s[0]+(s[2]>>4<<8),R=s[1]+((15&s[2])<<8),D=this.coordsIndex[255-s[3]],N=D&&this.sourceCache.getTileByID(D);if(!N)return null;const j=this._coordsTextureSize,$=(1<<N.tileID.canonical.z)*j;return new l.a1((N.tileID.canonical.x*j+M)/$+N.tileID.wrap,(N.tileID.canonical.y*j+R)/$,this.getElevation(N.tileID,M,R,j))}depthAtPoint(e){const s=new Uint8Array(4),h=this.painter.context,p=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),h.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(e){var s;const h=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,p=h&&e.canonical.y===0,y=h&&e.canonical.y===(1<<e.canonical.z)-1,S=`m_${p?"n":""}_${y?"s":""}`;if(this._meshCache[S])return this._meshCache[S];const k=this.painter.context,M=new l.cv,R=new l.aN,D=this.meshSize,N=l.$/D,j=D*D;for(let he=0;he<=D;he++)for(let Ee=0;Ee<=D;Ee++)M.emplaceBack(Ee*N,he*N,0);for(let he=0;he<j;he+=D+1)for(let Ee=0;Ee<D;Ee++)R.emplaceBack(Ee+he,D+Ee+he+1,D+Ee+he+2),R.emplaceBack(Ee+he,D+Ee+he+2,Ee+he+1);const $=M.length,W=$+(D+1),re=(D+1)*D,se=p?l.bh:0,oe=p?0:1,ae=y?l.bi:l.$,de=y?0:1;for(let he=0;he<=D;he++)M.emplaceBack(he*N,se,oe);for(let he=0;he<=D;he++)M.emplaceBack(he*N,ae,de);for(let he=0;he<D;he++)R.emplaceBack(re+he,W+he,W+he+1),R.emplaceBack(re+he,W+he+1,re+he+1),R.emplaceBack(0+he,$+he+1,$+he),R.emplaceBack(0+he,0+he+1,$+he+1);const le=M.length,ge=le+2*(D+1);for(const he of[0,1])for(let Ee=0;Ee<=D;Ee++)for(const $e of[0,1])M.emplaceBack(he*l.$,Ee*N,$e);for(let he=0;he<2*D;he+=2)R.emplaceBack(le+he,le+he+1,le+he+3),R.emplaceBack(le+he,le+he+3,le+he+2),R.emplaceBack(ge+he,ge+he+3,ge+he+1),R.emplaceBack(ge+he,ge+he+2,ge+he+3);const we=new Ao(k.createVertexBuffer(M,Nc.members),k.createIndexBuffer(R),l.aM.simpleSegment(0,0,M.length,R.length));return this._meshCache[S]=we,we}getMeshFrameDelta(e){return 2*Math.PI*l.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,s){var h;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(h=this.getMinMaxElevation(p).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return s&&s.dem&&(h.minElevation=s.dem.min*this.exaggeration,h.maxElevation=s.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,s){const h=l.a1.fromLngLat(e.wrap()),p=(1<<s)*l.$,y=h.x*p,S=h.y*p,k=Math.floor(y/l.$),M=Math.floor(S/l.$);return{tileID:new l.Z(s,0,s,k,M),mercatorX:y,mercatorY:S}}}class Wo{constructor(e,s,h){this._context=e,this._size=s,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(h.texture),{id:e,fbo:s,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>e.id!==s)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const xo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Hl{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Wo(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((h=>!e._layers[h].isHidden(s))),this._coordsAscending={};for(const h in e.sourceCaches){this._coordsAscending[h]={};const p=e.sourceCaches[h].getVisibleCoordinates(),y=e.sourceCaches[h].getSource(),S=y instanceof Zn?y.terrainTileRanges:null;for(const k of p){const M=this.terrain.sourceCache.getTerrainCoords(k,S);for(const R in M)this._coordsAscending[h][R]||(this._coordsAscending[h][R]=[]),this._coordsAscending[h][R].push(M[R])}}this._coordsAscendingStr={};for(const h of e._order){const p=e._layers[h],y=p.source;if(xo[p.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const S in this._coordsAscending[y])this._coordsAscendingStr[y][S]=this._coordsAscending[y][S].map((k=>k.key)).sort().join()}}for(const h of this._renderableTiles)for(const p in this._coordsAscendingStr){const y=this._coordsAscendingStr[p][h.tileID.key];y&&y!==h.rttCoords[p]&&(h.rtt=[])}}renderLayer(e,s){if(e.isHidden(this.painter.transform.zoom))return!1;const h=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),p=e.type,y=this.painter,S=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(xo[p]&&(this._prevType&&xo[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(e.id),!S))return!0;if(xo[this._prevType]||xo[p]&&S){this._prevType=p;const k=this._stacks.length-1,M=this._stacks[k]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(ms(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[k]){const N=this.pool.getObjectForId(R.rtt[k].id);if(N.stamp===R.rtt[k].stamp){this.pool.useObject(N);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),R.rtt[k]={id:D.id,stamp:D.stamp},y.context.bindFramebuffer.set(D.fbo.framebuffer),y.context.clear({color:l.bf.transparent,stencil:0}),y.currentStencilSource=void 0;for(let N=0;N<M.length;N++){const j=y.style._layers[M[N]],$=j.source?this._coordsAscending[j.source][R.tileID.key]:[R.tileID];y.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),y._renderTileClippingMasks(j,$,!0),y.renderLayer(y,y.style.sourceCaches[j.source],j,$,h),j.source&&(R.rttCoords[j.source]=this._coordsAscendingStr[j.source][R.tileID.key])}}return ms(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),xo[p]}return!1}}const fi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ru=L,pi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Wl,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},As={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ks{constructor(e,s,h=!1){this.mousedown=y=>{this.startMove(y,q.mousePos(this.element,y)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,q.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const p=new Sa;this._rotatePitchHandler=new Xa({clickTolerance:3,move:(y,S)=>{const k=s.getBoundingClientRect(),M=new l.P((k.bottom-k.top)/2,(k.right-k.left)/2);return{bearingDelta:l.cn(new l.P(y.x,S.y),S,M),pitchDelta:h?-.5*(S.y-y.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=e,q.addEventListener(s,"mousedown",this.mousedown),q.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(s,"touchcancel",this.reset)}startMove(e,s){this._rotatePitchHandler.dragStart(e,s),q.disableDrag()}move(e,s){const h=this.map,{bearingDelta:p,pitchDelta:y}=this._rotatePitchHandler.dragMove(e,s)||{};p&&h.setBearing(h.getBearing()+p),y&&h.setPitch(h.getPitch()+y)}off(){const e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let Yr;function wn(g,e,s,h=!1){if(h||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return g==null?void 0:g.wrap();const p=new l.S(g.lng,g.lat);if(g=new l.S(g.lng,g.lat),e){const y=new l.S(g.lng-360,g.lat),S=new l.S(g.lng+360,g.lat),k=s.locationToScreenPoint(g).distSqr(e);s.locationToScreenPoint(y).distSqr(e)<k?g=y:s.locationToScreenPoint(S).distSqr(e)<k&&(g=S)}for(;Math.abs(g.lng-s.center.lng)>180;){const y=s.locationToScreenPoint(g);if(y.x>=0&&y.y>=0&&y.x<=s.width&&y.y<=s.height)break;g.lng>s.center.lng?g.lng-=360:g.lng+=360}return g.lng!==p.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(g))?g:p}const zs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vs(g,e,s){const h=g.classList;for(const p in zs)h.remove(`maplibregl-${s}-anchor-${p}`);h.add(`maplibregl-${s}-anchor-${e}`)}class Pa extends l.E{constructor(e){if(super(),this._onKeyPress=s=>{const h=s.code,p=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=s=>{const h=s.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=wn(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${zs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),te.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");const s=q.createNS("http://www.w3.org/2000/svg","svg"),h=41,p=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${h}px`),s.setAttributeNS(null,"width",`${p}px`),s.setAttributeNS(null,"viewBox",`0 0 ${p} ${h}`);const y=q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const S=q.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const k=q.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of M){const ae=q.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",oe.rx),ae.setAttributeNS(null,"ry",oe.ry),k.appendChild(ae)}const R=q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const D=q.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(D);const N=q.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const j=q.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(j);const $=q.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const W=q.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=q.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const se=q.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),W.appendChild(re),W.appendChild(se),S.appendChild(k),S.appendChild(R),S.appendChild(N),S.appendChild($),S.appendChild(W),s.appendChild(S),s.setAttributeNS(null,"height",h*this._scale+"px"),s.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(s),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),vs(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,h;const p=(s=this._map)===null||s===void 0?void 0:s.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!p||y){const $=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const S=this._map,k=S.terrain.depthAtPoint(this._pos),M=S.terrain.getElevationForLngLatZoom(this._lngLat,S.transform.tileZoom);if(S.transform.lngLatToCameraDepth(this._lngLat,M)-k<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/S.transform.pixelsPerMeter,D=Math.sin(S.getPitch()*Math.PI/180)*R,N=S.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),j=S.transform.lngLatToCameraDepth(this._lngLat,M+D)-N>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&j&&this._popup.remove(),this._element.style.opacity=j?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return(this._opacity===void 0||e===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Du={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ts=0,rs=!1;const Ca={maxWidth:100,unit:"metric"};function Bc(g,e,s){const h=s&&s.maxWidth||100,p=g._container.clientHeight/2,y=g._container.clientWidth/2,S=g.unproject([y-h/2,p]),k=g.unproject([y+h/2,p]),M=Math.round(g.project(k).x-g.project(S).x),R=Math.min(h,M,g._container.clientWidth),D=S.distanceTo(k);if(s&&s.unit==="imperial"){const N=3.2808*D;N>5280?bo(e,R,N/5280,g._getUIString("ScaleControl.Miles")):bo(e,R,N,g._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?bo(e,R,D/1852,g._getUIString("ScaleControl.NauticalMiles")):D>=1e3?bo(e,R,D/1e3,g._getUIString("ScaleControl.Kilometers")):bo(e,R,D,g._getUIString("ScaleControl.Meters"))}function bo(g,e,s,h){const p=(function(y){const S=Math.pow(10,`${Math.floor(y)}`.length-1);let k=y/S;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:(function(M){const R=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*R)/R})(k),S*k})(s);g.style.width=e*(p/s)+"px",g.innerHTML=`${p}&nbsp;${h}`}const Lu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Ya=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xs(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-g),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const e=l.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return xs(new l.P(0,0))}const Qa=L;w.AJAXError=l.cz,w.Event=l.l,w.Evented=l.E,w.LngLat=l.S,w.MercatorCoordinate=l.a1,w.Point=l.P,w.addProtocol=l.cA,w.config=l.a,w.removeProtocol=l.cB,w.AttributionControl=zu,w.BoxZoomHandler=wi,w.CanvasSource=Be,w.CooperativeGesturesHandler=jc,w.DoubleClickZoomHandler=_s,w.DragPanHandler=Au,w.DragRotateHandler=Oc,w.EdgeInsets=uo,w.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=zi,w.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new l.S(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,p=this._map.getBearing(),y=l.e({bearing:p},this.options.fitBoundsOptions),S=Vr.fromLngLat(s,h);this._map.fitBounds(S,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new l.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&rs)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Pa({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{const h=(s==null?void 0:s[0])instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},Du,g)}onAdd(g){return this._map=g,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(e=!1){if(Yr!==void 0&&!e)return Yr;if(window.navigator.permissions===void 0)return Yr=!!window.navigator.geolocation,Yr;try{Yr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Yr=!!window.navigator.geolocation}return Yr}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ts=0,rs=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),s=g.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const g=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&g))return;const e=this._map.project(g),s=this._map.unproject([e.x+100,e.y]),h=g.distanceTo(s)/100,p=2*this._accuracy/h;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ts--,rs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ts++,ts>1?(g={maximumAge:6e5,timeout:0},rs=!0):(g=this.options.positionOptions,rs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=q.create("button","maplibregl-ctrl-globe",this._container),q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},w.Hash=ku,w.ImageSource=Zn,w.KeyboardHandler=Gl,w.LngLatBounds=Vr,w.LogoControl=Hh,w.Map=class extends ql{constructor(g){var e,s;l.cw.mark(l.cx.create);const h=Object.assign(Object.assign(Object.assign({},pi),g),{canvasContextAttributes:Object.assign(Object.assign({},pi.canvasContextAttributes),g.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new cn,y=new hi;if(h.minZoom!==void 0&&p.setMinZoom(h.minZoom),h.maxZoom!==void 0&&p.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&p.setMinPitch(h.minPitch),h.maxPitch!==void 0&&p.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&p.setRenderWorldCopies(h.renderWorldCopies),super(p,y,{bearingSnap:h.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Oi,this._controls=[],this._mapId=l.a7(),this._contextLost=k=>{k.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.l("webglcontextlost",{originalEvent:k}))},this._contextRestored=k=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:k}))},this._onMapScroll=k=>{if(k.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},fi),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Le.addThrottleControl((()=>this.isMoving())),this._requestManager=new Xe(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let k=!1;const M=$o((R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())}),50);this._resizeObserver=new ResizeObserver((R=>{k?M(R):k=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Wh(this,h),this._hash=h.hash&&new ku(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,l.e({},h.fitBoundsOptions,{duration:0}))));const S=typeof h.style=="string"||((s=(e=h.style)===null||e===void 0?void 0:e.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,S),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new zu(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new Hh,h.logoPosition),this.on("style.load",(()=>{if(S||this._resizeTransform(),this.transform.unmodified){const k=l.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(k)}})),this.on("data",(k=>{this._update(k.dataType==="style"),this.fire(new l.l(`${k.dataType}data`,k))})),this.on("dataloading",(k=>{this.fire(new l.l(`${k.dataType}dataloading`,k))})),this.on("dataabort",(k=>{this.fire(new l.l("sourcedataabort",k))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,e){return this.style.setGlobalStateProperty(g,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=g.onAdd(this);this._controls.push(g);const h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}coveringTiles(g){return Pe(this.transform,g)}calculateCameraOptionsFromTo(g,e,s,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,s,h)}resize(g,e=!0){const[s,h]=this._containerDimensions(),p=this._getClampedPixelRatio(s,h);if(this._resizeCanvas(s,h,p),this.painter.resize(s,h,p),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const k=this._getClampedPixelRatio(s,h);this._resizeCanvas(s,h,k),this.painter.resize(s,h,k)}this._resizeTransform(e);const y=!this._moving;return y&&(this.stop(),this.fire(new l.l("movestart",g)).fire(new l.l("move",g))),this.fire(new l.l("resize",g)),y&&this.fire(new l.l("moveend",g)),this}_resizeTransform(g=!0){var e;const[s,h]=this._containerDimensions();this.transform.resize(s,h,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(s,h,g)}_getClampedPixelRatio(g,e){const{0:s,1:h}=this._maxCanvasSize,p=this.getPixelRatio(),y=g*p,S=e*p;return Math.min(y>s?s/y:1,S>h?h/S:1)*p}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Vr.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(l.S.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,s){if(g==="mouseenter"||g==="mouseover"){let h=!1;return{layers:e,listener:s,delegates:{mousemove:y=>{const S=e.filter((M=>this.getLayer(M))),k=S.length!==0?this.queryRenderedFeatures(y.point,{layers:S}):[];k.length?h||(h=!0,s.call(this,new Or(g,this,y.originalEvent,{features:k}))):h=!1},mouseout:()=>{h=!1}}}}if(g==="mouseleave"||g==="mouseout"){let h=!1;return{layers:e,listener:s,delegates:{mousemove:S=>{const k=e.filter((M=>this.getLayer(M)));(k.length!==0?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?h=!0:h&&(h=!1,s.call(this,new Or(g,this,S.originalEvent)))},mouseout:S=>{h&&(h=!1,s.call(this,new Or(g,this,S.originalEvent)))}}}}{const h=p=>{const y=e.filter((k=>this.getLayer(k))),S=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];S.length&&(p.features=S,s.call(this,p),delete p.features)};return{layers:e,listener:s,delegates:{[g]:h}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,s){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const h=this._delegatedListeners[g];for(let p=0;p<h.length;p++){const y=h[p];if(y.listener===s&&y.layers.length===e.length&&y.layers.every((S=>e.includes(S)))){for(const S in y.delegates)this.off(S,y.delegates[S]);return void h.splice(p,1)}}}on(g,e,s){if(s===void 0)return super.on(g,e);const h=typeof e=="string"?[e]:e,p=this._createDelegatedListener(g,h,s);this._saveDelegatedListener(g,p);for(const y in p.delegates)this.on(y,p.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(g,h,s)}}}once(g,e,s){if(s===void 0)return super.once(g,e);const h=typeof e=="string"?[e]:e,p=this._createDelegatedListener(g,h,s);for(const y in p.delegates){const S=p.delegates[y];p.delegates[y]=(...k)=>{this._removeDelegatedListener(g,h,s),S(...k)}}this._saveDelegatedListener(g,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(g,e,s){return s===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let s;const h=g instanceof l.P||Array.isArray(g),p=h?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:g)||{},p instanceof l.P||typeof p[0]=="number")s=[l.P.convert(p)];else{const y=l.P.convert(p[0]),S=l.P.convert(p[1]);s=[y,new l.P(S.x,y.y),S,new l.P(y.x,S.y),y]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var s,h;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,e)));const p=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new bh(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,p):this.style.loadJSON(g,e,p),this):((h=(s=this.style)===null||s===void 0?void 0:s.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new bh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const s=this._requestManager.transformRequest(g,"Style");l.j(s,new AbortController).then((h=>{this._updateDiff(h.data,e)})).catch((h=>{h&&this.fire(new l.k(h))}))}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(s){l.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new l.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const h=this.style._layers[s];h.type==="hillshade"&&h.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),h.type==="color-relief"&&h.source===g.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Yt(this.painter,e,g),this.painter.renderToTexture=new Hl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var h;s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((h=s.source)===null||h===void 0?void 0:h.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const s=g[e]._tiles;for(const h in s){const p=s[h];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,e,s){if(s){const h=this.getSource(s);if(!h)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);h.calculateTileZoom=rt(Math.max(1,g),Math.max(1,e))}else for(const h in this.style.sourceCaches)this.style.sourceCaches[h].getSource().calculateTileZoom=rt(Math.max(1,g),Math.max(1,e));return this._update(!0),this}refreshTiles(g,e){const s=this.style.sourceCaches[g];if(!s)throw new Error(`There is no source cache with ID "${g}", cannot refresh tile`);e===void 0?s.reload(!0):s.refreshTiles(e.map((h=>new l.a4(h.z,h.x,h.y))))}addImage(g,e,s={}){const{pixelRatio:h=1,sdf:p=!1,stretchX:y,stretchY:S,content:k,textFitWidth:M,textFitHeight:R}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:N,data:j}=e,$=e;return this.style.addImage(g,{data:new l.R({width:D,height:N},new Uint8Array(j)),pixelRatio:h,stretchX:y,stretchY:S,content:k,textFitWidth:M,textFitHeight:R,sdf:p,version:0,userImage:$}),$.onAdd&&$.onAdd(this,g),this}}{const{width:D,height:N,data:j}=te.getImageData(e);this.style.addImage(g,{data:new l.R({width:D,height:N},j),pixelRatio:h,stretchX:y,stretchY:S,content:k,textFitWidth:M,textFitHeight:R,sdf:p,version:0})}}updateImage(g,e){const s=this.style.getImage(g);if(!s)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=e instanceof HTMLImageElement||l.b(e)?te.getImageData(e):e,{width:p,height:y,data:S}=h;if(p===void 0||y===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||y!==s.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(e instanceof HTMLImageElement||l.b(e));return s.data.replace(S,k),this.style.updateImage(g,s),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return Le.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,s){return this.style.setLayerZoomRange(g,e,s),this._update(!0)}setFilter(g,e,s={}){return this.style.setFilter(g,e,s),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,s,h={}){return this.style.setPaintProperty(g,e,s,h),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,s,h={}){return this.style.setLayoutProperty(g,e,s,h),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,s,(h=>{h||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,(s=>{s||this._update(!0)})),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=q.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),h=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],h);const p=this._controlContainer=q.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{y[S]=q.create("div",`maplibregl-ctrl-${S} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,s){this._canvas.width=Math.floor(s*g),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(h=>{e={requestedAttributes:g},h&&(e.statusMessage=h.statusMessage,e.type=h.type)}),{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!s){const h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new go(s,this.transform),Se.testSupport(s)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,s,h,p,y;const S=this._idleTriggered?this._fadeDuration:0,k=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,j=te.now();this.style.zoomHistory.update(N,j);const $=new l.F(N,{now:j,fadeDuration:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),W=$.crossFadingFactor();W===1&&W===this._crossFadingFactor||(M=!0,this._crossFadingFactor=W),this.style.update($)}const R=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==k;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cw.mark(l.cx.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,l.cw.mark(l.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Le.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cw.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,te.frame(this._frameRequest,(g=>{l.cw.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!l.cy(e)&&!(function(s){return s.message===Ic})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Ru}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},w.MapMouseEvent=Or,w.MapTouchEvent=gs,w.MapWheelEvent=ii,w.Marker=Pa,w.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,s)=>{const h=this._map._getUIString(`NavigationControl.${s}`);e.title=h,e.setAttribute("aria-label",h)},this.options=l.e({},As,g),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ks(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const s=q.create("button",g,this._container);return s.type="button",s.addEventListener("click",e),s}},w.Popup=class extends l.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=wn(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const s=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let h=this.options.anchor;const p=xs(this.options.offset);if(!h){const S=this._container.offsetWidth,k=this._container.offsetHeight;let M;M=s.y+p.bottom.y<k?["top"]:s.y>this._map.transform.height-k?["bottom"]:[],s.x<S/2?M.push("left"):s.x>this._map.transform.width-S/2&&M.push("right"),h=M.length===0?"bottom":M.join("-")}let y=s.add(p[h]);this.options.subpixelPositioning||(y=y.round()),q.setTransform(this._container,`${zs[h]} translate(${y.x}px,${y.y}px)`),vs(this._container,h,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Lu),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.S.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=g;h=s.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Ya);g&&g.focus()}},w.RasterDEMTileSource=Xi,w.RasterTileSource=jn,w.ScaleControl=class{constructor(g){this._onMove=()=>{Bc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Bc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ca),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=vn,w.Style=bh,w.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=vo,w.TwoFingersTouchRotateHandler=es,w.TwoFingersTouchZoomHandler=Li,w.TwoFingersTouchZoomRotateHandler=qh,w.VectorTileSource=Cn,w.VideoSource=xe,w.addSourceType=(g,e)=>l._(void 0,void 0,void 0,(function*(){if(kt(g))throw new Error(`A source type called "${g}" already exists.`);((s,h)=>{Ke[s]=h})(g,e)})),w.clearPrewarmedResources=function(){const g=jt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Ct),jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.createTileMesh=Tl,w.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return _r().getRTLTextPluginStatus()},w.getVersion=function(){return Qa},w.getWorkerCount=function(){return Me.workerCount},w.getWorkerUrl=function(){return l.a.WORKER_URL},w.importScriptInWorkers=function(g){return Lr().broadcast("IS",g)},w.prewarm=function(){fr().acquire(Ct)},w.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},w.setRTLTextPlugin=function(g,e){return _r().setRTLTextPlugin(g,e)},w.setWorkerCount=function(g){Me.workerCount=g},w.setWorkerUrl=function(g){l.a.WORKER_URL=g}}));var P=u;return P}))})(wg)),wg.exports}var BS=NS();const zy=k_(BS),$S="https://api.maptiler.com/maps/019951a8-6432-7aea-b555-2ac65a59181f/style.json?key=Dh5hFFvt6R7cmui0rEtJ",US="https://api.maptiler.com/maps/019951b2-24e8-7a45-8534-0731061b7984/style.json?key=Dh5hFFvt6R7cmui0rEtJ";function Ab(){return document.documentElement.classList.contains("dark")}function VS(){const n=getComputedStyle(document.documentElement).getPropertyValue("--color-accent").trim();return n.includes(" ")?`rgb(${n})`:n||"#0a5a82"}function Px(){return Ab()?US:$S}function ZS(n,o){const u=n.lat,m=o/111,b=o/(111*Math.cos(u*Math.PI/180)),P=n.lon-b,w=n.lon+b,l=n.lat-m,L=n.lat+m;return[[P,l],[w,L]]}function GS({points:n=[],focus:o,onMoveEnd:u}){const m=ee.useRef(null),b=ee.useRef(null),P=ee.useRef([]),w=ee.useRef(u);return w.current=u,ee.useEffect(()=>{if(!m.current)return;const l=new zy.Map({container:m.current,style:Px(),center:[15,62],zoom:4.3,minZoom:3,maxZoom:14,dragRotate:!1,pitchWithRotate:!1,attributionControl:{compact:!0}});b.current=l,l.once("load",()=>setTimeout(()=>l.resize(),0));const L=new MutationObserver(()=>{const V=Px();l.setStyle(V),l.once("styledata",()=>{})});L.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]});let B=!1;return l.on("movestart",V=>{B=!!V.originalEvent}),l.on("moveend",()=>{if(!B||!w.current)return;B=!1;const V=l.getBounds(),G=l.getCenter();w.current({bounds:{west:V.getWest(),south:V.getSouth(),east:V.getEast(),north:V.getNorth()},center:{lon:G.lng,lat:G.lat},zoom:l.getZoom()})}),()=>{L.disconnect(),P.current.forEach(V=>V.remove()),l.remove(),b.current=null}},[]),ee.useEffect(()=>{const l=b.current;if(!l)return;const L=VS();P.current.forEach(B=>B.remove()),P.current=[],n.forEach(B=>{const V=document.createElement("div");V.className="w-3 h-3 rounded-full shadow "+(Ab()?"ring-2 ring-black/60":"ring-2 ring-white/85"),V.style.background=L;const G=new zy.Marker({element:V}).setLngLat([B.lon,B.lat]).setPopup(new zy.Popup({closeButton:!1}).setText(B.name)).addTo(l);P.current.push(G)})},[n]),ee.useEffect(()=>{const l=b.current;if(!(!l||!(o!=null&&o.center)))if(l.stop(),o.radiusKm&&o.radiusKm>0){const L=o.radiusKm,B=L<=5,V=B?L*.65:L,G=B?12:24,te=B?16:12,q=ZS(o.center,V);l.fitBounds(q,{padding:G,maxZoom:te})}else l.flyTo({center:[o.center.lon,o.center.lat],zoom:11})},[o]),J.jsx("div",{className:"card p-0",children:J.jsx("div",{ref:m,className:"w-full h-[260px] rounded-2xl overflow-hidden"})})}function Cx(...n){console.log("[API]",...n)}const qS="https://bada-backend.vercel.app/api";async function Wf(n,o={}){const u=lc.getState().token,m=n.startsWith("http")?n:`${qS}${n}`,b={"Content-Type":"application/json",...o.headers||{}};u&&(b.Authorization=`Bearer ${u}`),Cx("→",o.method??"GET",m,{headers:b,body:o.body});const P=await fetch(m,{...o,headers:b});if(Cx("←",P.status,P.statusText,m),!P.ok){let w=null;try{w=await P.json()}catch{}const l=new Error((w==null?void 0:w.error)||P.statusText);throw l.status=P.status,l.details=w,l}if(P.status!==204)return await P.json()}function WS(n){var P;const o=n.properties,u=(P=n.geometry)==null?void 0:P.coordinates;if(!o||!u)return null;const[m,b]=u;return typeof b!="number"||typeof m!="number"?null:{id:o.NUTSKOD??n.id??"",name:o.NAMN??"Okänd",municipality:o.KMN_NAMN??"",lat:b,lon:m,lng:m}}async function HS(){return(await Wf("/beaches")).features.map(WS).filter(o=>o!==null)}async function zb(n){return Wf(`/beaches/${n}`)}function KS(){const[n,o]=ee.useState(null),[u,m]=ee.useState(!1),[b,P]=ee.useState(null),w=ee.useCallback(()=>{if(!("geolocation"in navigator)){P("Geolocation not supported");return}m(!0),P(null),navigator.geolocation.getCurrentPosition(l=>{m(!1),o({lat:l.coords.latitude,lon:l.coords.longitude})},l=>{m(!1),P(l.message||"Failed to get location")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},[]);return{coords:n,loading:u,error:b,request:w}}function Ex(n,o){const m=(o.lat-n.lat)*Math.PI/180,b=(o.lon-n.lon)*Math.PI/180,P=n.lat*Math.PI/180,w=o.lat*Math.PI/180,l=Math.sin(m/2)**2+Math.cos(P)*Math.cos(w)*Math.sin(b/2)**2;return 2*6371*Math.asin(Math.min(1,Math.sqrt(l)))}function XS(n){return n<1?`${Math.round(n*1e3)} m`:`${n.toFixed(n<10?1:0)} km`}const YS={lat:59.3326,lon:18.0649},QS=10,JS=5;function eT(){const{data:n,isLoading:o,isError:u,error:m,refetch:b}=V_({queryKey:["beaches"],queryFn:HS,staleTime:3e5}),w=Uy(Qe=>Qe.search).trim().toLowerCase(),{coords:l,loading:L,request:B}=KS(),[V,G]=ee.useState("default"),[te,q]=ee.useState(YS),[Se,ye]=ee.useState(QS),[fe,Fe]=ee.useState(null),Ce=ee.useMemo(()=>{if(!n)return[];const Qe=l||(V==="viewport"?null:te),it=n.map(at=>{const It=Qe?Ex({lat:Qe.lat,lon:Qe.lon},{lat:at.lat,lon:at.lon}):void 0;return{...at,_distanceKm:It}});return Qe?it.sort((at,It)=>(at._distanceKm??0)-(It._distanceKm??0)):it},[n,l,te,V]),Ie=ee.useMemo(()=>w?Ce.filter(Qe=>`${Qe.name} ${Qe.municipality??""}`.toLowerCase().includes(w)):Ce,[Ce,w]),Le=ee.useMemo(()=>V==="viewport"&&fe?Ie.filter(Qe=>Qe.lon>=fe.west&&Qe.lon<=fe.east&&Qe.lat>=fe.south&&Qe.lat<=fe.north):Ie.filter(Qe=>V==="default"||V==="nearby"?Ex(te,{lat:Qe.lat,lon:Qe.lon})<=Se:!0),[Ie,V,fe,te,Se]);ee.useEffect(()=>{!n&&!o&&b()},[n,o,b]),ee.useEffect(()=>{l&&(q({lat:l.lat,lon:l.lon}),ye(JS),G("nearby"))},[l]);const Xe=async()=>{await B()},mt=Qe=>{Fe(Qe.bounds),G("viewport")},yt=V==="viewport"?void 0:{center:{lon:te.lon,lat:te.lat},radiusKm:Se};return o?J.jsxs("div",{className:"space-y-3",children:[J.jsx("div",{className:"h-9 w-40 rounded-2xl bg-surface-muted animate-pulse"}),J.jsx(Ry,{}),J.jsx(Ry,{}),J.jsx(Ry,{})]}):u?J.jsxs("div",{role:"alert",className:"rounded-2xl border border-border bg-surface-muted p-4",children:[J.jsx("p",{className:"font-spectral text-lg",children:"Could not load beaches."}),J.jsx("p",{className:"text-sm text-ink-muted mt-1",children:(m==null?void 0:m.message)??"Please try again."}),J.jsx("button",{onClick:()=>b(),className:"mt-3 w-full px-3 py-3 rounded-2xl border border-border bg-surface hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40",children:"Retry"})]}):Ce.length?(w||V!=="default")&&Le.length===0?J.jsxs("div",{className:"rounded-2xl border border-border bg-surface-muted p-4",children:[J.jsx("p",{className:"font-spectral text-lg",children:"No matches here."}),J.jsx("p",{className:"text-sm text-ink-muted mt-1",children:V==="viewport"?"Pan or zoom to a different area.":"Try widening the radius."})]}):J.jsxs("div",{className:"space-y-4",children:[J.jsx(GS,{points:Le.map(Qe=>({id:Qe.id,name:Qe.name,lat:Qe.lat,lon:Qe.lon})),focus:yt,onMoveEnd:mt}),J.jsx("div",{className:"px-0",children:J.jsx("button",{className:"w-full px-3 py-2 rounded-2xl border border-border bg-surface-muted hover:bg-surface transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40",onClick:Xe,disabled:L,children:L?"Getting location…":"Use current location"})}),J.jsx("ul",{className:"space-y-3",children:Le.slice(0,50).map(Qe=>J.jsx("li",{children:J.jsx(li,{to:`/beach/${Qe.id}`,className:"block rounded-2xl border border-border bg-surface-muted p-3 hover:bg-surface transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40",children:J.jsxs("div",{className:"flex items-start justify-between gap-3",children:[J.jsxs("div",{className:"min-w-0",children:[J.jsx("h3",{className:"font-spectral text-lg leading-tight truncate",children:Qe.name}),J.jsxs("p",{className:"text-ink-muted text-sm",children:[Qe.municipality??"—"," • ",Qe.lat.toFixed(4),","," ",Qe.lon.toFixed(4)]})]}),typeof Qe._distanceKm=="number"&&J.jsx("span",{className:"badge shrink-0",children:XS(Qe._distanceKm)})]})})},Qe.id))})]}):J.jsxs("div",{className:"rounded-2xl border border-border bg-surface-muted p-4",children:[J.jsx("p",{className:"font-spectral text-lg",children:"No beaches found."}),J.jsx("p",{className:"text-sm text-ink-muted mt-1",children:"Try refreshing or adjusting the filters."})]})}function Ry(){return J.jsxs("div",{className:"rounded-2xl border border-border bg-surface-muted p-3",children:[J.jsx("div",{className:"h-5 w-2/3 bg-surface animate-pulse rounded"}),J.jsx("div",{className:"h-4 w-1/3 bg-surface animate-pulse rounded mt-2"})]})}function tT(){return J.jsx(eT,{})}let rT={data:""},nT=n=>{if(typeof window=="object"){let o=(n?n.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return o.nonce=window.__nonce__,o.parentNode||(n||document.head).appendChild(o),o.firstChild}return n||rT},iT=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,sT=/\/\*[^]*?\*\/|  +/g,kx=/\n+/g,eh=(n,o)=>{let u="",m="",b="";for(let P in n){let w=n[P];P[0]=="@"?P[1]=="i"?u=P+" "+w+";":m+=P[1]=="f"?eh(w,P):P+"{"+eh(w,P[1]=="k"?"":o)+"}":typeof w=="object"?m+=eh(w,o?o.replace(/([^,])+/g,l=>P.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,L=>/&/.test(L)?L.replace(/&/g,l):l?l+" "+L:L)):P):w!=null&&(P=/^--/.test(P)?P:P.replace(/[A-Z]/g,"-$&").toLowerCase(),b+=eh.p?eh.p(P,w):P+":"+w+";")}return u+(o&&b?o+"{"+b+"}":b)+m},tu={},Rb=n=>{if(typeof n=="object"){let o="";for(let u in n)o+=u+Rb(n[u]);return o}return n},oT=(n,o,u,m,b)=>{let P=Rb(n),w=tu[P]||(tu[P]=(L=>{let B=0,V=11;for(;B<L.length;)V=101*V+L.charCodeAt(B++)>>>0;return"go"+V})(P));if(!tu[w]){let L=P!==n?n:(B=>{let V,G,te=[{}];for(;V=iT.exec(B.replace(sT,""));)V[4]?te.shift():V[3]?(G=V[3].replace(kx," ").trim(),te.unshift(te[0][G]=te[0][G]||{})):te[0][V[1]]=V[2].replace(kx," ").trim();return te[0]})(n);tu[w]=eh(b?{["@keyframes "+w]:L}:L,u?"":"."+w)}let l=u&&tu.g?tu.g:null;return u&&(tu.g=tu[w]),((L,B,V,G)=>{G?B.data=B.data.replace(G,L):B.data.indexOf(L)===-1&&(B.data=V?L+B.data:B.data+L)})(tu[w],o,m,l),w},aT=(n,o,u)=>n.reduce((m,b,P)=>{let w=o[P];if(w&&w.call){let l=w(u),L=l&&l.props&&l.props.className||/^go/.test(l)&&l;w=L?"."+L:l&&typeof l=="object"?l.props?"":eh(l,""):l===!1?"":l}return m+b+(w??"")},"");function Vg(n){let o=this||{},u=n.call?n(o.p):n;return oT(u.unshift?u.raw?aT(u,[].slice.call(arguments,1),o.p):u.reduce((m,b)=>Object.assign(m,b&&b.call?b(o.p):b),{}):u,nT(o.target),o.g,o.o,o.k)}let Db,c_,u_;Vg.bind({g:1});let uu=Vg.bind({k:1});function lT(n,o,u,m){eh.p=o,Db=n,c_=u,u_=m}function ph(n,o){let u=this||{};return function(){let m=arguments;function b(P,w){let l=Object.assign({},P),L=l.className||b.className;u.p=Object.assign({theme:c_&&c_()},l),u.o=/ *go\d+/.test(L),l.className=Vg.apply(u,m)+(L?" "+L:"");let B=n;return n[0]&&(B=l.as||n,delete l.as),u_&&B[0]&&u_(l),Db(B,l)}return b}}var cT=n=>typeof n=="function",kg=(n,o)=>cT(n)?n(o):n,uT=(()=>{let n=0;return()=>(++n).toString()})(),Lb=(()=>{let n;return()=>{if(n===void 0&&typeof window<"u"){let o=matchMedia("(prefers-reduced-motion: reduce)");n=!o||o.matches}return n}})(),hT=20,G_="default",Fb=(n,o)=>{let{toastLimit:u}=n.settings;switch(o.type){case 0:return{...n,toasts:[o.toast,...n.toasts].slice(0,u)};case 1:return{...n,toasts:n.toasts.map(w=>w.id===o.toast.id?{...w,...o.toast}:w)};case 2:let{toast:m}=o;return Fb(n,{type:n.toasts.find(w=>w.id===m.id)?1:0,toast:m});case 3:let{toastId:b}=o;return{...n,toasts:n.toasts.map(w=>w.id===b||b===void 0?{...w,dismissed:!0,visible:!1}:w)};case 4:return o.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(w=>w.id!==o.toastId)};case 5:return{...n,pausedAt:o.time};case 6:let P=o.time-(n.pausedAt||0);return{...n,pausedAt:void 0,toasts:n.toasts.map(w=>({...w,pauseDuration:w.pauseDuration+P}))}}},Sg=[],Ob={toasts:[],pausedAt:void 0,settings:{toastLimit:hT}},sc={},jb=(n,o=G_)=>{sc[o]=Fb(sc[o]||Ob,n),Sg.forEach(([u,m])=>{u===o&&m(sc[o])})},Nb=n=>Object.keys(sc).forEach(o=>jb(n,o)),dT=n=>Object.keys(sc).find(o=>sc[o].toasts.some(u=>u.id===n)),Zg=(n=G_)=>o=>{jb(o,n)},fT={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},pT=(n={},o=G_)=>{let[u,m]=ee.useState(sc[o]||Ob),b=ee.useRef(sc[o]);ee.useEffect(()=>(b.current!==sc[o]&&m(sc[o]),Sg.push([o,m]),()=>{let w=Sg.findIndex(([l])=>l===o);w>-1&&Sg.splice(w,1)}),[o]);let P=u.toasts.map(w=>{var l,L,B;return{...n,...n[w.type],...w,removeDelay:w.removeDelay||((l=n[w.type])==null?void 0:l.removeDelay)||(n==null?void 0:n.removeDelay),duration:w.duration||((L=n[w.type])==null?void 0:L.duration)||(n==null?void 0:n.duration)||fT[w.type],style:{...n.style,...(B=n[w.type])==null?void 0:B.style,...w.style}}});return{...u,toasts:P}},mT=(n,o="blank",u)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:o,ariaProps:{role:"status","aria-live":"polite"},message:n,pauseDuration:0,...u,id:(u==null?void 0:u.id)||uT()}),_m=n=>(o,u)=>{let m=mT(o,n,u);return Zg(m.toasterId||dT(m.id))({type:2,toast:m}),m.id},Hi=(n,o)=>_m("blank")(n,o);Hi.error=_m("error");Hi.success=_m("success");Hi.loading=_m("loading");Hi.custom=_m("custom");Hi.dismiss=(n,o)=>{let u={type:3,toastId:n};o?Zg(o)(u):Nb(u)};Hi.dismissAll=n=>Hi.dismiss(void 0,n);Hi.remove=(n,o)=>{let u={type:4,toastId:n};o?Zg(o)(u):Nb(u)};Hi.removeAll=n=>Hi.remove(void 0,n);Hi.promise=(n,o,u)=>{let m=Hi.loading(o.loading,{...u,...u==null?void 0:u.loading});return typeof n=="function"&&(n=n()),n.then(b=>{let P=o.success?kg(o.success,b):void 0;return P?Hi.success(P,{id:m,...u,...u==null?void 0:u.success}):Hi.dismiss(m),b}).catch(b=>{let P=o.error?kg(o.error,b):void 0;P?Hi.error(P,{id:m,...u,...u==null?void 0:u.error}):Hi.dismiss(m)}),n};var gT=1e3,yT=(n,o="default")=>{let{toasts:u,pausedAt:m}=pT(n,o),b=ee.useRef(new Map).current,P=ee.useCallback((G,te=gT)=>{if(b.has(G))return;let q=setTimeout(()=>{b.delete(G),w({type:4,toastId:G})},te);b.set(G,q)},[]);ee.useEffect(()=>{if(m)return;let G=Date.now(),te=u.map(q=>{if(q.duration===1/0)return;let Se=(q.duration||0)+q.pauseDuration-(G-q.createdAt);if(Se<0){q.visible&&Hi.dismiss(q.id);return}return setTimeout(()=>Hi.dismiss(q.id,o),Se)});return()=>{te.forEach(q=>q&&clearTimeout(q))}},[u,m,o]);let w=ee.useCallback(Zg(o),[o]),l=ee.useCallback(()=>{w({type:5,time:Date.now()})},[w]),L=ee.useCallback((G,te)=>{w({type:1,toast:{id:G,height:te}})},[w]),B=ee.useCallback(()=>{m&&w({type:6,time:Date.now()})},[m,w]),V=ee.useCallback((G,te)=>{let{reverseOrder:q=!1,gutter:Se=8,defaultPosition:ye}=te||{},fe=u.filter(Ie=>(Ie.position||ye)===(G.position||ye)&&Ie.height),Fe=fe.findIndex(Ie=>Ie.id===G.id),Ce=fe.filter((Ie,Le)=>Le<Fe&&Ie.visible).length;return fe.filter(Ie=>Ie.visible).slice(...q?[Ce+1]:[0,Ce]).reduce((Ie,Le)=>Ie+(Le.height||0)+Se,0)},[u]);return ee.useEffect(()=>{u.forEach(G=>{if(G.dismissed)P(G.id,G.removeDelay);else{let te=b.get(G.id);te&&(clearTimeout(te),b.delete(G.id))}})},[u,P]),{toasts:u,handlers:{updateHeight:L,startPause:l,endPause:B,calculateOffset:V}}},_T=uu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,vT=uu`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,xT=uu`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,bT=ph("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${_T} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${vT} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${n=>n.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${xT} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,wT=uu`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ST=ph("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${n=>n.secondary||"#e0e0e0"};
  border-right-color: ${n=>n.primary||"#616161"};
  animation: ${wT} 1s linear infinite;
`,TT=uu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,PT=uu`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,CT=ph("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${TT} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${PT} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${n=>n.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,ET=ph("div")`
  position: absolute;
`,kT=ph("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,MT=uu`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,IT=ph("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${MT} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,AT=({toast:n})=>{let{icon:o,type:u,iconTheme:m}=n;return o!==void 0?typeof o=="string"?ee.createElement(IT,null,o):o:u==="blank"?null:ee.createElement(kT,null,ee.createElement(ST,{...m}),u!=="loading"&&ee.createElement(ET,null,u==="error"?ee.createElement(bT,{...m}):ee.createElement(CT,{...m})))},zT=n=>`
0% {transform: translate3d(0,${n*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,RT=n=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${n*-150}%,-1px) scale(.6); opacity:0;}
`,DT="0%{opacity:0;} 100%{opacity:1;}",LT="0%{opacity:1;} 100%{opacity:0;}",FT=ph("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,OT=ph("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,jT=(n,o)=>{let u=n.includes("top")?1:-1,[m,b]=Lb()?[DT,LT]:[zT(u),RT(u)];return{animation:o?`${uu(m)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${uu(b)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},NT=ee.memo(({toast:n,position:o,style:u,children:m})=>{let b=n.height?jT(n.position||o||"top-center",n.visible):{opacity:0},P=ee.createElement(AT,{toast:n}),w=ee.createElement(OT,{...n.ariaProps},kg(n.message,n));return ee.createElement(FT,{className:n.className,style:{...b,...u,...n.style}},typeof m=="function"?m({icon:P,message:w}):ee.createElement(ee.Fragment,null,P,w))});lT(ee.createElement);var BT=({id:n,className:o,style:u,onHeightUpdate:m,children:b})=>{let P=ee.useCallback(w=>{if(w){let l=()=>{let L=w.getBoundingClientRect().height;m(n,L)};l(),new MutationObserver(l).observe(w,{subtree:!0,childList:!0,characterData:!0})}},[n,m]);return ee.createElement("div",{ref:P,className:o,style:u},b)},$T=(n,o)=>{let u=n.includes("top"),m=u?{top:0}:{bottom:0},b=n.includes("center")?{justifyContent:"center"}:n.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Lb()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${o*(u?1:-1)}px)`,...m,...b}},UT=Vg`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dg=16,VT=({reverseOrder:n,position:o="top-center",toastOptions:u,gutter:m,children:b,toasterId:P,containerStyle:w,containerClassName:l})=>{let{toasts:L,handlers:B}=yT(u,P);return ee.createElement("div",{"data-rht-toaster":P||"",style:{position:"fixed",zIndex:9999,top:dg,left:dg,right:dg,bottom:dg,pointerEvents:"none",...w},className:l,onMouseEnter:B.startPause,onMouseLeave:B.endPause},L.map(V=>{let G=V.position||o,te=B.calculateOffset(V,{reverseOrder:n,gutter:m,defaultPosition:o}),q=$T(G,te);return ee.createElement(BT,{id:V.id,key:V.id,onHeightUpdate:B.updateHeight,className:V.visible?UT:"",style:q},V.type==="custom"?kg(V.message,V):b?b(V):ee.createElement(NT,{toast:V,position:G}))}))},Rd=Hi;function ZT(n,o="long"){if(!n)return"—";const u=new Date(n);if(Number.isNaN(u.getTime()))return String(n);if(o==="short")return u.toLocaleDateString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit"});const m=typeof navigator<"u"&&navigator.language||"sv-SE";return u.toLocaleDateString(m,{year:"numeric",month:"short",day:"numeric"})}function Bb(){const n=lc(o=>o.token);return V_({queryKey:["favorites",n],enabled:!!n,queryFn:()=>Wf("/favorites"),staleTime:6e4})}function GT(){const n=hu(),o=lc.getState().token;return Z_({mutationFn:u=>Wf("/favorites",{method:"POST",body:JSON.stringify({beachId:u})}),onSuccess:()=>{n.invalidateQueries({queryKey:["favorites",o]})}})}function $b(){const n=hu(),o=lc.getState().token;return Z_({mutationFn:u=>{const m=u.id?`/favorites/${u.id}`:`/favorites/by-beach/${u.beachId}`;return Wf(m,{method:"DELETE"})},onMutate:async u=>{await n.cancelQueries({queryKey:["favorites",o]});const m=n.getQueryData(["favorites",o]);if(m){const b=m.filter(P=>u.id?P._id!==u.id:P.beachId!==u.beachId);n.setQueryData(["favorites",o],b)}return{prev:m}},onError:(u,m,b)=>{b!=null&&b.prev&&n.setQueryData(["favorites",o],b.prev)},onSettled:()=>{n.invalidateQueries({queryKey:["favorites",o]})}})}function qT(){const n=hu(),o=lc.getState().token;return Z_({mutationFn:u=>Wf("/favorites/reorder",{method:"PATCH",body:JSON.stringify({order:u})}),onSuccess:()=>{n.invalidateQueries({queryKey:["favorites",o]})}})}function WT(n){if(typeof n=="number")switch(n){case 1:return"kpi-excellent";case 2:return"kpi-good";case 3:return"kpi-sufficient";case 4:return"kpi-poor";default:return"kpi-unknown"}if(typeof n=="string"){const o=n.toLowerCase();if(o.includes("utmärkt"))return"kpi-excellent";if(o.includes("bra"))return"kpi-good";if(o.includes("tillfreds")||o.includes("sufficient"))return"kpi-sufficient";if(o.includes("dålig")||o.includes("poor"))return"kpi-poor"}return"kpi-unknown"}function HT(){const{id:n}=n2(),o=qf(),u=_l(),{token:m}=lc(),{data:b,isLoading:P,isError:w,error:l}=V_({queryKey:["beach",n],enabled:!!n,queryFn:()=>zb(n),staleTime:300*1e3}),L=hu(),{data:B}=Bb(),V=GT(),G=$b(),te=B==null?void 0:B.find(Xe=>Xe.beachId===n),q=!!te;if(P)return J.jsxs("section",{className:"p-4 space-y-4",children:[J.jsx("div",{className:"h-7 w-2/3 bg-surface-muted rounded animate-pulse"}),J.jsx("div",{className:"h-4 w-1/3 bg-surface-muted rounded animate-pulse"}),J.jsxs("div",{className:"card p-4",children:[J.jsx("div",{className:"h-4 w-1/2 bg-surface rounded animate-pulse"}),J.jsx("div",{className:"h-4 w-1/3 bg-surface rounded animate-pulse mt-2"})]})]});if(w||!b)return J.jsx("section",{className:"p-4",children:J.jsxs("div",{className:"card p-4",children:[J.jsx("p",{className:"font-spectral text-lg",children:"Could not load this beach."}),J.jsx("p",{className:"text-sm text-ink-muted mt-1",children:(l==null?void 0:l.message)??"Please try again."}),J.jsx(li,{to:"/",className:"inline-block mt-3 px-3 py-2 rounded-2xl border border-border bg-surface hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40",children:"← Back to list"})]})});const Se=b.locationName??"Beach",ye=b.locationArea??"",fe=b.classification,Fe=b.classificationText??"Okänd",Ce=WT(fe??Fe),Ie=b.latestSampleDate?ZT(b.latestSampleDate,"short"):"—";async function Le(){if(!m){o("/login",{replace:!1,state:{from:u}});return}try{q?(await G.mutateAsync({id:te==null?void 0:te._id,beachId:n}),Rd.success("Removed from favorites")):(await V.mutateAsync(n),Rd.success("Added to favorites")),L.invalidateQueries({queryKey:["favorites",m]}),L.invalidateQueries({queryKey:["beach",n]})}catch(Xe){const mt=(Xe==null?void 0:Xe.message)??"Favorite action failed";Rd.error(mt)}}return J.jsxs("section",{className:"p-4 space-y-4",children:[J.jsxs("header",{className:"space-y-1",children:[J.jsx("h1",{className:"font-spectral text-2xl leading-tight",children:Se}),J.jsx("p",{className:"text-ink-muted",children:ye||"—"})]}),J.jsxs("div",{className:"flex items-center gap-2",children:[J.jsxs("span",{className:`badge ${Ce}`,children:[Fe," ",b.classificationYear?`• ${b.classificationYear}`:""]}),b.euType&&J.jsx("span",{className:"badge",children:"EU-bad"})]}),J.jsxs("div",{className:"card p-4 space-y-3",children:[J.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[J.jsxs("div",{children:[J.jsx("div",{className:"text-ink-muted",children:"Latest sample"}),J.jsx("div",{className:"font-medium",children:Ie})]}),J.jsxs("div",{children:[J.jsx("div",{className:"text-ink-muted",children:"Algal bloom"}),J.jsx("div",{className:"font-medium",children:b.algalText??"—"})]}),J.jsxs("div",{children:[J.jsx("div",{className:"text-ink-muted",children:"EU motive"}),J.jsx("div",{className:"font-medium",children:b.euMotive??"—"})]}),J.jsxs("div",{children:[J.jsx("div",{className:"text-ink-muted",children:"NUTS code"}),J.jsx("div",{className:"font-medium",children:b.nutsCode})]})]}),J.jsxs("div",{className:"pt-2 flex items-center gap-2",children:[J.jsx("button",{className:"px-3 py-2 rounded-2xl border border-border bg-surface hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40 disabled:opacity-60",onClick:Le,disabled:V.isPending||G.isPending,children:q?"★ Remove favorite":"☆ Save as favorite"}),J.jsx(li,{to:"/",className:"px-3 py-2 rounded-2xl border border-border bg-surface hover:bg-surface-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40",children:"← Back"})]})]}),b.bathInformation&&J.jsxs("article",{className:"card p-4",children:[J.jsx("h2",{className:"font-spectral text-lg mb-1",children:"About this beach"}),J.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-line",children:b.bathInformation})]}),(b.contactMail||b.contactPhone||b.contactUrl)&&J.jsxs("div",{className:"card p-4 space-y-1 text-sm",children:[J.jsx("h3",{className:"font-spectral text-lg",children:"Contact"}),b.contactMail&&J.jsxs("div",{children:["Mail:"," ",J.jsx("a",{href:`mailto:${b.contactMail}`,className:"underline text-accent",children:b.contactMail})]}),b.contactPhone&&J.jsxs("div",{children:["Phone: ",b.contactPhone]}),b.contactUrl&&J.jsxs("div",{children:["Website:"," ",J.jsx("a",{href:b.contactUrl.startsWith("http")?b.contactUrl:`https://${b.contactUrl}`,target:"_blank",rel:"noreferrer",className:"underline text-accent",children:b.contactUrl})]})]})]})}var vm=n=>n.type==="checkbox",Sd=n=>n instanceof Date,oo=n=>n==null;const Ub=n=>typeof n=="object";var Ai=n=>!oo(n)&&!Array.isArray(n)&&Ub(n)&&!Sd(n),KT=n=>Ai(n)&&n.target?vm(n.target)?n.target.checked:n.target.value:n,XT=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,YT=(n,o)=>n.has(XT(o)),QT=n=>{const o=n.constructor&&n.constructor.prototype;return Ai(o)&&o.hasOwnProperty("isPrototypeOf")},q_=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function as(n){let o;const u=Array.isArray(n),m=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)o=new Date(n);else if(!(q_&&(n instanceof Blob||m))&&(u||Ai(n)))if(o=u?[]:Object.create(Object.getPrototypeOf(n)),!u&&!QT(n))o=n;else for(const b in n)n.hasOwnProperty(b)&&(o[b]=as(n[b]));else return n;return o}var Gg=n=>/^\w*$/.test(n),Ii=n=>n===void 0,W_=n=>Array.isArray(n)?n.filter(Boolean):[],H_=n=>W_(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Jt=(n,o,u)=>{if(!o||!Ai(n))return u;const m=(Gg(o)?[o]:H_(o)).reduce((b,P)=>oo(b)?b:b[P],n);return Ii(m)||m===n?Ii(n[o])?u:n[o]:m},tc=n=>typeof n=="boolean",Pn=(n,o,u)=>{let m=-1;const b=Gg(o)?[o]:H_(o),P=b.length,w=P-1;for(;++m<P;){const l=b[m];let L=u;if(m!==w){const B=n[l];L=Ai(B)||Array.isArray(B)?B:isNaN(+b[m+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;n[l]=L,n=n[l]}};const Mx={BLUR:"blur",FOCUS_OUT:"focusout"},fl={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ru={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},JT=hn.createContext(null);JT.displayName="HookFormContext";var eP=(n,o,u,m=!0)=>{const b={defaultValues:o._defaultValues};for(const P in n)Object.defineProperty(b,P,{get:()=>{const w=P;return o._proxyFormState[w]!==fl.all&&(o._proxyFormState[w]=!m||fl.all),n[w]}});return b};const tP=typeof window<"u"?hn.useLayoutEffect:hn.useEffect;var oa=n=>typeof n=="string",rP=(n,o,u,m,b)=>oa(n)?(m&&o.watch.add(n),Jt(u,n,b)):Array.isArray(n)?n.map(P=>(m&&o.watch.add(P),Jt(u,P))):(m&&(o.watchAll=!0),u),h_=n=>oo(n)||!Ub(n);function th(n,o,u=new WeakSet){if(h_(n)||h_(o))return n===o;if(Sd(n)&&Sd(o))return n.getTime()===o.getTime();const m=Object.keys(n),b=Object.keys(o);if(m.length!==b.length)return!1;if(u.has(n)||u.has(o))return!0;u.add(n),u.add(o);for(const P of m){const w=n[P];if(!b.includes(P))return!1;if(P!=="ref"){const l=o[P];if(Sd(w)&&Sd(l)||Ai(w)&&Ai(l)||Array.isArray(w)&&Array.isArray(l)?!th(w,l,u):w!==l)return!1}}return!0}var K_=(n,o,u,m,b)=>o?{...u[n],types:{...u[n]&&u[n].types?u[n].types:{},[m]:b||!0}}:{},qp=n=>Array.isArray(n)?n:[n],Ix=()=>{let n=[];return{get observers(){return n},next:b=>{for(const P of n)P.next&&P.next(b)},subscribe:b=>(n.push(b),{unsubscribe:()=>{n=n.filter(P=>P!==b)}}),unsubscribe:()=>{n=[]}}};function Vb(n,o){const u={};for(const m in n)if(n.hasOwnProperty(m)){const b=n[m],P=o[m];if(b&&Ai(b)&&P){const w=Vb(b,P);Ai(w)&&(u[m]=w)}else n[m]&&(u[m]=P)}return u}var ko=n=>Ai(n)&&!Object.keys(n).length,X_=n=>n.type==="file",pl=n=>typeof n=="function",Mg=n=>{if(!q_)return!1;const o=n?n.ownerDocument:0;return n instanceof(o&&o.defaultView?o.defaultView.HTMLElement:HTMLElement)},Zb=n=>n.type==="select-multiple",Y_=n=>n.type==="radio",nP=n=>Y_(n)||vm(n),Dy=n=>Mg(n)&&n.isConnected;function iP(n,o){const u=o.slice(0,-1).length;let m=0;for(;m<u;)n=Ii(n)?m++:n[o[m++]];return n}function sP(n){for(const o in n)if(n.hasOwnProperty(o)&&!Ii(n[o]))return!1;return!0}function Mi(n,o){const u=Array.isArray(o)?o:Gg(o)?[o]:H_(o),m=u.length===1?n:iP(n,u),b=u.length-1,P=u[b];return m&&delete m[P],b!==0&&(Ai(m)&&ko(m)||Array.isArray(m)&&sP(m))&&Mi(n,u.slice(0,-1)),n}var oP=n=>{for(const o in n)if(pl(n[o]))return!0;return!1};function Gb(n){return Array.isArray(n)||Ai(n)&&!oP(n)}function d_(n,o={}){for(const u in n)Gb(n[u])?(o[u]=Array.isArray(n[u])?[]:{},d_(n[u],o[u])):oo(n[u])||(o[u]=!0);return o}function Tf(n,o,u){u||(u=d_(o));for(const m in n)Gb(n[m])?Ii(o)||h_(u[m])?u[m]=d_(n[m],Array.isArray(n[m])?[]:{}):Tf(n[m],oo(o)?{}:o[m],u[m]):u[m]=!th(n[m],o[m]);return u}const Ax={value:!1,isValid:!1},zx={value:!0,isValid:!0};var qb=n=>{if(Array.isArray(n)){if(n.length>1){const o=n.filter(u=>u&&u.checked&&!u.disabled).map(u=>u.value);return{value:o,isValid:!!o.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Ii(n[0].attributes.value)?Ii(n[0].value)||n[0].value===""?zx:{value:n[0].value,isValid:!0}:zx:Ax}return Ax},Wb=(n,{valueAsNumber:o,valueAsDate:u,setValueAs:m})=>Ii(n)?n:o?n===""?NaN:n&&+n:u&&oa(n)?new Date(n):m?m(n):n;const Rx={isValid:!1,value:null};var Hb=n=>Array.isArray(n)?n.reduce((o,u)=>u&&u.checked&&!u.disabled?{isValid:!0,value:u.value}:o,Rx):Rx;function Dx(n){const o=n.ref;return X_(o)?o.files:Y_(o)?Hb(n.refs).value:Zb(o)?[...o.selectedOptions].map(({value:u})=>u):vm(o)?qb(n.refs).value:Wb(Ii(o.value)?n.ref.value:o.value,n)}var aP=(n,o,u,m)=>{const b={};for(const P of n){const w=Jt(o,P);w&&Pn(b,P,w._f)}return{criteriaMode:u,names:[...n],fields:b,shouldUseNativeValidation:m}},Ig=n=>n instanceof RegExp,Up=n=>Ii(n)?n:Ig(n)?n.source:Ai(n)?Ig(n.value)?n.value.source:n.value:n,Lx=n=>({isOnSubmit:!n||n===fl.onSubmit,isOnBlur:n===fl.onBlur,isOnChange:n===fl.onChange,isOnAll:n===fl.all,isOnTouch:n===fl.onTouched});const Fx="AsyncFunction";var lP=n=>!!n&&!!n.validate&&!!(pl(n.validate)&&n.validate.constructor.name===Fx||Ai(n.validate)&&Object.values(n.validate).find(o=>o.constructor.name===Fx)),cP=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),Ox=(n,o,u)=>!u&&(o.watchAll||o.watch.has(n)||[...o.watch].some(m=>n.startsWith(m)&&/^\.\w+/.test(n.slice(m.length))));const Wp=(n,o,u,m)=>{for(const b of u||Object.keys(n)){const P=Jt(n,b);if(P){const{_f:w,...l}=P;if(w){if(w.refs&&w.refs[0]&&o(w.refs[0],b)&&!m)return!0;if(w.ref&&o(w.ref,w.name)&&!m)return!0;if(Wp(l,o))break}else if(Ai(l)&&Wp(l,o))break}}};function jx(n,o,u){const m=Jt(n,u);if(m||Gg(u))return{error:m,name:u};const b=u.split(".");for(;b.length;){const P=b.join("."),w=Jt(o,P),l=Jt(n,P);if(w&&!Array.isArray(w)&&u!==P)return{name:u};if(l&&l.type)return{name:P,error:l};if(l&&l.root&&l.root.type)return{name:`${P}.root`,error:l.root};b.pop()}return{name:u}}var uP=(n,o,u,m)=>{u(n);const{name:b,...P}=n;return ko(P)||Object.keys(P).length>=Object.keys(o).length||Object.keys(P).find(w=>o[w]===(!m||fl.all))},hP=(n,o,u)=>!n||!o||n===o||qp(n).some(m=>m&&(u?m===o:m.startsWith(o)||o.startsWith(m))),dP=(n,o,u,m,b)=>b.isOnAll?!1:!u&&b.isOnTouch?!(o||n):(u?m.isOnBlur:b.isOnBlur)?!n:(u?m.isOnChange:b.isOnChange)?n:!0,fP=(n,o)=>!W_(Jt(n,o)).length&&Mi(n,o),pP=(n,o,u)=>{const m=qp(Jt(n,u));return Pn(m,"root",o[u]),Pn(n,u,m),n};function Nx(n,o,u="validate"){if(oa(n)||Array.isArray(n)&&n.every(oa)||tc(n)&&!n)return{type:u,message:oa(n)?n:"",ref:o}}var wf=n=>Ai(n)&&!Ig(n)?n:{value:n,message:""},Bx=async(n,o,u,m,b,P)=>{const{ref:w,refs:l,required:L,maxLength:B,minLength:V,min:G,max:te,pattern:q,validate:Se,name:ye,valueAsNumber:fe,mount:Fe}=n._f,Ce=Jt(u,ye);if(!Fe||o.has(ye))return{};const Ie=l?l[0]:w,Le=Rt=>{b&&Ie.reportValidity&&(Ie.setCustomValidity(tc(Rt)?"":Rt||""),Ie.reportValidity())},Xe={},mt=Y_(w),yt=vm(w),Qe=mt||yt,it=(fe||X_(w))&&Ii(w.value)&&Ii(Ce)||Mg(w)&&w.value===""||Ce===""||Array.isArray(Ce)&&!Ce.length,at=K_.bind(null,ye,m,Xe),It=(Rt,At,Ht,Rr=ru.maxLength,ar=ru.minLength)=>{const Zt=Rt?At:Ht;Xe[ye]={type:Rt?Rr:ar,message:Zt,ref:w,...at(Rt?Rr:ar,Zt)}};if(P?!Array.isArray(Ce)||!Ce.length:L&&(!Qe&&(it||oo(Ce))||tc(Ce)&&!Ce||yt&&!qb(l).isValid||mt&&!Hb(l).isValid)){const{value:Rt,message:At}=oa(L)?{value:!!L,message:L}:wf(L);if(Rt&&(Xe[ye]={type:ru.required,message:At,ref:Ie,...at(ru.required,At)},!m))return Le(At),Xe}if(!it&&(!oo(G)||!oo(te))){let Rt,At;const Ht=wf(te),Rr=wf(G);if(!oo(Ce)&&!isNaN(Ce)){const ar=w.valueAsNumber||Ce&&+Ce;oo(Ht.value)||(Rt=ar>Ht.value),oo(Rr.value)||(At=ar<Rr.value)}else{const ar=w.valueAsDate||new Date(Ce),Zt=Ct=>new Date(new Date().toDateString()+" "+Ct),_t=w.type=="time",ht=w.type=="week";oa(Ht.value)&&Ce&&(Rt=_t?Zt(Ce)>Zt(Ht.value):ht?Ce>Ht.value:ar>new Date(Ht.value)),oa(Rr.value)&&Ce&&(At=_t?Zt(Ce)<Zt(Rr.value):ht?Ce<Rr.value:ar<new Date(Rr.value))}if((Rt||At)&&(It(!!Rt,Ht.message,Rr.message,ru.max,ru.min),!m))return Le(Xe[ye].message),Xe}if((B||V)&&!it&&(oa(Ce)||P&&Array.isArray(Ce))){const Rt=wf(B),At=wf(V),Ht=!oo(Rt.value)&&Ce.length>+Rt.value,Rr=!oo(At.value)&&Ce.length<+At.value;if((Ht||Rr)&&(It(Ht,Rt.message,At.message),!m))return Le(Xe[ye].message),Xe}if(q&&!it&&oa(Ce)){const{value:Rt,message:At}=wf(q);if(Ig(Rt)&&!Ce.match(Rt)&&(Xe[ye]={type:ru.pattern,message:At,ref:w,...at(ru.pattern,At)},!m))return Le(At),Xe}if(Se){if(pl(Se)){const Rt=await Se(Ce,u),At=Nx(Rt,Ie);if(At&&(Xe[ye]={...At,...at(ru.validate,At.message)},!m))return Le(At.message),Xe}else if(Ai(Se)){let Rt={};for(const At in Se){if(!ko(Rt)&&!m)break;const Ht=Nx(await Se[At](Ce,u),Ie,At);Ht&&(Rt={...Ht,...at(At,Ht.message)},Le(Ht.message),m&&(Xe[ye]=Rt))}if(!ko(Rt)&&(Xe[ye]={ref:Ie,...Rt},!m))return Xe}}return Le(!0),Xe};const mP={mode:fl.onSubmit,reValidateMode:fl.onChange,shouldFocusError:!0};function gP(n={}){let o={...mP,...n},u={submitCount:0,isDirty:!1,isReady:!1,isLoading:pl(o.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:o.errors||{},disabled:o.disabled||!1},m={},b=Ai(o.defaultValues)||Ai(o.values)?as(o.defaultValues||o.values)||{}:{},P=o.shouldUnregister?{}:as(b),w={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},L,B=0;const V={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let G={...V};const te={array:Ix(),state:Ix()},q=o.criteriaMode===fl.all,Se=xe=>Be=>{clearTimeout(B),B=setTimeout(xe,Be)},ye=async xe=>{if(!o.disabled&&(V.isValid||G.isValid||xe)){const Be=o.resolver?ko((await yt()).errors):await it(m,!0);Be!==u.isValid&&te.state.next({isValid:Be})}},fe=(xe,Be)=>{!o.disabled&&(V.isValidating||V.validatingFields||G.isValidating||G.validatingFields)&&((xe||Array.from(l.mount)).forEach(Ke=>{Ke&&(Be?Pn(u.validatingFields,Ke,Be):Mi(u.validatingFields,Ke))}),te.state.next({validatingFields:u.validatingFields,isValidating:!ko(u.validatingFields)}))},Fe=(xe,Be=[],Ke,kt,vt=!0,pt=!0)=>{if(kt&&Ke&&!o.disabled){if(w.action=!0,pt&&Array.isArray(Jt(m,xe))){const Bt=Ke(Jt(m,xe),kt.argA,kt.argB);vt&&Pn(m,xe,Bt)}if(pt&&Array.isArray(Jt(u.errors,xe))){const Bt=Ke(Jt(u.errors,xe),kt.argA,kt.argB);vt&&Pn(u.errors,xe,Bt),fP(u.errors,xe)}if((V.touchedFields||G.touchedFields)&&pt&&Array.isArray(Jt(u.touchedFields,xe))){const Bt=Ke(Jt(u.touchedFields,xe),kt.argA,kt.argB);vt&&Pn(u.touchedFields,xe,Bt)}(V.dirtyFields||G.dirtyFields)&&(u.dirtyFields=Tf(b,P)),te.state.next({name:xe,isDirty:It(xe,Be),dirtyFields:u.dirtyFields,errors:u.errors,isValid:u.isValid})}else Pn(P,xe,Be)},Ce=(xe,Be)=>{Pn(u.errors,xe,Be),te.state.next({errors:u.errors})},Ie=xe=>{u.errors=xe,te.state.next({errors:u.errors,isValid:!1})},Le=(xe,Be,Ke,kt)=>{const vt=Jt(m,xe);if(vt){const pt=Jt(P,xe,Ii(Ke)?Jt(b,xe):Ke);Ii(pt)||kt&&kt.defaultChecked||Be?Pn(P,xe,Be?pt:Dx(vt._f)):Ht(xe,pt),w.mount&&ye()}},Xe=(xe,Be,Ke,kt,vt)=>{let pt=!1,Bt=!1;const _r={name:xe};if(!o.disabled){if(!Ke||kt){(V.isDirty||G.isDirty)&&(Bt=u.isDirty,u.isDirty=_r.isDirty=It(),pt=Bt!==_r.isDirty);const Sr=th(Jt(b,xe),Be);Bt=!!Jt(u.dirtyFields,xe),Sr?Mi(u.dirtyFields,xe):Pn(u.dirtyFields,xe,!0),_r.dirtyFields=u.dirtyFields,pt=pt||(V.dirtyFields||G.dirtyFields)&&Bt!==!Sr}if(Ke){const Sr=Jt(u.touchedFields,xe);Sr||(Pn(u.touchedFields,xe,Ke),_r.touchedFields=u.touchedFields,pt=pt||(V.touchedFields||G.touchedFields)&&Sr!==Ke)}pt&&vt&&te.state.next(_r)}return pt?_r:{}},mt=(xe,Be,Ke,kt)=>{const vt=Jt(u.errors,xe),pt=(V.isValid||G.isValid)&&tc(Be)&&u.isValid!==Be;if(o.delayError&&Ke?(L=Se(()=>Ce(xe,Ke)),L(o.delayError)):(clearTimeout(B),L=null,Ke?Pn(u.errors,xe,Ke):Mi(u.errors,xe)),(Ke?!th(vt,Ke):vt)||!ko(kt)||pt){const Bt={...kt,...pt&&tc(Be)?{isValid:Be}:{},errors:u.errors,name:xe};u={...u,...Bt},te.state.next(Bt)}},yt=async xe=>{fe(xe,!0);const Be=await o.resolver(P,o.context,aP(xe||l.mount,m,o.criteriaMode,o.shouldUseNativeValidation));return fe(xe),Be},Qe=async xe=>{const{errors:Be}=await yt(xe);if(xe)for(const Ke of xe){const kt=Jt(Be,Ke);kt?Pn(u.errors,Ke,kt):Mi(u.errors,Ke)}else u.errors=Be;return Be},it=async(xe,Be,Ke={valid:!0})=>{for(const kt in xe){const vt=xe[kt];if(vt){const{_f:pt,...Bt}=vt;if(pt){const _r=l.array.has(pt.name),Sr=vt._f&&lP(vt._f);Sr&&V.validatingFields&&fe([pt.name],!0);const Te=await Bx(vt,l.disabled,P,q,o.shouldUseNativeValidation&&!Be,_r);if(Sr&&V.validatingFields&&fe([pt.name]),Te[pt.name]&&(Ke.valid=!1,Be))break;!Be&&(Jt(Te,pt.name)?_r?pP(u.errors,Te,pt.name):Pn(u.errors,pt.name,Te[pt.name]):Mi(u.errors,pt.name))}!ko(Bt)&&await it(Bt,Be,Ke)}}return Ke.valid},at=()=>{for(const xe of l.unMount){const Be=Jt(m,xe);Be&&(Be._f.refs?Be._f.refs.every(Ke=>!Dy(Ke)):!Dy(Be._f.ref))&&Lr(xe)}l.unMount=new Set},It=(xe,Be)=>!o.disabled&&(xe&&Be&&Pn(P,xe,Be),!th(Ct(),b)),Rt=(xe,Be,Ke)=>rP(xe,l,{...w.mount?P:Ii(Be)?b:oa(xe)?{[xe]:Be}:Be},Ke,Be),At=xe=>W_(Jt(w.mount?P:b,xe,o.shouldUnregister?Jt(b,xe,[]):[])),Ht=(xe,Be,Ke={})=>{const kt=Jt(m,xe);let vt=Be;if(kt){const pt=kt._f;pt&&(!pt.disabled&&Pn(P,xe,Wb(Be,pt)),vt=Mg(pt.ref)&&oo(Be)?"":Be,Zb(pt.ref)?[...pt.ref.options].forEach(Bt=>Bt.selected=vt.includes(Bt.value)):pt.refs?vm(pt.ref)?pt.refs.forEach(Bt=>{(!Bt.defaultChecked||!Bt.disabled)&&(Array.isArray(vt)?Bt.checked=!!vt.find(_r=>_r===Bt.value):Bt.checked=vt===Bt.value||!!vt)}):pt.refs.forEach(Bt=>Bt.checked=Bt.value===vt):X_(pt.ref)?pt.ref.value="":(pt.ref.value=vt,pt.ref.type||te.state.next({name:xe,values:as(P)})))}(Ke.shouldDirty||Ke.shouldTouch)&&Xe(xe,vt,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&ht(xe)},Rr=(xe,Be,Ke)=>{for(const kt in Be){if(!Be.hasOwnProperty(kt))return;const vt=Be[kt],pt=xe+"."+kt,Bt=Jt(m,pt);(l.array.has(xe)||Ai(vt)||Bt&&!Bt._f)&&!Sd(vt)?Rr(pt,vt,Ke):Ht(pt,vt,Ke)}},ar=(xe,Be,Ke={})=>{const kt=Jt(m,xe),vt=l.array.has(xe),pt=as(Be);Pn(P,xe,pt),vt?(te.array.next({name:xe,values:as(P)}),(V.isDirty||V.dirtyFields||G.isDirty||G.dirtyFields)&&Ke.shouldDirty&&te.state.next({name:xe,dirtyFields:Tf(b,P),isDirty:It(xe,pt)})):kt&&!kt._f&&!oo(pt)?Rr(xe,pt,Ke):Ht(xe,pt,Ke),Ox(xe,l)&&te.state.next({...u,name:xe}),te.state.next({name:w.mount?xe:void 0,values:as(P)})},Zt=async xe=>{w.mount=!0;const Be=xe.target;let Ke=Be.name,kt=!0;const vt=Jt(m,Ke),pt=Sr=>{kt=Number.isNaN(Sr)||Sd(Sr)&&isNaN(Sr.getTime())||th(Sr,Jt(P,Ke,Sr))},Bt=Lx(o.mode),_r=Lx(o.reValidateMode);if(vt){let Sr,Te;const K=Be.type?Dx(vt._f):KT(xe),X=xe.type===Mx.BLUR||xe.type===Mx.FOCUS_OUT,ne=!cP(vt._f)&&!o.resolver&&!Jt(u.errors,Ke)&&!vt._f.deps||dP(X,Jt(u.touchedFields,Ke),u.isSubmitted,_r,Bt),ue=Ox(Ke,l,X);Pn(P,Ke,K),X?(!Be||!Be.readOnly)&&(vt._f.onBlur&&vt._f.onBlur(xe),L&&L(0)):vt._f.onChange&&vt._f.onChange(xe);const ve=Xe(Ke,K,X),Ae=!ko(ve)||ue;if(!X&&te.state.next({name:Ke,type:xe.type,values:as(P)}),ne)return(V.isValid||G.isValid)&&(o.mode==="onBlur"?X&&ye():X||ye()),Ae&&te.state.next({name:Ke,...ue?{}:ve});if(!X&&ue&&te.state.next({...u}),o.resolver){const{errors:Oe}=await yt([Ke]);if(pt(K),kt){const ze=jx(u.errors,m,Ke),qe=jx(Oe,m,ze.name||Ke);Sr=qe.error,Ke=qe.name,Te=ko(Oe)}}else fe([Ke],!0),Sr=(await Bx(vt,l.disabled,P,q,o.shouldUseNativeValidation))[Ke],fe([Ke]),pt(K),kt&&(Sr?Te=!1:(V.isValid||G.isValid)&&(Te=await it(m,!0)));kt&&(vt._f.deps&&(!Array.isArray(vt._f.deps)||vt._f.deps.length>0)&&ht(vt._f.deps),mt(Ke,Te,Sr,ve))}},_t=(xe,Be)=>{if(Jt(u.errors,Be)&&xe.focus)return xe.focus(),1},ht=async(xe,Be={})=>{let Ke,kt;const vt=qp(xe);if(o.resolver){const pt=await Qe(Ii(xe)?xe:vt);Ke=ko(pt),kt=xe?!vt.some(Bt=>Jt(pt,Bt)):Ke}else xe?(kt=(await Promise.all(vt.map(async pt=>{const Bt=Jt(m,pt);return await it(Bt&&Bt._f?{[pt]:Bt}:Bt)}))).every(Boolean),!(!kt&&!u.isValid)&&ye()):kt=Ke=await it(m);return te.state.next({...!oa(xe)||(V.isValid||G.isValid)&&Ke!==u.isValid?{}:{name:xe},...o.resolver||!xe?{isValid:Ke}:{},errors:u.errors}),Be.shouldFocus&&!kt&&Wp(m,_t,xe?vt:l.mount),kt},Ct=(xe,Be)=>{let Ke={...w.mount?P:b};return Be&&(Ke=Vb(Be.dirtyFields?u.dirtyFields:u.touchedFields,Ke)),Ii(xe)?Ke:oa(xe)?Jt(Ke,xe):xe.map(kt=>Jt(Ke,kt))},Me=(xe,Be)=>({invalid:!!Jt((Be||u).errors,xe),isDirty:!!Jt((Be||u).dirtyFields,xe),error:Jt((Be||u).errors,xe),isValidating:!!Jt(u.validatingFields,xe),isTouched:!!Jt((Be||u).touchedFields,xe)}),Ye=xe=>{xe&&qp(xe).forEach(Be=>Mi(u.errors,Be)),te.state.next({errors:xe?u.errors:{}})},jt=(xe,Be,Ke)=>{const kt=(Jt(m,xe,{_f:{}})._f||{}).ref,vt=Jt(u.errors,xe)||{},{ref:pt,message:Bt,type:_r,...Sr}=vt;Pn(u.errors,xe,{...Sr,...Be,ref:kt}),te.state.next({name:xe,errors:u.errors,isValid:!1}),Ke&&Ke.shouldFocus&&kt&&kt.focus&&kt.focus()},tr=(xe,Be)=>pl(xe)?te.state.subscribe({next:Ke=>"values"in Ke&&xe(Rt(void 0,Be),Ke)}):Rt(xe,Be,!0),fr=xe=>te.state.subscribe({next:Be=>{hP(xe.name,Be.name,xe.exact)&&uP(Be,xe.formState||V,Xi,xe.reRenderRoot)&&xe.callback({values:{...P},...u,...Be,defaultValues:b})}}).unsubscribe,Kt=xe=>(w.mount=!0,G={...G,...xe.formState},fr({...xe,formState:G})),Lr=(xe,Be={})=>{for(const Ke of xe?qp(xe):l.mount)l.mount.delete(Ke),l.array.delete(Ke),Be.keepValue||(Mi(m,Ke),Mi(P,Ke)),!Be.keepError&&Mi(u.errors,Ke),!Be.keepDirty&&Mi(u.dirtyFields,Ke),!Be.keepTouched&&Mi(u.touchedFields,Ke),!Be.keepIsValidating&&Mi(u.validatingFields,Ke),!o.shouldUnregister&&!Be.keepDefaultValue&&Mi(b,Ke);te.state.next({values:as(P)}),te.state.next({...u,...Be.keepDirty?{isDirty:It()}:{}}),!Be.keepIsValid&&ye()},sr=({disabled:xe,name:Be})=>{(tc(xe)&&w.mount||xe||l.disabled.has(Be))&&(xe?l.disabled.add(Be):l.disabled.delete(Be))},yr=(xe,Be={})=>{let Ke=Jt(m,xe);const kt=tc(Be.disabled)||tc(o.disabled);return Pn(m,xe,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:xe}},name:xe,mount:!0,...Be}}),l.mount.add(xe),Ke?sr({disabled:tc(Be.disabled)?Be.disabled:o.disabled,name:xe}):Le(xe,!0,Be.value),{...kt?{disabled:Be.disabled||o.disabled}:{},...o.progressive?{required:!!Be.required,min:Up(Be.min),max:Up(Be.max),minLength:Up(Be.minLength),maxLength:Up(Be.maxLength),pattern:Up(Be.pattern)}:{},name:xe,onChange:Zt,onBlur:Zt,ref:vt=>{if(vt){yr(xe,Be),Ke=Jt(m,xe);const pt=Ii(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Bt=nP(pt),_r=Ke._f.refs||[];if(Bt?_r.find(Sr=>Sr===pt):pt===Ke._f.ref)return;Pn(m,xe,{_f:{...Ke._f,...Bt?{refs:[..._r.filter(Dy),pt,...Array.isArray(Jt(b,xe))?[{}]:[]],ref:{type:pt.type,name:xe}}:{ref:pt}}}),Le(xe,!1,void 0,pt)}else Ke=Jt(m,xe,{}),Ke._f&&(Ke._f.mount=!1),(o.shouldUnregister||Be.shouldUnregister)&&!(YT(l.array,xe)&&w.action)&&l.unMount.add(xe)}}},lr=()=>o.shouldFocusError&&Wp(m,_t,l.mount),ci=xe=>{tc(xe)&&(te.state.next({disabled:xe}),Wp(m,(Be,Ke)=>{const kt=Jt(m,Ke);kt&&(Be.disabled=kt._f.disabled||xe,Array.isArray(kt._f.refs)&&kt._f.refs.forEach(vt=>{vt.disabled=kt._f.disabled||xe}))},0,!1))},ln=(xe,Be)=>async Ke=>{let kt;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let vt=as(P);if(te.state.next({isSubmitting:!0}),o.resolver){const{errors:pt,values:Bt}=await yt();u.errors=pt,vt=as(Bt)}else await it(m);if(l.disabled.size)for(const pt of l.disabled)Mi(vt,pt);if(Mi(u.errors,"root"),ko(u.errors)){te.state.next({errors:{}});try{await xe(vt,Ke)}catch(pt){kt=pt}}else Be&&await Be({...u.errors},Ke),lr(),setTimeout(lr);if(te.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ko(u.errors)&&!kt,submitCount:u.submitCount+1,errors:u.errors}),kt)throw kt},Vr=(xe,Be={})=>{Jt(m,xe)&&(Ii(Be.defaultValue)?ar(xe,as(Jt(b,xe))):(ar(xe,Be.defaultValue),Pn(b,xe,as(Be.defaultValue))),Be.keepTouched||Mi(u.touchedFields,xe),Be.keepDirty||(Mi(u.dirtyFields,xe),u.isDirty=Be.defaultValue?It(xe,as(Jt(b,xe))):It()),Be.keepError||(Mi(u.errors,xe),V.isValid&&ye()),te.state.next({...u}))},Nr=(xe,Be={})=>{const Ke=xe?as(xe):b,kt=as(Ke),vt=ko(xe),pt=vt?b:kt;if(Be.keepDefaultValues||(b=Ke),!Be.keepValues){if(Be.keepDirtyValues){const Bt=new Set([...l.mount,...Object.keys(Tf(b,P))]);for(const _r of Array.from(Bt))Jt(u.dirtyFields,_r)?Pn(pt,_r,Jt(P,_r)):ar(_r,Jt(pt,_r))}else{if(q_&&Ii(xe))for(const Bt of l.mount){const _r=Jt(m,Bt);if(_r&&_r._f){const Sr=Array.isArray(_r._f.refs)?_r._f.refs[0]:_r._f.ref;if(Mg(Sr)){const Te=Sr.closest("form");if(Te){Te.reset();break}}}}if(Be.keepFieldsRef)for(const Bt of l.mount)ar(Bt,Jt(pt,Bt));else m={}}P=o.shouldUnregister?Be.keepDefaultValues?as(b):{}:as(pt),te.array.next({values:{...pt}}),te.state.next({values:{...pt}})}l={mount:Be.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},w.mount=!V.isValid||!!Be.keepIsValid||!!Be.keepDirtyValues,w.watch=!!o.shouldUnregister,te.state.next({submitCount:Be.keepSubmitCount?u.submitCount:0,isDirty:vt?!1:Be.keepDirty?u.isDirty:!!(Be.keepDefaultValues&&!th(xe,b)),isSubmitted:Be.keepIsSubmitted?u.isSubmitted:!1,dirtyFields:vt?{}:Be.keepDirtyValues?Be.keepDefaultValues&&P?Tf(b,P):u.dirtyFields:Be.keepDefaultValues&&xe?Tf(b,xe):Be.keepDirty?u.dirtyFields:{},touchedFields:Be.keepTouched?u.touchedFields:{},errors:Be.keepErrors?u.errors:{},isSubmitSuccessful:Be.keepIsSubmitSuccessful?u.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:b})},Cn=(xe,Be)=>Nr(pl(xe)?xe(P):xe,Be),jn=(xe,Be={})=>{const Ke=Jt(m,xe),kt=Ke&&Ke._f;if(kt){const vt=kt.refs?kt.refs[0]:kt.ref;vt.focus&&(vt.focus(),Be.shouldSelect&&pl(vt.select)&&vt.select())}},Xi=xe=>{u={...u,...xe}},Zn={control:{register:yr,unregister:Lr,getFieldState:Me,handleSubmit:ln,setError:jt,_subscribe:fr,_runSchema:yt,_focusError:lr,_getWatch:Rt,_getDirty:It,_setValid:ye,_setFieldArray:Fe,_setDisabledField:sr,_setErrors:Ie,_getFieldArray:At,_reset:Nr,_resetDefaultValues:()=>pl(o.defaultValues)&&o.defaultValues().then(xe=>{Cn(xe,o.resetOptions),te.state.next({isLoading:!1})}),_removeUnmounted:at,_disableForm:ci,_subjects:te,_proxyFormState:V,get _fields(){return m},get _formValues(){return P},get _state(){return w},set _state(xe){w=xe},get _defaultValues(){return b},get _names(){return l},set _names(xe){l=xe},get _formState(){return u},get _options(){return o},set _options(xe){o={...o,...xe}}},subscribe:Kt,trigger:ht,register:yr,handleSubmit:ln,watch:tr,setValue:ar,getValues:Ct,reset:Cn,resetField:Vr,clearErrors:Ye,unregister:Lr,setError:jt,setFocus:jn,getFieldState:Me};return{...Zn,formControl:Zn}}function Kb(n={}){const o=hn.useRef(void 0),u=hn.useRef(void 0),[m,b]=hn.useState({isDirty:!1,isValidating:!1,isLoading:pl(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:pl(n.defaultValues)?void 0:n.defaultValues});if(!o.current)if(n.formControl)o.current={...n.formControl,formState:m},n.defaultValues&&!pl(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:w,...l}=gP(n);o.current={...l,formState:m}}const P=o.current.control;return P._options=n,tP(()=>{const w=P._subscribe({formState:P._proxyFormState,callback:()=>b({...P._formState}),reRenderRoot:!0});return b(l=>({...l,isReady:!0})),P._formState.isReady=!0,w},[P]),hn.useEffect(()=>P._disableForm(n.disabled),[P,n.disabled]),hn.useEffect(()=>{n.mode&&(P._options.mode=n.mode),n.reValidateMode&&(P._options.reValidateMode=n.reValidateMode)},[P,n.mode,n.reValidateMode]),hn.useEffect(()=>{n.errors&&(P._setErrors(n.errors),P._focusError())},[P,n.errors]),hn.useEffect(()=>{n.shouldUnregister&&P._subjects.state.next({values:P._getWatch()})},[P,n.shouldUnregister]),hn.useEffect(()=>{if(P._proxyFormState.isDirty){const w=P._getDirty();w!==m.isDirty&&P._subjects.state.next({isDirty:w})}},[P,m.isDirty]),hn.useEffect(()=>{n.values&&!th(n.values,u.current)?(P._reset(n.values,{keepFieldsRef:!0,...P._options.resetOptions}),u.current=n.values,b(w=>({...w}))):P._resetDefaultValues()},[P,n.values]),hn.useEffect(()=>{P._state.mount||(P._setValid(),P._state.mount=!0),P._state.watch&&(P._state.watch=!1,P._subjects.state.next({...P._formState})),P._removeUnmounted()}),o.current.formState=eP(m,P),o.current}function dt(n,o,u){function m(l,L){var B;Object.defineProperty(l,"_zod",{value:l._zod??{},enumerable:!1}),(B=l._zod).traits??(B.traits=new Set),l._zod.traits.add(n),o(l,L);for(const V in w.prototype)V in l||Object.defineProperty(l,V,{value:w.prototype[V].bind(l)});l._zod.constr=w,l._zod.def=L}const b=(u==null?void 0:u.Parent)??Object;class P extends b{}Object.defineProperty(P,"name",{value:n});function w(l){var L;const B=u!=null&&u.Parent?new P:this;m(B,l),(L=B._zod).deferred??(L.deferred=[]);for(const V of B._zod.deferred)V();return B}return Object.defineProperty(w,"init",{value:m}),Object.defineProperty(w,Symbol.hasInstance,{value:l=>{var L,B;return u!=null&&u.Parent&&l instanceof u.Parent?!0:(B=(L=l==null?void 0:l._zod)==null?void 0:L.traits)==null?void 0:B.has(n)}}),Object.defineProperty(w,"name",{value:n}),w}class Cf extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Xb extends Error{constructor(o){super(`Encountered unidirectional transform during encode: ${o}`),this.name="ZodEncodeError"}}const Yb={};function Od(n){return Yb}function yP(n){const o=Object.values(n).filter(m=>typeof m=="number");return Object.entries(n).filter(([m,b])=>o.indexOf(+m)===-1).map(([m,b])=>b)}function f_(n,o){return typeof o=="bigint"?o.toString():o}function Q_(n){return{get value(){{const o=n();return Object.defineProperty(this,"value",{value:o}),o}}}}function J_(n){return n==null}function ev(n){const o=n.startsWith("^")?1:0,u=n.endsWith("$")?n.length-1:n.length;return n.slice(o,u)}const $x=Symbol("evaluating");function An(n,o,u){let m;Object.defineProperty(n,o,{get(){if(m!==$x)return m===void 0&&(m=$x,m=u()),m},set(b){Object.defineProperty(n,o,{value:b})},configurable:!0})}function Bd(n,o,u){Object.defineProperty(n,o,{value:u,writable:!0,enumerable:!0,configurable:!0})}function $d(...n){const o={};for(const u of n){const m=Object.getOwnPropertyDescriptors(u);Object.assign(o,m)}return Object.defineProperties({},o)}function Ux(n){return JSON.stringify(n)}const Qb="captureStackTrace"in Error?Error.captureStackTrace:(...n)=>{};function Ag(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}const _P=Q_(()=>{var n;if(typeof navigator<"u"&&((n=navigator==null?void 0:navigator.userAgent)!=null&&n.includes("Cloudflare")))return!1;try{const o=Function;return new o(""),!0}catch{return!1}});function rm(n){if(Ag(n)===!1)return!1;const o=n.constructor;if(o===void 0)return!0;const u=o.prototype;return!(Ag(u)===!1||Object.prototype.hasOwnProperty.call(u,"isPrototypeOf")===!1)}function Jb(n){return rm(n)?{...n}:Array.isArray(n)?[...n]:n}const vP=new Set(["string","number","symbol"]);function qg(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function mh(n,o,u){const m=new n._zod.constr(o??n._zod.def);return(!o||u!=null&&u.parent)&&(m._zod.parent=n),m}function zr(n){const o=n;if(!o)return{};if(typeof o=="string")return{error:()=>o};if((o==null?void 0:o.message)!==void 0){if((o==null?void 0:o.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");o.error=o.message}return delete o.message,typeof o.error=="string"?{...o,error:()=>o.error}:o}function xP(n){return Object.keys(n).filter(o=>n[o]._zod.optin==="optional"&&n[o]._zod.optout==="optional")}function bP(n,o){const u=n._zod.def,m=$d(n._zod.def,{get shape(){const b={};for(const P in o){if(!(P in u.shape))throw new Error(`Unrecognized key: "${P}"`);o[P]&&(b[P]=u.shape[P])}return Bd(this,"shape",b),b},checks:[]});return mh(n,m)}function wP(n,o){const u=n._zod.def,m=$d(n._zod.def,{get shape(){const b={...n._zod.def.shape};for(const P in o){if(!(P in u.shape))throw new Error(`Unrecognized key: "${P}"`);o[P]&&delete b[P]}return Bd(this,"shape",b),b},checks:[]});return mh(n,m)}function SP(n,o){if(!rm(o))throw new Error("Invalid input to extend: expected a plain object");const u=n._zod.def.checks;if(u&&u.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const b=$d(n._zod.def,{get shape(){const P={...n._zod.def.shape,...o};return Bd(this,"shape",P),P},checks:[]});return mh(n,b)}function TP(n,o){if(!rm(o))throw new Error("Invalid input to safeExtend: expected a plain object");const u={...n._zod.def,get shape(){const m={...n._zod.def.shape,...o};return Bd(this,"shape",m),m},checks:n._zod.def.checks};return mh(n,u)}function PP(n,o){const u=$d(n._zod.def,{get shape(){const m={...n._zod.def.shape,...o._zod.def.shape};return Bd(this,"shape",m),m},get catchall(){return o._zod.def.catchall},checks:[]});return mh(n,u)}function CP(n,o,u){const m=$d(o._zod.def,{get shape(){const b=o._zod.def.shape,P={...b};if(u)for(const w in u){if(!(w in b))throw new Error(`Unrecognized key: "${w}"`);u[w]&&(P[w]=n?new n({type:"optional",innerType:b[w]}):b[w])}else for(const w in b)P[w]=n?new n({type:"optional",innerType:b[w]}):b[w];return Bd(this,"shape",P),P},checks:[]});return mh(o,m)}function EP(n,o,u){const m=$d(o._zod.def,{get shape(){const b=o._zod.def.shape,P={...b};if(u)for(const w in u){if(!(w in P))throw new Error(`Unrecognized key: "${w}"`);u[w]&&(P[w]=new n({type:"nonoptional",innerType:b[w]}))}else for(const w in b)P[w]=new n({type:"nonoptional",innerType:b[w]});return Bd(this,"shape",P),P},checks:[]});return mh(o,m)}function Pf(n,o=0){var u;if(n.aborted===!0)return!0;for(let m=o;m<n.issues.length;m++)if(((u=n.issues[m])==null?void 0:u.continue)!==!0)return!0;return!1}function e1(n,o){return o.map(u=>{var m;return(m=u).path??(m.path=[]),u.path.unshift(n),u})}function fg(n){return typeof n=="string"?n:n==null?void 0:n.message}function jd(n,o,u){var b,P,w,l,L,B;const m={...n,path:n.path??[]};if(!n.message){const V=fg((w=(P=(b=n.inst)==null?void 0:b._zod.def)==null?void 0:P.error)==null?void 0:w.call(P,n))??fg((l=o==null?void 0:o.error)==null?void 0:l.call(o,n))??fg((L=u.customError)==null?void 0:L.call(u,n))??fg((B=u.localeError)==null?void 0:B.call(u,n))??"Invalid input";m.message=V}return delete m.inst,delete m.continue,o!=null&&o.reportInput||delete m.input,m}function tv(n){return Array.isArray(n)?"array":typeof n=="string"?"string":"unknown"}function nm(...n){const[o,u,m]=n;return typeof o=="string"?{message:o,code:"custom",input:u,inst:m}:{...o}}const t1=(n,o)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:o,enumerable:!1}),n.message=JSON.stringify(o,f_,2),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},rv=dt("$ZodError",t1),Wg=dt("$ZodError",t1,{Parent:Error});function kP(n,o=u=>u.message){const u={},m=[];for(const b of n.issues)b.path.length>0?(u[b.path[0]]=u[b.path[0]]||[],u[b.path[0]].push(o(b))):m.push(o(b));return{formErrors:m,fieldErrors:u}}function MP(n,o){const u=o||function(P){return P.message},m={_errors:[]},b=P=>{for(const w of P.issues)if(w.code==="invalid_union"&&w.errors.length)w.errors.map(l=>b({issues:l}));else if(w.code==="invalid_key")b({issues:w.issues});else if(w.code==="invalid_element")b({issues:w.issues});else if(w.path.length===0)m._errors.push(u(w));else{let l=m,L=0;for(;L<w.path.length;){const B=w.path[L];L===w.path.length-1?(l[B]=l[B]||{_errors:[]},l[B]._errors.push(u(w))):l[B]=l[B]||{_errors:[]},l=l[B],L++}}};return b(n),m}const Hg=n=>(o,u,m,b)=>{const P=m?Object.assign(m,{async:!1}):{async:!1},w=o._zod.run({value:u,issues:[]},P);if(w instanceof Promise)throw new Cf;if(w.issues.length){const l=new((b==null?void 0:b.Err)??n)(w.issues.map(L=>jd(L,P,Od())));throw Qb(l,b==null?void 0:b.callee),l}return w.value},IP=Hg(Wg),Kg=n=>async(o,u,m,b)=>{const P=m?Object.assign(m,{async:!0}):{async:!0};let w=o._zod.run({value:u,issues:[]},P);if(w instanceof Promise&&(w=await w),w.issues.length){const l=new((b==null?void 0:b.Err)??n)(w.issues.map(L=>jd(L,P,Od())));throw Qb(l,b==null?void 0:b.callee),l}return w.value},AP=Kg(Wg),Xg=n=>(o,u,m)=>{const b=m?{...m,async:!1}:{async:!1},P=o._zod.run({value:u,issues:[]},b);if(P instanceof Promise)throw new Cf;return P.issues.length?{success:!1,error:new(n??rv)(P.issues.map(w=>jd(w,b,Od())))}:{success:!0,data:P.value}},zP=Xg(Wg),Yg=n=>async(o,u,m)=>{const b=m?Object.assign(m,{async:!0}):{async:!0};let P=o._zod.run({value:u,issues:[]},b);return P instanceof Promise&&(P=await P),P.issues.length?{success:!1,error:new n(P.issues.map(w=>jd(w,b,Od())))}:{success:!0,data:P.value}},RP=Yg(Wg),DP=n=>(o,u,m)=>{const b=m?Object.assign(m,{direction:"backward"}):{direction:"backward"};return Hg(n)(o,u,b)},LP=n=>(o,u,m)=>Hg(n)(o,u,m),FP=n=>async(o,u,m)=>{const b=m?Object.assign(m,{direction:"backward"}):{direction:"backward"};return Kg(n)(o,u,b)},OP=n=>async(o,u,m)=>Kg(n)(o,u,m),jP=n=>(o,u,m)=>{const b=m?Object.assign(m,{direction:"backward"}):{direction:"backward"};return Xg(n)(o,u,b)},NP=n=>(o,u,m)=>Xg(n)(o,u,m),BP=n=>async(o,u,m)=>{const b=m?Object.assign(m,{direction:"backward"}):{direction:"backward"};return Yg(n)(o,u,b)},$P=n=>async(o,u,m)=>Yg(n)(o,u,m),UP=/^[cC][^\s-]{8,}$/,VP=/^[0-9a-z]+$/,ZP=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,GP=/^[0-9a-vA-V]{20}$/,qP=/^[A-Za-z0-9]{27}$/,WP=/^[a-zA-Z0-9_-]{21}$/,HP=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,KP=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Vx=n=>n?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${n}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,XP=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,YP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function QP(){return new RegExp(YP,"u")}const JP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,eC=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,tC=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,rC=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,nC=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,r1=/^[A-Za-z0-9_-]*$/,iC=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,sC=/^\+(?:[0-9]){6,14}[0-9]$/,n1="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",oC=new RegExp(`^${n1}$`);function i1(n){const o="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof n.precision=="number"?n.precision===-1?`${o}`:n.precision===0?`${o}:[0-5]\\d`:`${o}:[0-5]\\d\\.\\d{${n.precision}}`:`${o}(?::[0-5]\\d(?:\\.\\d+)?)?`}function aC(n){return new RegExp(`^${i1(n)}$`)}function lC(n){const o=i1({precision:n.precision}),u=["Z"];n.local&&u.push(""),n.offset&&u.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const m=`${o}(?:${u.join("|")})`;return new RegExp(`^${n1}T(?:${m})$`)}const cC=n=>{const o=n?`[\\s\\S]{${(n==null?void 0:n.minimum)??0},${(n==null?void 0:n.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${o}$`)},uC=/^[^A-Z]*$/,hC=/^[^a-z]*$/,cc=dt("$ZodCheck",(n,o)=>{var u;n._zod??(n._zod={}),n._zod.def=o,(u=n._zod).onattach??(u.onattach=[])}),dC=dt("$ZodCheckMaxLength",(n,o)=>{var u;cc.init(n,o),(u=n._zod.def).when??(u.when=m=>{const b=m.value;return!J_(b)&&b.length!==void 0}),n._zod.onattach.push(m=>{const b=m._zod.bag.maximum??Number.POSITIVE_INFINITY;o.maximum<b&&(m._zod.bag.maximum=o.maximum)}),n._zod.check=m=>{const b=m.value;if(b.length<=o.maximum)return;const w=tv(b);m.issues.push({origin:w,code:"too_big",maximum:o.maximum,inclusive:!0,input:b,inst:n,continue:!o.abort})}}),fC=dt("$ZodCheckMinLength",(n,o)=>{var u;cc.init(n,o),(u=n._zod.def).when??(u.when=m=>{const b=m.value;return!J_(b)&&b.length!==void 0}),n._zod.onattach.push(m=>{const b=m._zod.bag.minimum??Number.NEGATIVE_INFINITY;o.minimum>b&&(m._zod.bag.minimum=o.minimum)}),n._zod.check=m=>{const b=m.value;if(b.length>=o.minimum)return;const w=tv(b);m.issues.push({origin:w,code:"too_small",minimum:o.minimum,inclusive:!0,input:b,inst:n,continue:!o.abort})}}),pC=dt("$ZodCheckLengthEquals",(n,o)=>{var u;cc.init(n,o),(u=n._zod.def).when??(u.when=m=>{const b=m.value;return!J_(b)&&b.length!==void 0}),n._zod.onattach.push(m=>{const b=m._zod.bag;b.minimum=o.length,b.maximum=o.length,b.length=o.length}),n._zod.check=m=>{const b=m.value,P=b.length;if(P===o.length)return;const w=tv(b),l=P>o.length;m.issues.push({origin:w,...l?{code:"too_big",maximum:o.length}:{code:"too_small",minimum:o.length},inclusive:!0,exact:!0,input:m.value,inst:n,continue:!o.abort})}}),Qg=dt("$ZodCheckStringFormat",(n,o)=>{var u,m;cc.init(n,o),n._zod.onattach.push(b=>{const P=b._zod.bag;P.format=o.format,o.pattern&&(P.patterns??(P.patterns=new Set),P.patterns.add(o.pattern))}),o.pattern?(u=n._zod).check??(u.check=b=>{o.pattern.lastIndex=0,!o.pattern.test(b.value)&&b.issues.push({origin:"string",code:"invalid_format",format:o.format,input:b.value,...o.pattern?{pattern:o.pattern.toString()}:{},inst:n,continue:!o.abort})}):(m=n._zod).check??(m.check=()=>{})}),mC=dt("$ZodCheckRegex",(n,o)=>{Qg.init(n,o),n._zod.check=u=>{o.pattern.lastIndex=0,!o.pattern.test(u.value)&&u.issues.push({origin:"string",code:"invalid_format",format:"regex",input:u.value,pattern:o.pattern.toString(),inst:n,continue:!o.abort})}}),gC=dt("$ZodCheckLowerCase",(n,o)=>{o.pattern??(o.pattern=uC),Qg.init(n,o)}),yC=dt("$ZodCheckUpperCase",(n,o)=>{o.pattern??(o.pattern=hC),Qg.init(n,o)}),_C=dt("$ZodCheckIncludes",(n,o)=>{cc.init(n,o);const u=qg(o.includes),m=new RegExp(typeof o.position=="number"?`^.{${o.position}}${u}`:u);o.pattern=m,n._zod.onattach.push(b=>{const P=b._zod.bag;P.patterns??(P.patterns=new Set),P.patterns.add(m)}),n._zod.check=b=>{b.value.includes(o.includes,o.position)||b.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:o.includes,input:b.value,inst:n,continue:!o.abort})}}),vC=dt("$ZodCheckStartsWith",(n,o)=>{cc.init(n,o);const u=new RegExp(`^${qg(o.prefix)}.*`);o.pattern??(o.pattern=u),n._zod.onattach.push(m=>{const b=m._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(u)}),n._zod.check=m=>{m.value.startsWith(o.prefix)||m.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:o.prefix,input:m.value,inst:n,continue:!o.abort})}}),xC=dt("$ZodCheckEndsWith",(n,o)=>{cc.init(n,o);const u=new RegExp(`.*${qg(o.suffix)}$`);o.pattern??(o.pattern=u),n._zod.onattach.push(m=>{const b=m._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(u)}),n._zod.check=m=>{m.value.endsWith(o.suffix)||m.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:o.suffix,input:m.value,inst:n,continue:!o.abort})}}),bC=dt("$ZodCheckOverwrite",(n,o)=>{cc.init(n,o),n._zod.check=u=>{u.value=o.tx(u.value)}});class wC{constructor(o=[]){this.content=[],this.indent=0,this&&(this.args=o)}indented(o){this.indent+=1,o(this),this.indent-=1}write(o){if(typeof o=="function"){o(this,{execution:"sync"}),o(this,{execution:"async"});return}const m=o.split(`
`).filter(w=>w),b=Math.min(...m.map(w=>w.length-w.trimStart().length)),P=m.map(w=>w.slice(b)).map(w=>" ".repeat(this.indent*2)+w);for(const w of P)this.content.push(w)}compile(){const o=Function,u=this==null?void 0:this.args,b=[...((this==null?void 0:this.content)??[""]).map(P=>`  ${P}`)];return new o(...u,b.join(`
`))}}const SC={major:4,minor:1,patch:11},Ki=dt("$ZodType",(n,o)=>{var b;var u;n??(n={}),n._zod.def=o,n._zod.bag=n._zod.bag||{},n._zod.version=SC;const m=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&m.unshift(n);for(const P of m)for(const w of P._zod.onattach)w(n);if(m.length===0)(u=n._zod).deferred??(u.deferred=[]),(b=n._zod.deferred)==null||b.push(()=>{n._zod.run=n._zod.parse});else{const P=(l,L,B)=>{let V=Pf(l),G;for(const te of L){if(te._zod.def.when){if(!te._zod.def.when(l))continue}else if(V)continue;const q=l.issues.length,Se=te._zod.check(l);if(Se instanceof Promise&&(B==null?void 0:B.async)===!1)throw new Cf;if(G||Se instanceof Promise)G=(G??Promise.resolve()).then(async()=>{await Se,l.issues.length!==q&&(V||(V=Pf(l,q)))});else{if(l.issues.length===q)continue;V||(V=Pf(l,q))}}return G?G.then(()=>l):l},w=(l,L,B)=>{if(Pf(l))return l.aborted=!0,l;const V=P(L,m,B);if(V instanceof Promise){if(B.async===!1)throw new Cf;return V.then(G=>n._zod.parse(G,B))}return n._zod.parse(V,B)};n._zod.run=(l,L)=>{if(L.skipChecks)return n._zod.parse(l,L);if(L.direction==="backward"){const V=n._zod.parse({value:l.value,issues:[]},{...L,skipChecks:!0});return V instanceof Promise?V.then(G=>w(G,l,L)):w(V,l,L)}const B=n._zod.parse(l,L);if(B instanceof Promise){if(L.async===!1)throw new Cf;return B.then(V=>P(V,m,L))}return P(B,m,L)}}n["~standard"]={validate:P=>{var w;try{const l=zP(n,P);return l.success?{value:l.data}:{issues:(w=l.error)==null?void 0:w.issues}}catch{return RP(n,P).then(L=>{var B;return L.success?{value:L.data}:{issues:(B=L.error)==null?void 0:B.issues}})}},vendor:"zod",version:1}}),nv=dt("$ZodString",(n,o)=>{var u;Ki.init(n,o),n._zod.pattern=[...((u=n==null?void 0:n._zod.bag)==null?void 0:u.patterns)??[]].pop()??cC(n._zod.bag),n._zod.parse=(m,b)=>{if(o.coerce)try{m.value=String(m.value)}catch{}return typeof m.value=="string"||m.issues.push({expected:"string",code:"invalid_type",input:m.value,inst:n}),m}}),Vn=dt("$ZodStringFormat",(n,o)=>{Qg.init(n,o),nv.init(n,o)}),TC=dt("$ZodGUID",(n,o)=>{o.pattern??(o.pattern=KP),Vn.init(n,o)}),PC=dt("$ZodUUID",(n,o)=>{if(o.version){const m={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[o.version];if(m===void 0)throw new Error(`Invalid UUID version: "${o.version}"`);o.pattern??(o.pattern=Vx(m))}else o.pattern??(o.pattern=Vx());Vn.init(n,o)}),CC=dt("$ZodEmail",(n,o)=>{o.pattern??(o.pattern=XP),Vn.init(n,o)}),EC=dt("$ZodURL",(n,o)=>{Vn.init(n,o),n._zod.check=u=>{try{const m=u.value.trim(),b=new URL(m);o.hostname&&(o.hostname.lastIndex=0,o.hostname.test(b.hostname)||u.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:iC.source,input:u.value,inst:n,continue:!o.abort})),o.protocol&&(o.protocol.lastIndex=0,o.protocol.test(b.protocol.endsWith(":")?b.protocol.slice(0,-1):b.protocol)||u.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:o.protocol.source,input:u.value,inst:n,continue:!o.abort})),o.normalize?u.value=b.href:u.value=m;return}catch{u.issues.push({code:"invalid_format",format:"url",input:u.value,inst:n,continue:!o.abort})}}}),kC=dt("$ZodEmoji",(n,o)=>{o.pattern??(o.pattern=QP()),Vn.init(n,o)}),MC=dt("$ZodNanoID",(n,o)=>{o.pattern??(o.pattern=WP),Vn.init(n,o)}),IC=dt("$ZodCUID",(n,o)=>{o.pattern??(o.pattern=UP),Vn.init(n,o)}),AC=dt("$ZodCUID2",(n,o)=>{o.pattern??(o.pattern=VP),Vn.init(n,o)}),zC=dt("$ZodULID",(n,o)=>{o.pattern??(o.pattern=ZP),Vn.init(n,o)}),RC=dt("$ZodXID",(n,o)=>{o.pattern??(o.pattern=GP),Vn.init(n,o)}),DC=dt("$ZodKSUID",(n,o)=>{o.pattern??(o.pattern=qP),Vn.init(n,o)}),LC=dt("$ZodISODateTime",(n,o)=>{o.pattern??(o.pattern=lC(o)),Vn.init(n,o)}),FC=dt("$ZodISODate",(n,o)=>{o.pattern??(o.pattern=oC),Vn.init(n,o)}),OC=dt("$ZodISOTime",(n,o)=>{o.pattern??(o.pattern=aC(o)),Vn.init(n,o)}),jC=dt("$ZodISODuration",(n,o)=>{o.pattern??(o.pattern=HP),Vn.init(n,o)}),NC=dt("$ZodIPv4",(n,o)=>{o.pattern??(o.pattern=JP),Vn.init(n,o),n._zod.onattach.push(u=>{const m=u._zod.bag;m.format="ipv4"})}),BC=dt("$ZodIPv6",(n,o)=>{o.pattern??(o.pattern=eC),Vn.init(n,o),n._zod.onattach.push(u=>{const m=u._zod.bag;m.format="ipv6"}),n._zod.check=u=>{try{new URL(`http://[${u.value}]`)}catch{u.issues.push({code:"invalid_format",format:"ipv6",input:u.value,inst:n,continue:!o.abort})}}}),$C=dt("$ZodCIDRv4",(n,o)=>{o.pattern??(o.pattern=tC),Vn.init(n,o)}),UC=dt("$ZodCIDRv6",(n,o)=>{o.pattern??(o.pattern=rC),Vn.init(n,o),n._zod.check=u=>{const m=u.value.split("/");try{if(m.length!==2)throw new Error;const[b,P]=m;if(!P)throw new Error;const w=Number(P);if(`${w}`!==P)throw new Error;if(w<0||w>128)throw new Error;new URL(`http://[${b}]`)}catch{u.issues.push({code:"invalid_format",format:"cidrv6",input:u.value,inst:n,continue:!o.abort})}}});function s1(n){if(n==="")return!0;if(n.length%4!==0)return!1;try{return atob(n),!0}catch{return!1}}const VC=dt("$ZodBase64",(n,o)=>{o.pattern??(o.pattern=nC),Vn.init(n,o),n._zod.onattach.push(u=>{u._zod.bag.contentEncoding="base64"}),n._zod.check=u=>{s1(u.value)||u.issues.push({code:"invalid_format",format:"base64",input:u.value,inst:n,continue:!o.abort})}});function ZC(n){if(!r1.test(n))return!1;const o=n.replace(/[-_]/g,m=>m==="-"?"+":"/"),u=o.padEnd(Math.ceil(o.length/4)*4,"=");return s1(u)}const GC=dt("$ZodBase64URL",(n,o)=>{o.pattern??(o.pattern=r1),Vn.init(n,o),n._zod.onattach.push(u=>{u._zod.bag.contentEncoding="base64url"}),n._zod.check=u=>{ZC(u.value)||u.issues.push({code:"invalid_format",format:"base64url",input:u.value,inst:n,continue:!o.abort})}}),qC=dt("$ZodE164",(n,o)=>{o.pattern??(o.pattern=sC),Vn.init(n,o)});function WC(n,o=null){try{const u=n.split(".");if(u.length!==3)return!1;const[m]=u;if(!m)return!1;const b=JSON.parse(atob(m));return!("typ"in b&&(b==null?void 0:b.typ)!=="JWT"||!b.alg||o&&(!("alg"in b)||b.alg!==o))}catch{return!1}}const HC=dt("$ZodJWT",(n,o)=>{Vn.init(n,o),n._zod.check=u=>{WC(u.value,o.alg)||u.issues.push({code:"invalid_format",format:"jwt",input:u.value,inst:n,continue:!o.abort})}}),KC=dt("$ZodUnknown",(n,o)=>{Ki.init(n,o),n._zod.parse=u=>u}),XC=dt("$ZodNever",(n,o)=>{Ki.init(n,o),n._zod.parse=(u,m)=>(u.issues.push({expected:"never",code:"invalid_type",input:u.value,inst:n}),u)});function Zx(n,o,u){n.issues.length&&o.issues.push(...e1(u,n.issues)),o.value[u]=n.value}const YC=dt("$ZodArray",(n,o)=>{Ki.init(n,o),n._zod.parse=(u,m)=>{const b=u.value;if(!Array.isArray(b))return u.issues.push({expected:"array",code:"invalid_type",input:b,inst:n}),u;u.value=Array(b.length);const P=[];for(let w=0;w<b.length;w++){const l=b[w],L=o.element._zod.run({value:l,issues:[]},m);L instanceof Promise?P.push(L.then(B=>Zx(B,u,w))):Zx(L,u,w)}return P.length?Promise.all(P).then(()=>u):u}});function zg(n,o,u,m){n.issues.length&&o.issues.push(...e1(u,n.issues)),n.value===void 0?u in m&&(o.value[u]=void 0):o.value[u]=n.value}function o1(n){var m,b,P,w;const o=Object.keys(n.shape);for(const l of o)if(!((w=(P=(b=(m=n.shape)==null?void 0:m[l])==null?void 0:b._zod)==null?void 0:P.traits)!=null&&w.has("$ZodType")))throw new Error(`Invalid element at key "${l}": expected a Zod schema`);const u=xP(n.shape);return{...n,keys:o,keySet:new Set(o),numKeys:o.length,optionalKeys:new Set(u)}}function a1(n,o,u,m,b,P){const w=[],l=b.keySet,L=b.catchall._zod,B=L.def.type;for(const V of Object.keys(o)){if(l.has(V))continue;if(B==="never"){w.push(V);continue}const G=L.run({value:o[V],issues:[]},m);G instanceof Promise?n.push(G.then(te=>zg(te,u,V,o))):zg(G,u,V,o)}return w.length&&u.issues.push({code:"unrecognized_keys",keys:w,input:o,inst:P}),n.length?Promise.all(n).then(()=>u):u}const QC=dt("$ZodObject",(n,o)=>{Ki.init(n,o);const u=Object.getOwnPropertyDescriptor(o,"shape");if(!(u!=null&&u.get)){const l=o.shape;Object.defineProperty(o,"shape",{get:()=>{const L={...l};return Object.defineProperty(o,"shape",{value:L}),L}})}const m=Q_(()=>o1(o));An(n._zod,"propValues",()=>{const l=o.shape,L={};for(const B in l){const V=l[B]._zod;if(V.values){L[B]??(L[B]=new Set);for(const G of V.values)L[B].add(G)}}return L});const b=Ag,P=o.catchall;let w;n._zod.parse=(l,L)=>{w??(w=m.value);const B=l.value;if(!b(B))return l.issues.push({expected:"object",code:"invalid_type",input:B,inst:n}),l;l.value={};const V=[],G=w.shape;for(const te of w.keys){const Se=G[te]._zod.run({value:B[te],issues:[]},L);Se instanceof Promise?V.push(Se.then(ye=>zg(ye,l,te,B))):zg(Se,l,te,B)}return P?a1(V,B,l,L,m.value,n):V.length?Promise.all(V).then(()=>l):l}}),JC=dt("$ZodObjectJIT",(n,o)=>{QC.init(n,o);const u=n._zod.parse,m=Q_(()=>o1(o)),b=te=>{const q=new wC(["shape","payload","ctx"]),Se=m.value,ye=Ie=>{const Le=Ux(Ie);return`shape[${Le}]._zod.run({ value: input[${Le}], issues: [] }, ctx)`};q.write("const input = payload.value;");const fe=Object.create(null);let Fe=0;for(const Ie of Se.keys)fe[Ie]=`key_${Fe++}`;q.write("const newResult = {};");for(const Ie of Se.keys){const Le=fe[Ie],Xe=Ux(Ie);q.write(`const ${Le} = ${ye(Ie)};`),q.write(`
        if (${Le}.issues.length) {
          payload.issues = payload.issues.concat(${Le}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Xe}, ...iss.path] : [${Xe}]
          })));
        }
        
        
        if (${Le}.value === undefined) {
          if (${Xe} in input) {
            newResult[${Xe}] = undefined;
          }
        } else {
          newResult[${Xe}] = ${Le}.value;
        }
        
      `)}q.write("payload.value = newResult;"),q.write("return payload;");const Ce=q.compile();return(Ie,Le)=>Ce(te,Ie,Le)};let P;const w=Ag,l=!Yb.jitless,B=l&&_P.value,V=o.catchall;let G;n._zod.parse=(te,q)=>{G??(G=m.value);const Se=te.value;return w(Se)?l&&B&&(q==null?void 0:q.async)===!1&&q.jitless!==!0?(P||(P=b(o.shape)),te=P(te,q),V?a1([],Se,te,q,G,n):te):u(te,q):(te.issues.push({expected:"object",code:"invalid_type",input:Se,inst:n}),te)}});function Gx(n,o,u,m){for(const P of n)if(P.issues.length===0)return o.value=P.value,o;const b=n.filter(P=>!Pf(P));return b.length===1?(o.value=b[0].value,b[0]):(o.issues.push({code:"invalid_union",input:o.value,inst:u,errors:n.map(P=>P.issues.map(w=>jd(w,m,Od())))}),o)}const eE=dt("$ZodUnion",(n,o)=>{Ki.init(n,o),An(n._zod,"optin",()=>o.options.some(b=>b._zod.optin==="optional")?"optional":void 0),An(n._zod,"optout",()=>o.options.some(b=>b._zod.optout==="optional")?"optional":void 0),An(n._zod,"values",()=>{if(o.options.every(b=>b._zod.values))return new Set(o.options.flatMap(b=>Array.from(b._zod.values)))}),An(n._zod,"pattern",()=>{if(o.options.every(b=>b._zod.pattern)){const b=o.options.map(P=>P._zod.pattern);return new RegExp(`^(${b.map(P=>ev(P.source)).join("|")})$`)}});const u=o.options.length===1,m=o.options[0]._zod.run;n._zod.parse=(b,P)=>{if(u)return m(b,P);let w=!1;const l=[];for(const L of o.options){const B=L._zod.run({value:b.value,issues:[]},P);if(B instanceof Promise)l.push(B),w=!0;else{if(B.issues.length===0)return B;l.push(B)}}return w?Promise.all(l).then(L=>Gx(L,b,n,P)):Gx(l,b,n,P)}}),tE=dt("$ZodIntersection",(n,o)=>{Ki.init(n,o),n._zod.parse=(u,m)=>{const b=u.value,P=o.left._zod.run({value:b,issues:[]},m),w=o.right._zod.run({value:b,issues:[]},m);return P instanceof Promise||w instanceof Promise?Promise.all([P,w]).then(([L,B])=>qx(u,L,B)):qx(u,P,w)}});function p_(n,o){if(n===o)return{valid:!0,data:n};if(n instanceof Date&&o instanceof Date&&+n==+o)return{valid:!0,data:n};if(rm(n)&&rm(o)){const u=Object.keys(o),m=Object.keys(n).filter(P=>u.indexOf(P)!==-1),b={...n,...o};for(const P of m){const w=p_(n[P],o[P]);if(!w.valid)return{valid:!1,mergeErrorPath:[P,...w.mergeErrorPath]};b[P]=w.data}return{valid:!0,data:b}}if(Array.isArray(n)&&Array.isArray(o)){if(n.length!==o.length)return{valid:!1,mergeErrorPath:[]};const u=[];for(let m=0;m<n.length;m++){const b=n[m],P=o[m],w=p_(b,P);if(!w.valid)return{valid:!1,mergeErrorPath:[m,...w.mergeErrorPath]};u.push(w.data)}return{valid:!0,data:u}}return{valid:!1,mergeErrorPath:[]}}function qx(n,o,u){if(o.issues.length&&n.issues.push(...o.issues),u.issues.length&&n.issues.push(...u.issues),Pf(n))return n;const m=p_(o.value,u.value);if(!m.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(m.mergeErrorPath)}`);return n.value=m.data,n}const rE=dt("$ZodEnum",(n,o)=>{Ki.init(n,o);const u=yP(o.entries),m=new Set(u);n._zod.values=m,n._zod.pattern=new RegExp(`^(${u.filter(b=>vP.has(typeof b)).map(b=>typeof b=="string"?qg(b):b.toString()).join("|")})$`),n._zod.parse=(b,P)=>{const w=b.value;return m.has(w)||b.issues.push({code:"invalid_value",values:u,input:w,inst:n}),b}}),nE=dt("$ZodTransform",(n,o)=>{Ki.init(n,o),n._zod.parse=(u,m)=>{if(m.direction==="backward")throw new Xb(n.constructor.name);const b=o.transform(u.value,u);if(m.async)return(b instanceof Promise?b:Promise.resolve(b)).then(w=>(u.value=w,u));if(b instanceof Promise)throw new Cf;return u.value=b,u}});function Wx(n,o){return n.issues.length&&o===void 0?{issues:[],value:void 0}:n}const iE=dt("$ZodOptional",(n,o)=>{Ki.init(n,o),n._zod.optin="optional",n._zod.optout="optional",An(n._zod,"values",()=>o.innerType._zod.values?new Set([...o.innerType._zod.values,void 0]):void 0),An(n._zod,"pattern",()=>{const u=o.innerType._zod.pattern;return u?new RegExp(`^(${ev(u.source)})?$`):void 0}),n._zod.parse=(u,m)=>{if(o.innerType._zod.optin==="optional"){const b=o.innerType._zod.run(u,m);return b instanceof Promise?b.then(P=>Wx(P,u.value)):Wx(b,u.value)}return u.value===void 0?u:o.innerType._zod.run(u,m)}}),sE=dt("$ZodNullable",(n,o)=>{Ki.init(n,o),An(n._zod,"optin",()=>o.innerType._zod.optin),An(n._zod,"optout",()=>o.innerType._zod.optout),An(n._zod,"pattern",()=>{const u=o.innerType._zod.pattern;return u?new RegExp(`^(${ev(u.source)}|null)$`):void 0}),An(n._zod,"values",()=>o.innerType._zod.values?new Set([...o.innerType._zod.values,null]):void 0),n._zod.parse=(u,m)=>u.value===null?u:o.innerType._zod.run(u,m)}),oE=dt("$ZodDefault",(n,o)=>{Ki.init(n,o),n._zod.optin="optional",An(n._zod,"values",()=>o.innerType._zod.values),n._zod.parse=(u,m)=>{if(m.direction==="backward")return o.innerType._zod.run(u,m);if(u.value===void 0)return u.value=o.defaultValue,u;const b=o.innerType._zod.run(u,m);return b instanceof Promise?b.then(P=>Hx(P,o)):Hx(b,o)}});function Hx(n,o){return n.value===void 0&&(n.value=o.defaultValue),n}const aE=dt("$ZodPrefault",(n,o)=>{Ki.init(n,o),n._zod.optin="optional",An(n._zod,"values",()=>o.innerType._zod.values),n._zod.parse=(u,m)=>(m.direction==="backward"||u.value===void 0&&(u.value=o.defaultValue),o.innerType._zod.run(u,m))}),lE=dt("$ZodNonOptional",(n,o)=>{Ki.init(n,o),An(n._zod,"values",()=>{const u=o.innerType._zod.values;return u?new Set([...u].filter(m=>m!==void 0)):void 0}),n._zod.parse=(u,m)=>{const b=o.innerType._zod.run(u,m);return b instanceof Promise?b.then(P=>Kx(P,n)):Kx(b,n)}});function Kx(n,o){return!n.issues.length&&n.value===void 0&&n.issues.push({code:"invalid_type",expected:"nonoptional",input:n.value,inst:o}),n}const cE=dt("$ZodCatch",(n,o)=>{Ki.init(n,o),An(n._zod,"optin",()=>o.innerType._zod.optin),An(n._zod,"optout",()=>o.innerType._zod.optout),An(n._zod,"values",()=>o.innerType._zod.values),n._zod.parse=(u,m)=>{if(m.direction==="backward")return o.innerType._zod.run(u,m);const b=o.innerType._zod.run(u,m);return b instanceof Promise?b.then(P=>(u.value=P.value,P.issues.length&&(u.value=o.catchValue({...u,error:{issues:P.issues.map(w=>jd(w,m,Od()))},input:u.value}),u.issues=[]),u)):(u.value=b.value,b.issues.length&&(u.value=o.catchValue({...u,error:{issues:b.issues.map(P=>jd(P,m,Od()))},input:u.value}),u.issues=[]),u)}}),uE=dt("$ZodPipe",(n,o)=>{Ki.init(n,o),An(n._zod,"values",()=>o.in._zod.values),An(n._zod,"optin",()=>o.in._zod.optin),An(n._zod,"optout",()=>o.out._zod.optout),An(n._zod,"propValues",()=>o.in._zod.propValues),n._zod.parse=(u,m)=>{if(m.direction==="backward"){const P=o.out._zod.run(u,m);return P instanceof Promise?P.then(w=>pg(w,o.in,m)):pg(P,o.in,m)}const b=o.in._zod.run(u,m);return b instanceof Promise?b.then(P=>pg(P,o.out,m)):pg(b,o.out,m)}});function pg(n,o,u){return n.issues.length?(n.aborted=!0,n):o._zod.run({value:n.value,issues:n.issues},u)}const hE=dt("$ZodReadonly",(n,o)=>{Ki.init(n,o),An(n._zod,"propValues",()=>o.innerType._zod.propValues),An(n._zod,"values",()=>o.innerType._zod.values),An(n._zod,"optin",()=>o.innerType._zod.optin),An(n._zod,"optout",()=>o.innerType._zod.optout),n._zod.parse=(u,m)=>{if(m.direction==="backward")return o.innerType._zod.run(u,m);const b=o.innerType._zod.run(u,m);return b instanceof Promise?b.then(Xx):Xx(b)}});function Xx(n){return n.value=Object.freeze(n.value),n}const dE=dt("$ZodCustom",(n,o)=>{cc.init(n,o),Ki.init(n,o),n._zod.parse=(u,m)=>u,n._zod.check=u=>{const m=u.value,b=o.fn(m);if(b instanceof Promise)return b.then(P=>Yx(P,u,m,n));Yx(b,u,m,n)}});function Yx(n,o,u,m){if(!n){const b={code:"custom",input:u,inst:m,path:[...m._zod.def.path??[]],continue:!m._zod.def.abort};m._zod.def.params&&(b.params=m._zod.def.params),o.issues.push(nm(b))}}class fE{constructor(){this._map=new WeakMap,this._idmap=new Map}add(o,...u){const m=u[0];if(this._map.set(o,m),m&&typeof m=="object"&&"id"in m){if(this._idmap.has(m.id))throw new Error(`ID ${m.id} already exists in the registry`);this._idmap.set(m.id,o)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(o){const u=this._map.get(o);return u&&typeof u=="object"&&"id"in u&&this._idmap.delete(u.id),this._map.delete(o),this}get(o){const u=o._zod.parent;if(u){const m={...this.get(u)??{}};delete m.id;const b={...m,...this._map.get(o)};return Object.keys(b).length?b:void 0}return this._map.get(o)}has(o){return this._map.has(o)}}function pE(){return new fE}const mg=pE();function mE(n,o){return new n({type:"string",...zr(o)})}function gE(n,o){return new n({type:"string",format:"email",check:"string_format",abort:!1,...zr(o)})}function Qx(n,o){return new n({type:"string",format:"guid",check:"string_format",abort:!1,...zr(o)})}function yE(n,o){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,...zr(o)})}function _E(n,o){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...zr(o)})}function vE(n,o){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...zr(o)})}function xE(n,o){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...zr(o)})}function bE(n,o){return new n({type:"string",format:"url",check:"string_format",abort:!1,...zr(o)})}function wE(n,o){return new n({type:"string",format:"emoji",check:"string_format",abort:!1,...zr(o)})}function SE(n,o){return new n({type:"string",format:"nanoid",check:"string_format",abort:!1,...zr(o)})}function TE(n,o){return new n({type:"string",format:"cuid",check:"string_format",abort:!1,...zr(o)})}function PE(n,o){return new n({type:"string",format:"cuid2",check:"string_format",abort:!1,...zr(o)})}function CE(n,o){return new n({type:"string",format:"ulid",check:"string_format",abort:!1,...zr(o)})}function EE(n,o){return new n({type:"string",format:"xid",check:"string_format",abort:!1,...zr(o)})}function kE(n,o){return new n({type:"string",format:"ksuid",check:"string_format",abort:!1,...zr(o)})}function ME(n,o){return new n({type:"string",format:"ipv4",check:"string_format",abort:!1,...zr(o)})}function IE(n,o){return new n({type:"string",format:"ipv6",check:"string_format",abort:!1,...zr(o)})}function AE(n,o){return new n({type:"string",format:"cidrv4",check:"string_format",abort:!1,...zr(o)})}function zE(n,o){return new n({type:"string",format:"cidrv6",check:"string_format",abort:!1,...zr(o)})}function RE(n,o){return new n({type:"string",format:"base64",check:"string_format",abort:!1,...zr(o)})}function DE(n,o){return new n({type:"string",format:"base64url",check:"string_format",abort:!1,...zr(o)})}function LE(n,o){return new n({type:"string",format:"e164",check:"string_format",abort:!1,...zr(o)})}function FE(n,o){return new n({type:"string",format:"jwt",check:"string_format",abort:!1,...zr(o)})}function OE(n,o){return new n({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...zr(o)})}function jE(n,o){return new n({type:"string",format:"date",check:"string_format",...zr(o)})}function NE(n,o){return new n({type:"string",format:"time",check:"string_format",precision:null,...zr(o)})}function BE(n,o){return new n({type:"string",format:"duration",check:"string_format",...zr(o)})}function $E(n){return new n({type:"unknown"})}function UE(n,o){return new n({type:"never",...zr(o)})}function l1(n,o){return new dC({check:"max_length",...zr(o),maximum:n})}function Rg(n,o){return new fC({check:"min_length",...zr(o),minimum:n})}function c1(n,o){return new pC({check:"length_equals",...zr(o),length:n})}function VE(n,o){return new mC({check:"string_format",format:"regex",...zr(o),pattern:n})}function ZE(n){return new gC({check:"string_format",format:"lowercase",...zr(n)})}function GE(n){return new yC({check:"string_format",format:"uppercase",...zr(n)})}function qE(n,o){return new _C({check:"string_format",format:"includes",...zr(o),includes:n})}function WE(n,o){return new vC({check:"string_format",format:"starts_with",...zr(o),prefix:n})}function HE(n,o){return new xC({check:"string_format",format:"ends_with",...zr(o),suffix:n})}function xm(n){return new bC({check:"overwrite",tx:n})}function KE(n){return xm(o=>o.normalize(n))}function XE(){return xm(n=>n.trim())}function YE(){return xm(n=>n.toLowerCase())}function QE(){return xm(n=>n.toUpperCase())}function JE(n,o,u){return new n({type:"array",element:o,...zr(u)})}function ek(n,o,u){return new n({type:"custom",check:"custom",fn:o,...zr(u)})}function tk(n){const o=rk(u=>(u.addIssue=m=>{if(typeof m=="string")u.issues.push(nm(m,u.value,o._zod.def));else{const b=m;b.fatal&&(b.continue=!1),b.code??(b.code="custom"),b.input??(b.input=u.value),b.inst??(b.inst=o),b.continue??(b.continue=!o._zod.def.abort),u.issues.push(nm(b))}},n(u.value,u)));return o}function rk(n,o){const u=new cc({check:"custom",...zr(o)});return u._zod.check=n,u}const nk=dt("ZodISODateTime",(n,o)=>{LC.init(n,o),ei.init(n,o)});function ik(n){return OE(nk,n)}const sk=dt("ZodISODate",(n,o)=>{FC.init(n,o),ei.init(n,o)});function ok(n){return jE(sk,n)}const ak=dt("ZodISOTime",(n,o)=>{OC.init(n,o),ei.init(n,o)});function lk(n){return NE(ak,n)}const ck=dt("ZodISODuration",(n,o)=>{jC.init(n,o),ei.init(n,o)});function uk(n){return BE(ck,n)}const hk=(n,o)=>{rv.init(n,o),n.name="ZodError",Object.defineProperties(n,{format:{value:u=>MP(n,u)},flatten:{value:u=>kP(n,u)},addIssue:{value:u=>{n.issues.push(u),n.message=JSON.stringify(n.issues,f_,2)}},addIssues:{value:u=>{n.issues.push(...u),n.message=JSON.stringify(n.issues,f_,2)}},isEmpty:{get(){return n.issues.length===0}}})},Fa=dt("ZodError",hk,{Parent:Error}),dk=Hg(Fa),fk=Kg(Fa),pk=Xg(Fa),mk=Yg(Fa),gk=DP(Fa),yk=LP(Fa),_k=FP(Fa),vk=OP(Fa),xk=jP(Fa),bk=NP(Fa),wk=BP(Fa),Sk=$P(Fa),us=dt("ZodType",(n,o)=>(Ki.init(n,o),n.def=o,n.type=o.type,Object.defineProperty(n,"_def",{value:o}),n.check=(...u)=>n.clone($d(o,{checks:[...o.checks??[],...u.map(m=>typeof m=="function"?{_zod:{check:m,def:{check:"custom"},onattach:[]}}:m)]})),n.clone=(u,m)=>mh(n,u,m),n.brand=()=>n,n.register=((u,m)=>(u.add(n,m),n)),n.parse=(u,m)=>dk(n,u,m,{callee:n.parse}),n.safeParse=(u,m)=>pk(n,u,m),n.parseAsync=async(u,m)=>fk(n,u,m,{callee:n.parseAsync}),n.safeParseAsync=async(u,m)=>mk(n,u,m),n.spa=n.safeParseAsync,n.encode=(u,m)=>gk(n,u,m),n.decode=(u,m)=>yk(n,u,m),n.encodeAsync=async(u,m)=>_k(n,u,m),n.decodeAsync=async(u,m)=>vk(n,u,m),n.safeEncode=(u,m)=>xk(n,u,m),n.safeDecode=(u,m)=>bk(n,u,m),n.safeEncodeAsync=async(u,m)=>wk(n,u,m),n.safeDecodeAsync=async(u,m)=>Sk(n,u,m),n.refine=(u,m)=>n.check(fM(u,m)),n.superRefine=u=>n.check(pM(u)),n.overwrite=u=>n.check(xm(u)),n.optional=()=>t0(n),n.nullable=()=>r0(n),n.nullish=()=>t0(r0(n)),n.nonoptional=u=>oM(n,u),n.array=()=>qk(n),n.or=u=>Kk([n,u]),n.and=u=>Yk(n,u),n.transform=u=>n0(n,eM(u)),n.default=u=>nM(n,u),n.prefault=u=>sM(n,u),n.catch=u=>lM(n,u),n.pipe=u=>n0(n,u),n.readonly=()=>hM(n),n.describe=u=>{const m=n.clone();return mg.add(m,{description:u}),m},Object.defineProperty(n,"description",{get(){var u;return(u=mg.get(n))==null?void 0:u.description},configurable:!0}),n.meta=(...u)=>{if(u.length===0)return mg.get(n);const m=n.clone();return mg.add(m,u[0]),m},n.isOptional=()=>n.safeParse(void 0).success,n.isNullable=()=>n.safeParse(null).success,n)),u1=dt("_ZodString",(n,o)=>{nv.init(n,o),us.init(n,o);const u=n._zod.bag;n.format=u.format??null,n.minLength=u.minimum??null,n.maxLength=u.maximum??null,n.regex=(...m)=>n.check(VE(...m)),n.includes=(...m)=>n.check(qE(...m)),n.startsWith=(...m)=>n.check(WE(...m)),n.endsWith=(...m)=>n.check(HE(...m)),n.min=(...m)=>n.check(Rg(...m)),n.max=(...m)=>n.check(l1(...m)),n.length=(...m)=>n.check(c1(...m)),n.nonempty=(...m)=>n.check(Rg(1,...m)),n.lowercase=m=>n.check(ZE(m)),n.uppercase=m=>n.check(GE(m)),n.trim=()=>n.check(XE()),n.normalize=(...m)=>n.check(KE(...m)),n.toLowerCase=()=>n.check(YE()),n.toUpperCase=()=>n.check(QE())}),Tk=dt("ZodString",(n,o)=>{nv.init(n,o),u1.init(n,o),n.email=u=>n.check(gE(Pk,u)),n.url=u=>n.check(bE(Ck,u)),n.jwt=u=>n.check(FE($k,u)),n.emoji=u=>n.check(wE(Ek,u)),n.guid=u=>n.check(Qx(Jx,u)),n.uuid=u=>n.check(yE(gg,u)),n.uuidv4=u=>n.check(_E(gg,u)),n.uuidv6=u=>n.check(vE(gg,u)),n.uuidv7=u=>n.check(xE(gg,u)),n.nanoid=u=>n.check(SE(kk,u)),n.guid=u=>n.check(Qx(Jx,u)),n.cuid=u=>n.check(TE(Mk,u)),n.cuid2=u=>n.check(PE(Ik,u)),n.ulid=u=>n.check(CE(Ak,u)),n.base64=u=>n.check(RE(jk,u)),n.base64url=u=>n.check(DE(Nk,u)),n.xid=u=>n.check(EE(zk,u)),n.ksuid=u=>n.check(kE(Rk,u)),n.ipv4=u=>n.check(ME(Dk,u)),n.ipv6=u=>n.check(IE(Lk,u)),n.cidrv4=u=>n.check(AE(Fk,u)),n.cidrv6=u=>n.check(zE(Ok,u)),n.e164=u=>n.check(LE(Bk,u)),n.datetime=u=>n.check(ik(u)),n.date=u=>n.check(ok(u)),n.time=u=>n.check(lk(u)),n.duration=u=>n.check(uk(u))});function Hp(n){return mE(Tk,n)}const ei=dt("ZodStringFormat",(n,o)=>{Vn.init(n,o),u1.init(n,o)}),Pk=dt("ZodEmail",(n,o)=>{CC.init(n,o),ei.init(n,o)}),Jx=dt("ZodGUID",(n,o)=>{TC.init(n,o),ei.init(n,o)}),gg=dt("ZodUUID",(n,o)=>{PC.init(n,o),ei.init(n,o)}),Ck=dt("ZodURL",(n,o)=>{EC.init(n,o),ei.init(n,o)}),Ek=dt("ZodEmoji",(n,o)=>{kC.init(n,o),ei.init(n,o)}),kk=dt("ZodNanoID",(n,o)=>{MC.init(n,o),ei.init(n,o)}),Mk=dt("ZodCUID",(n,o)=>{IC.init(n,o),ei.init(n,o)}),Ik=dt("ZodCUID2",(n,o)=>{AC.init(n,o),ei.init(n,o)}),Ak=dt("ZodULID",(n,o)=>{zC.init(n,o),ei.init(n,o)}),zk=dt("ZodXID",(n,o)=>{RC.init(n,o),ei.init(n,o)}),Rk=dt("ZodKSUID",(n,o)=>{DC.init(n,o),ei.init(n,o)}),Dk=dt("ZodIPv4",(n,o)=>{NC.init(n,o),ei.init(n,o)}),Lk=dt("ZodIPv6",(n,o)=>{BC.init(n,o),ei.init(n,o)}),Fk=dt("ZodCIDRv4",(n,o)=>{$C.init(n,o),ei.init(n,o)}),Ok=dt("ZodCIDRv6",(n,o)=>{UC.init(n,o),ei.init(n,o)}),jk=dt("ZodBase64",(n,o)=>{VC.init(n,o),ei.init(n,o)}),Nk=dt("ZodBase64URL",(n,o)=>{GC.init(n,o),ei.init(n,o)}),Bk=dt("ZodE164",(n,o)=>{qC.init(n,o),ei.init(n,o)}),$k=dt("ZodJWT",(n,o)=>{HC.init(n,o),ei.init(n,o)}),Uk=dt("ZodUnknown",(n,o)=>{KC.init(n,o),us.init(n,o)});function e0(){return $E(Uk)}const Vk=dt("ZodNever",(n,o)=>{XC.init(n,o),us.init(n,o)});function Zk(n){return UE(Vk,n)}const Gk=dt("ZodArray",(n,o)=>{YC.init(n,o),us.init(n,o),n.element=o.element,n.min=(u,m)=>n.check(Rg(u,m)),n.nonempty=u=>n.check(Rg(1,u)),n.max=(u,m)=>n.check(l1(u,m)),n.length=(u,m)=>n.check(c1(u,m)),n.unwrap=()=>n.element});function qk(n,o){return JE(Gk,n,o)}const Wk=dt("ZodObject",(n,o)=>{JC.init(n,o),us.init(n,o),An(n,"shape",()=>o.shape),n.keyof=()=>Qk(Object.keys(n._zod.def.shape)),n.catchall=u=>n.clone({...n._zod.def,catchall:u}),n.passthrough=()=>n.clone({...n._zod.def,catchall:e0()}),n.loose=()=>n.clone({...n._zod.def,catchall:e0()}),n.strict=()=>n.clone({...n._zod.def,catchall:Zk()}),n.strip=()=>n.clone({...n._zod.def,catchall:void 0}),n.extend=u=>SP(n,u),n.safeExtend=u=>TP(n,u),n.merge=u=>PP(n,u),n.pick=u=>bP(n,u),n.omit=u=>wP(n,u),n.partial=(...u)=>CP(d1,n,u[0]),n.required=(...u)=>EP(f1,n,u[0])});function h1(n,o){const u={type:"object",shape:n??{},...zr(o)};return new Wk(u)}const Hk=dt("ZodUnion",(n,o)=>{eE.init(n,o),us.init(n,o),n.options=o.options});function Kk(n,o){return new Hk({type:"union",options:n,...zr(o)})}const Xk=dt("ZodIntersection",(n,o)=>{tE.init(n,o),us.init(n,o)});function Yk(n,o){return new Xk({type:"intersection",left:n,right:o})}const m_=dt("ZodEnum",(n,o)=>{rE.init(n,o),us.init(n,o),n.enum=o.entries,n.options=Object.values(o.entries);const u=new Set(Object.keys(o.entries));n.extract=(m,b)=>{const P={};for(const w of m)if(u.has(w))P[w]=o.entries[w];else throw new Error(`Key ${w} not found in enum`);return new m_({...o,checks:[],...zr(b),entries:P})},n.exclude=(m,b)=>{const P={...o.entries};for(const w of m)if(u.has(w))delete P[w];else throw new Error(`Key ${w} not found in enum`);return new m_({...o,checks:[],...zr(b),entries:P})}});function Qk(n,o){const u=Array.isArray(n)?Object.fromEntries(n.map(m=>[m,m])):n;return new m_({type:"enum",entries:u,...zr(o)})}const Jk=dt("ZodTransform",(n,o)=>{nE.init(n,o),us.init(n,o),n._zod.parse=(u,m)=>{if(m.direction==="backward")throw new Xb(n.constructor.name);u.addIssue=P=>{if(typeof P=="string")u.issues.push(nm(P,u.value,o));else{const w=P;w.fatal&&(w.continue=!1),w.code??(w.code="custom"),w.input??(w.input=u.value),w.inst??(w.inst=n),u.issues.push(nm(w))}};const b=o.transform(u.value,u);return b instanceof Promise?b.then(P=>(u.value=P,u)):(u.value=b,u)}});function eM(n){return new Jk({type:"transform",transform:n})}const d1=dt("ZodOptional",(n,o)=>{iE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType});function t0(n){return new d1({type:"optional",innerType:n})}const tM=dt("ZodNullable",(n,o)=>{sE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType});function r0(n){return new tM({type:"nullable",innerType:n})}const rM=dt("ZodDefault",(n,o)=>{oE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType,n.removeDefault=n.unwrap});function nM(n,o){return new rM({type:"default",innerType:n,get defaultValue(){return typeof o=="function"?o():Jb(o)}})}const iM=dt("ZodPrefault",(n,o)=>{aE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType});function sM(n,o){return new iM({type:"prefault",innerType:n,get defaultValue(){return typeof o=="function"?o():Jb(o)}})}const f1=dt("ZodNonOptional",(n,o)=>{lE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType});function oM(n,o){return new f1({type:"nonoptional",innerType:n,...zr(o)})}const aM=dt("ZodCatch",(n,o)=>{cE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType,n.removeCatch=n.unwrap});function lM(n,o){return new aM({type:"catch",innerType:n,catchValue:typeof o=="function"?o:()=>o})}const cM=dt("ZodPipe",(n,o)=>{uE.init(n,o),us.init(n,o),n.in=o.in,n.out=o.out});function n0(n,o){return new cM({type:"pipe",in:n,out:o})}const uM=dt("ZodReadonly",(n,o)=>{hE.init(n,o),us.init(n,o),n.unwrap=()=>n._zod.def.innerType});function hM(n){return new uM({type:"readonly",innerType:n})}const dM=dt("ZodCustom",(n,o)=>{dE.init(n,o),us.init(n,o)});function fM(n,o={}){return ek(dM,n,o)}function pM(n){return tk(n)}const i0=(n,o,u)=>{if(n&&"reportValidity"in n){const m=Jt(u,o);n.setCustomValidity(m&&m.message||""),n.reportValidity()}},g_=(n,o)=>{for(const u in o.fields){const m=o.fields[u];m&&m.ref&&"reportValidity"in m.ref?i0(m.ref,u,n):m&&m.refs&&m.refs.forEach(b=>i0(b,u,n))}},s0=(n,o)=>{o.shouldUseNativeValidation&&g_(n,o);const u={};for(const m in n){const b=Jt(o.fields,m),P=Object.assign(n[m]||{},{ref:b&&b.ref});if(mM(o.names||Object.keys(n),m)){const w=Object.assign({},Jt(u,m));Pn(w,"root",P),Pn(u,m,w)}else Pn(u,m,P)}return u},mM=(n,o)=>{const u=o0(o);return n.some(m=>o0(m).match(`^${u}\\.\\d+`))};function o0(n){return n.replace(/\]|\[/g,"")}function a0(n,o){try{var u=n()}catch(m){return o(m)}return u&&u.then?u.then(void 0,o):u}function gM(n,o){for(var u={};n.length;){var m=n[0],b=m.code,P=m.message,w=m.path.join(".");if(!u[w])if("unionErrors"in m){var l=m.unionErrors[0].errors[0];u[w]={message:l.message,type:l.code}}else u[w]={message:P,type:b};if("unionErrors"in m&&m.unionErrors.forEach(function(V){return V.errors.forEach(function(G){return n.push(G)})}),o){var L=u[w].types,B=L&&L[m.code];u[w]=K_(w,o,u,b,B?[].concat(B,m.message):m.message)}n.shift()}return u}function yM(n,o){for(var u={};n.length;){var m=n[0],b=m.code,P=m.message,w=m.path.join(".");if(!u[w])if(m.code==="invalid_union"&&m.errors.length>0){var l=m.errors[0][0];u[w]={message:l.message,type:l.code}}else u[w]={message:P,type:b};if(m.code==="invalid_union"&&m.errors.forEach(function(V){return V.forEach(function(G){return n.push(G)})}),o){var L=u[w].types,B=L&&L[m.code];u[w]=K_(w,o,u,b,B?[].concat(B,m.message):m.message)}n.shift()}return u}function p1(n,o,u){if(u===void 0&&(u={}),(function(m){return"_def"in m&&typeof m._def=="object"&&"typeName"in m._def})(n))return function(m,b,P){try{return Promise.resolve(a0(function(){return Promise.resolve(n[u.mode==="sync"?"parse":"parseAsync"](m,o)).then(function(w){return P.shouldUseNativeValidation&&g_({},P),{errors:{},values:u.raw?Object.assign({},m):w}})},function(w){if((function(l){return Array.isArray(l==null?void 0:l.issues)})(w))return{values:{},errors:s0(gM(w.errors,!P.shouldUseNativeValidation&&P.criteriaMode==="all"),P)};throw w}))}catch(w){return Promise.reject(w)}};if((function(m){return"_zod"in m&&typeof m._zod=="object"})(n))return function(m,b,P){try{return Promise.resolve(a0(function(){return Promise.resolve((u.mode==="sync"?IP:AP)(n,m,o)).then(function(w){return P.shouldUseNativeValidation&&g_({},P),{errors:{},values:u.raw?Object.assign({},m):w}})},function(w){if((function(l){return l instanceof rv})(w))return{values:{},errors:s0(yM(w.issues,!P.shouldUseNativeValidation&&P.criteriaMode==="all"),P)};throw w}))}catch(w){return Promise.reject(w)}};throw new Error("Invalid input: not a Zod schema")}const _M=h1({email:Hp().email("Invalid email address"),password:Hp().min(8,"Password must be at least 8 characters")});function vM(){var V,G;const{setToken:n}=lc(),o=qf(),m=((G=(V=_l().state)==null?void 0:V.from)==null?void 0:G.pathname)||"/",{register:b,handleSubmit:P,formState:{errors:w,isSubmitting:l},setError:L}=Kb({resolver:p1(_M)});async function B(te){try{const q=await fetch("https://bada-backend.vercel.app/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});if(!q.ok){const ye=await q.json().catch(()=>null),fe=(ye==null?void 0:ye.error)??q.statusText;L("root",{message:fe});return}const Se=await q.json();n(Se.token),Rd.success("Successfully signed in!"),o(m,{replace:!0})}catch(q){const Se=q.message??"Login failed";L("root",{message:Se}),Rd.error(Se)}}return J.jsxs("main",{className:"max-w-md mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-2xl",children:"Sign in"}),J.jsxs("form",{onSubmit:P(B),className:"space-y-4",children:[J.jsxs("div",{children:[J.jsx("label",{htmlFor:"login-email",className:"block text-sm mb-1",children:"Email"}),J.jsx("input",{id:"login-email",type:"email",...b("email"),className:"w-full rounded-lg border border-border px-3 py-2"}),w.email&&J.jsx("p",{className:"text-red-600 text-sm",children:w.email.message})]}),J.jsxs("div",{children:[J.jsx("label",{htmlFor:"login-password",className:"block text-sm mb-1",children:"Password"}),J.jsx("input",{id:"login-password",type:"password",...b("password"),className:"w-full rounded-lg border border-border px-3 py-2"}),w.password&&J.jsx("p",{className:"text-red-600 text-sm",children:w.password.message})]}),w.root&&J.jsx("p",{className:"text-red-600 text-sm",children:w.root.message}),J.jsx("button",{type:"submit",disabled:l,className:"w-full rounded-lg bg-accent text-white py-2 hover:bg-accent/90 disabled:opacity-50",children:l?"Signing in…":"Sign in"})]}),J.jsxs("p",{className:"text-sm text-ink-muted",children:["No account?"," ",J.jsx(li,{to:"/register",className:"text-accent underline",children:"Register here"})]})]})}const xM=h1({email:Hp().email("Invalid email address"),password:Hp().min(8,"Password must be at least 8 characters"),confirmPassword:Hp()}).refine(n=>n.password===n.confirmPassword,{message:"Passwords must match",path:["confirmPassword"]});function bM(){const n=qf(),{register:o,handleSubmit:u,formState:{errors:m,isSubmitting:b},setError:P}=Kb({resolver:p1(xM)});async function w(l){try{const L=await fetch("https://bada-backend.vercel.app/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l.email,password:l.password})});if(!L.ok){const B=await L.json().catch(()=>null),V=(B==null?void 0:B.error)??L.statusText;P("root",{message:V});return}Rd.success("Registration successful! Please sign in."),n("/login",{replace:!0})}catch(L){const B=L.message??"Registration failed";P("root",{message:B}),Rd.error(B)}}return J.jsxs("main",{className:"max-w-md mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-2xl",children:"Register"}),J.jsxs("form",{onSubmit:u(w),className:"space-y-4",children:[J.jsxs("div",{children:[J.jsx("label",{htmlFor:"register-email",className:"block text-sm mb-1",children:"Email"}),J.jsx("input",{id:"register-email",type:"email",...o("email"),className:"w-full rounded-lg border border-border px-3 py-2"}),m.email&&J.jsx("p",{className:"text-red-600 text-sm",children:m.email.message})]}),J.jsxs("div",{children:[J.jsx("label",{htmlFor:"register-password",className:"block text-sm mb-1",children:"Password"}),J.jsx("input",{id:"register-password",type:"password",...o("password"),className:"w-full rounded-lg border border-border px-3 py-2"}),m.password&&J.jsx("p",{className:"text-red-600 text-sm",children:m.password.message})]}),J.jsxs("div",{children:[J.jsx("label",{htmlFor:"register-confirm-password",className:"block text-sm mb-1",children:"Confirm Password"}),J.jsx("input",{id:"register-confirm-password",type:"password",...o("confirmPassword"),className:"w-full rounded-lg border border-border px-3 py-2"}),m.confirmPassword&&J.jsx("p",{className:"text-red-600 text-sm",children:m.confirmPassword.message})]}),m.root&&J.jsx("p",{className:"text-red-600 text-sm",children:m.root.message}),J.jsx("button",{type:"submit",disabled:b,className:"w-full rounded-lg bg-accent text-white py-2 hover:bg-accent/90 disabled:opacity-50",children:b?"Registering…":"Register"})]}),J.jsxs("p",{className:"text-sm text-ink-muted",children:["Already have an account?"," ",J.jsx(li,{to:"/login",className:"text-accent underline",children:"Sign in here"})]})]})}function wM(n){const o=IS({queries:(n??[]).map(m=>({queryKey:["beach",m],queryFn:()=>zb(m),enabled:!!m,staleTime:3e5}))}),u=new Map;return o.forEach((m,b)=>{const P=n==null?void 0:n[b];P&&m.data&&u.set(P,m.data)}),{byId:u,isLoading:o.some(m=>m.isLoading),isError:o.some(m=>m.isError)}}function SM(){for(var n=arguments.length,o=new Array(n),u=0;u<n;u++)o[u]=arguments[u];return ee.useMemo(()=>m=>{o.forEach(b=>b(m))},o)}const Jg=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Hf(n){const o=Object.prototype.toString.call(n);return o==="[object Window]"||o==="[object global]"}function iv(n){return"nodeType"in n}function Mo(n){var o,u;return n?Hf(n)?n:iv(n)&&(o=(u=n.ownerDocument)==null?void 0:u.defaultView)!=null?o:window:window}function sv(n){const{Document:o}=Mo(n);return n instanceof o}function bm(n){return Hf(n)?!1:n instanceof Mo(n).HTMLElement}function m1(n){return n instanceof Mo(n).SVGElement}function Kf(n){return n?Hf(n)?n.document:iv(n)?sv(n)?n:bm(n)||m1(n)?n.ownerDocument:document:document:document}const ac=Jg?ee.useLayoutEffect:ee.useEffect;function ov(n){const o=ee.useRef(n);return ac(()=>{o.current=n}),ee.useCallback(function(){for(var u=arguments.length,m=new Array(u),b=0;b<u;b++)m[b]=arguments[b];return o.current==null?void 0:o.current(...m)},[])}function TM(){const n=ee.useRef(null),o=ee.useCallback((m,b)=>{n.current=setInterval(m,b)},[]),u=ee.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[o,u]}function im(n,o){o===void 0&&(o=[n]);const u=ee.useRef(n);return ac(()=>{u.current!==n&&(u.current=n)},o),u}function wm(n,o){const u=ee.useRef();return ee.useMemo(()=>{const m=n(u.current);return u.current=m,m},[...o])}function Dg(n){const o=ov(n),u=ee.useRef(null),m=ee.useCallback(b=>{b!==u.current&&(o==null||o(b,u.current)),u.current=b},[]);return[u,m]}function y_(n){const o=ee.useRef();return ee.useEffect(()=>{o.current=n},[n]),o.current}let Ly={};function Sm(n,o){return ee.useMemo(()=>{if(o)return o;const u=Ly[n]==null?0:Ly[n]+1;return Ly[n]=u,n+"-"+u},[n,o])}function g1(n){return function(o){for(var u=arguments.length,m=new Array(u>1?u-1:0),b=1;b<u;b++)m[b-1]=arguments[b];return m.reduce((P,w)=>{const l=Object.entries(w);for(const[L,B]of l){const V=P[L];V!=null&&(P[L]=V+n*B)}return P},{...o})}}const Ef=g1(1),Lg=g1(-1);function PM(n){return"clientX"in n&&"clientY"in n}function av(n){if(!n)return!1;const{KeyboardEvent:o}=Mo(n.target);return o&&n instanceof o}function CM(n){if(!n)return!1;const{TouchEvent:o}=Mo(n.target);return o&&n instanceof o}function __(n){if(CM(n)){if(n.touches&&n.touches.length){const{clientX:o,clientY:u}=n.touches[0];return{x:o,y:u}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:o,clientY:u}=n.changedTouches[0];return{x:o,y:u}}}return PM(n)?{x:n.clientX,y:n.clientY}:null}const sm=Object.freeze({Translate:{toString(n){if(!n)return;const{x:o,y:u}=n;return"translate3d("+(o?Math.round(o):0)+"px, "+(u?Math.round(u):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:o,scaleY:u}=n;return"scaleX("+o+") scaleY("+u+")"}},Transform:{toString(n){if(n)return[sm.Translate.toString(n),sm.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:o,duration:u,easing:m}=n;return o+" "+u+"ms "+m}}}),l0="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function EM(n){return n.matches(l0)?n:n.querySelector(l0)}const kM={display:"none"};function MM(n){let{id:o,value:u}=n;return hn.createElement("div",{id:o,style:kM},u)}function IM(n){let{id:o,announcement:u,ariaLiveType:m="assertive"}=n;const b={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return hn.createElement("div",{id:o,style:b,role:"status","aria-live":m,"aria-atomic":!0},u)}function AM(){const[n,o]=ee.useState("");return{announce:ee.useCallback(m=>{m!=null&&o(m)},[]),announcement:n}}const y1=ee.createContext(null);function zM(n){const o=ee.useContext(y1);ee.useEffect(()=>{if(!o)throw new Error("useDndMonitor must be used within a children of <DndContext>");return o(n)},[n,o])}function RM(){const[n]=ee.useState(()=>new Set),o=ee.useCallback(m=>(n.add(m),()=>n.delete(m)),[n]);return[ee.useCallback(m=>{let{type:b,event:P}=m;n.forEach(w=>{var l;return(l=w[b])==null?void 0:l.call(w,P)})},[n]),o]}const DM={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},LM={onDragStart(n){let{active:o}=n;return"Picked up draggable item "+o.id+"."},onDragOver(n){let{active:o,over:u}=n;return u?"Draggable item "+o.id+" was moved over droppable area "+u.id+".":"Draggable item "+o.id+" is no longer over a droppable area."},onDragEnd(n){let{active:o,over:u}=n;return u?"Draggable item "+o.id+" was dropped over droppable area "+u.id:"Draggable item "+o.id+" was dropped."},onDragCancel(n){let{active:o}=n;return"Dragging was cancelled. Draggable item "+o.id+" was dropped."}};function FM(n){let{announcements:o=LM,container:u,hiddenTextDescribedById:m,screenReaderInstructions:b=DM}=n;const{announce:P,announcement:w}=AM(),l=Sm("DndLiveRegion"),[L,B]=ee.useState(!1);if(ee.useEffect(()=>{B(!0)},[]),zM(ee.useMemo(()=>({onDragStart(G){let{active:te}=G;P(o.onDragStart({active:te}))},onDragMove(G){let{active:te,over:q}=G;o.onDragMove&&P(o.onDragMove({active:te,over:q}))},onDragOver(G){let{active:te,over:q}=G;P(o.onDragOver({active:te,over:q}))},onDragEnd(G){let{active:te,over:q}=G;P(o.onDragEnd({active:te,over:q}))},onDragCancel(G){let{active:te,over:q}=G;P(o.onDragCancel({active:te,over:q}))}}),[P,o])),!L)return null;const V=hn.createElement(hn.Fragment,null,hn.createElement(MM,{id:m,value:b.draggable}),hn.createElement(IM,{id:l,announcement:w}));return u?Zp.createPortal(V,u):V}var Wi;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Wi||(Wi={}));function Fg(){}function OM(n,o){return ee.useMemo(()=>({sensor:n,options:o??{}}),[n,o])}function jM(){for(var n=arguments.length,o=new Array(n),u=0;u<n;u++)o[u]=arguments[u];return ee.useMemo(()=>[...o].filter(m=>m!=null),[...o])}const gl=Object.freeze({x:0,y:0});function NM(n,o){return Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2))}function BM(n,o){let{data:{value:u}}=n,{data:{value:m}}=o;return u-m}function $M(n,o){let{data:{value:u}}=n,{data:{value:m}}=o;return m-u}function UM(n,o){if(!n||n.length===0)return null;const[u]=n;return u[o]}function c0(n,o,u){return o===void 0&&(o=n.left),u===void 0&&(u=n.top),{x:o+n.width*.5,y:u+n.height*.5}}const VM=n=>{let{collisionRect:o,droppableRects:u,droppableContainers:m}=n;const b=c0(o,o.left,o.top),P=[];for(const w of m){const{id:l}=w,L=u.get(l);if(L){const B=NM(c0(L),b);P.push({id:l,data:{droppableContainer:w,value:B}})}}return P.sort(BM)};function ZM(n,o){const u=Math.max(o.top,n.top),m=Math.max(o.left,n.left),b=Math.min(o.left+o.width,n.left+n.width),P=Math.min(o.top+o.height,n.top+n.height),w=b-m,l=P-u;if(m<b&&u<P){const L=o.width*o.height,B=n.width*n.height,V=w*l,G=V/(L+B-V);return Number(G.toFixed(4))}return 0}const GM=n=>{let{collisionRect:o,droppableRects:u,droppableContainers:m}=n;const b=[];for(const P of m){const{id:w}=P,l=u.get(w);if(l){const L=ZM(l,o);L>0&&b.push({id:w,data:{droppableContainer:P,value:L}})}}return b.sort($M)};function qM(n,o,u){return{...n,scaleX:o&&u?o.width/u.width:1,scaleY:o&&u?o.height/u.height:1}}function _1(n,o){return n&&o?{x:n.left-o.left,y:n.top-o.top}:gl}function WM(n){return function(u){for(var m=arguments.length,b=new Array(m>1?m-1:0),P=1;P<m;P++)b[P-1]=arguments[P];return b.reduce((w,l)=>({...w,top:w.top+n*l.y,bottom:w.bottom+n*l.y,left:w.left+n*l.x,right:w.right+n*l.x}),{...u})}}const HM=WM(1);function KM(n){if(n.startsWith("matrix3d(")){const o=n.slice(9,-1).split(/, /);return{x:+o[12],y:+o[13],scaleX:+o[0],scaleY:+o[5]}}else if(n.startsWith("matrix(")){const o=n.slice(7,-1).split(/, /);return{x:+o[4],y:+o[5],scaleX:+o[0],scaleY:+o[3]}}return null}function XM(n,o,u){const m=KM(o);if(!m)return n;const{scaleX:b,scaleY:P,x:w,y:l}=m,L=n.left-w-(1-b)*parseFloat(u),B=n.top-l-(1-P)*parseFloat(u.slice(u.indexOf(" ")+1)),V=b?n.width/b:n.width,G=P?n.height/P:n.height;return{width:V,height:G,top:B,right:L+V,bottom:B+G,left:L}}const YM={ignoreTransform:!1};function Xf(n,o){o===void 0&&(o=YM);let u=n.getBoundingClientRect();if(o.ignoreTransform){const{transform:B,transformOrigin:V}=Mo(n).getComputedStyle(n);B&&(u=XM(u,B,V))}const{top:m,left:b,width:P,height:w,bottom:l,right:L}=u;return{top:m,left:b,width:P,height:w,bottom:l,right:L}}function u0(n){return Xf(n,{ignoreTransform:!0})}function QM(n){const o=n.innerWidth,u=n.innerHeight;return{top:0,left:0,right:o,bottom:u,width:o,height:u}}function JM(n,o){return o===void 0&&(o=Mo(n).getComputedStyle(n)),o.position==="fixed"}function eI(n,o){o===void 0&&(o=Mo(n).getComputedStyle(n));const u=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(b=>{const P=o[b];return typeof P=="string"?u.test(P):!1})}function lv(n,o){const u=[];function m(b){if(o!=null&&u.length>=o||!b)return u;if(sv(b)&&b.scrollingElement!=null&&!u.includes(b.scrollingElement))return u.push(b.scrollingElement),u;if(!bm(b)||m1(b)||u.includes(b))return u;const P=Mo(n).getComputedStyle(b);return b!==n&&eI(b,P)&&u.push(b),JM(b,P)?u:m(b.parentNode)}return n?m(n):u}function v1(n){const[o]=lv(n,1);return o??null}function Fy(n){return!Jg||!n?null:Hf(n)?n:iv(n)?sv(n)||n===Kf(n).scrollingElement?window:bm(n)?n:null:null}function x1(n){return Hf(n)?n.scrollX:n.scrollLeft}function b1(n){return Hf(n)?n.scrollY:n.scrollTop}function v_(n){return{x:x1(n),y:b1(n)}}var cs;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(cs||(cs={}));function w1(n){return!Jg||!n?!1:n===document.scrollingElement}function S1(n){const o={x:0,y:0},u=w1(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},m={x:n.scrollWidth-u.width,y:n.scrollHeight-u.height},b=n.scrollTop<=o.y,P=n.scrollLeft<=o.x,w=n.scrollTop>=m.y,l=n.scrollLeft>=m.x;return{isTop:b,isLeft:P,isBottom:w,isRight:l,maxScroll:m,minScroll:o}}const tI={x:.2,y:.2};function rI(n,o,u,m,b){let{top:P,left:w,right:l,bottom:L}=u;m===void 0&&(m=10),b===void 0&&(b=tI);const{isTop:B,isBottom:V,isLeft:G,isRight:te}=S1(n),q={x:0,y:0},Se={x:0,y:0},ye={height:o.height*b.y,width:o.width*b.x};return!B&&P<=o.top+ye.height?(q.y=cs.Backward,Se.y=m*Math.abs((o.top+ye.height-P)/ye.height)):!V&&L>=o.bottom-ye.height&&(q.y=cs.Forward,Se.y=m*Math.abs((o.bottom-ye.height-L)/ye.height)),!te&&l>=o.right-ye.width?(q.x=cs.Forward,Se.x=m*Math.abs((o.right-ye.width-l)/ye.width)):!G&&w<=o.left+ye.width&&(q.x=cs.Backward,Se.x=m*Math.abs((o.left+ye.width-w)/ye.width)),{direction:q,speed:Se}}function nI(n){if(n===document.scrollingElement){const{innerWidth:P,innerHeight:w}=window;return{top:0,left:0,right:P,bottom:w,width:P,height:w}}const{top:o,left:u,right:m,bottom:b}=n.getBoundingClientRect();return{top:o,left:u,right:m,bottom:b,width:n.clientWidth,height:n.clientHeight}}function T1(n){return n.reduce((o,u)=>Ef(o,v_(u)),gl)}function iI(n){return n.reduce((o,u)=>o+x1(u),0)}function sI(n){return n.reduce((o,u)=>o+b1(u),0)}function oI(n,o){if(o===void 0&&(o=Xf),!n)return;const{top:u,left:m,bottom:b,right:P}=o(n);v1(n)&&(b<=0||P<=0||u>=window.innerHeight||m>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const aI=[["x",["left","right"],iI],["y",["top","bottom"],sI]];class cv{constructor(o,u){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const m=lv(u),b=T1(m);this.rect={...o},this.width=o.width,this.height=o.height;for(const[P,w,l]of aI)for(const L of w)Object.defineProperty(this,L,{get:()=>{const B=l(m),V=b[P]-B;return this.rect[L]+V},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Kp{constructor(o){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(u=>{var m;return(m=this.target)==null?void 0:m.removeEventListener(...u)})},this.target=o}add(o,u,m){var b;(b=this.target)==null||b.addEventListener(o,u,m),this.listeners.push([o,u,m])}}function lI(n){const{EventTarget:o}=Mo(n);return n instanceof o?n:Kf(n)}function Oy(n,o){const u=Math.abs(n.x),m=Math.abs(n.y);return typeof o=="number"?Math.sqrt(u**2+m**2)>o:"x"in o&&"y"in o?u>o.x&&m>o.y:"x"in o?u>o.x:"y"in o?m>o.y:!1}var Da;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Da||(Da={}));function h0(n){n.preventDefault()}function cI(n){n.stopPropagation()}var mn;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(mn||(mn={}));const P1={start:[mn.Space,mn.Enter],cancel:[mn.Esc],end:[mn.Space,mn.Enter,mn.Tab]},uI=(n,o)=>{let{currentCoordinates:u}=o;switch(n.code){case mn.Right:return{...u,x:u.x+25};case mn.Left:return{...u,x:u.x-25};case mn.Down:return{...u,y:u.y+25};case mn.Up:return{...u,y:u.y-25}}};class C1{constructor(o){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=o;const{event:{target:u}}=o;this.props=o,this.listeners=new Kp(Kf(u)),this.windowListeners=new Kp(Mo(u)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Da.Resize,this.handleCancel),this.windowListeners.add(Da.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Da.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:o,onStart:u}=this.props,m=o.node.current;m&&oI(m),u(gl)}handleKeyDown(o){if(av(o)){const{active:u,context:m,options:b}=this.props,{keyboardCodes:P=P1,coordinateGetter:w=uI,scrollBehavior:l="smooth"}=b,{code:L}=o;if(P.end.includes(L)){this.handleEnd(o);return}if(P.cancel.includes(L)){this.handleCancel(o);return}const{collisionRect:B}=m.current,V=B?{x:B.left,y:B.top}:gl;this.referenceCoordinates||(this.referenceCoordinates=V);const G=w(o,{active:u,context:m.current,currentCoordinates:V});if(G){const te=Lg(G,V),q={x:0,y:0},{scrollableAncestors:Se}=m.current;for(const ye of Se){const fe=o.code,{isTop:Fe,isRight:Ce,isLeft:Ie,isBottom:Le,maxScroll:Xe,minScroll:mt}=S1(ye),yt=nI(ye),Qe={x:Math.min(fe===mn.Right?yt.right-yt.width/2:yt.right,Math.max(fe===mn.Right?yt.left:yt.left+yt.width/2,G.x)),y:Math.min(fe===mn.Down?yt.bottom-yt.height/2:yt.bottom,Math.max(fe===mn.Down?yt.top:yt.top+yt.height/2,G.y))},it=fe===mn.Right&&!Ce||fe===mn.Left&&!Ie,at=fe===mn.Down&&!Le||fe===mn.Up&&!Fe;if(it&&Qe.x!==G.x){const It=ye.scrollLeft+te.x,Rt=fe===mn.Right&&It<=Xe.x||fe===mn.Left&&It>=mt.x;if(Rt&&!te.y){ye.scrollTo({left:It,behavior:l});return}Rt?q.x=ye.scrollLeft-It:q.x=fe===mn.Right?ye.scrollLeft-Xe.x:ye.scrollLeft-mt.x,q.x&&ye.scrollBy({left:-q.x,behavior:l});break}else if(at&&Qe.y!==G.y){const It=ye.scrollTop+te.y,Rt=fe===mn.Down&&It<=Xe.y||fe===mn.Up&&It>=mt.y;if(Rt&&!te.x){ye.scrollTo({top:It,behavior:l});return}Rt?q.y=ye.scrollTop-It:q.y=fe===mn.Down?ye.scrollTop-Xe.y:ye.scrollTop-mt.y,q.y&&ye.scrollBy({top:-q.y,behavior:l});break}}this.handleMove(o,Ef(Lg(G,this.referenceCoordinates),q))}}}handleMove(o,u){const{onMove:m}=this.props;o.preventDefault(),m(u)}handleEnd(o){const{onEnd:u}=this.props;o.preventDefault(),this.detach(),u()}handleCancel(o){const{onCancel:u}=this.props;o.preventDefault(),this.detach(),u()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}C1.activators=[{eventName:"onKeyDown",handler:(n,o,u)=>{let{keyboardCodes:m=P1,onActivation:b}=o,{active:P}=u;const{code:w}=n.nativeEvent;if(m.start.includes(w)){const l=P.activatorNode.current;return l&&n.target!==l?!1:(n.preventDefault(),b==null||b({event:n.nativeEvent}),!0)}return!1}}];function d0(n){return!!(n&&"distance"in n)}function f0(n){return!!(n&&"delay"in n)}class uv{constructor(o,u,m){var b;m===void 0&&(m=lI(o.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=o,this.events=u;const{event:P}=o,{target:w}=P;this.props=o,this.events=u,this.document=Kf(w),this.documentListeners=new Kp(this.document),this.listeners=new Kp(m),this.windowListeners=new Kp(Mo(w)),this.initialCoordinates=(b=__(P))!=null?b:gl,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:o,props:{options:{activationConstraint:u,bypassActivationConstraint:m}}}=this;if(this.listeners.add(o.move.name,this.handleMove,{passive:!1}),this.listeners.add(o.end.name,this.handleEnd),o.cancel&&this.listeners.add(o.cancel.name,this.handleCancel),this.windowListeners.add(Da.Resize,this.handleCancel),this.windowListeners.add(Da.DragStart,h0),this.windowListeners.add(Da.VisibilityChange,this.handleCancel),this.windowListeners.add(Da.ContextMenu,h0),this.documentListeners.add(Da.Keydown,this.handleKeydown),u){if(m!=null&&m({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(f0(u)){this.timeoutId=setTimeout(this.handleStart,u.delay),this.handlePending(u);return}if(d0(u)){this.handlePending(u);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(o,u){const{active:m,onPending:b}=this.props;b(m,o,this.initialCoordinates,u)}handleStart(){const{initialCoordinates:o}=this,{onStart:u}=this.props;o&&(this.activated=!0,this.documentListeners.add(Da.Click,cI,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Da.SelectionChange,this.removeTextSelection),u(o))}handleMove(o){var u;const{activated:m,initialCoordinates:b,props:P}=this,{onMove:w,options:{activationConstraint:l}}=P;if(!b)return;const L=(u=__(o))!=null?u:gl,B=Lg(b,L);if(!m&&l){if(d0(l)){if(l.tolerance!=null&&Oy(B,l.tolerance))return this.handleCancel();if(Oy(B,l.distance))return this.handleStart()}if(f0(l)&&Oy(B,l.tolerance))return this.handleCancel();this.handlePending(l,B);return}o.cancelable&&o.preventDefault(),w(L)}handleEnd(){const{onAbort:o,onEnd:u}=this.props;this.detach(),this.activated||o(this.props.active),u()}handleCancel(){const{onAbort:o,onCancel:u}=this.props;this.detach(),this.activated||o(this.props.active),u()}handleKeydown(o){o.code===mn.Esc&&this.handleCancel()}removeTextSelection(){var o;(o=this.document.getSelection())==null||o.removeAllRanges()}}const hI={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class hv extends uv{constructor(o){const{event:u}=o,m=Kf(u.target);super(o,hI,m)}}hv.activators=[{eventName:"onPointerDown",handler:(n,o)=>{let{nativeEvent:u}=n,{onActivation:m}=o;return!u.isPrimary||u.button!==0?!1:(m==null||m({event:u}),!0)}}];const dI={move:{name:"mousemove"},end:{name:"mouseup"}};var x_;(function(n){n[n.RightClick=2]="RightClick"})(x_||(x_={}));class fI extends uv{constructor(o){super(o,dI,Kf(o.event.target))}}fI.activators=[{eventName:"onMouseDown",handler:(n,o)=>{let{nativeEvent:u}=n,{onActivation:m}=o;return u.button===x_.RightClick?!1:(m==null||m({event:u}),!0)}}];const jy={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class pI extends uv{constructor(o){super(o,jy)}static setup(){return window.addEventListener(jy.move.name,o,{capture:!1,passive:!1}),function(){window.removeEventListener(jy.move.name,o)};function o(){}}}pI.activators=[{eventName:"onTouchStart",handler:(n,o)=>{let{nativeEvent:u}=n,{onActivation:m}=o;const{touches:b}=u;return b.length>1?!1:(m==null||m({event:u}),!0)}}];var Xp;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Xp||(Xp={}));var Og;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Og||(Og={}));function mI(n){let{acceleration:o,activator:u=Xp.Pointer,canScroll:m,draggingRect:b,enabled:P,interval:w=5,order:l=Og.TreeOrder,pointerCoordinates:L,scrollableAncestors:B,scrollableAncestorRects:V,delta:G,threshold:te}=n;const q=yI({delta:G,disabled:!P}),[Se,ye]=TM(),fe=ee.useRef({x:0,y:0}),Fe=ee.useRef({x:0,y:0}),Ce=ee.useMemo(()=>{switch(u){case Xp.Pointer:return L?{top:L.y,bottom:L.y,left:L.x,right:L.x}:null;case Xp.DraggableRect:return b}},[u,b,L]),Ie=ee.useRef(null),Le=ee.useCallback(()=>{const mt=Ie.current;if(!mt)return;const yt=fe.current.x*Fe.current.x,Qe=fe.current.y*Fe.current.y;mt.scrollBy(yt,Qe)},[]),Xe=ee.useMemo(()=>l===Og.TreeOrder?[...B].reverse():B,[l,B]);ee.useEffect(()=>{if(!P||!B.length||!Ce){ye();return}for(const mt of Xe){if((m==null?void 0:m(mt))===!1)continue;const yt=B.indexOf(mt),Qe=V[yt];if(!Qe)continue;const{direction:it,speed:at}=rI(mt,Qe,Ce,o,te);for(const It of["x","y"])q[It][it[It]]||(at[It]=0,it[It]=0);if(at.x>0||at.y>0){ye(),Ie.current=mt,Se(Le,w),fe.current=at,Fe.current=it;return}}fe.current={x:0,y:0},Fe.current={x:0,y:0},ye()},[o,Le,m,ye,P,w,JSON.stringify(Ce),JSON.stringify(q),Se,B,Xe,V,JSON.stringify(te)])}const gI={x:{[cs.Backward]:!1,[cs.Forward]:!1},y:{[cs.Backward]:!1,[cs.Forward]:!1}};function yI(n){let{delta:o,disabled:u}=n;const m=y_(o);return wm(b=>{if(u||!m||!b)return gI;const P={x:Math.sign(o.x-m.x),y:Math.sign(o.y-m.y)};return{x:{[cs.Backward]:b.x[cs.Backward]||P.x===-1,[cs.Forward]:b.x[cs.Forward]||P.x===1},y:{[cs.Backward]:b.y[cs.Backward]||P.y===-1,[cs.Forward]:b.y[cs.Forward]||P.y===1}}},[u,o,m])}function _I(n,o){const u=o!=null?n.get(o):void 0,m=u?u.node.current:null;return wm(b=>{var P;return o==null?null:(P=m??b)!=null?P:null},[m,o])}function vI(n,o){return ee.useMemo(()=>n.reduce((u,m)=>{const{sensor:b}=m,P=b.activators.map(w=>({eventName:w.eventName,handler:o(w.handler,m)}));return[...u,...P]},[]),[n,o])}var om;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(om||(om={}));var b_;(function(n){n.Optimized="optimized"})(b_||(b_={}));const p0=new Map;function xI(n,o){let{dragging:u,dependencies:m,config:b}=o;const[P,w]=ee.useState(null),{frequency:l,measure:L,strategy:B}=b,V=ee.useRef(n),G=fe(),te=im(G),q=ee.useCallback(function(Fe){Fe===void 0&&(Fe=[]),!te.current&&w(Ce=>Ce===null?Fe:Ce.concat(Fe.filter(Ie=>!Ce.includes(Ie))))},[te]),Se=ee.useRef(null),ye=wm(Fe=>{if(G&&!u)return p0;if(!Fe||Fe===p0||V.current!==n||P!=null){const Ce=new Map;for(let Ie of n){if(!Ie)continue;if(P&&P.length>0&&!P.includes(Ie.id)&&Ie.rect.current){Ce.set(Ie.id,Ie.rect.current);continue}const Le=Ie.node.current,Xe=Le?new cv(L(Le),Le):null;Ie.rect.current=Xe,Xe&&Ce.set(Ie.id,Xe)}return Ce}return Fe},[n,P,u,G,L]);return ee.useEffect(()=>{V.current=n},[n]),ee.useEffect(()=>{G||q()},[u,G]),ee.useEffect(()=>{P&&P.length>0&&w(null)},[JSON.stringify(P)]),ee.useEffect(()=>{G||typeof l!="number"||Se.current!==null||(Se.current=setTimeout(()=>{q(),Se.current=null},l))},[l,G,q,...m]),{droppableRects:ye,measureDroppableContainers:q,measuringScheduled:P!=null};function fe(){switch(B){case om.Always:return!1;case om.BeforeDragging:return u;default:return!u}}}function E1(n,o){return wm(u=>n?u||(typeof o=="function"?o(n):n):null,[o,n])}function bI(n,o){return E1(n,o)}function wI(n){let{callback:o,disabled:u}=n;const m=ov(o),b=ee.useMemo(()=>{if(u||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:P}=window;return new P(m)},[m,u]);return ee.useEffect(()=>()=>b==null?void 0:b.disconnect(),[b]),b}function ey(n){let{callback:o,disabled:u}=n;const m=ov(o),b=ee.useMemo(()=>{if(u||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:P}=window;return new P(m)},[u]);return ee.useEffect(()=>()=>b==null?void 0:b.disconnect(),[b]),b}function SI(n){return new cv(Xf(n),n)}function m0(n,o,u){o===void 0&&(o=SI);const[m,b]=ee.useState(null);function P(){b(L=>{if(!n)return null;if(n.isConnected===!1){var B;return(B=L??u)!=null?B:null}const V=o(n);return JSON.stringify(L)===JSON.stringify(V)?L:V})}const w=wI({callback(L){if(n)for(const B of L){const{type:V,target:G}=B;if(V==="childList"&&G instanceof HTMLElement&&G.contains(n)){P();break}}}}),l=ey({callback:P});return ac(()=>{P(),n?(l==null||l.observe(n),w==null||w.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),w==null||w.disconnect())},[n]),m}function TI(n){const o=E1(n);return _1(n,o)}const g0=[];function PI(n){const o=ee.useRef(n),u=wm(m=>n?m&&m!==g0&&n&&o.current&&n.parentNode===o.current.parentNode?m:lv(n):g0,[n]);return ee.useEffect(()=>{o.current=n},[n]),u}function CI(n){const[o,u]=ee.useState(null),m=ee.useRef(n),b=ee.useCallback(P=>{const w=Fy(P.target);w&&u(l=>l?(l.set(w,v_(w)),new Map(l)):null)},[]);return ee.useEffect(()=>{const P=m.current;if(n!==P){w(P);const l=n.map(L=>{const B=Fy(L);return B?(B.addEventListener("scroll",b,{passive:!0}),[B,v_(B)]):null}).filter(L=>L!=null);u(l.length?new Map(l):null),m.current=n}return()=>{w(n),w(P)};function w(l){l.forEach(L=>{const B=Fy(L);B==null||B.removeEventListener("scroll",b)})}},[b,n]),ee.useMemo(()=>n.length?o?Array.from(o.values()).reduce((P,w)=>Ef(P,w),gl):T1(n):gl,[n,o])}function y0(n,o){o===void 0&&(o=[]);const u=ee.useRef(null);return ee.useEffect(()=>{u.current=null},o),ee.useEffect(()=>{const m=n!==gl;m&&!u.current&&(u.current=n),!m&&u.current&&(u.current=null)},[n]),u.current?Lg(n,u.current):gl}function EI(n){ee.useEffect(()=>{if(!Jg)return;const o=n.map(u=>{let{sensor:m}=u;return m.setup==null?void 0:m.setup()});return()=>{for(const u of o)u==null||u()}},n.map(o=>{let{sensor:u}=o;return u}))}function kI(n,o){return ee.useMemo(()=>n.reduce((u,m)=>{let{eventName:b,handler:P}=m;return u[b]=w=>{P(w,o)},u},{}),[n,o])}function k1(n){return ee.useMemo(()=>n?QM(n):null,[n])}const _0=[];function MI(n,o){o===void 0&&(o=Xf);const[u]=n,m=k1(u?Mo(u):null),[b,P]=ee.useState(_0);function w(){P(()=>n.length?n.map(L=>w1(L)?m:new cv(o(L),L)):_0)}const l=ey({callback:w});return ac(()=>{l==null||l.disconnect(),w(),n.forEach(L=>l==null?void 0:l.observe(L))},[n]),b}function II(n){if(!n)return null;if(n.children.length>1)return n;const o=n.children[0];return bm(o)?o:n}function AI(n){let{measure:o}=n;const[u,m]=ee.useState(null),b=ee.useCallback(B=>{for(const{target:V}of B)if(bm(V)){m(G=>{const te=o(V);return G?{...G,width:te.width,height:te.height}:te});break}},[o]),P=ey({callback:b}),w=ee.useCallback(B=>{const V=II(B);P==null||P.disconnect(),V&&(P==null||P.observe(V)),m(V?o(V):null)},[o,P]),[l,L]=Dg(w);return ee.useMemo(()=>({nodeRef:l,rect:u,setRef:L}),[u,l,L])}const zI=[{sensor:hv,options:{}},{sensor:C1,options:{}}],RI={current:{}},Tg={draggable:{measure:u0},droppable:{measure:u0,strategy:om.WhileDragging,frequency:b_.Optimized},dragOverlay:{measure:Xf}};class Yp extends Map{get(o){var u;return o!=null&&(u=super.get(o))!=null?u:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(o=>{let{disabled:u}=o;return!u})}getNodeFor(o){var u,m;return(u=(m=this.get(o))==null?void 0:m.node.current)!=null?u:void 0}}const DI={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Yp,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Fg},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Tg,measureDroppableContainers:Fg,windowRect:null,measuringScheduled:!1},LI={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Fg,draggableNodes:new Map,over:null,measureDroppableContainers:Fg},ty=ee.createContext(LI),M1=ee.createContext(DI);function FI(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Yp}}}function OI(n,o){switch(o.type){case Wi.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:o.initialCoordinates,active:o.active}};case Wi.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:o.coordinates.x-n.draggable.initialCoordinates.x,y:o.coordinates.y-n.draggable.initialCoordinates.y}}};case Wi.DragEnd:case Wi.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Wi.RegisterDroppable:{const{element:u}=o,{id:m}=u,b=new Yp(n.droppable.containers);return b.set(m,u),{...n,droppable:{...n.droppable,containers:b}}}case Wi.SetDroppableDisabled:{const{id:u,key:m,disabled:b}=o,P=n.droppable.containers.get(u);if(!P||m!==P.key)return n;const w=new Yp(n.droppable.containers);return w.set(u,{...P,disabled:b}),{...n,droppable:{...n.droppable,containers:w}}}case Wi.UnregisterDroppable:{const{id:u,key:m}=o,b=n.droppable.containers.get(u);if(!b||m!==b.key)return n;const P=new Yp(n.droppable.containers);return P.delete(u),{...n,droppable:{...n.droppable,containers:P}}}default:return n}}function jI(n){let{disabled:o}=n;const{active:u,activatorEvent:m,draggableNodes:b}=ee.useContext(ty),P=y_(m),w=y_(u==null?void 0:u.id);return ee.useEffect(()=>{if(!o&&!m&&P&&w!=null){if(!av(P)||document.activeElement===P.target)return;const l=b.get(w);if(!l)return;const{activatorNode:L,node:B}=l;if(!L.current&&!B.current)return;requestAnimationFrame(()=>{for(const V of[L.current,B.current]){if(!V)continue;const G=EM(V);if(G){G.focus();break}}})}},[m,o,b,w,P]),null}function NI(n,o){let{transform:u,...m}=o;return n!=null&&n.length?n.reduce((b,P)=>P({transform:b,...m}),u):u}function BI(n){return ee.useMemo(()=>({draggable:{...Tg.draggable,...n==null?void 0:n.draggable},droppable:{...Tg.droppable,...n==null?void 0:n.droppable},dragOverlay:{...Tg.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function $I(n){let{activeNode:o,measure:u,initialRect:m,config:b=!0}=n;const P=ee.useRef(!1),{x:w,y:l}=typeof b=="boolean"?{x:b,y:b}:b;ac(()=>{if(!w&&!l||!o){P.current=!1;return}if(P.current||!m)return;const B=o==null?void 0:o.node.current;if(!B||B.isConnected===!1)return;const V=u(B),G=_1(V,m);if(w||(G.x=0),l||(G.y=0),P.current=!0,Math.abs(G.x)>0||Math.abs(G.y)>0){const te=v1(B);te&&te.scrollBy({top:G.y,left:G.x})}},[o,w,l,m,u])}const I1=ee.createContext({...gl,scaleX:1,scaleY:1});var Ju;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ju||(Ju={}));const UI=ee.memo(function(o){var u,m,b,P;let{id:w,accessibility:l,autoScroll:L=!0,children:B,sensors:V=zI,collisionDetection:G=GM,measuring:te,modifiers:q,...Se}=o;const ye=ee.useReducer(OI,void 0,FI),[fe,Fe]=ye,[Ce,Ie]=RM(),[Le,Xe]=ee.useState(Ju.Uninitialized),mt=Le===Ju.Initialized,{draggable:{active:yt,nodes:Qe,translate:it},droppable:{containers:at}}=fe,It=yt!=null?Qe.get(yt):null,Rt=ee.useRef({initial:null,translated:null}),At=ee.useMemo(()=>{var Pe;return yt!=null?{id:yt,data:(Pe=It==null?void 0:It.data)!=null?Pe:RI,rect:Rt}:null},[yt,It]),Ht=ee.useRef(null),[Rr,ar]=ee.useState(null),[Zt,_t]=ee.useState(null),ht=im(Se,Object.values(Se)),Ct=Sm("DndDescribedBy",w),Me=ee.useMemo(()=>at.getEnabled(),[at]),Ye=BI(te),{droppableRects:jt,measureDroppableContainers:tr,measuringScheduled:fr}=xI(Me,{dragging:mt,dependencies:[it.x,it.y],config:Ye.droppable}),Kt=_I(Qe,yt),Lr=ee.useMemo(()=>Zt?__(Zt):null,[Zt]),sr=zt(),yr=bI(Kt,Ye.draggable.measure);$I({activeNode:yt!=null?Qe.get(yt):null,config:sr.layoutShiftCompensation,initialRect:yr,measure:Ye.draggable.measure});const lr=m0(Kt,Ye.draggable.measure,yr),ci=m0(Kt?Kt.parentElement:null),ln=ee.useRef({activatorEvent:null,active:null,activeNode:Kt,collisionRect:null,collisions:null,droppableRects:jt,draggableNodes:Qe,draggingNode:null,draggingNodeRect:null,droppableContainers:at,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Vr=at.getNodeFor((u=ln.current.over)==null?void 0:u.id),Nr=AI({measure:Ye.dragOverlay.measure}),Cn=(m=Nr.nodeRef.current)!=null?m:Kt,jn=mt?(b=Nr.rect)!=null?b:lr:null,Xi=!!(Nr.nodeRef.current&&Nr.rect),zi=TI(Xi?null:lr),Zn=k1(Cn?Mo(Cn):null),xe=PI(mt?Vr??Kt:null),Be=MI(xe),Ke=NI(q,{transform:{x:it.x-zi.x,y:it.y-zi.y,scaleX:1,scaleY:1},activatorEvent:Zt,active:At,activeNodeRect:lr,containerNodeRect:ci,draggingNodeRect:jn,over:ln.current.over,overlayNodeRect:Nr.rect,scrollableAncestors:xe,scrollableAncestorRects:Be,windowRect:Zn}),kt=Lr?Ef(Lr,it):null,vt=CI(xe),pt=y0(vt),Bt=y0(vt,[lr]),_r=Ef(Ke,pt),Sr=jn?HM(jn,Ke):null,Te=At&&Sr?G({active:At,collisionRect:Sr,droppableRects:jt,droppableContainers:Me,pointerCoordinates:kt}):null,K=UM(Te,"id"),[X,ne]=ee.useState(null),ue=Xi?Ke:Ef(Ke,Bt),ve=qM(ue,(P=X==null?void 0:X.rect)!=null?P:null,lr),Ae=ee.useRef(null),Oe=ee.useCallback((Pe,$t)=>{let{sensor:rr,options:Dt}=$t;if(Ht.current==null)return;const Xt=Qe.get(Ht.current);if(!Xt)return;const Cr=Pe.nativeEvent,Kr=new rr({active:Ht.current,activeNode:Xt,event:Cr,options:Dt,context:ln,onAbort(Tr){if(!Qe.get(Tr))return;const{onDragAbort:or}=ht.current,en={id:Tr};or==null||or(en),Ce({type:"onDragAbort",event:en})},onPending(Tr,cr,or,en){if(!Qe.get(Tr))return;const{onDragPending:_n}=ht.current,$r={id:Tr,constraint:cr,initialCoordinates:or,offset:en};_n==null||_n($r),Ce({type:"onDragPending",event:$r})},onStart(Tr){const cr=Ht.current;if(cr==null)return;const or=Qe.get(cr);if(!or)return;const{onDragStart:en}=ht.current,st={activatorEvent:Cr,active:{id:cr,data:or.data,rect:Rt}};Zp.unstable_batchedUpdates(()=>{en==null||en(st),Xe(Ju.Initializing),Fe({type:Wi.DragStart,initialCoordinates:Tr,active:cr}),Ce({type:"onDragStart",event:st}),ar(Ae.current),_t(Cr)})},onMove(Tr){Fe({type:Wi.DragMove,coordinates:Tr})},onEnd:dn(Wi.DragEnd),onCancel:dn(Wi.DragCancel)});Ae.current=Kr;function dn(Tr){return async function(){const{active:or,collisions:en,over:st,scrollAdjustedTranslate:_n}=ln.current;let $r=null;if(or&&_n){const{cancelDrop:vi}=ht.current;$r={activatorEvent:Cr,active:or,collisions:en,delta:_n,over:st},Tr===Wi.DragEnd&&typeof vi=="function"&&await Promise.resolve(vi($r))&&(Tr=Wi.DragCancel)}Ht.current=null,Zp.unstable_batchedUpdates(()=>{Fe({type:Tr}),Xe(Ju.Uninitialized),ne(null),ar(null),_t(null),Ae.current=null;const vi=Tr===Wi.DragEnd?"onDragEnd":"onDragCancel";if($r){const ao=ht.current[vi];ao==null||ao($r),Ce({type:vi,event:$r})}})}}},[Qe]),ze=ee.useCallback((Pe,$t)=>(rr,Dt)=>{const Xt=rr.nativeEvent,Cr=Qe.get(Dt);if(Ht.current!==null||!Cr||Xt.dndKit||Xt.defaultPrevented)return;const Kr={active:Cr};Pe(rr,$t.options,Kr)===!0&&(Xt.dndKit={capturedBy:$t.sensor},Ht.current=Dt,Oe(rr,$t))},[Qe,Oe]),qe=vI(V,ze);EI(V),ac(()=>{lr&&Le===Ju.Initializing&&Xe(Ju.Initialized)},[lr,Le]),ee.useEffect(()=>{const{onDragMove:Pe}=ht.current,{active:$t,activatorEvent:rr,collisions:Dt,over:Xt}=ln.current;if(!$t||!rr)return;const Cr={active:$t,activatorEvent:rr,collisions:Dt,delta:{x:_r.x,y:_r.y},over:Xt};Zp.unstable_batchedUpdates(()=>{Pe==null||Pe(Cr),Ce({type:"onDragMove",event:Cr})})},[_r.x,_r.y]),ee.useEffect(()=>{const{active:Pe,activatorEvent:$t,collisions:rr,droppableContainers:Dt,scrollAdjustedTranslate:Xt}=ln.current;if(!Pe||Ht.current==null||!$t||!Xt)return;const{onDragOver:Cr}=ht.current,Kr=Dt.get(K),dn=Kr&&Kr.rect.current?{id:Kr.id,rect:Kr.rect.current,data:Kr.data,disabled:Kr.disabled}:null,Tr={active:Pe,activatorEvent:$t,collisions:rr,delta:{x:Xt.x,y:Xt.y},over:dn};Zp.unstable_batchedUpdates(()=>{ne(dn),Cr==null||Cr(Tr),Ce({type:"onDragOver",event:Tr})})},[K]),ac(()=>{ln.current={activatorEvent:Zt,active:At,activeNode:Kt,collisionRect:Sr,collisions:Te,droppableRects:jt,draggableNodes:Qe,draggingNode:Cn,draggingNodeRect:jn,droppableContainers:at,over:X,scrollableAncestors:xe,scrollAdjustedTranslate:_r},Rt.current={initial:jn,translated:Sr}},[At,Kt,Te,Sr,Qe,Cn,jn,jt,at,X,xe,_r]),mI({...sr,delta:it,draggingRect:Sr,pointerCoordinates:kt,scrollableAncestors:xe,scrollableAncestorRects:Be});const rt=ee.useMemo(()=>({active:At,activeNode:Kt,activeNodeRect:lr,activatorEvent:Zt,collisions:Te,containerNodeRect:ci,dragOverlay:Nr,draggableNodes:Qe,droppableContainers:at,droppableRects:jt,over:X,measureDroppableContainers:tr,scrollableAncestors:xe,scrollableAncestorRects:Be,measuringConfiguration:Ye,measuringScheduled:fr,windowRect:Zn}),[At,Kt,lr,Zt,Te,ci,Nr,Qe,at,jt,X,tr,xe,Be,Ye,fr,Zn]),Je=ee.useMemo(()=>({activatorEvent:Zt,activators:qe,active:At,activeNodeRect:lr,ariaDescribedById:{draggable:Ct},dispatch:Fe,draggableNodes:Qe,over:X,measureDroppableContainers:tr}),[Zt,qe,At,lr,Fe,Ct,Qe,X,tr]);return hn.createElement(y1.Provider,{value:Ie},hn.createElement(ty.Provider,{value:Je},hn.createElement(M1.Provider,{value:rt},hn.createElement(I1.Provider,{value:ve},B)),hn.createElement(jI,{disabled:(l==null?void 0:l.restoreFocus)===!1})),hn.createElement(FM,{...l,hiddenTextDescribedById:Ct}));function zt(){const Pe=(Rr==null?void 0:Rr.autoScrollEnabled)===!1,$t=typeof L=="object"?L.enabled===!1:L===!1,rr=mt&&!Pe&&!$t;return typeof L=="object"?{...L,enabled:rr}:{enabled:rr}}}),VI=ee.createContext(null),v0="button",ZI="Draggable";function GI(n){let{id:o,data:u,disabled:m=!1,attributes:b}=n;const P=Sm(ZI),{activators:w,activatorEvent:l,active:L,activeNodeRect:B,ariaDescribedById:V,draggableNodes:G,over:te}=ee.useContext(ty),{role:q=v0,roleDescription:Se="draggable",tabIndex:ye=0}=b??{},fe=(L==null?void 0:L.id)===o,Fe=ee.useContext(fe?I1:VI),[Ce,Ie]=Dg(),[Le,Xe]=Dg(),mt=kI(w,o),yt=im(u);ac(()=>(G.set(o,{id:o,key:P,node:Ce,activatorNode:Le,data:yt}),()=>{const it=G.get(o);it&&it.key===P&&G.delete(o)}),[G,o]);const Qe=ee.useMemo(()=>({role:q,tabIndex:ye,"aria-disabled":m,"aria-pressed":fe&&q===v0?!0:void 0,"aria-roledescription":Se,"aria-describedby":V.draggable}),[m,q,ye,fe,Se,V.draggable]);return{active:L,activatorEvent:l,activeNodeRect:B,attributes:Qe,isDragging:fe,listeners:m?void 0:mt,node:Ce,over:te,setNodeRef:Ie,setActivatorNodeRef:Xe,transform:Fe}}function qI(){return ee.useContext(M1)}const WI="Droppable",HI={timeout:25};function KI(n){let{data:o,disabled:u=!1,id:m,resizeObserverConfig:b}=n;const P=Sm(WI),{active:w,dispatch:l,over:L,measureDroppableContainers:B}=ee.useContext(ty),V=ee.useRef({disabled:u}),G=ee.useRef(!1),te=ee.useRef(null),q=ee.useRef(null),{disabled:Se,updateMeasurementsFor:ye,timeout:fe}={...HI,...b},Fe=im(ye??m),Ce=ee.useCallback(()=>{if(!G.current){G.current=!0;return}q.current!=null&&clearTimeout(q.current),q.current=setTimeout(()=>{B(Array.isArray(Fe.current)?Fe.current:[Fe.current]),q.current=null},fe)},[fe]),Ie=ey({callback:Ce,disabled:Se||!w}),Le=ee.useCallback((Qe,it)=>{Ie&&(it&&(Ie.unobserve(it),G.current=!1),Qe&&Ie.observe(Qe))},[Ie]),[Xe,mt]=Dg(Le),yt=im(o);return ee.useEffect(()=>{!Ie||!Xe.current||(Ie.disconnect(),G.current=!1,Ie.observe(Xe.current))},[Xe,Ie]),ee.useEffect(()=>(l({type:Wi.RegisterDroppable,element:{id:m,key:P,disabled:u,node:Xe,rect:te,data:yt}}),()=>l({type:Wi.UnregisterDroppable,key:P,id:m})),[m]),ee.useEffect(()=>{u!==V.current.disabled&&(l({type:Wi.SetDroppableDisabled,id:m,key:P,disabled:u}),V.current.disabled=u)},[m,P,u,l]),{active:w,rect:te,isOver:(L==null?void 0:L.id)===m,node:Xe,over:L,setNodeRef:mt}}function dv(n,o,u){const m=n.slice();return m.splice(u<0?m.length+u:u,0,m.splice(o,1)[0]),m}function XI(n,o){return n.reduce((u,m,b)=>{const P=o.get(m);return P&&(u[b]=P),u},Array(n.length))}function yg(n){return n!==null&&n>=0}function YI(n,o){if(n===o)return!0;if(n.length!==o.length)return!1;for(let u=0;u<n.length;u++)if(n[u]!==o[u])return!1;return!0}function QI(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const fv=n=>{let{rects:o,activeIndex:u,overIndex:m,index:b}=n;const P=dv(o,m,u),w=o[b],l=P[b];return!l||!w?null:{x:l.left-w.left,y:l.top-w.top,scaleX:l.width/w.width,scaleY:l.height/w.height}},A1="Sortable",z1=hn.createContext({activeIndex:-1,containerId:A1,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:fv,disabled:{draggable:!1,droppable:!1}});function JI(n){let{children:o,id:u,items:m,strategy:b=fv,disabled:P=!1}=n;const{active:w,dragOverlay:l,droppableRects:L,over:B,measureDroppableContainers:V}=qI(),G=Sm(A1,u),te=l.rect!==null,q=ee.useMemo(()=>m.map(mt=>typeof mt=="object"&&"id"in mt?mt.id:mt),[m]),Se=w!=null,ye=w?q.indexOf(w.id):-1,fe=B?q.indexOf(B.id):-1,Fe=ee.useRef(q),Ce=!YI(q,Fe.current),Ie=fe!==-1&&ye===-1||Ce,Le=QI(P);ac(()=>{Ce&&Se&&V(q)},[Ce,q,Se,V]),ee.useEffect(()=>{Fe.current=q},[q]);const Xe=ee.useMemo(()=>({activeIndex:ye,containerId:G,disabled:Le,disableTransforms:Ie,items:q,overIndex:fe,useDragOverlay:te,sortedRects:XI(q,L),strategy:b}),[ye,G,Le.draggable,Le.droppable,Ie,q,fe,L,te,b]);return hn.createElement(z1.Provider,{value:Xe},o)}const eA=n=>{let{id:o,items:u,activeIndex:m,overIndex:b}=n;return dv(u,m,b).indexOf(o)},tA=n=>{let{containerId:o,isSorting:u,wasDragging:m,index:b,items:P,newIndex:w,previousItems:l,previousContainerId:L,transition:B}=n;return!B||!m||l!==P&&b===w?!1:u?!0:w!==b&&o===L},rA={duration:200,easing:"ease"},R1="transform",nA=sm.Transition.toString({property:R1,duration:0,easing:"linear"}),iA={roleDescription:"sortable"};function sA(n){let{disabled:o,index:u,node:m,rect:b}=n;const[P,w]=ee.useState(null),l=ee.useRef(u);return ac(()=>{if(!o&&u!==l.current&&m.current){const L=b.current;if(L){const B=Xf(m.current,{ignoreTransform:!0}),V={x:L.left-B.left,y:L.top-B.top,scaleX:L.width/B.width,scaleY:L.height/B.height};(V.x||V.y)&&w(V)}}u!==l.current&&(l.current=u)},[o,u,m,b]),ee.useEffect(()=>{P&&w(null)},[P]),P}function oA(n){let{animateLayoutChanges:o=tA,attributes:u,disabled:m,data:b,getNewIndex:P=eA,id:w,strategy:l,resizeObserverConfig:L,transition:B=rA}=n;const{items:V,containerId:G,activeIndex:te,disabled:q,disableTransforms:Se,sortedRects:ye,overIndex:fe,useDragOverlay:Fe,strategy:Ce}=ee.useContext(z1),Ie=aA(m,q),Le=V.indexOf(w),Xe=ee.useMemo(()=>({sortable:{containerId:G,index:Le,items:V},...b}),[G,b,Le,V]),mt=ee.useMemo(()=>V.slice(V.indexOf(w)),[V,w]),{rect:yt,node:Qe,isOver:it,setNodeRef:at}=KI({id:w,data:Xe,disabled:Ie.droppable,resizeObserverConfig:{updateMeasurementsFor:mt,...L}}),{active:It,activatorEvent:Rt,activeNodeRect:At,attributes:Ht,setNodeRef:Rr,listeners:ar,isDragging:Zt,over:_t,setActivatorNodeRef:ht,transform:Ct}=GI({id:w,data:Xe,attributes:{...iA,...u},disabled:Ie.draggable}),Me=SM(at,Rr),Ye=!!It,jt=Ye&&!Se&&yg(te)&&yg(fe),tr=!Fe&&Zt,fr=tr&&jt?Ct:null,Lr=jt?fr??(l??Ce)({rects:ye,activeNodeRect:At,activeIndex:te,overIndex:fe,index:Le}):null,sr=yg(te)&&yg(fe)?P({id:w,items:V,activeIndex:te,overIndex:fe}):Le,yr=It==null?void 0:It.id,lr=ee.useRef({activeId:yr,items:V,newIndex:sr,containerId:G}),ci=V!==lr.current.items,ln=o({active:It,containerId:G,isDragging:Zt,isSorting:Ye,id:w,index:Le,items:V,newIndex:lr.current.newIndex,previousItems:lr.current.items,previousContainerId:lr.current.containerId,transition:B,wasDragging:lr.current.activeId!=null}),Vr=sA({disabled:!ln,index:Le,node:Qe,rect:yt});return ee.useEffect(()=>{Ye&&lr.current.newIndex!==sr&&(lr.current.newIndex=sr),G!==lr.current.containerId&&(lr.current.containerId=G),V!==lr.current.items&&(lr.current.items=V)},[Ye,sr,G,V]),ee.useEffect(()=>{if(yr===lr.current.activeId)return;if(yr!=null&&lr.current.activeId==null){lr.current.activeId=yr;return}const Cn=setTimeout(()=>{lr.current.activeId=yr},50);return()=>clearTimeout(Cn)},[yr]),{active:It,activeIndex:te,attributes:Ht,data:Xe,rect:yt,index:Le,newIndex:sr,items:V,isOver:it,isSorting:Ye,isDragging:Zt,listeners:ar,node:Qe,overIndex:fe,over:_t,setNodeRef:Me,setActivatorNodeRef:ht,setDroppableNodeRef:at,setDraggableNodeRef:Rr,transform:Vr??Lr,transition:Nr()};function Nr(){if(Vr||ci&&lr.current.newIndex===Le)return nA;if(!(tr&&!av(Rt)||!B)&&(Ye||ln))return sm.Transition.toString({...B,property:R1})}}function aA(n,o){var u,m;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(u=n==null?void 0:n.draggable)!=null?u:o.draggable,droppable:(m=n==null?void 0:n.droppable)!=null?m:o.droppable}}mn.Down,mn.Right,mn.Up,mn.Left;function lA({id:n,name:o,muni:u,classificationText:m,classificationClass:b,onRemove:P,disabled:w}){const{attributes:l,listeners:L,setNodeRef:B,transform:V,transition:G,isDragging:te}=oA({id:n,disabled:w}),q={transform:sm.Transform.toString(V),transition:G,opacity:te?.85:1};return J.jsxs("li",{ref:B,style:q,className:"w-full card p-4 flex items-start justify-between gap-4",children:[J.jsxs("div",{className:"min-w-0 flex-1",children:[J.jsxs("div",{className:"flex items-center gap-2",children:[!w&&J.jsx("button",{"aria-label":"Drag to reorder",className:"shrink-0 w-6 h-6 grid place-items-center cursor-grab active:cursor-grabbing rounded hover:bg-surface-muted",...l,...L,children:J.jsxs("span",{className:"grid grid-cols-2 gap-0.5","aria-hidden":!0,children:[J.jsx("span",{className:"w-1.5 h-1.5 bg-ink/60 rounded-sm"}),J.jsx("span",{className:"w-1.5 h-1.5 bg-ink/60 rounded-sm"}),J.jsx("span",{className:"w-1.5 h-1.5 bg-ink/60 rounded-sm"}),J.jsx("span",{className:"w-1.5 h-1.5 bg-ink/60 rounded-sm"})]})}),J.jsx(li,{to:`/beach/${n}`,className:"font-medium hover:underline block truncate max-w-[200px] sm:max-w-none",title:o,children:o})]}),J.jsx("div",{className:"text-sm text-ink-muted truncate",children:u||"—"}),J.jsx("div",{className:"mt-1",children:J.jsx("span",{className:`badge ${b}`,children:m})})]}),J.jsxs("div",{className:"flex items-center gap-2 shrink-0 flex-wrap justify-end",children:[J.jsx(li,{to:`/beach/${n}`,className:"px-3 py-1.5 rounded-lg border border-border hover:bg-surface-muted text-sm",children:"View"}),J.jsx("button",{className:"px-3 py-1.5 rounded-lg border border-border hover:bg-surface-muted text-sm",onClick:P,"aria-label":`Remove ${o} from favorites`,children:"Remove"})]})]})}function cA(n){if(typeof n=="number")return["kpi-excellent","kpi-good","kpi-sufficient","kpi-poor"][n-1]??"kpi-unknown";const o=String(n??"").toLowerCase();return o.includes("utmärkt")?"kpi-excellent":o.includes("bra")?"kpi-good":o.includes("tillfreds")||o.includes("sufficient")?"kpi-sufficient":o.includes("dålig")||o.includes("poor")?"kpi-poor":"kpi-unknown"}const x0="favoritesSort",b0="favoritesOrder:v1";function uA(){const{data:n,isLoading:o,isError:u,error:m}=Bb(),b=n==null?void 0:n.map(fe=>fe.beachId),P=wM(b),w=$b(),l=qT(),[L,B]=ee.useState(()=>localStorage.getItem(x0)??"name");ee.useEffect(()=>{localStorage.setItem(x0,L)},[L]);const[V,G]=ee.useState(()=>{try{const fe=localStorage.getItem(b0);return fe?JSON.parse(fe):[]}catch{return[]}});ee.useEffect(()=>{if(!n)return;const fe=n.map(Le=>Le.beachId),Fe=new Set(V),Ie=[...V,...fe.filter(Le=>!Fe.has(Le))].filter(Le=>fe.includes(Le));JSON.stringify(Ie)!==JSON.stringify(V)&&G(Ie)},[n]),ee.useEffect(()=>{localStorage.setItem(b0,JSON.stringify(V))},[V]);const te=ee.useMemo(()=>{const fe=new Map;if(!n)return fe;for(const Fe of n){const Ce=P.byId.get(Fe.beachId);fe.set(Fe.beachId,{fav:Fe,name:(Ce==null?void 0:Ce.locationName)??Fe.beachId,muni:(Ce==null?void 0:Ce.locationArea)??"",classification:(Ce==null?void 0:Ce.classification)??(Ce==null?void 0:Ce.classificationText),classificationText:(Ce==null?void 0:Ce.classificationText)??"Unknown"})}return fe},[n,P.byId]),q=ee.useMemo(()=>{if(!n)return[];const fe=n.map(Ie=>Ie.beachId);if(L==="custom"&&V.length)return V.filter(Ie=>fe.includes(Ie));const Fe=fe.slice(),Ce=new Intl.Collator(void 0,{sensitivity:"base"});return Fe.sort((Ie,Le)=>{const Xe=te.get(Ie),mt=te.get(Le);return!Xe||!mt?0:L==="name"?Ce.compare(Xe.name,mt.name):Ce.compare(Xe.muni,mt.muni)}),Fe},[n,L,V,te]),Se=jM(OM(hv,{activationConstraint:{distance:5}}));function ye(fe){if(L!=="custom")return;const{active:Fe,over:Ce}=fe;if(!Ce||Fe.id===Ce.id)return;const Ie=V.indexOf(String(Fe.id)),Le=V.indexOf(String(Ce.id));if(Ie===-1||Le===-1)return;const Xe=dv(V,Ie,Le);G(Xe),l.mutate(Xe,{onError:()=>{G(V)}})}return o?J.jsxs("main",{className:"max-w-screen-lg mx-auto p-6",children:[J.jsx("h1",{className:"font-spectral text-2xl mb-4",children:"Your favorite beaches"}),J.jsx("div",{className:"space-y-3",children:[...Array(3)].map((fe,Fe)=>J.jsxs("div",{className:"card p-4 animate-pulse",children:[J.jsx("div",{className:"h-5 w-1/2 bg-surface-muted rounded mb-2"}),J.jsx("div",{className:"h-4 w-1/3 bg-surface-muted rounded"})]},Fe))})]}):u?J.jsxs("main",{className:"max-w-screen-lg mx-auto p-6",children:[J.jsx("h1",{className:"font-spectral text-2xl mb-4",children:"Your favorite beaches"}),J.jsx("p",{className:"text-red-600",children:(m==null?void 0:m.message)??"Could not load favorites"})]}):J.jsxs("main",{className:"max-w-screen-lg mx-auto p-6 space-y-6",children:[J.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between sm:gap-4",children:[J.jsx("h1",{className:"font-spectral text-2xl",children:"Your favorite beaches"}),J.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[J.jsxs("label",{className:"text-sm",children:["Sort by:"," ",J.jsxs("select",{value:L,onChange:fe=>B(fe.target.value),className:"ml-1 border rounded px-2 py-1 text-sm","aria-label":"Sort favorites",children:[J.jsx("option",{value:"custom",children:"Custom (drag & drop)"}),J.jsx("option",{value:"name",children:"Name (A–Z)"}),J.jsx("option",{value:"municipality",children:"Municipality (A–Z)"})]})]}),J.jsx(li,{to:"/",className:"underline text-accent block",children:"Browse all beaches"})]})]}),n&&n.length===0&&J.jsxs("div",{className:"card p-6",children:[J.jsx("h2",{className:"font-spectral text-lg mb-1",children:"No favorites yet"}),J.jsx("p",{className:"text-sm text-ink-muted mb-3",children:"Browse the map and tap “Save as favorite” on a beach you like."}),J.jsx(li,{to:"/",className:"inline-block px-3 py-2 rounded-2xl border border-border hover:bg-surface-muted",children:"Go to map"})]}),J.jsx(UI,{sensors:Se,collisionDetection:VM,onDragEnd:ye,children:J.jsx(JI,{items:q,strategy:fv,children:J.jsx("ul",{className:"grid gap-3 list-none sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4",children:q.map(fe=>{const Fe=te.get(fe);if(!Fe)return null;const{fav:Ce,name:Ie,muni:Le,classification:Xe,classificationText:mt}=Fe,yt=cA(Xe??mt);return J.jsx(lA,{id:fe,name:Ie,muni:Le,classificationText:mt,classificationClass:yt,disabled:L!=="custom",onRemove:()=>w.mutateAsync({id:Ce._id,beachId:Ce.beachId}).then(()=>{G(Qe=>Qe.filter(it=>it!==fe))})},Ce._id)})})})})]})}function hA(){return J.jsxs("main",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-3xl",children:"About BADA"}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"What is BADA?"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"BADA helps beachgoers and families in Sweden find safe, EU-classified bathing waters with real-time quality updates. We replace outdated or clunky websites with a clean, mobile-friendly experience."}),J.jsx("p",{className:"text-ink leading-relaxed",children:"Our mission is to make water quality information accessible to everyone, helping you make informed decisions about where to swim and enjoy Sweden's beautiful coastal waters."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Data Source"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"BADA uses official data from the Swedish Agency for Marine and Water Management (Havs- och Vattenmyndigheten, HaV), which monitors and classifies EU bathing waters across Sweden."}),J.jsx("p",{className:"text-ink leading-relaxed",children:"Water quality classifications are based on the European Bathing Water Directive and are updated regularly throughout the bathing season."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Features"}),J.jsxs("ul",{className:"space-y-2 list-disc list-inside text-ink",children:[J.jsx("li",{children:"🗺️ Interactive map of all EU-classified beaches in Sweden"}),J.jsx("li",{children:"📍 Find the nearest beach based on your current location"}),J.jsx("li",{children:"🔬 View water quality, classification, and recent test results"}),J.jsx("li",{children:"❤️ Save your favorite beaches to your profile"}),J.jsx("li",{children:"🌗 Dark mode and responsive design"}),J.jsx("li",{children:"🌐 Multi-language support (Swedish / English)"})]})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Built With"}),J.jsxs("p",{className:"text-ink",children:["BADA is built with React, TypeScript, Node.js, Express, and MongoDB. Maps are powered by MapLibre and OpenStreetMap. See our"," ",J.jsx("a",{href:"https://github.com/govargas/bada",target:"_blank",rel:"noopener noreferrer",className:"text-accent underline",children:"GitHub repository"})," ","for more details."]})]}),J.jsx("div",{className:"pt-6",children:J.jsx(li,{to:"/",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"← Back to map"})})]})}function dA(){return J.jsxs("main",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-3xl",children:"What is an EU Beach?"}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"EU Bathing Water Directive"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"An EU bathing water is a beach or section of a coastline where the European Union's Bathing Water Directive (2006/7/EC) applies. This directive requires member states to monitor and regularly test the water quality at designated bathing sites."}),J.jsx("p",{className:"text-ink leading-relaxed",children:"In Sweden, the Swedish Agency for Marine and Water Management (HaV) monitors these beaches and classifies them according to water quality standards."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Water Quality Classifications"}),J.jsxs("div",{className:"space-y-3",children:[J.jsxs("div",{className:"card p-4",children:[J.jsx("div",{className:"flex items-center gap-3 mb-2",children:J.jsx("span",{className:"badge kpi-excellent",children:"Excellent"})}),J.jsx("p",{className:"text-sm text-ink-muted",children:"Best water quality. The water meets the highest standards with excellent microbiological quality."})]}),J.jsxs("div",{className:"card p-4",children:[J.jsx("div",{className:"flex items-center gap-3 mb-2",children:J.jsx("span",{className:"badge kpi-good",children:"Good"})}),J.jsx("p",{className:"text-sm text-ink-muted",children:"Good water quality. The water meets the standards with good microbiological quality."})]}),J.jsxs("div",{className:"card p-4",children:[J.jsx("div",{className:"flex items-center gap-3 mb-2",children:J.jsx("span",{className:"badge kpi-sufficient",children:"Sufficient"})}),J.jsx("p",{className:"text-sm text-ink-muted",children:"Sufficient water quality. The water meets the minimum standards."})]}),J.jsxs("div",{className:"card p-4",children:[J.jsx("div",{className:"flex items-center gap-3 mb-2",children:J.jsx("span",{className:"badge kpi-poor",children:"Poor"})}),J.jsx("p",{className:"text-sm text-ink-muted",children:"Poor water quality. Swimming is not recommended. The water does not meet the minimum standards."})]})]})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Monitoring"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"Water quality is monitored throughout the bathing season (typically May to September). Samples are taken regularly and tested for bacteria and other contaminants that could affect human health."}),J.jsx("p",{className:"text-ink leading-relaxed",children:"The classification is based on data from the last four bathing seasons to provide a stable and reliable assessment of water quality."})]}),J.jsx("div",{className:"pt-6",children:J.jsx(li,{to:"/",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"← Back to map"})})]})}function fA(){return J.jsxs("main",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-3xl",children:"Terms of Use"}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Acceptance of Terms"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"By using BADA, you agree to these terms of use. If you do not agree with any part of these terms, please do not use our service."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Service Description"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"BADA provides information about EU-classified bathing waters in Sweden. We aggregate data from official sources and present it in an accessible format."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Disclaimer"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"The water quality information provided by BADA is based on official data from the Swedish Agency for Marine and Water Management. While we strive for accuracy, we cannot guarantee the completeness or timeliness of all information."}),J.jsx("p",{className:"text-ink leading-relaxed",children:'BADA is provided "as is" without warranty of any kind. Users should exercise their own judgment and discretion when using this information to make decisions about swimming or other water activities.'})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"User Accounts"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"When you create an account, you are responsible for maintaining the confidentiality of your account information and password. You agree to notify us immediately of any unauthorized use of your account."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Intellectual Property"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"The BADA application and its original content, features, and functionality are owned by the BADA project and are protected by international copyright, trademark, and other intellectual property laws."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Changes to Terms"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"We reserve the right to modify these terms at any time. We will notify users of any significant changes by posting the new terms on this page."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Contact"}),J.jsxs("p",{className:"text-ink leading-relaxed",children:["If you have questions about these terms, please"," ",J.jsx(li,{to:"/contact",className:"text-accent underline",children:"contact us"}),"."]})]}),J.jsx("div",{className:"pt-6",children:J.jsx(li,{to:"/",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"← Back to map"})})]})}function pA(){return J.jsxs("main",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-3xl",children:"Contact Us"}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Get in Touch"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"We'd love to hear from you! Whether you have feedback, suggestions, questions, or found a bug, please don't hesitate to reach out."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"GitHub"}),J.jsxs("p",{className:"text-ink leading-relaxed",children:["For bug reports, feature requests, or code contributions, please visit our"," ",J.jsx("a",{href:"https://github.com/govargas/bada",target:"_blank",rel:"noopener noreferrer",className:"text-accent underline",children:"GitHub repository"}),"."]})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Issues & Feedback"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"If you encounter any issues with the application or have suggestions for improvement, please open an issue on GitHub. Your feedback helps us make BADA better."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Data Accuracy"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"If you notice any inaccuracies in the water quality data or beach information, please let us know. We rely on official sources, but errors can occur and we'll work to correct them promptly."})]}),J.jsxs("section",{className:"space-y-4",children:[J.jsx("h2",{className:"font-spectral text-2xl",children:"Privacy"}),J.jsx("p",{className:"text-ink leading-relaxed",children:"For questions about privacy and data handling, please see our terms of use or contact us through GitHub."})]}),J.jsx("div",{className:"pt-6",children:J.jsx(li,{to:"/",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"← Back to map"})})]})}function mA(){const{token:n,clearToken:o}=lc(),u=qf(),m=hu(),b=()=>{o(),m.clear(),u("/")};return J.jsxs("main",{className:"max-w-2xl mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-3xl",children:"Your Profile"}),J.jsxs("section",{className:"card p-6 space-y-4",children:[J.jsx("h2",{className:"font-spectral text-xl",children:"Account Information"}),J.jsx("p",{className:"text-ink-muted",children:"You are currently signed in. Your account allows you to save favorite beaches and access them from any device."})]}),J.jsxs("section",{className:"card p-6 space-y-4",children:[J.jsx("h2",{className:"font-spectral text-xl",children:"Your Favorites"}),J.jsx("p",{className:"text-ink-muted",children:"Manage your saved beaches and keep track of your favorite swimming spots."}),J.jsx(li,{to:"/favorites",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"View My Favorites"})]}),J.jsxs("section",{className:"card p-6 space-y-4",children:[J.jsx("h2",{className:"font-spectral text-xl text-red-600",children:"Sign Out"}),J.jsx("p",{className:"text-ink-muted",children:"Sign out of your account. You'll need to sign in again to access your favorites."}),J.jsx("button",{onClick:b,className:"px-4 py-2 rounded-lg border border-red-600 text-red-600 hover:bg-red-50 dark:hover:bg-red-950",children:"Sign Out"})]}),J.jsx("div",{className:"pt-6",children:J.jsx(li,{to:"/",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"← Back to map"})})]})}const gA=(n,o,u,m)=>{var P,w,l,L;const b=[u,{code:o,...m||{}}];if((w=(P=n==null?void 0:n.services)==null?void 0:P.logger)!=null&&w.forward)return n.services.logger.forward(b,"warn","react-i18next::",!0);Dd(b[0])&&(b[0]=`react-i18next:: ${b[0]}`),(L=(l=n==null?void 0:n.services)==null?void 0:l.logger)!=null&&L.warn?n.services.logger.warn(...b):console!=null&&console.warn&&console.warn(...b)},w0={},w_=(n,o,u,m)=>{Dd(u)&&w0[u]||(Dd(u)&&(w0[u]=new Date),gA(n,o,u,m))},D1=(n,o)=>()=>{if(n.isInitialized)o();else{const u=()=>{setTimeout(()=>{n.off("initialized",u)},0),o()};n.on("initialized",u)}},S_=(n,o,u)=>{n.loadNamespaces(o,D1(n,u))},S0=(n,o,u,m)=>{if(Dd(u)&&(u=[u]),n.options.preload&&n.options.preload.indexOf(o)>-1)return S_(n,u,m);u.forEach(b=>{n.options.ns.indexOf(b)<0&&n.options.ns.push(b)}),n.loadLanguages(o,D1(n,m))},yA=(n,o,u={})=>!o.languages||!o.languages.length?(w_(o,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:o.languages}),!0):o.hasLoadedNamespace(n,{lng:u.lng,precheck:(m,b)=>{if(u.bindI18n&&u.bindI18n.indexOf("languageChanging")>-1&&m.services.backendConnector.backend&&m.isLanguageChangingTo&&!b(m.isLanguageChangingTo,n))return!1}}),Dd=n=>typeof n=="string",_A=n=>typeof n=="object"&&n!==null,vA=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,xA={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},bA=n=>xA[n],wA=n=>n.replace(vA,bA);let T_={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:wA};const SA=(n={})=>{T_={...T_,...n}},TA=()=>T_;let L1;const PA=n=>{L1=n},CA=()=>L1,EA={type:"3rdParty",init(n){SA(n.options.react),PA(n)}},kA=ee.createContext();class MA{constructor(){this.usedNamespaces={}}addUsedNamespaces(o){o.forEach(u=>{this.usedNamespaces[u]||(this.usedNamespaces[u]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const IA=(n,o)=>{const u=ee.useRef();return ee.useEffect(()=>{u.current=n},[n,o]),u.current},F1=(n,o,u,m)=>n.getFixedT(o,u,m),AA=(n,o,u,m)=>ee.useCallback(F1(n,o,u,m),[n,o,u,m]),O1=(n,o={})=>{var Le,Xe,mt,yt;const{i18n:u}=o,{i18n:m,defaultNS:b}=ee.useContext(kA)||{},P=u||m||CA();if(P&&!P.reportNamespaces&&(P.reportNamespaces=new MA),!P){w_(P,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const Qe=(at,It)=>Dd(It)?It:_A(It)&&Dd(It.defaultValue)?It.defaultValue:Array.isArray(at)?at[at.length-1]:at,it=[Qe,{},!1];return it.t=Qe,it.i18n={},it.ready=!1,it}(Le=P.options.react)!=null&&Le.wait&&w_(P,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const w={...TA(),...P.options.react,...o},{useSuspense:l,keyPrefix:L}=w;let B=b||((Xe=P.options)==null?void 0:Xe.defaultNS);B=Dd(B)?[B]:B||["translation"],(yt=(mt=P.reportNamespaces).addUsedNamespaces)==null||yt.call(mt,B);const V=(P.isInitialized||P.initializedStoreOnce)&&B.every(Qe=>yA(Qe,P,w)),G=AA(P,o.lng||null,w.nsMode==="fallback"?B:B[0],L),te=()=>G,q=()=>F1(P,o.lng||null,w.nsMode==="fallback"?B:B[0],L),[Se,ye]=ee.useState(te);let fe=B.join();o.lng&&(fe=`${o.lng}${fe}`);const Fe=IA(fe),Ce=ee.useRef(!0);ee.useEffect(()=>{const{bindI18n:Qe,bindI18nStore:it}=w;Ce.current=!0,!V&&!l&&(o.lng?S0(P,o.lng,B,()=>{Ce.current&&ye(q)}):S_(P,B,()=>{Ce.current&&ye(q)})),V&&Fe&&Fe!==fe&&Ce.current&&ye(q);const at=()=>{Ce.current&&ye(q)};return Qe&&(P==null||P.on(Qe,at)),it&&(P==null||P.store.on(it,at)),()=>{Ce.current=!1,P&&Qe&&(Qe==null||Qe.split(" ").forEach(It=>P.off(It,at))),it&&P&&it.split(" ").forEach(It=>P.store.off(It,at))}},[P,fe]),ee.useEffect(()=>{Ce.current&&V&&ye(te)},[P,L,V]);const Ie=[Se,P,V];if(Ie.t=Se,Ie.i18n=P,Ie.ready=V,V||!V&&!l)return Ie;throw new Promise(Qe=>{o.lng?S0(P,o.lng,B,()=>Qe()):S_(P,B,()=>Qe())})};function zA(){const{i18n:n}=O1(),o=n.language.startsWith("en")?"en":"sv";function u(m){n.changeLanguage(m),localStorage.setItem("lang",m)}return J.jsxs("div",{className:"p-2 flex gap-2",children:[J.jsx("button",{onClick:()=>u("sv"),"aria-pressed":o==="sv",className:`px-3 py-1 rounded-lg text-sm transition-colors ${o==="sv"?"bg-accent text-white font-bold":"bg-surface-muted text-ink hover:bg-surface"}`,children:"Svenska"}),J.jsx("button",{onClick:()=>u("en"),"aria-pressed":o==="en",className:`px-3 py-1 rounded-lg text-sm transition-colors ${o==="en"?"bg-accent text-white font-bold":"bg-surface-muted text-ink hover:bg-surface"}`,children:"English"})]})}function RA(){const{t:n}=O1();return J.jsxs("main",{className:"max-w-2xl mx-auto p-6 space-y-6",children:[J.jsx("h1",{className:"font-spectral text-3xl",children:"Settings"}),J.jsxs("section",{className:"card p-6 space-y-4",children:[J.jsx("h2",{className:"font-spectral text-xl",children:"Language"}),J.jsx("p",{className:"text-ink-muted",children:"Choose your preferred language for BADA."}),J.jsx(zA,{})]}),J.jsxs("section",{className:"card p-6 space-y-4",children:[J.jsx("h2",{className:"font-spectral text-xl",children:"Dark Mode"}),J.jsx("p",{className:"text-ink-muted",children:"Toggle dark mode from the user menu in the header."})]}),J.jsxs("section",{className:"card p-6 space-y-4",children:[J.jsx("h2",{className:"font-spectral text-xl",children:"Notifications"}),J.jsx("p",{className:"text-ink-muted",children:"Notification preferences will be available in a future update."})]}),J.jsx("div",{className:"pt-6",children:J.jsx(li,{to:"/",className:"inline-block px-4 py-2 rounded-lg bg-accent text-white hover:bg-accent/90",children:"← Back to map"})})]})}function DA(){return J.jsx(FS,{children:J.jsxs("div",{className:"min-h-screen",children:[J.jsx(LS,{}),J.jsx("main",{id:"main-content",className:"p-4",children:J.jsxs(x2,{children:[J.jsx(ia,{path:"/",element:J.jsx(tT,{})}),J.jsx(ia,{path:"/beach/:id",element:J.jsx(HT,{})}),J.jsx(ia,{path:"/login",element:J.jsx(vM,{})}),J.jsx(ia,{path:"/register",element:J.jsx(bM,{})}),J.jsx(ia,{path:"/about",element:J.jsx(hA,{})}),J.jsx(ia,{path:"/what-is-eu-beach",element:J.jsx(dA,{})}),J.jsx(ia,{path:"/terms",element:J.jsx(fA,{})}),J.jsx(ia,{path:"/contact",element:J.jsx(pA,{})}),J.jsxs(ia,{element:J.jsx(OS,{}),children:[J.jsx(ia,{path:"/favorites",element:J.jsx(uA,{})}),J.jsx(ia,{path:"/profile",element:J.jsx(mA,{})}),J.jsx(ia,{path:"/settings",element:J.jsx(RA,{})})]})]})})]})})}const Ar=n=>typeof n=="string",Vp=()=>{let n,o;const u=new Promise((m,b)=>{n=m,o=b});return u.resolve=n,u.reject=o,u},T0=n=>n==null?"":""+n,LA=(n,o,u)=>{n.forEach(m=>{o[m]&&(u[m]=o[m])})},FA=/###/g,P0=n=>n&&n.indexOf("###")>-1?n.replace(FA,"."):n,C0=n=>!n||Ar(n),Qp=(n,o,u)=>{const m=Ar(o)?o.split("."):o;let b=0;for(;b<m.length-1;){if(C0(n))return{};const P=P0(m[b]);!n[P]&&u&&(n[P]=new u),Object.prototype.hasOwnProperty.call(n,P)?n=n[P]:n={},++b}return C0(n)?{}:{obj:n,k:P0(m[b])}},E0=(n,o,u)=>{const{obj:m,k:b}=Qp(n,o,Object);if(m!==void 0||o.length===1){m[b]=u;return}let P=o[o.length-1],w=o.slice(0,o.length-1),l=Qp(n,w,Object);for(;l.obj===void 0&&w.length;)P=`${w[w.length-1]}.${P}`,w=w.slice(0,w.length-1),l=Qp(n,w,Object),l!=null&&l.obj&&typeof l.obj[`${l.k}.${P}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${P}`]=u},OA=(n,o,u,m)=>{const{obj:b,k:P}=Qp(n,o,Object);b[P]=b[P]||[],b[P].push(u)},jg=(n,o)=>{const{obj:u,k:m}=Qp(n,o);if(u&&Object.prototype.hasOwnProperty.call(u,m))return u[m]},jA=(n,o,u)=>{const m=jg(n,u);return m!==void 0?m:jg(o,u)},j1=(n,o,u)=>{for(const m in o)m!=="__proto__"&&m!=="constructor"&&(m in n?Ar(n[m])||n[m]instanceof String||Ar(o[m])||o[m]instanceof String?u&&(n[m]=o[m]):j1(n[m],o[m],u):n[m]=o[m]);return n},Sf=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var NA={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const BA=n=>Ar(n)?n.replace(/[&<>"'\/]/g,o=>NA[o]):n;class $A{constructor(o){this.capacity=o,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(o){const u=this.regExpMap.get(o);if(u!==void 0)return u;const m=new RegExp(o);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(o,m),this.regExpQueue.push(o),m}}const UA=[" ",",","?","!",";"],VA=new $A(20),ZA=(n,o,u)=>{o=o||"",u=u||"";const m=UA.filter(w=>o.indexOf(w)<0&&u.indexOf(w)<0);if(m.length===0)return!0;const b=VA.getRegExp(`(${m.map(w=>w==="?"?"\\?":w).join("|")})`);let P=!b.test(n);if(!P){const w=n.indexOf(u);w>0&&!b.test(n.substring(0,w))&&(P=!0)}return P},P_=(n,o,u=".")=>{if(!n)return;if(n[o])return Object.prototype.hasOwnProperty.call(n,o)?n[o]:void 0;const m=o.split(u);let b=n;for(let P=0;P<m.length;){if(!b||typeof b!="object")return;let w,l="";for(let L=P;L<m.length;++L)if(L!==P&&(l+=u),l+=m[L],w=b[l],w!==void 0){if(["string","number","boolean"].indexOf(typeof w)>-1&&L<m.length-1)continue;P+=L-P+1;break}b=w}return b},am=n=>n==null?void 0:n.replace("_","-"),GA={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,o){var u,m;(m=(u=console==null?void 0:console[n])==null?void 0:u.apply)==null||m.call(u,console,o)}};class Ng{constructor(o,u={}){this.init(o,u)}init(o,u={}){this.prefix=u.prefix||"i18next:",this.logger=o||GA,this.options=u,this.debug=u.debug}log(...o){return this.forward(o,"log","",!0)}warn(...o){return this.forward(o,"warn","",!0)}error(...o){return this.forward(o,"error","")}deprecate(...o){return this.forward(o,"warn","WARNING DEPRECATED: ",!0)}forward(o,u,m,b){return b&&!this.debug?null:(Ar(o[0])&&(o[0]=`${m}${this.prefix} ${o[0]}`),this.logger[u](o))}create(o){return new Ng(this.logger,{prefix:`${this.prefix}:${o}:`,...this.options})}clone(o){return o=o||this.options,o.prefix=o.prefix||this.prefix,new Ng(this.logger,o)}}var oc=new Ng;class ry{constructor(){this.observers={}}on(o,u){return o.split(" ").forEach(m=>{this.observers[m]||(this.observers[m]=new Map);const b=this.observers[m].get(u)||0;this.observers[m].set(u,b+1)}),this}off(o,u){if(this.observers[o]){if(!u){delete this.observers[o];return}this.observers[o].delete(u)}}emit(o,...u){this.observers[o]&&Array.from(this.observers[o].entries()).forEach(([b,P])=>{for(let w=0;w<P;w++)b(...u)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([b,P])=>{for(let w=0;w<P;w++)b.apply(b,[o,...u])})}}class k0 extends ry{constructor(o,u={ns:["translation"],defaultNS:"translation"}){super(),this.data=o||{},this.options=u,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(o){this.options.ns.indexOf(o)<0&&this.options.ns.push(o)}removeNamespaces(o){const u=this.options.ns.indexOf(o);u>-1&&this.options.ns.splice(u,1)}getResource(o,u,m,b={}){var B,V;const P=b.keySeparator!==void 0?b.keySeparator:this.options.keySeparator,w=b.ignoreJSONStructure!==void 0?b.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;o.indexOf(".")>-1?l=o.split("."):(l=[o,u],m&&(Array.isArray(m)?l.push(...m):Ar(m)&&P?l.push(...m.split(P)):l.push(m)));const L=jg(this.data,l);return!L&&!u&&!m&&o.indexOf(".")>-1&&(o=l[0],u=l[1],m=l.slice(2).join(".")),L||!w||!Ar(m)?L:P_((V=(B=this.data)==null?void 0:B[o])==null?void 0:V[u],m,P)}addResource(o,u,m,b,P={silent:!1}){const w=P.keySeparator!==void 0?P.keySeparator:this.options.keySeparator;let l=[o,u];m&&(l=l.concat(w?m.split(w):m)),o.indexOf(".")>-1&&(l=o.split("."),b=u,u=l[1]),this.addNamespaces(u),E0(this.data,l,b),P.silent||this.emit("added",o,u,m,b)}addResources(o,u,m,b={silent:!1}){for(const P in m)(Ar(m[P])||Array.isArray(m[P]))&&this.addResource(o,u,P,m[P],{silent:!0});b.silent||this.emit("added",o,u,m)}addResourceBundle(o,u,m,b,P,w={silent:!1,skipCopy:!1}){let l=[o,u];o.indexOf(".")>-1&&(l=o.split("."),b=m,m=u,u=l[1]),this.addNamespaces(u);let L=jg(this.data,l)||{};w.skipCopy||(m=JSON.parse(JSON.stringify(m))),b?j1(L,m,P):L={...L,...m},E0(this.data,l,L),w.silent||this.emit("added",o,u,m)}removeResourceBundle(o,u){this.hasResourceBundle(o,u)&&delete this.data[o][u],this.removeNamespaces(u),this.emit("removed",o,u)}hasResourceBundle(o,u){return this.getResource(o,u)!==void 0}getResourceBundle(o,u){return u||(u=this.options.defaultNS),this.getResource(o,u)}getDataByLanguage(o){return this.data[o]}hasLanguageSomeTranslations(o){const u=this.getDataByLanguage(o);return!!(u&&Object.keys(u)||[]).find(b=>u[b]&&Object.keys(u[b]).length>0)}toJSON(){return this.data}}var N1={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,o,u,m,b){return n.forEach(P=>{var w;o=((w=this.processors[P])==null?void 0:w.process(o,u,m,b))??o}),o}};const B1=Symbol("i18next/PATH_KEY");function qA(){const n=[],o=Object.create(null);let u;return o.get=(m,b)=>{var P;return(P=u==null?void 0:u.revoke)==null||P.call(u),b===B1?n:(n.push(b),u=Proxy.revocable(m,o),u.proxy)},Proxy.revocable(Object.create(null),o).proxy}function C_(n,o){const{[B1]:u}=n(qA());return u.join((o==null?void 0:o.keySeparator)??".")}const M0={},I0=n=>!Ar(n)&&typeof n!="boolean"&&typeof n!="number";class Bg extends ry{constructor(o,u={}){super(),LA(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],o,this),this.options=u,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=oc.create("translator")}changeLanguage(o){o&&(this.language=o)}exists(o,u={interpolation:{}}){const m={...u};if(o==null)return!1;const b=this.resolve(o,m);return(b==null?void 0:b.res)!==void 0}extractFromKey(o,u){let m=u.nsSeparator!==void 0?u.nsSeparator:this.options.nsSeparator;m===void 0&&(m=":");const b=u.keySeparator!==void 0?u.keySeparator:this.options.keySeparator;let P=u.ns||this.options.defaultNS||[];const w=m&&o.indexOf(m)>-1,l=!this.options.userDefinedKeySeparator&&!u.keySeparator&&!this.options.userDefinedNsSeparator&&!u.nsSeparator&&!ZA(o,m,b);if(w&&!l){const L=o.match(this.interpolator.nestingRegexp);if(L&&L.length>0)return{key:o,namespaces:Ar(P)?[P]:P};const B=o.split(m);(m!==b||m===b&&this.options.ns.indexOf(B[0])>-1)&&(P=B.shift()),o=B.join(b)}return{key:o,namespaces:Ar(P)?[P]:P}}translate(o,u,m){let b=typeof u=="object"?{...u}:u;if(typeof b!="object"&&this.options.overloadTranslationOptionHandler&&(b=this.options.overloadTranslationOptionHandler(arguments)),typeof b=="object"&&(b={...b}),b||(b={}),o==null)return"";typeof o=="function"&&(o=C_(o,{...this.options,...b})),Array.isArray(o)||(o=[String(o)]);const P=b.returnDetails!==void 0?b.returnDetails:this.options.returnDetails,w=b.keySeparator!==void 0?b.keySeparator:this.options.keySeparator,{key:l,namespaces:L}=this.extractFromKey(o[o.length-1],b),B=L[L.length-1];let V=b.nsSeparator!==void 0?b.nsSeparator:this.options.nsSeparator;V===void 0&&(V=":");const G=b.lng||this.language,te=b.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((G==null?void 0:G.toLowerCase())==="cimode")return te?P?{res:`${B}${V}${l}`,usedKey:l,exactUsedKey:l,usedLng:G,usedNS:B,usedParams:this.getUsedParamsDetails(b)}:`${B}${V}${l}`:P?{res:l,usedKey:l,exactUsedKey:l,usedLng:G,usedNS:B,usedParams:this.getUsedParamsDetails(b)}:l;const q=this.resolve(o,b);let Se=q==null?void 0:q.res;const ye=(q==null?void 0:q.usedKey)||l,fe=(q==null?void 0:q.exactUsedKey)||l,Fe=["[object Number]","[object Function]","[object RegExp]"],Ce=b.joinArrays!==void 0?b.joinArrays:this.options.joinArrays,Ie=!this.i18nFormat||this.i18nFormat.handleAsObject,Le=b.count!==void 0&&!Ar(b.count),Xe=Bg.hasDefaultValue(b),mt=Le?this.pluralResolver.getSuffix(G,b.count,b):"",yt=b.ordinal&&Le?this.pluralResolver.getSuffix(G,b.count,{ordinal:!1}):"",Qe=Le&&!b.ordinal&&b.count===0,it=Qe&&b[`defaultValue${this.options.pluralSeparator}zero`]||b[`defaultValue${mt}`]||b[`defaultValue${yt}`]||b.defaultValue;let at=Se;Ie&&!Se&&Xe&&(at=it);const It=I0(at),Rt=Object.prototype.toString.apply(at);if(Ie&&at&&It&&Fe.indexOf(Rt)<0&&!(Ar(Ce)&&Array.isArray(at))){if(!b.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const At=this.options.returnedObjectHandler?this.options.returnedObjectHandler(ye,at,{...b,ns:L}):`key '${l} (${this.language})' returned an object instead of string.`;return P?(q.res=At,q.usedParams=this.getUsedParamsDetails(b),q):At}if(w){const At=Array.isArray(at),Ht=At?[]:{},Rr=At?fe:ye;for(const ar in at)if(Object.prototype.hasOwnProperty.call(at,ar)){const Zt=`${Rr}${w}${ar}`;Xe&&!Se?Ht[ar]=this.translate(Zt,{...b,defaultValue:I0(it)?it[ar]:void 0,joinArrays:!1,ns:L}):Ht[ar]=this.translate(Zt,{...b,joinArrays:!1,ns:L}),Ht[ar]===Zt&&(Ht[ar]=at[ar])}Se=Ht}}else if(Ie&&Ar(Ce)&&Array.isArray(Se))Se=Se.join(Ce),Se&&(Se=this.extendTranslation(Se,o,b,m));else{let At=!1,Ht=!1;!this.isValidLookup(Se)&&Xe&&(At=!0,Se=it),this.isValidLookup(Se)||(Ht=!0,Se=l);const ar=(b.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Ht?void 0:Se,Zt=Xe&&it!==Se&&this.options.updateMissing;if(Ht||At||Zt){if(this.logger.log(Zt?"updateKey":"missingKey",G,B,l,Zt?it:Se),w){const Me=this.resolve(l,{...b,keySeparator:!1});Me&&Me.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let _t=[];const ht=this.languageUtils.getFallbackCodes(this.options.fallbackLng,b.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ht&&ht[0])for(let Me=0;Me<ht.length;Me++)_t.push(ht[Me]);else this.options.saveMissingTo==="all"?_t=this.languageUtils.toResolveHierarchy(b.lng||this.language):_t.push(b.lng||this.language);const Ct=(Me,Ye,jt)=>{var fr;const tr=Xe&&jt!==Se?jt:ar;this.options.missingKeyHandler?this.options.missingKeyHandler(Me,B,Ye,tr,Zt,b):(fr=this.backendConnector)!=null&&fr.saveMissing&&this.backendConnector.saveMissing(Me,B,Ye,tr,Zt,b),this.emit("missingKey",Me,B,Ye,Se)};this.options.saveMissing&&(this.options.saveMissingPlurals&&Le?_t.forEach(Me=>{const Ye=this.pluralResolver.getSuffixes(Me,b);Qe&&b[`defaultValue${this.options.pluralSeparator}zero`]&&Ye.indexOf(`${this.options.pluralSeparator}zero`)<0&&Ye.push(`${this.options.pluralSeparator}zero`),Ye.forEach(jt=>{Ct([Me],l+jt,b[`defaultValue${jt}`]||it)})}):Ct(_t,l,it))}Se=this.extendTranslation(Se,o,b,q,m),Ht&&Se===l&&this.options.appendNamespaceToMissingKey&&(Se=`${B}${V}${l}`),(Ht||At)&&this.options.parseMissingKeyHandler&&(Se=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${B}${V}${l}`:l,At?Se:void 0,b))}return P?(q.res=Se,q.usedParams=this.getUsedParamsDetails(b),q):Se}extendTranslation(o,u,m,b,P){var L,B;if((L=this.i18nFormat)!=null&&L.parse)o=this.i18nFormat.parse(o,{...this.options.interpolation.defaultVariables,...m},m.lng||this.language||b.usedLng,b.usedNS,b.usedKey,{resolved:b});else if(!m.skipInterpolation){m.interpolation&&this.interpolator.init({...m,interpolation:{...this.options.interpolation,...m.interpolation}});const V=Ar(o)&&(((B=m==null?void 0:m.interpolation)==null?void 0:B.skipOnVariables)!==void 0?m.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let G;if(V){const q=o.match(this.interpolator.nestingRegexp);G=q&&q.length}let te=m.replace&&!Ar(m.replace)?m.replace:m;if(this.options.interpolation.defaultVariables&&(te={...this.options.interpolation.defaultVariables,...te}),o=this.interpolator.interpolate(o,te,m.lng||this.language||b.usedLng,m),V){const q=o.match(this.interpolator.nestingRegexp),Se=q&&q.length;G<Se&&(m.nest=!1)}!m.lng&&b&&b.res&&(m.lng=this.language||b.usedLng),m.nest!==!1&&(o=this.interpolator.nest(o,(...q)=>(P==null?void 0:P[0])===q[0]&&!m.context?(this.logger.warn(`It seems you are nesting recursively key: ${q[0]} in key: ${u[0]}`),null):this.translate(...q,u),m)),m.interpolation&&this.interpolator.reset()}const w=m.postProcess||this.options.postProcess,l=Ar(w)?[w]:w;return o!=null&&(l!=null&&l.length)&&m.applyPostProcessor!==!1&&(o=N1.handle(l,o,u,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...b,usedParams:this.getUsedParamsDetails(m)},...m}:m,this)),o}resolve(o,u={}){let m,b,P,w,l;return Ar(o)&&(o=[o]),o.forEach(L=>{if(this.isValidLookup(m))return;const B=this.extractFromKey(L,u),V=B.key;b=V;let G=B.namespaces;this.options.fallbackNS&&(G=G.concat(this.options.fallbackNS));const te=u.count!==void 0&&!Ar(u.count),q=te&&!u.ordinal&&u.count===0,Se=u.context!==void 0&&(Ar(u.context)||typeof u.context=="number")&&u.context!=="",ye=u.lngs?u.lngs:this.languageUtils.toResolveHierarchy(u.lng||this.language,u.fallbackLng);G.forEach(fe=>{var Fe,Ce;this.isValidLookup(m)||(l=fe,!M0[`${ye[0]}-${fe}`]&&((Fe=this.utils)!=null&&Fe.hasLoadedNamespace)&&!((Ce=this.utils)!=null&&Ce.hasLoadedNamespace(l))&&(M0[`${ye[0]}-${fe}`]=!0,this.logger.warn(`key "${b}" for languages "${ye.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),ye.forEach(Ie=>{var mt;if(this.isValidLookup(m))return;w=Ie;const Le=[V];if((mt=this.i18nFormat)!=null&&mt.addLookupKeys)this.i18nFormat.addLookupKeys(Le,V,Ie,fe,u);else{let yt;te&&(yt=this.pluralResolver.getSuffix(Ie,u.count,u));const Qe=`${this.options.pluralSeparator}zero`,it=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(te&&(u.ordinal&&yt.indexOf(it)===0&&Le.push(V+yt.replace(it,this.options.pluralSeparator)),Le.push(V+yt),q&&Le.push(V+Qe)),Se){const at=`${V}${this.options.contextSeparator||"_"}${u.context}`;Le.push(at),te&&(u.ordinal&&yt.indexOf(it)===0&&Le.push(at+yt.replace(it,this.options.pluralSeparator)),Le.push(at+yt),q&&Le.push(at+Qe))}}let Xe;for(;Xe=Le.pop();)this.isValidLookup(m)||(P=Xe,m=this.getResource(Ie,fe,Xe,u))}))})}),{res:m,usedKey:b,exactUsedKey:P,usedLng:w,usedNS:l}}isValidLookup(o){return o!==void 0&&!(!this.options.returnNull&&o===null)&&!(!this.options.returnEmptyString&&o==="")}getResource(o,u,m,b={}){var P;return(P=this.i18nFormat)!=null&&P.getResource?this.i18nFormat.getResource(o,u,m,b):this.resourceStore.getResource(o,u,m,b)}getUsedParamsDetails(o={}){const u=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],m=o.replace&&!Ar(o.replace);let b=m?o.replace:o;if(m&&typeof o.count<"u"&&(b.count=o.count),this.options.interpolation.defaultVariables&&(b={...this.options.interpolation.defaultVariables,...b}),!m){b={...b};for(const P of u)delete b[P]}return b}static hasDefaultValue(o){const u="defaultValue";for(const m in o)if(Object.prototype.hasOwnProperty.call(o,m)&&u===m.substring(0,u.length)&&o[m]!==void 0)return!0;return!1}}class A0{constructor(o){this.options=o,this.supportedLngs=this.options.supportedLngs||!1,this.logger=oc.create("languageUtils")}getScriptPartFromCode(o){if(o=am(o),!o||o.indexOf("-")<0)return null;const u=o.split("-");return u.length===2||(u.pop(),u[u.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(u.join("-"))}getLanguagePartFromCode(o){if(o=am(o),!o||o.indexOf("-")<0)return o;const u=o.split("-");return this.formatLanguageCode(u[0])}formatLanguageCode(o){if(Ar(o)&&o.indexOf("-")>-1){let u;try{u=Intl.getCanonicalLocales(o)[0]}catch{}return u&&this.options.lowerCaseLng&&(u=u.toLowerCase()),u||(this.options.lowerCaseLng?o.toLowerCase():o)}return this.options.cleanCode||this.options.lowerCaseLng?o.toLowerCase():o}isSupportedCode(o){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(o=this.getLanguagePartFromCode(o)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(o)>-1}getBestMatchFromCodes(o){if(!o)return null;let u;return o.forEach(m=>{if(u)return;const b=this.formatLanguageCode(m);(!this.options.supportedLngs||this.isSupportedCode(b))&&(u=b)}),!u&&this.options.supportedLngs&&o.forEach(m=>{if(u)return;const b=this.getScriptPartFromCode(m);if(this.isSupportedCode(b))return u=b;const P=this.getLanguagePartFromCode(m);if(this.isSupportedCode(P))return u=P;u=this.options.supportedLngs.find(w=>{if(w===P)return w;if(!(w.indexOf("-")<0&&P.indexOf("-")<0)&&(w.indexOf("-")>0&&P.indexOf("-")<0&&w.substring(0,w.indexOf("-"))===P||w.indexOf(P)===0&&P.length>1))return w})}),u||(u=this.getFallbackCodes(this.options.fallbackLng)[0]),u}getFallbackCodes(o,u){if(!o)return[];if(typeof o=="function"&&(o=o(u)),Ar(o)&&(o=[o]),Array.isArray(o))return o;if(!u)return o.default||[];let m=o[u];return m||(m=o[this.getScriptPartFromCode(u)]),m||(m=o[this.formatLanguageCode(u)]),m||(m=o[this.getLanguagePartFromCode(u)]),m||(m=o.default),m||[]}toResolveHierarchy(o,u){const m=this.getFallbackCodes((u===!1?[]:u)||this.options.fallbackLng||[],o),b=[],P=w=>{w&&(this.isSupportedCode(w)?b.push(w):this.logger.warn(`rejecting language code not found in supportedLngs: ${w}`))};return Ar(o)&&(o.indexOf("-")>-1||o.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&P(this.formatLanguageCode(o)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&P(this.getScriptPartFromCode(o)),this.options.load!=="currentOnly"&&P(this.getLanguagePartFromCode(o))):Ar(o)&&P(this.formatLanguageCode(o)),m.forEach(w=>{b.indexOf(w)<0&&P(this.formatLanguageCode(w))}),b}}const z0={zero:0,one:1,two:2,few:3,many:4,other:5},R0={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class WA{constructor(o,u={}){this.languageUtils=o,this.options=u,this.logger=oc.create("pluralResolver"),this.pluralRulesCache={}}addRule(o,u){this.rules[o]=u}clearCache(){this.pluralRulesCache={}}getRule(o,u={}){const m=am(o==="dev"?"en":o),b=u.ordinal?"ordinal":"cardinal",P=JSON.stringify({cleanedCode:m,type:b});if(P in this.pluralRulesCache)return this.pluralRulesCache[P];let w;try{w=new Intl.PluralRules(m,{type:b})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),R0;if(!o.match(/-|_/))return R0;const L=this.languageUtils.getLanguagePartFromCode(o);w=this.getRule(L,u)}return this.pluralRulesCache[P]=w,w}needsPlural(o,u={}){let m=this.getRule(o,u);return m||(m=this.getRule("dev",u)),(m==null?void 0:m.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(o,u,m={}){return this.getSuffixes(o,m).map(b=>`${u}${b}`)}getSuffixes(o,u={}){let m=this.getRule(o,u);return m||(m=this.getRule("dev",u)),m?m.resolvedOptions().pluralCategories.sort((b,P)=>z0[b]-z0[P]).map(b=>`${this.options.prepend}${u.ordinal?`ordinal${this.options.prepend}`:""}${b}`):[]}getSuffix(o,u,m={}){const b=this.getRule(o,m);return b?`${this.options.prepend}${m.ordinal?`ordinal${this.options.prepend}`:""}${b.select(u)}`:(this.logger.warn(`no plural rule found for: ${o}`),this.getSuffix("dev",u,m))}}const D0=(n,o,u,m=".",b=!0)=>{let P=jA(n,o,u);return!P&&b&&Ar(u)&&(P=P_(n,u,m),P===void 0&&(P=P_(o,u,m))),P},Ny=n=>n.replace(/\$/g,"$$$$");class HA{constructor(o={}){var u;this.logger=oc.create("interpolator"),this.options=o,this.format=((u=o==null?void 0:o.interpolation)==null?void 0:u.format)||(m=>m),this.init(o)}init(o={}){o.interpolation||(o.interpolation={escapeValue:!0});const{escape:u,escapeValue:m,useRawValueToEscape:b,prefix:P,prefixEscaped:w,suffix:l,suffixEscaped:L,formatSeparator:B,unescapeSuffix:V,unescapePrefix:G,nestingPrefix:te,nestingPrefixEscaped:q,nestingSuffix:Se,nestingSuffixEscaped:ye,nestingOptionsSeparator:fe,maxReplaces:Fe,alwaysFormat:Ce}=o.interpolation;this.escape=u!==void 0?u:BA,this.escapeValue=m!==void 0?m:!0,this.useRawValueToEscape=b!==void 0?b:!1,this.prefix=P?Sf(P):w||"{{",this.suffix=l?Sf(l):L||"}}",this.formatSeparator=B||",",this.unescapePrefix=V?"":G||"-",this.unescapeSuffix=this.unescapePrefix?"":V||"",this.nestingPrefix=te?Sf(te):q||Sf("$t("),this.nestingSuffix=Se?Sf(Se):ye||Sf(")"),this.nestingOptionsSeparator=fe||",",this.maxReplaces=Fe||1e3,this.alwaysFormat=Ce!==void 0?Ce:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const o=(u,m)=>(u==null?void 0:u.source)===m?(u.lastIndex=0,u):new RegExp(m,"g");this.regexp=o(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=o(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=o(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(o,u,m,b){var q;let P,w,l;const L=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},B=Se=>{if(Se.indexOf(this.formatSeparator)<0){const Ce=D0(u,L,Se,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(Ce,void 0,m,{...b,...u,interpolationkey:Se}):Ce}const ye=Se.split(this.formatSeparator),fe=ye.shift().trim(),Fe=ye.join(this.formatSeparator).trim();return this.format(D0(u,L,fe,this.options.keySeparator,this.options.ignoreJSONStructure),Fe,m,{...b,...u,interpolationkey:fe})};this.resetRegExp();const V=(b==null?void 0:b.missingInterpolationHandler)||this.options.missingInterpolationHandler,G=((q=b==null?void 0:b.interpolation)==null?void 0:q.skipOnVariables)!==void 0?b.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:Se=>Ny(Se)},{regex:this.regexp,safeValue:Se=>this.escapeValue?Ny(this.escape(Se)):Ny(Se)}].forEach(Se=>{for(l=0;P=Se.regex.exec(o);){const ye=P[1].trim();if(w=B(ye),w===void 0)if(typeof V=="function"){const Fe=V(o,P,b);w=Ar(Fe)?Fe:""}else if(b&&Object.prototype.hasOwnProperty.call(b,ye))w="";else if(G){w=P[0];continue}else this.logger.warn(`missed to pass in variable ${ye} for interpolating ${o}`),w="";else!Ar(w)&&!this.useRawValueToEscape&&(w=T0(w));const fe=Se.safeValue(w);if(o=o.replace(P[0],fe),G?(Se.regex.lastIndex+=w.length,Se.regex.lastIndex-=P[0].length):Se.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),o}nest(o,u,m={}){let b,P,w;const l=(L,B)=>{const V=this.nestingOptionsSeparator;if(L.indexOf(V)<0)return L;const G=L.split(new RegExp(`${V}[ ]*{`));let te=`{${G[1]}`;L=G[0],te=this.interpolate(te,w);const q=te.match(/'/g),Se=te.match(/"/g);(((q==null?void 0:q.length)??0)%2===0&&!Se||Se.length%2!==0)&&(te=te.replace(/'/g,'"'));try{w=JSON.parse(te),B&&(w={...B,...w})}catch(ye){return this.logger.warn(`failed parsing options string in nesting for key ${L}`,ye),`${L}${V}${te}`}return w.defaultValue&&w.defaultValue.indexOf(this.prefix)>-1&&delete w.defaultValue,L};for(;b=this.nestingRegexp.exec(o);){let L=[];w={...m},w=w.replace&&!Ar(w.replace)?w.replace:w,w.applyPostProcessor=!1,delete w.defaultValue;const B=/{.*}/.test(b[1])?b[1].lastIndexOf("}")+1:b[1].indexOf(this.formatSeparator);if(B!==-1&&(L=b[1].slice(B).split(this.formatSeparator).map(V=>V.trim()).filter(Boolean),b[1]=b[1].slice(0,B)),P=u(l.call(this,b[1].trim(),w),w),P&&b[0]===o&&!Ar(P))return P;Ar(P)||(P=T0(P)),P||(this.logger.warn(`missed to resolve ${b[1]} for nesting ${o}`),P=""),L.length&&(P=L.reduce((V,G)=>this.format(V,G,m.lng,{...m,interpolationkey:b[1].trim()}),P.trim())),o=o.replace(b[0],P),this.regexp.lastIndex=0}return o}}const KA=n=>{let o=n.toLowerCase().trim();const u={};if(n.indexOf("(")>-1){const m=n.split("(");o=m[0].toLowerCase().trim();const b=m[1].substring(0,m[1].length-1);o==="currency"&&b.indexOf(":")<0?u.currency||(u.currency=b.trim()):o==="relativetime"&&b.indexOf(":")<0?u.range||(u.range=b.trim()):b.split(";").forEach(w=>{if(w){const[l,...L]=w.split(":"),B=L.join(":").trim().replace(/^'+|'+$/g,""),V=l.trim();u[V]||(u[V]=B),B==="false"&&(u[V]=!1),B==="true"&&(u[V]=!0),isNaN(B)||(u[V]=parseInt(B,10))}})}return{formatName:o,formatOptions:u}},L0=n=>{const o={};return(u,m,b)=>{let P=b;b&&b.interpolationkey&&b.formatParams&&b.formatParams[b.interpolationkey]&&b[b.interpolationkey]&&(P={...P,[b.interpolationkey]:void 0});const w=m+JSON.stringify(P);let l=o[w];return l||(l=n(am(m),b),o[w]=l),l(u)}},XA=n=>(o,u,m)=>n(am(u),m)(o);class YA{constructor(o={}){this.logger=oc.create("formatter"),this.options=o,this.init(o)}init(o,u={interpolation:{}}){this.formatSeparator=u.interpolation.formatSeparator||",";const m=u.cacheInBuiltFormats?L0:XA;this.formats={number:m((b,P)=>{const w=new Intl.NumberFormat(b,{...P});return l=>w.format(l)}),currency:m((b,P)=>{const w=new Intl.NumberFormat(b,{...P,style:"currency"});return l=>w.format(l)}),datetime:m((b,P)=>{const w=new Intl.DateTimeFormat(b,{...P});return l=>w.format(l)}),relativetime:m((b,P)=>{const w=new Intl.RelativeTimeFormat(b,{...P});return l=>w.format(l,P.range||"day")}),list:m((b,P)=>{const w=new Intl.ListFormat(b,{...P});return l=>w.format(l)})}}add(o,u){this.formats[o.toLowerCase().trim()]=u}addCached(o,u){this.formats[o.toLowerCase().trim()]=L0(u)}format(o,u,m,b={}){const P=u.split(this.formatSeparator);if(P.length>1&&P[0].indexOf("(")>1&&P[0].indexOf(")")<0&&P.find(l=>l.indexOf(")")>-1)){const l=P.findIndex(L=>L.indexOf(")")>-1);P[0]=[P[0],...P.splice(1,l)].join(this.formatSeparator)}return P.reduce((l,L)=>{var G;const{formatName:B,formatOptions:V}=KA(L);if(this.formats[B]){let te=l;try{const q=((G=b==null?void 0:b.formatParams)==null?void 0:G[b.interpolationkey])||{},Se=q.locale||q.lng||b.locale||b.lng||m;te=this.formats[B](l,Se,{...V,...b,...q})}catch(q){this.logger.warn(q)}return te}else this.logger.warn(`there was no format function for ${B}`);return l},o)}}const QA=(n,o)=>{n.pending[o]!==void 0&&(delete n.pending[o],n.pendingCount--)};class JA extends ry{constructor(o,u,m,b={}){var P,w;super(),this.backend=o,this.store=u,this.services=m,this.languageUtils=m.languageUtils,this.options=b,this.logger=oc.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=b.maxParallelReads||10,this.readingCalls=0,this.maxRetries=b.maxRetries>=0?b.maxRetries:5,this.retryTimeout=b.retryTimeout>=1?b.retryTimeout:350,this.state={},this.queue=[],(w=(P=this.backend)==null?void 0:P.init)==null||w.call(P,m,b.backend,b)}queueLoad(o,u,m,b){const P={},w={},l={},L={};return o.forEach(B=>{let V=!0;u.forEach(G=>{const te=`${B}|${G}`;!m.reload&&this.store.hasResourceBundle(B,G)?this.state[te]=2:this.state[te]<0||(this.state[te]===1?w[te]===void 0&&(w[te]=!0):(this.state[te]=1,V=!1,w[te]===void 0&&(w[te]=!0),P[te]===void 0&&(P[te]=!0),L[G]===void 0&&(L[G]=!0)))}),V||(l[B]=!0)}),(Object.keys(P).length||Object.keys(w).length)&&this.queue.push({pending:w,pendingCount:Object.keys(w).length,loaded:{},errors:[],callback:b}),{toLoad:Object.keys(P),pending:Object.keys(w),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(L)}}loaded(o,u,m){const b=o.split("|"),P=b[0],w=b[1];u&&this.emit("failedLoading",P,w,u),!u&&m&&this.store.addResourceBundle(P,w,m,void 0,void 0,{skipCopy:!0}),this.state[o]=u?-1:2,u&&m&&(this.state[o]=0);const l={};this.queue.forEach(L=>{OA(L.loaded,[P],w),QA(L,o),u&&L.errors.push(u),L.pendingCount===0&&!L.done&&(Object.keys(L.loaded).forEach(B=>{l[B]||(l[B]={});const V=L.loaded[B];V.length&&V.forEach(G=>{l[B][G]===void 0&&(l[B][G]=!0)})}),L.done=!0,L.errors.length?L.callback(L.errors):L.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(L=>!L.done)}read(o,u,m,b=0,P=this.retryTimeout,w){if(!o.length)return w(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:o,ns:u,fcName:m,tried:b,wait:P,callback:w});return}this.readingCalls++;const l=(B,V)=>{if(this.readingCalls--,this.waitingReads.length>0){const G=this.waitingReads.shift();this.read(G.lng,G.ns,G.fcName,G.tried,G.wait,G.callback)}if(B&&V&&b<this.maxRetries){setTimeout(()=>{this.read.call(this,o,u,m,b+1,P*2,w)},P);return}w(B,V)},L=this.backend[m].bind(this.backend);if(L.length===2){try{const B=L(o,u);B&&typeof B.then=="function"?B.then(V=>l(null,V)).catch(l):l(null,B)}catch(B){l(B)}return}return L(o,u,l)}prepareLoading(o,u,m={},b){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),b&&b();Ar(o)&&(o=this.languageUtils.toResolveHierarchy(o)),Ar(u)&&(u=[u]);const P=this.queueLoad(o,u,m,b);if(!P.toLoad.length)return P.pending.length||b(),null;P.toLoad.forEach(w=>{this.loadOne(w)})}load(o,u,m){this.prepareLoading(o,u,{},m)}reload(o,u,m){this.prepareLoading(o,u,{reload:!0},m)}loadOne(o,u=""){const m=o.split("|"),b=m[0],P=m[1];this.read(b,P,"read",void 0,void 0,(w,l)=>{w&&this.logger.warn(`${u}loading namespace ${P} for language ${b} failed`,w),!w&&l&&this.logger.log(`${u}loaded namespace ${P} for language ${b}`,l),this.loaded(o,w,l)})}saveMissing(o,u,m,b,P,w={},l=()=>{}){var L,B,V,G,te;if((B=(L=this.services)==null?void 0:L.utils)!=null&&B.hasLoadedNamespace&&!((G=(V=this.services)==null?void 0:V.utils)!=null&&G.hasLoadedNamespace(u))){this.logger.warn(`did not save key "${m}" as the namespace "${u}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(m==null||m==="")){if((te=this.backend)!=null&&te.create){const q={...w,isUpdate:P},Se=this.backend.create.bind(this.backend);if(Se.length<6)try{let ye;Se.length===5?ye=Se(o,u,m,b,q):ye=Se(o,u,m,b),ye&&typeof ye.then=="function"?ye.then(fe=>l(null,fe)).catch(l):l(null,ye)}catch(ye){l(ye)}else Se(o,u,m,b,l,q)}!o||!o[0]||this.store.addResource(o[0],u,m,b)}}}const F0=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let o={};if(typeof n[1]=="object"&&(o=n[1]),Ar(n[1])&&(o.defaultValue=n[1]),Ar(n[2])&&(o.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const u=n[3]||n[2];Object.keys(u).forEach(m=>{o[m]=u[m]})}return o},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),O0=n=>{var o,u;return Ar(n.ns)&&(n.ns=[n.ns]),Ar(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),Ar(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),((u=(o=n.supportedLngs)==null?void 0:o.indexOf)==null?void 0:u.call(o,"cimode"))<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n},_g=()=>{},ez=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(u=>{typeof n[u]=="function"&&(n[u]=n[u].bind(n))})};class lm extends ry{constructor(o={},u){if(super(),this.options=O0(o),this.services={},this.logger=oc,this.modules={external:[]},ez(this),u&&!this.isInitialized&&!o.isClone){if(!this.options.initAsync)return this.init(o,u),this;setTimeout(()=>{this.init(o,u)},0)}}init(o={},u){this.isInitializing=!0,typeof o=="function"&&(u=o,o={}),o.defaultNS==null&&o.ns&&(Ar(o.ns)?o.defaultNS=o.ns:o.ns.indexOf("translation")<0&&(o.defaultNS=o.ns[0]));const m=F0();this.options={...m,...this.options,...O0(o)},this.options.interpolation={...m.interpolation,...this.options.interpolation},o.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=o.keySeparator),o.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=o.nsSeparator);const b=B=>B?typeof B=="function"?new B:B:null;if(!this.options.isClone){this.modules.logger?oc.init(b(this.modules.logger),this.options):oc.init(null,this.options);let B;this.modules.formatter?B=this.modules.formatter:B=YA;const V=new A0(this.options);this.store=new k0(this.options.resources,this.options);const G=this.services;G.logger=oc,G.resourceStore=this.store,G.languageUtils=V,G.pluralResolver=new WA(V,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==m.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),B&&(!this.options.interpolation.format||this.options.interpolation.format===m.interpolation.format)&&(G.formatter=b(B),G.formatter.init&&G.formatter.init(G,this.options),this.options.interpolation.format=G.formatter.format.bind(G.formatter)),G.interpolator=new HA(this.options),G.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},G.backendConnector=new JA(b(this.modules.backend),G.resourceStore,G,this.options),G.backendConnector.on("*",(q,...Se)=>{this.emit(q,...Se)}),this.modules.languageDetector&&(G.languageDetector=b(this.modules.languageDetector),G.languageDetector.init&&G.languageDetector.init(G,this.options.detection,this.options)),this.modules.i18nFormat&&(G.i18nFormat=b(this.modules.i18nFormat),G.i18nFormat.init&&G.i18nFormat.init(this)),this.translator=new Bg(this.services,this.options),this.translator.on("*",(q,...Se)=>{this.emit(q,...Se)}),this.modules.external.forEach(q=>{q.init&&q.init(this)})}if(this.format=this.options.interpolation.format,u||(u=_g),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const B=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);B.length>0&&B[0]!=="dev"&&(this.options.lng=B[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(B=>{this[B]=(...V)=>this.store[B](...V)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(B=>{this[B]=(...V)=>(this.store[B](...V),this)});const l=Vp(),L=()=>{const B=(V,G)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(G),u(V,G)};if(this.languages&&!this.isInitialized)return B(null,this.t.bind(this));this.changeLanguage(this.options.lng,B)};return this.options.resources||!this.options.initAsync?L():setTimeout(L,0),l}loadResources(o,u=_g){var P,w;let m=u;const b=Ar(o)?o:this.language;if(typeof o=="function"&&(m=o),!this.options.resources||this.options.partialBundledLanguages){if((b==null?void 0:b.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return m();const l=[],L=B=>{if(!B||B==="cimode")return;this.services.languageUtils.toResolveHierarchy(B).forEach(G=>{G!=="cimode"&&l.indexOf(G)<0&&l.push(G)})};b?L(b):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(V=>L(V)),(w=(P=this.options.preload)==null?void 0:P.forEach)==null||w.call(P,B=>L(B)),this.services.backendConnector.load(l,this.options.ns,B=>{!B&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),m(B)})}else m(null)}reloadResources(o,u,m){const b=Vp();return typeof o=="function"&&(m=o,o=void 0),typeof u=="function"&&(m=u,u=void 0),o||(o=this.languages),u||(u=this.options.ns),m||(m=_g),this.services.backendConnector.reload(o,u,P=>{b.resolve(),m(P)}),b}use(o){if(!o)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!o.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return o.type==="backend"&&(this.modules.backend=o),(o.type==="logger"||o.log&&o.warn&&o.error)&&(this.modules.logger=o),o.type==="languageDetector"&&(this.modules.languageDetector=o),o.type==="i18nFormat"&&(this.modules.i18nFormat=o),o.type==="postProcessor"&&N1.addPostProcessor(o),o.type==="formatter"&&(this.modules.formatter=o),o.type==="3rdParty"&&this.modules.external.push(o),this}setResolvedLanguage(o){if(!(!o||!this.languages)&&!(["cimode","dev"].indexOf(o)>-1)){for(let u=0;u<this.languages.length;u++){const m=this.languages[u];if(!(["cimode","dev"].indexOf(m)>-1)&&this.store.hasLanguageSomeTranslations(m)){this.resolvedLanguage=m;break}}!this.resolvedLanguage&&this.languages.indexOf(o)<0&&this.store.hasLanguageSomeTranslations(o)&&(this.resolvedLanguage=o,this.languages.unshift(o))}}changeLanguage(o,u){this.isLanguageChangingTo=o;const m=Vp();this.emit("languageChanging",o);const b=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},P=(l,L)=>{L?this.isLanguageChangingTo===o&&(b(L),this.translator.changeLanguage(L),this.isLanguageChangingTo=void 0,this.emit("languageChanged",L),this.logger.log("languageChanged",L)):this.isLanguageChangingTo=void 0,m.resolve((...B)=>this.t(...B)),u&&u(l,(...B)=>this.t(...B))},w=l=>{var V,G;!o&&!l&&this.services.languageDetector&&(l=[]);const L=Ar(l)?l:l&&l[0],B=this.store.hasLanguageSomeTranslations(L)?L:this.services.languageUtils.getBestMatchFromCodes(Ar(l)?[l]:l);B&&(this.language||b(B),this.translator.language||this.translator.changeLanguage(B),(G=(V=this.services.languageDetector)==null?void 0:V.cacheUserLanguage)==null||G.call(V,B)),this.loadResources(B,te=>{P(te,B)})};return!o&&this.services.languageDetector&&!this.services.languageDetector.async?w(this.services.languageDetector.detect()):!o&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(w):this.services.languageDetector.detect(w):w(o),m}getFixedT(o,u,m){const b=(P,w,...l)=>{let L;typeof w!="object"?L=this.options.overloadTranslationOptionHandler([P,w].concat(l)):L={...w},L.lng=L.lng||b.lng,L.lngs=L.lngs||b.lngs,L.ns=L.ns||b.ns,L.keyPrefix!==""&&(L.keyPrefix=L.keyPrefix||m||b.keyPrefix);const B=this.options.keySeparator||".";let V;return L.keyPrefix&&Array.isArray(P)?V=P.map(G=>(typeof G=="function"&&(G=C_(G,{...this.options,...w})),`${L.keyPrefix}${B}${G}`)):(typeof P=="function"&&(P=C_(P,{...this.options,...w})),V=L.keyPrefix?`${L.keyPrefix}${B}${P}`:P),this.t(V,L)};return Ar(o)?b.lng=o:b.lngs=o,b.ns=u,b.keyPrefix=m,b}t(...o){var u;return(u=this.translator)==null?void 0:u.translate(...o)}exists(...o){var u;return(u=this.translator)==null?void 0:u.exists(...o)}setDefaultNamespace(o){this.options.defaultNS=o}hasLoadedNamespace(o,u={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const m=u.lng||this.resolvedLanguage||this.languages[0],b=this.options?this.options.fallbackLng:!1,P=this.languages[this.languages.length-1];if(m.toLowerCase()==="cimode")return!0;const w=(l,L)=>{const B=this.services.backendConnector.state[`${l}|${L}`];return B===-1||B===0||B===2};if(u.precheck){const l=u.precheck(this,w);if(l!==void 0)return l}return!!(this.hasResourceBundle(m,o)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||w(m,o)&&(!b||w(P,o)))}loadNamespaces(o,u){const m=Vp();return this.options.ns?(Ar(o)&&(o=[o]),o.forEach(b=>{this.options.ns.indexOf(b)<0&&this.options.ns.push(b)}),this.loadResources(b=>{m.resolve(),u&&u(b)}),m):(u&&u(),Promise.resolve())}loadLanguages(o,u){const m=Vp();Ar(o)&&(o=[o]);const b=this.options.preload||[],P=o.filter(w=>b.indexOf(w)<0&&this.services.languageUtils.isSupportedCode(w));return P.length?(this.options.preload=b.concat(P),this.loadResources(w=>{m.resolve(),u&&u(w)}),m):(u&&u(),Promise.resolve())}dir(o){var b,P;if(o||(o=this.resolvedLanguage||(((b=this.languages)==null?void 0:b.length)>0?this.languages[0]:this.language)),!o)return"rtl";try{const w=new Intl.Locale(o);if(w&&w.getTextInfo){const l=w.getTextInfo();if(l&&l.direction)return l.direction}}catch{}const u=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],m=((P=this.services)==null?void 0:P.languageUtils)||new A0(F0());return o.toLowerCase().indexOf("-latn")>1?"ltr":u.indexOf(m.getLanguagePartFromCode(o))>-1||o.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(o={},u){return new lm(o,u)}cloneInstance(o={},u=_g){const m=o.forkResourceStore;m&&delete o.forkResourceStore;const b={...this.options,...o,isClone:!0},P=new lm(b);if((o.debug!==void 0||o.prefix!==void 0)&&(P.logger=P.logger.clone(o)),["store","services","language"].forEach(l=>{P[l]=this[l]}),P.services={...this.services},P.services.utils={hasLoadedNamespace:P.hasLoadedNamespace.bind(P)},m){const l=Object.keys(this.store.data).reduce((L,B)=>(L[B]={...this.store.data[B]},L[B]=Object.keys(L[B]).reduce((V,G)=>(V[G]={...L[B][G]},V),L[B]),L),{});P.store=new k0(l,b),P.services.resourceStore=P.store}return P.translator=new Bg(P.services,b),P.translator.on("*",(l,...L)=>{P.emit(l,...L)}),P.init(b,u),P.translator.options=b,P.translator.backendConnector.services.utils={hasLoadedNamespace:P.hasLoadedNamespace.bind(P)},P}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const hs=lm.createInstance();hs.createInstance=lm.createInstance;hs.createInstance;hs.dir;hs.init;hs.loadResources;hs.reloadResources;hs.use;hs.changeLanguage;hs.getFixedT;hs.t;hs.exists;hs.setDefaultNamespace;hs.hasLoadedNamespace;hs.loadNamespaces;hs.loadLanguages;const tz="BADA",rz="Badplatser",nz="Laddar badplatser…",iz="Kunde inte ladda data.",sz="Tillbaka",oz="Vattenkvalitet",az="Senaste år",lz="Koordinater",cz="Kommun",uz={excellent:"Utmärkt kvalitet",good:"Bra kvalitet",sufficient:"Tillfredsställande kvalitet",poor:"Dålig kvalitet",unknown:"Okänd"},hz="Källtext på svenska",dz={appTitle:tz,beaches:rz,loadingBeaches:nz,loadError:iz,back:sz,waterQuality:oz,latestYear:az,coordinates:lz,municipality:cz,classification:uz,sourceTextNote:hz},fz="BADA",pz="Beaches",mz="Loading beaches…",gz="Could not load data.",yz="Back",_z="Water quality",vz="Latest year",xz="Coordinates",bz="Municipality",wz={excellent:"Excellent",good:"Good",sufficient:"Sufficient",poor:"Poor",unknown:"Unknown"},Sz="Source text in Swedish",Tz={appTitle:fz,beaches:pz,loadingBeaches:mz,loadError:gz,back:yz,waterQuality:_z,latestYear:vz,coordinates:xz,municipality:bz,classification:wz,sourceTextNote:Sz},Pz=localStorage.getItem("lang"),$1="sv",Cz=Pz||$1;hs.use(EA).init({resources:{sv:{common:dz},en:{common:Tz}},lng:Cz,fallbackLng:$1,ns:["common"],defaultNS:"common",interpolation:{escapeValue:!1}});const Ez=new CS;hs.on("languageChanged",n=>{document.documentElement.lang=n});document.documentElement.lang=hs.language;Pw.createRoot(document.getElementById("root")).render(J.jsx(hn.StrictMode,{children:J.jsx(ES,{client:Ez,children:J.jsxs(V2,{children:[J.jsx(DA,{}),J.jsx(VT,{position:"top-center",toastOptions:{duration:3e3,style:{background:"var(--color-surface-muted)",color:"var(--color-ink)",border:"1px solid var(--color-border)",borderRadius:"16px"},success:{iconTheme:{primary:"var(--color-accent)",secondary:"var(--color-surface-muted)"}},error:{iconTheme:{primary:"var(--color-quality-poor)",secondary:"var(--color-surface-muted)"}}}})]})})}));
